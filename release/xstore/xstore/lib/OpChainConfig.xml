<?xml version="1.0" encoding="UTF-8"?>
<OpChainSet xmlns="http://micros.com/xstore/config/opchain">
  <!-- A reference to this chain cannot be used everywhere receipts need to print, as there is
       sometimes good reason to interject other operations between these operations.  However,
       for all less complicated scenarios that do not have sufficient extenuating circumstances
       for splitting up the immediately consecutive execution of these operations, this chain
       can be referenced.  The bottom line is if you see a chain that has these operations split,
       be completely sure that they are not split for a reason before replacing them with a
       reference to this chain. -->
  <OpChain name="PRINT_RECEIPTS">
    <Op class="dtv.pos.hardware.op.BuildRcptsOp" />
    <WorkerOp workersBean="emailRcptsWorkers" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <WorkerOp workersBean="saveRcptsWorkers" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
  </OpChain>
  <OpChain name="PRINT_FISCAL_RECEIPTS.local">
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.pre" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.post" />
  </OpChain>
  <OpChain name="PRINT_FISCAL_RECEIPTS.pre" />
  <OpChain name="PRINT_FISCAL_RECEIPTS.post" />
  <OpChain name="ROLLBACK_TRAINING_TRANS">
    <OpChainRoute chainKey="CANCEL_TRANSACTION" chainType="START" condition="dtv.pos.register.condition.NoTransRunCondition" />
    <OpChainRoute chainKey="CANCEL_NO_TRANSACTION" chainType="START" />
  </OpChain>
  <OpChain name="TRAINING_MODE_ENTER" signal="TransactionComplete" rollbackChainKey="ROLLBACK_TRAINING_TRANS">
    <PromptOp class="dtv.pos.assistance.TrainingDatabaseRestoringPromptOp"/>
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="PROMPT_WISH_TO_ENTER_TRAINING_MODE" />
    <Op class="dtv.pos.assistance.CreateTrainingTransactionOp">
      <Parameter name="MODE" value="ENTER" />
    </Op>
    <OpChainRoute chainKey="TRAINING_MODE_ENTER.local" />
    <Op class="dtv.pos.assistance.EnterTrainingModeOp" />
    <Op class="dtv.pos.assistance.ReinitializeSessionManagerOp" />
    <Op class="dtv.pos.hardware.op.BuildRcptsOp" />
    <WorkerOp workersBean="emailRcptsWorkers" />
    <Op class="dtv.pos.assistance.TrainingEnterExitPrintRcptsOp" />
    <WorkerOp workersBean="saveRcptsWorkers" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
    <Op class="dtv.pos.systemcycle.access.SynchStateJournalOp">
      <Parameter name="SilentChange" value="true" />
    </Op>
    <Op class="dtv.pos.systemcycle.common.RefreshScreenIndicatorsOp" />
    <Op class="dtv.pos.framework.op.OpChainRollbackToTopOp" />
  </OpChain>
  <OpChain name="TRAINING_MODE_ENTER.local">
    <Op class="dtv.pos.hardware.op.CompleteFiscalTransactionOp" longRunning="true" />
  </OpChain>
  <OpChain name="TRAINING_MODE_EXIT" signal="TransactionComplete" rollbackChainKey="ROLLBACK_TRAINING_TRANS">
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="PROMPT_WISH_TO_EXIT_TRAINING_MODE" />
    <Op class="dtv.pos.assistance.ExitTrainingModeOp" />
    <Op class="dtv.pos.assistance.ReinitializeSessionManagerOp" />
    <Op class="dtv.pos.systemcycle.access.SynchStateJournalOp">
      <Parameter name="SilentChange" value="true" />
    </Op>
    <Op class="dtv.pos.assistance.CreateTrainingTransactionOp">
      <Parameter name="MODE" value="EXIT" />
    </Op>
    <OpChainRoute chainKey="TRAINING_MODE_EXIT.local" />
    <Op class="dtv.pos.hardware.op.BuildRcptsOp" />
    <WorkerOp workersBean="emailRcptsWorkers" />
    <Op class="dtv.pos.assistance.TrainingEnterExitPrintRcptsOp" />
    <WorkerOp workersBean="saveRcptsWorkers" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
    <Op class="dtv.pos.common.ClearPersistablesBagOp" />    
    <OpChainRoute chainKey="TRAINING_MODE_EXIT.local.complete" />
    <Op class="dtv.pos.systemcycle.common.RefreshScreenIndicatorsOp" />
    <Op class="dtv.pos.framework.op.OpChainRollbackToTopOp" />
  </OpChain>
  <OpChain name="TRAINING_MODE_EXIT.local">
    <Op class="dtv.pos.hardware.op.CompleteFiscalTransactionOp" longRunning="true" />
  </OpChain>
  <OpChain name="TRAINING_MODE_EXIT.local.complete" />
  <OpChain name="DO_NOTHING">
    <Op class="dtv.pos.framework.op.DoNothingOp" />
  </OpChain>
  <OpChain name="INVALID_INPUT">
    <Op class="dtv.pos.hardware.op.InvalidInputNotifyOp" />
  </OpChain>
  <OpChain name="INVALID_CREDIT_CARD_SWIPE">
    <Op class="dtv.pos.hardware.op.InvalidCreditCardSwipeOp" />
  </OpChain>
  <OpChain name="BAD_CARD_READ">
    <!-- this could be used instead of the base BadCardReadNotifyOp
    <PromptOp key="BAD_CARD_READ" />
     -->
    <Op class="dtv.pos.hardware.op.BadCardReadNotifyOp" />
  </OpChain>
  <OpChain name="BAD_CHECK_READ">
    <PromptOp key="BAD_CHECK_READ" />
  </OpChain>
  <OpChain name="CANCEL_DENIED">
    <Op class="dtv.pos.register.CancelDeniedOp" />
  </OpChain>

  <OpChain name="REGISTER_STARTUP" contextKey="REGISTER_LOGIN">
    <OpChainRoute chainKey="REGISTER_STARTUP.pre" />
    <OpChainRoute chainKey="REGISTER_STARTUP.workers" />
    <Op class="dtv.pos.appmanagement.preflight.check.op.PreFlightCheckOp" />
    <Op class="dtv.pos.systemcycle.access.SynchStateJournalOp">
      <Parameter name="SilentChange" value="true" />
    </Op>
    <OpChainRoute chainKey="REGISTER_STARTUP.1" />
    <OpChainRoute chainKey="INITIALIZE_FACTORIES" />
    <Op class="dtv.pos.register.ui.InitializeSecondDisplayOp" />
    <OpChainRoute chainKey="REGISTER_STARTUP.ORDER" />
    <OpChainRoute chainKey="REGISTER_STARTUP.2" />
    <Op class="dtv.pos.hardware.op.IdleCustomerDisplayOp" required="false" />
    <OpChainRoute chainKey="INITIALIZE_BACKGROUND_PROCESSES" />
    <OpChainRoute chainKey="INITIALIZE_REFRESH_PROMOTIONS_PROCESSES" />
    <OpChainRoute chainKey="REGISTER_STARTUP.post" />
    <OpChainRoute chainKey="REGISTER_STARTUP.local.post" />
    <OpChainRoute chainKey="VERIFY_HARDWARE_STARTUP" />
    <OpChainRoute chainKey="REGISTER_LOGIN" chainType="START" />
  </OpChain>
  <OpChain name="REGISTER_STARTUP.pre">
    <OpChainRoute chainKey="REGISTER_STARTUP.local.pre" />
  </OpChain>
  <OpChain name="REGISTER_STARTUP.local.pre" />
  <OpChain name="REGISTER_STARTUP.workers">
    <WorkerOp workersBean="startupWorkers" />
  </OpChain>
  <OpChain name="REGISTER_STARTUP.1" />
  <OpChain name="REGISTER_STARTUP.2" />
  <OpChain name="REGISTER_STARTUP.post" />
  <OpChain name="REGISTER_STARTUP.local.post" />
  <OpChain name="REGISTER_STARTUP.ORDER" />
  <OpChain name="VERIFY_HARDWARE_STARTUP">
    <Op class="dtv.pos.hardware.op.WaitForHardwareSetupAtStartupOp" required="false" />
  </OpChain>
  <OpChain name="INITIALIZE_FACTORIES">
    <Op class="dtv.pos.register.InitializeFactoriesOp" />
  </OpChain>
  <OpChain name="RESET_STATION" signal="TransactionCancelled">
    <Op class="dtv.pos.common.ClearStationModelOp" />
    <OpChainRoute chainKey="SECURITY_LOGOUT" />
    <OpChainRoute chainKey="REINIT_HARDWARE" />
    <Op class="dtv.tenderauth.impl.op.ClearAuthConfigOp" />
    <OpChainRoute chainKey="RESET_REGISTER" />
    <WorkerOp workersBean="orphanedTransactionWorkers" required="false" />
    <OpChainRoute chainKey="RESUME_XUNIT" />
    <Op class="dtv.pos.framework.op.OpChainRollbackToTopOp" />
  </OpChain>
  <OpChain name="RESUME_XUNIT" />
  <OpChain name="REINIT_HARDWARE">
    <Op class="dtv.pos.hardware.op.ShutdownHardwareOp" longRunning="true" />
    <WorkerOp workersBean="initHardwareWorkers" />
    <Op class="dtv.pos.hardware.op.WaitForHardwareSetupOp" />
    <Op class="dtv.pos.hardware.op.IdleCustomerDisplayOp" />
  </OpChain>
  <OpChain name="REINIT_HARDWARE_PROMPT">
    <PromptOp class="dtv.pos.hardware.op.PromptReinitializeHardwareOp" />
    <OpChainRoute chainKey="REINIT_HARDWARE" />
  </OpChain>

  <OpChain name="CHEETAH_CLIENT_DEVICE_ACCESS_PROMPT" rollbackLevel="40">
    <PromptOp class="dtv.pos.hardware.op.PromptCheetahClientDeviceAccessOp" breakpoint="true" />
  </OpChain>

  <OpChain name="CHEETAH_CLIENT_DEVICE_ACCESS_ENABLE">
    <ValidationOp validationsBean="cheetahClientDeviceAccessEnableRules" />
    <PromptOp class="dtv.pos.hardware.op.PromptDeviceAccessConfirmationOp" key="CHEETAH_CLIENT_DEVICE_ACCESS_ENABLE_CONFIRMATION" />
    <Op class="dtv.pos.hardware.op.CheetahDeviceAccessUpdateOp">
      <Parameter name="Status" value="ENABLED" />
    </Op>
  </OpChain>

  <OpChain name="CHEETAH_CLIENT_DEVICE_ACCESS_BLOCK">
    <ValidationOp validationsBean="cheetahClientDeviceAccessBlockRules" />
    <PromptOp class="dtv.pos.hardware.op.PromptDeviceAccessConfirmationOp" key="CHEETAH_CLIENT_DEVICE_ACCESS_BLOCK_CONFIRMATION" />
    <Op class="dtv.pos.hardware.op.CheetahDeviceAccessUpdateOp">
      <Parameter name="Status" value="BLOCKED" />
    </Op>
  </OpChain>

  <OpChain name="CHEETAH_CLIENT_DEVICE_ACCESS_DELETE">
    <ValidationOp validationsBean="cheetahClientDeviceAccessDeleteRules" />
    <PromptOp class="dtv.pos.hardware.op.PromptDeviceAccessConfirmationOp" key="CHEETAH_CLIENT_DEVICE_ACCESS_DELETE_CONFIRMATION" />
    <Op class="dtv.pos.hardware.op.CheetahDeviceAccessDeleteOp" />
  </OpChain>

  <OpChain name="EDIT_HARDWARE">
    <Op class="dtv.pos.hardware.op.HardwareDeviceEditOp" />
  </OpChain>
  <OpChain name="DISABLE_MICR">
    <Op class="dtv.pos.hardware.op.DisableDeviceOp">
      <Parameter name="deviceType" value="MICR" />
      <Parameter name="use" value="MAIN_MICR" />
      <Parameter name="promptKey" value="MICR_DISABLED" />
    </Op>
  </OpChain>
  <OpChain name="DISABLE_CUST_MSR">
    <Op class="dtv.pos.hardware.op.DisableDeviceOp">
      <Parameter name="deviceType" value="MSR" />
      <Parameter name="use" value="CUST_MSR" />
      <Parameter name="promptKey" value="CUST_MSR_DISABLED" />
    </Op>
  </OpChain>
  <OpChain name="DISABLE_MAIN_MSR">
    <Op class="dtv.pos.hardware.op.DisableDeviceOp">
      <Parameter name="deviceType" value="MSR" />
      <Parameter name="use" value="MAIN_MSR" />
      <Parameter name="promptKey" value="MAIN_MSR_DISABLED" />
    </Op>
  </OpChain>
  <OpChain name="DISABLE_VALIDATION_PRINTER">
    <Op class="dtv.pos.hardware.op.DisablePrinterStationOp">
      <Parameter name="printer" value="VALIDATION" />
      <Parameter name="station" value="SLIP" />
      <Parameter name="promptKey" value="VALIDATION_PRINTER_DISABLED" />
    </Op>
  </OpChain>
  <OpChain name="GIFT_RECEIPT_PRINT_SELECTION" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.giftreceipt.PromptForGiftReceiptItemsOp" validationsBean="giftReceiptLimitsRules">
      <Parameter name="ClearSelections" value="false" />
    </PromptOp>
  </OpChain>
  <OpChain name="ISSUE_GIFT_RECEIPT_PRINT_SELECTION">
    <!-- used by back office -->
    <ValidationOp validationsBean="reprintTransactionGiftReceiptRules" />
    <PromptOp class="dtv.pos.ejournal.giftrcpt.PromptForGiftReceiptItemsOp" validationsBean="giftReceiptLimitsRules">
      <Parameter name="ClearSelections" value="true" />
    </PromptOp>
    <Op class="dtv.pos.ejournal.giftrcpt.GroupGiftReceiptsOp" />
    <Op class="dtv.pos.ejournal.giftrcpt.AddMultipleGiftReceiptsOp" />
    <Op class="dtv.pos.register.giftreceipt.AddGiftRcptSourcesOp">
      <Parameter name="ReplaceExistingReceipts" value="true" />
    </Op>
    <Op class="dtv.pos.hardware.op.BuildRcptsOp" />
    <Op class="dtv.pos.common.PersistObjectsOp" />
    <WorkerOp workersBean="emailRcptsWorkers" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <Op class="dtv.pos.register.giftreceipt.GiftReceiptClearSelectedItemsOp" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
  </OpChain>

  <OpChain name="GIFT_RECEIPT_PRICE_LOOKUP">
    <PromptOp class="dtv.pos.register.giftreceipt.PromptGiftReceiptPriceOp" validationsBean="encodedItemPriceRules" />
  </OpChain>

  <OpChain name="GIFT_RECEIPT_REISSUE_SELECTION">
    <PromptOp class="dtv.pos.ejournal.PromptTransactionIdOp" validationsBean="transactionExistsRule" />
    <PromptOp class="dtv.pos.ejournal.giftrcpt.PromptForGiftReceiptItemsOp" validationsBean="giftReceiptLimitsRules">
      <Parameter name="ClearSelections" value="true" />
    </PromptOp>
    <Op class="dtv.pos.ejournal.giftrcpt.GroupGiftReceiptsOp" />
    <Op class="dtv.pos.ejournal.giftrcpt.AddMultipleGiftReceiptsOp" />
    <Op class="dtv.pos.register.giftreceipt.AddGiftRcptSourcesOp">
      <Parameter name="ReplaceExistingReceipts" value="true" />
    </Op>
    <Op class="dtv.pos.hardware.op.BuildRcptsOp" />
    <WorkerOp workersBean="emailRcptsWorkers" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <Op class="dtv.pos.register.giftreceipt.GiftReceiptClearSelectedItemsOp" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
  </OpChain>
  <!--  New OpChain to handle Back Office Menu item Reprint Receipt -->
  <OpChain name="REPRINT_RECEIPT_MENU">
    <Op class="dtv.pos.register.reprint.PromptReprintReceiptInformationOp" />
    <OpChainRoute chainKey="REPRINT_RECEIPT" />
  </OpChain>
  <OpChain name="REPRINT_RECEIPT">
    <ValidationOp validationsBean="receiptReprintRules" />
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="REPRINT_RECEIPT" />
    <Op class="dtv.pos.hardware.op.BuildTenderFrankingsOnSelectedTransactionOp" />
    <PromptOp class="dtv.pos.register.reprint.PromptRefrankDocsOp" />
    <OpChainRoute chainKey="REPRINT_PREPARE_RECEIPTS" />
    <OpChainRoute chainKey="REPRINT_EJ_RECEIPTS.local" />
    <Op class="dtv.pos.hardware.op.FrankTendersOp" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <OpChainRoute chainKey="PRINT_DOCUMENTS" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
  </OpChain>
  <OpChain name="REPRINT_PREPARE_RECEIPTS">
    <Op class="dtv.pos.register.reprint.GetReprintRcptsOp" />
  </OpChain>
  <OpChain name="REPRINT_EJ_RECEIPTS.local">
    <OpChainRoute chainKey="REPRINT_EJ_RECEIPTS.pre" />
    <Op class="dtv.pos.hardware.op.ReprintEjRcptsOp" />
    <OpChainRoute chainKey="REPRINT_EJ_RECEIPTS.post" />
  </OpChain>
  <OpChain name="REPRINT_EJ_RECEIPTS.pre" />
  <OpChain name="REPRINT_EJ_RECEIPTS.post" />
  <OpChain name="REGISTER_SHUTDOWN">
    <OpChainRoute chainKey="REGISTER_SHUTDOWN.local" />
    <Op class="dtv.pos.hardware.op.ShutdownHardwareOp" required="false" />
    <Op class="dtv.pos.framework.op.ShutdownViewOp" />
  </OpChain>
  <OpChain name="REGISTER_SHUTDOWN.local" />
  <!-- Start: System Cycle -->
  <OpChain name="RETAIL_LOCATION_OPEN" contextKey="RETAIL_LOCATION_OPEN" signal="TransactionComplete">
    <ValidationOp validationsBean="openRetailLocationRules" />
    <OpChainRoute chainKey="RETAIL_LOCATION_OPEN.order" />
    <PromptOp class="dtv.pos.systemcycle.open.PromptToOpenOp" key="OPEN_RETAIL_LOCATION" />
    <OpChainRoute chainKey="CHANGE_BUSINESS_DATE_OPEN" />
    <PromptOp class="dtv.pos.systemcycle.questions.PromptCycleQuestionsOp">
      <Parameter name="QuestionType" value="SYSTEM_OPEN" />
    </PromptOp>
    <PromptOp class="dtv.pos.systemcycle.open.DisplayCloseMessageOp" />
    <Op class="dtv.pos.till.count.OpenStoreBankOp" />
    <Op class="dtv.pos.systemcycle.retaillocation.CreateOpenTransactionOp" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <Op class="dtv.pos.appmanagement.op.SendIpcMessageOp">
      <Parameter name="SERVICE" value="xstore" />
      <Parameter name="METHOD" value="OPEN_STORE" />
    </Op>
    <OpChainRoute chainKey="REPORT_RUN_OPEN_GROUP" />
    <OpChainRoute chainKey="RETAIL_LOCATION_OPEN_ACTIVITY.local" />
    <Op class="dtv.pos.systemcycle.workstation.IsWorkStationOpenOp" />
  </OpChain>
  <OpChain name="RETAIL_LOCATION_OPEN_ACTIVITY.local">
    <OpChainRoute chainKey="RETAIL_LOCATION_OPEN_ACTIVITY.pre" />
    <OpChainRoute chainKey="RETAIL_LOCATION_OPEN_ACTIVITY.local.1" />
    <OpChainRoute chainKey="RETAIL_LOCATION_OPEN_ACTIVITY.local.2" />
    <!-- This where any Fiscal related things need done during Retail Location Open -->
    <OpChainRoute chainKey="RETAIL_LOCATION_OPEN_ACTIVITY.post" />
  </OpChain>
  <OpChain name="RETAIL_LOCATION_OPEN_ACTIVITY.local.1" />
  <OpChain name="RETAIL_LOCATION_OPEN_ACTIVITY.local.2" />
  <OpChain name="RETAIL_LOCATION_OPEN_ACTIVITY.pre" />
  <OpChain name="RETAIL_LOCATION_OPEN_ACTIVITY.post" />
  <OpChain name="WORKSTATION_OPEN" contextKey="WORKSTATION_OPEN" signal="TransactionComplete">
    <ValidationOp validationsBean="openWorkstationRules" />
    <PromptOp class="dtv.pos.systemcycle.workstation.PromptToOpenRegisterOp" key="OPEN_WORKSTATION" />
    <!-- Prevents to reprint several "Register Closed" receipts by every suspended transaction canceled -->
    <Op class="dtv.pos.till.ClearTillCountReceiptsOp" />
    <WorkerOp workersBean="saveSystemTimeWorkers" />
    <PromptOp class="dtv.pos.systemcycle.workstation.PromptRegisterOpenBusinessDate" key="CHOOSE_BUSINESS_DATE" />
    <!-- Reinitialize to clear the current session in case this register is force closed from another register -->
    <Op class="dtv.pos.assistance.ReinitializeSessionManagerOp" />
    <OpChainRoute chainKey="WORKSTATION_OPEN_EXT.local" />
    <OpChainRoute chainKey="WORKSTATION_OPEN.1" />
    <OpChainRoute chainKey="WORKSTATION_OPEN.eftlink" />
    <OpChainRoute>
      <Choice chainKey="REGISTER_MODE_COUNT_TILL" condition="dtv.pos.till.rollingclose.RollingCloseCountAtRegisterOpenRunCondition" />
      <Choice chainKey="REGISTER_MODE_NO_COUNT" condition="dtv.pos.till.rollingclose.RollingCloseNoCountAtRegisterOpenRunCondition" />
    </OpChainRoute>
    <Op class="dtv.pos.systemcycle.workstation.CreateWorkstationOpenOp" longRunning="true" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <OpChainRoute chainKey="NOTIFY_OPEN_WORKSTATION" />
    <OpChainRoute chainKey="EXT_WORKSTATION_OPEN_CHECK" />
  </OpChain>
  <OpChain name="ROLLING_CLOSE_FIRST_WORKSTATION_TO_OPEN">
    <OpChainRoute chainKey="RETAIL_LOCATION_CLOSE.order.1" />
    <PromptOp class="dtv.pos.payroll.op.PromptPayrollNotYetPostYesNoMsgOp" key="ROLLING_CLOSE_PAYROLL_NOT_YET_POSTED" />
    <PromptOp class="dtv.pos.register.suspendresume.PromptCancelSuspendTransOp" />
    <PromptOp class="dtv.pos.systemcycle.questions.PromptCycleQuestionsOp">
      <Parameter name="QuestionType" value="WORKSTATION_OPEN" />
    </PromptOp>
    <Op class="dtv.pos.register.suspendresume.CancelAllSuspendTransOp" />
        <OpChainRoute chainKey="RETAIL_LOCATION_CLOSE.order.2" />
    <Op class="dtv.pos.payroll.op.WritePayrollLogOp" longRunning="true" />
    <Op class="dtv.pos.systemcycle.close.ProcessPayrollOp" longRunning="true" />
    <Op class="dtv.tenderauth.impl.xpay.XpayCloseBatchOp" longRunning="true" />
  </OpChain>
  <OpChain name="END_OF_DAY_PROCESS">
    <PromptOp class="dtv.pos.systemcycle.endofday.BusinessPeriodListOp" />
    <PromptOp class="dtv.pos.systemcycle.endofday.PromptCloseRetailPeriodOp" />
    <Op class="dtv.pos.systemcycle.close.CountStoreBankAtStoreClosingOp" />
    <WorkerOp workersBean="createEndOfRetailPeriodTransWorkers" />
    <WorkerOp workersBean="persistBusinessPeriodCloseWorkers" />
    <PromptOp class="dtv.pos.systemcycle.endofday.PromptCloseRetailPeriodCompletedOp" />
  </OpChain>
  <OpChain name="REGISTER_MODE_COUNT_TILL">
    <OpChainRoute>
        <Choice chainKey="REGISTER_MODE_QUICK_STARTING_COUNT_CHAIN_SET" condition="dtv.pos.register.condition.QuickOpeningCountAtRegisterRunCondition" />
        <Choice chainKey="REGISTER_MODE_STARTING_COUNT_CHAIN_SET" condition="dtv.pos.register.condition.OpeningCountAtRegisterRunCondition" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="REGISTER_MODE_NO_COUNT" signal="TransactionComplete">
    <!-- This is the path for Insert predefined float, carry over balance, and float balance. -->
    <OpChainRoute chainKey="REGISTER_MODE_ISSUE_ATTACH_TILL" condition="dtv.pos.till.UseTillAccountability" />
    <Op class="dtv.pos.till.GetCurrentSessionOp" longRunning="true" />
    <OpChainRoute chainKey="ROLLING_CLOSE_INSERT_PREDEFINED_FLOAT" chainType="START" condition="dtv.pos.till.rollingclose.RollingCloseRegisterCloseInsertPredefinedFloatRunCondition" />
    <OpChainRoute chainKey="ROLLING_CLOSE_FIRST_WORKSTATION_TO_OPEN" condition="dtv.pos.register.RollingCloseFirstRegisterToOpenCondition" />
    <OpChainRoute chainKey="AUTO_CREATE_BEGIN_COUNT_TRANS" />
  </OpChain>
  <OpChain name="ROLLING_CLOSE_INSERT_PREDEFINED_FLOAT" contextKey="CHANGE_TILL_FLOAT" signal="TransactionComplete">
    <PromptOp class="dtv.pos.till.rollingclose.PromptRollingCloseInsertPreDefinedFloatOp" />
    <ValidationOp validationsBean="rollingCloseTillCashRules" />
    <OpChainRoute chainKey="ROLLING_CLOSE_FIRST_WORKSTATION_TO_OPEN" condition="dtv.pos.register.RollingCloseFirstRegisterToOpenCondition" />
    <OpChainRoute chainKey="AUTO_CREATE_BEGIN_COUNT_TRANS" />
    <Op class="dtv.pos.systemcycle.workstation.CreateWorkstationOpenOp" longRunning="true" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <OpChainRoute chainKey="NOTIFY_OPEN_WORKSTATION" />
    <OpChainRoute chainKey="EXT_WORKSTATION_OPEN_CHECK" />
  </OpChain>
  <OpChain name="AUTO_CREATE_BEGIN_COUNT_TRANS" signal="TransactionComplete">
    <Op class="dtv.pos.till.rollingclose.AutoCreateRollingCloseBeginCountOp" />
    <WorkerOp workersBean="createTillStartCountObjectsWorkers" contextKey="ISSUE_TILL" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
  </OpChain>
  <OpChain name="ROLLING_CLOSE_CHANGE_FLOAT_SETUP" contextKey="CHANGE_TILL_FLOAT">
    <PromptOp class="dtv.pos.till.PromptChangeFloatReasonCodeOp" />
    <PromptOp class="dtv.pos.till.PromptCountableCashTendersOp" validationsBean="cashTenderListSelectionRules">
      <Parameter name="Instruction" value="_promptChangeFloatCurrencyListMessage" />
      <Parameter name="Title" value="_promptChangeFloatCurrencyListTitle" />
    </PromptOp>
    <Op class="dtv.pos.till.rollingclose.SetSelectedTenderRepositoriesOp" />
    <Op class="dtv.pos.till.CreateTillControlTransactionOp" />
    <Op class="dtv.pos.till.CreateChangeFloatDetailsOp" />
    <OpChainRoute chainKey="ROLLING_CLOSE_CHANGE_FLOAT" chainType="START" />
  </OpChain>
  <OpChain name="ROLLING_CLOSE_CHANGE_FLOAT" contextKey="CHANGE_TILL_FLOAT" rollbackChainKey="PROMPT_CANCEL_TRANSACTION">
    <PromptOp class="dtv.pos.till.PromptChangeFloatAmountOp" validationsBean="changeTillFloatRules" />
    <PromptOp class="dtv.pos.till.rollingclose.PromptRollingCloseSaveChangeFloatOp" />
    <WorkerOp workersBean="completeTransactionWorkers" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <!-- Re-prompt the predefined float screen to give the user a chance to change another currency if needed be -->
    <OpChainRoute chainKey="ROLLING_CLOSE_INSERT_PREDEFINED_FLOAT" chainType="START" />
  </OpChain>
  <OpChain name="NOTIFY_OPEN_WORKSTATION">
    <Op class="dtv.pos.appmanagement.op.SendIpcMessageOp">
      <Parameter name="SERVICE" value="xstore" />
      <Parameter name="METHOD" value="OPEN_WORKSTATION" />
    </Op>
    <Op class="dtv.pos.appmanagement.op.SendIpcMessageRollingCloseOp">
      <Parameter name="SERVICE" value="xstore" />
      <Parameter name="METHOD" value="BUSINESS_DATE_CHANGED" />
    </Op>
  </OpChain>
  <OpChain name="WORKSTATION_OPEN_EXT.local">
    <OpChainRoute chainKey="WORKSTATION_OPEN_EXT.pre" />
    <OpChainRoute chainKey="WORKSTATION_OPEN_EXT.local.1" />
    <OpChainRoute chainKey="WORKSTATION_OPEN_EXT.local.2" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="WORKSTATION_OPEN_EXT.local.3" />
    <OpChainRoute chainKey="WORKSTATION_OPEN_EXT.post" />
  </OpChain>
  <OpChain name="WORKSTATION_OPEN_EXT.local.1" />
  <OpChain name="WORKSTATION_OPEN_EXT.local.2" />
  <OpChain name="WORKSTATION_OPEN_EXT.local.3" />
  <OpChain name="WORKSTATION_OPEN_EXT.pre" />
  <OpChain name="WORKSTATION_OPEN_EXT.post" />
  <OpChain name="WORKSTATION_OPEN.1" />
  <OpChain name="WORKSTATION_OPEN.eftlink" />
  <OpChain name="RETAIL_LOCATION_OPEN.order" />
  <OpChain name="RETAIL_LOCATION_CLOSE" contextKey="RETAIL_LOCATION_CLOSE" signal="TransactionComplete">
    <Op class="dtv.pos.register.itemmessages.DefaultIdleMsgOp" />
    <ValidationOp validationsBean="closeRetailLocationRules" />
    <OpChainRoute chainKey="RETAIL_LOCATION_CLOSE.order.1" />
    <PromptOp class="dtv.pos.systemcycle.close.ValidateNotClockOutEmployeesOp" />
    <PromptOp class="dtv.pos.systemcycle.close.PromptToCloseStoreOp" />
    <PromptOp class="dtv.pos.payroll.op.PromptPayrollNotYetPostYesNoMsgOp" />
    <Op class="dtv.pos.systemcycle.close.ValidateWorkstationsClosedOp" />
    <Op class="dtv.pos.systemcycle.close.ValidateCashdrawersClosedOp" />
    <PromptOp class="dtv.pos.systemcycle.close.ValidateRollingCloseTillsReconciledOp" key="ROLLING_CLOSE_STORE_CLOSE_UNRECONCILED_TILLS" />
    <PromptOp class="dtv.pos.systemcycle.close.ValidateRollingCloseAllDaysEndedOp" key="ROLLING_CLOSE_STORE_CLOSE_DAYS_NOT_ENDED" />
    <PromptOp class="dtv.pos.register.suspendresume.PromptCancelSuspendTransOp" />
    <PromptOp class="dtv.pos.systemcycle.close.PromptCloseMessageOp" />
    <OpChainRoute chainKey="RETAIL_LOCATION_CLOSE.1" />
    <PromptOp class="dtv.pos.systemcycle.questions.PromptCycleQuestionsOp">
      <Parameter name="QuestionType" value="SYSTEM_CLOSE" />
    </PromptOp>
    <Op class="dtv.pos.systemcycle.close.CountStoreBankAtStoreClosingOp" />
    <PromptOp class="dtv.pos.systemcycle.questions.PromptCycleQuestionsOp">
      <Parameter name="QuestionType" value="SYSTEM_CLOSE_DEPOSIT_COMPLETE" />
    </PromptOp>
    <OpChainRoute chainKey="RETAIL_LOCATION_CLOSE.2" />
    <Op class="dtv.pos.systemcycle.close.DisplayFinalSystemCloseMsgOp" />
    <Op class="dtv.pos.common.op.DisablePromptActionsOp" />
    <Op class="dtv.pos.register.suspendresume.CancelAllSuspendTransOp" />
    <Op class="dtv.pos.systemcycle.retaillocation.AutoCloseWorkstationOp" />
    <Op class="dtv.pos.systemcycle.close.AutoClockOutOp" />
    <OpChainRoute chainKey="RETAIL_LOCATION_CLOSE.order.2" />
    <Op class="dtv.pos.payroll.op.WritePayrollLogOp" longRunning="true" />
    <Op class="dtv.pos.systemcycle.close.ProcessPayrollOp" longRunning="true" />
    <Op class="dtv.pos.systemcycle.retaillocation.CreateStoreCloseTransactionOp" />
    <Op class="dtv.tenderauth.impl.xpay.XpayCloseBatchOp" longRunning="true" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <Op class="dtv.pos.appmanagement.op.SendIpcMessageNotRollingCloseOp">
      <Parameter name="SERVICE" value="xstore" />
      <Parameter name="METHOD" value="BUSINESS_DATE_CHANGED" />
    </Op>
    <OpChainRoute chainKey="REPORT_RUN_CLOSE_GROUP" />
    <OpChainRoute chainKey="RETAIL_LOCATION_CLOSE.local" />
    <OpChainRoute chainKey="RETAIL_LOCATION_CLOSE.local.2" />
    <Op class="dtv.pos.systemcycle.close.ExitAppOnSystemCloseOp" />
    <OpChainRoute chainKey="RETURN_TO_LOGIN" />
  </OpChain>
  <OpChain name="RETAIL_LOCATION_CLOSE.order.1" />
  <OpChain name="RETAIL_LOCATION_CLOSE.order.2" />
  <OpChain name="RETAIL_LOCATION_CLOSE.1" />
  <OpChain name="RETAIL_LOCATION_CLOSE.2" />
  <OpChain name="RETAIL_LOCATION_CLOSE.local" />
  <OpChain name="RETAIL_LOCATION_CLOSE.local.2" />
  <OpChain name="WORKSTATION_CLOSE" contextKey="WORKSTATION_CLOSE">
    <OpChainRoute chainKey="WORKSTATION_CLOSE_IMPL" />
    <OpChainRoute chainKey="RETURN_TO_LOGIN" />
  </OpChain>
  <OpChain name="WORKSTATION_CLOSE_IMPL" contextKey="WORKSTATION_CLOSE" signal="TransactionComplete" rollbackChainKey="ROLLBACK_WORKSTATION_CLOSE_TRANS">
    <Op class="dtv.pos.register.itemmessages.DefaultIdleMsgOp" />

    <!-- In rolling close and till accountability mode, we should be able to close the register even though the till is still attach to it.
         The user is prompted if he wants to proceed of removing the till from the register.
     -->
    <OpChainRoute chainKey="DETACH_TILL_FROM_WKSTN_ROLLING_CLOSE_TILL_ACCOUNTABILITY" condition="dtv.pos.till.rollingclose.DetachTillFromWkstnInTillAccountabilityRunCondition" />
    <ValidationOp validationsBean="closeWorkstationRules" />
    <PromptOp class="dtv.pos.systemcycle.close.PromptToCloseOp" key="CLOSE_WORKSTATION" />
    <OpChainRoute chainKey="EXT_WORKSTATION_CLOSE_CHECK" />
    <OpChainRoute chainKey="WORKSTATION_CLOSE.local" />
    <OpChainRoute>
      <Choice chainKey="REGISTER_CLOSING_NO_COUNT" condition="dtv.pos.till.rollingclose.RollingCloseRunCondition" />
      <Choice chainKey="REGISTER_CLOSING_WITH_COUNT" condition="dtv.pos.till.rollingclose.NonRollingCloseRunCondition" />
    </OpChainRoute>
    <PromptOp class="dtv.pos.systemcycle.questions.PromptCycleQuestionsOp">
      <Parameter name="QuestionType" value="WORKSTATION_CLOSE" />
    </PromptOp>
    <Op class="dtv.pos.systemcycle.workstation.CreateCloseTransactionOp" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <OpChainRoute chainKey="NOTIFY_CLOSE_WORKSTATION" />
    <WorkerOp workersBean="registerCloserWorkers" />
    <PromptOp class="dtv.pos.systemcycle.workstation.PromptToReopenRegisterOp">
      <Parameter name="ChainKey" value="WORKSTATION_OPEN"/>
    </PromptOp>
  </OpChain>
  <OpChain name="DETACH_TILL_FROM_WKSTN_ROLLING_CLOSE_TILL_ACCOUNTABILITY">
    <PromptOp class="dtv.pos.till.PromptRemoveTillOp" />
    <Op class="dtv.pos.till.rollingclose.GetCurrentActiveSession" />
    <Op class="dtv.pos.till.RemoveTillOp" />
    <Op class="dtv.pos.hardware.op.AlwaysOpenCashDrawerOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <PromptOp class="dtv.pos.till.NotifyTillActionOp" key="NOTIFY_TILL_REMOVED" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
  </OpChain>
  <!-- 24x7  Begin -->
  <OpChain name="REGISTER_CLOSING_NO_COUNT">
    <OpChainRoute>
      <Choice chainKey="ROLLING_CLOSE_REGISTER_CLOSE_EMPTY_DRAWER" condition="dtv.pos.till.rollingclose.RollingCloseEmptyDrawerRunCondition" />
      <Choice chainKey="REGISTER_MODE_CARRY_OVER_BALANCE" condition="dtv.pos.till.rollingclose.RollingCloseRegisterCloseCarryOverBalanceRunCondition" />
   </OpChainRoute>
  </OpChain>
  <OpChain name="REGISTER_CLOSING_WITH_COUNT">
    <OpChainRoute>
      <Choice chainKey="QUICK_CLOSING_COUNT_AT_REGISTER" condition="dtv.pos.register.condition.QuickClosingCountAtRegisterRunCondition" />
      <Choice chainKey="CLOSING_COUNT_AT_REGISTER_CLOSE" condition="dtv.pos.register.condition.ClosingCountAtRegisterRunCondition" />
    </OpChainRoute>
  </OpChain>

  <!-- This is the flow for prompt for float and insert predefined float configuration -->
  <OpChain name="ROLLING_CLOSE_REGISTER_CLOSE_EMPTY_DRAWER">
    <Op class="dtv.pos.till.CheckCurrentSessionStatusOp">
      <Parameter name="AcceptedStatus" value="BEGINCOUNT" />
    </Op>
    <Op class="dtv.pos.till.count.EndCountOpenCashDrawerOp" />
    <PromptOp class="dtv.pos.till.rollingclose.PromptRollingCloseEmptyTheDrawerOp" />
    <Op class="dtv.pos.till.rollingclose.DetachTillAndEndSessionOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
  </OpChain>

  <!-- This is the chain for the carry over balance and float pickup configuration -->
  <OpChain name="REGISTER_MODE_CARRY_OVER_BALANCE">
    <Op class="dtv.pos.till.CheckCurrentSessionStatusOp">
      <Parameter name="AcceptedStatus" value="BEGINCOUNT" />
    </Op>
    <Op class="dtv.pos.till.count.EndCountOpenCashDrawerOp" />
    <PromptOp class="dtv.pos.till.rollingclose.PromptRollingCloseRemoveNonCashTendersOp" />
    <Op class="dtv.pos.till.rollingclose.PromptRollingClosingPickupAmountsOp">
      <Parameter name="ChainKey" value="PROMPT_PICKUP_FLOAT" />
    </Op>
    <Op class="dtv.pos.till.rollingclose.UpdateLastClosingBalanceOp" />
    <Op class="dtv.pos.till.rollingclose.DetachTillAndEndSessionOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
  </OpChain>
  <OpChain name = "PROMPT_PICKUP_FLOAT">
    <Op class="dtv.pos.till.rollingclose.PromptRollingClosingPickupAmtOp" />
  </OpChain>
  <OpChain name="ROLLING_CLOSING_RECONCILE_REGISTER" signal="TransactionComplete" contextKey="CLOSE_COUNT" rollbackChainKey="ROLLBACK_WORKSTATION_CLOSE_TRANS">
    <PromptOp class="dtv.pos.till.rollingclose.PromptReconcileRegisterTillOp" />
    <PromptOp class="dtv.pos.till.rollingclose.PromptReconcileRegisterConfirmOp" />
    <Op class="dtv.pos.till.rollingclose.PromptRollingCloseTillCountOp" />
    <Op class="dtv.pos.till.rollingclose.CreateRollingCloseTillEndCountObjectsOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
  </OpChain>
  <!-- 24x7 End -->

  <OpChain name="ROLLBACK_WORKSTATION_CLOSE_TRANS">
    <OpChainRoute chainKey="CANCEL_TRANSACTION" chainType="START" condition="dtv.pos.register.condition.NoTransRunCondition" />
    <OpChainRoute chainKey="CANCEL_NO_TRANSACTION" chainType="START" />
  </OpChain>
  <OpChain name="WORKSTATION_CLOSE.local" />
  <OpChain name="NOTIFY_CLOSE_WORKSTATION.local" />
  <OpChain name="NOTIFY_CLOSE_WORKSTATION">
    <OpChainRoute chainKey="NOTIFY_CLOSE_WORKSTATION.local" />
    <Op class="dtv.pos.appmanagement.op.SendIpcMessageOp">
      <Parameter name="SERVICE" value="xstore" />
      <Parameter name="METHOD" value="CLOSE_WORKSTATION" />
    </Op>
  </OpChain>
  <OpChain name="CHANGE_BUSINESS_DATE_PROMPT" contextKey="CHANGE_BUSINESS_DATE">
    <Op class="dtv.pos.register.itemmessages.DefaultIdleMsgOp" />
    <ValidationOp validationsBean="allowChangeBusinessDateRules" />
    <Op class="dtv.pos.systemcycle.businessdate.GetCurrentBusinessDateOp">
      <Parameter name="BUSINESSDATE" value="DB" />
    </Op>
    <PromptOp class="dtv.pos.systemcycle.businessdate.PromptChangeBusinessDateOp" breakpoint="true" validationsBean="changeBusinessDateRules" />
    <Op class="dtv.pos.systemcycle.businessdate.CheckSameDayStoreReopenOp" />
    <Op class="dtv.pos.systemcycle.businessdate.CheckUnscheduledStoreOpenOp" />
    <PromptOp class="dtv.pos.systemcycle.businessdate.PromptVerifyBusinessDateOp" />
    <Op class="dtv.pos.systemcycle.businessdate.UpdateBusinessDateOp" />
  </OpChain>
  <OpChain name="CHANGE_BUSINESS_DATE_OPEN">
    <Op class="dtv.pos.systemcycle.businessdate.GetCurrentBusinessDateOp" />
    <PromptOp class="dtv.pos.systemcycle.businessdate.PromptChangeBusinessDateOp" validationsBean="changeBusinessDateRules" />
    <Op class="dtv.pos.systemcycle.businessdate.CheckSameDayStoreReopenOp" />
    <Op class="dtv.pos.systemcycle.businessdate.CheckUnscheduledStoreOpenOp" />
    <PromptOp class="dtv.pos.systemcycle.businessdate.PromptVerifyBusinessDateOp" />
    <Op class="dtv.pos.systemcycle.businessdate.UpdateBusinessDateOp" />
  </OpChain>
  <OpChain name="FORCE_CLOSE_WORKSTATION">
    <!-- the op promptforcecloseworkstationsop is available without the
      conditional acknowledgement motifies after process is complete. This new
      op will allow you to start with no workstations selected and is
      extending AbstractListPromptOp which is a better starting point than operation -->
    <PromptOp class="dtv.pos.systemcycle.common.PromptForceCloseWorkstationOp" validationsBean="forceCloseWorkstationSelectionRules" />
    <Op class="dtv.pos.systemcycle.common.HandleForceCloseWorkstationOp" />
    <PromptOp key="WORKSTATION_FORCE_CLOSED" />
  </OpChain>
  <!-- START: Initialize Back Office -->
  <OpChain name="BACK_OFFICE_STARTUP" contextKey="BACK_OFFICE_LOGIN">
    <Op class="dtv.pos.appmanagement.op.SendIpcConfigUpdateMessageOp">
      <Parameter name="PRIMARY_ONLY" value="true" />
      <Parameter name="SERVICE" value="xstoreSync" />
      <Parameter name="METHOD" value="configUpdate" />
      <Parameter name="XCENTER_URL" value="url" />
      <Parameter name="XCENTER_USERNAME" value="username" />
      <Parameter name="XCENTER_PASSWORD" value="password" />
      <Parameter name="XSTORE_ORG_ID" value="organizationId" />
      <Parameter name="XSTORE_STORE_NUMBER" value="storeNumber" />
      <Parameter name="XSTORE_TRADITIONAL_CLOSE_DISABLED" value="traditionalCloseDisabled"/>
    </Op>
    <Op class="dtv.pos.appmanagement.op.SendIpcConfigUpdateMessageOp">
      <Parameter name="PRIMARY_ONLY" value="false" />
      <Parameter name="SERVICE" value="xstoreSync" />
      <Parameter name="METHOD" value="configUpdateNoForward" />
      <Parameter name="XSTORE_LOCAL_DATABASE" value="localDatabaseUrl" />
      <Parameter name="XSTORE_LOCAL_DATABASE_USER" value="localDatabaseUsername" />
      <Parameter name="XSTORE_LOCAL_DATABASE_PASSWORD" value="localDatabasePassword" />
      <Parameter name="XSTORE_LOCAL_DATABASE_DRIVER" value="localDatabaseDriver" />
      <Parameter name="XSTORE_UPDATE_GRACE_PERIOD_TIME_SECONDS" value="updateGracePeriodTimeInSeconds" />
      <Parameter name="XSTORE_UPDATE_REQUIRED_PERIOD_TIME_SECONDS" value="updateRequiredTimeInSeconds" />
    </Op>

    <!-- included here in case a workstation is set up with BackOffice only -->
    <!-- ... if already run, will not do anything -->
    <OpChainRoute chainKey="BACK_OFFICE_LOGIN" chainType="START" />
  </OpChain>
  <OpChain name="BACK_OFFICE_LOGIN" contextKey="BACK_OFFICE_LOGIN" rollbackLevel="0">
    <!--The user is logging in to the register from within the register app. -->
    <Op class="dtv.pos.register.itemmessages.DefaultIdleMsgOp" />
    <Op class="dtv.pos.security.op.PosLoginOp">
      <Parameter name="IdPrompt" value="BACK_OFFICE_LOGIN_USER_ID" />
      <Parameter name="PasswordPrompt" value="BACK_OFFICE_LOGIN_USER_PWD" />
    </Op>
    <WorkerOp workersBean="registerWorkstationActiveWorkers" />
    <PromptOp class="dtv.pos.security.op.PromptPasswordChallengeQuestionsOp" />
    <OpChainRoute chainKey="VALIDATE_BACKOFFICE_STARTUP" />
    <PromptOp class="dtv.pos.payroll.op.PromptPayrollNotYetPostMsgOp" />
    <OpChainRoute chainKey="BACK_OFFICE_MAIN_MENU" chainType="START" />
  </OpChain>
  <OpChain name="BACK_OFFICE_MAIN_MENU" contextKey="BACK_OFFICE_MAIN_MENU" rollbackLevel="10" rollbackChainKey="EXIT_BACK_OFFICE">
    <OpChainRoute chainKey="UPDATE_PROMPTS_ROLLBACK" condition="dtv.pos.register.condition.RegisterNotInTrainingModeRunCondition" />
    <Op class="dtv.pos.security.op.StopAutoLogoutTimerOp" />
    <Op class="dtv.pos.framework.op.DoNothingOp" contextKey="BACK_OFFICE_MAIN_MENU" breakpoint="true" />
  </OpChain>
  <OpChain name="EXIT_BACK_OFFICE">
    <OpChainRoute chainKey="SECURITY_LOGOUT" />
    <Op class="dtv.pos.framework.op.OpChainRollbackToTopOp" />
  </OpChain>
  <!-- END: Initialize Back Office -->
  <!-- ask user if they want to clock in with their login credentials -->
  <OpChain name="AUTO_CLOCK_IN" contextKey="CLOCK_IN_OUT">
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="AUTO_CLOCK_IN" />
    <ValidationOp validationsBean="timeClockAccessRules" />
    <Op class="dtv.pos.timeclock.DoClockInOrOutOp" />
    <OpChainRoute chainKey="CLOCK_IN_OUT_FINISH" />
  </OpChain>
  <OpChain name="NO_SALE" signal="TransactionComplete" contextKey="TILL" rollbackChainKey="ROLLBACK_NO_SALE_TRANS">
    <ValidationOp validationsBean="isCashDrawerPresentValidations"/>
    <OpChainRoute chainKey="PRE_TRANS_TILL_VALIDATION" />
    <Op class="dtv.pos.nosale.CreateNoSaleTransactionOp" />
    <PromptOp class="dtv.pos.nosale.PromptNoSaleReasonCodeOp" />
    <Op class="dtv.pos.hardware.op.UseIpCashDrawerPromptOp" />
    <PromptOp class="dtv.pos.hardware.op.IpCashDrawerScanOp" validationsBean="scanIpCashDrawerRules" breakpoint="true"/>
    <Op class="dtv.pos.hardware.op.OpenCashDrawerOp" />
    <WorkerOp workersBean="completeNoSaleTransWorkers" />
    <WorkerOp workersBean="updateCashDrawerIdWorkers" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
    <WorkerOp workersBean="clearActiveCashDrawerWorkers" />
    <Op class="dtv.pos.security.op.StartAutoLogoutTimerOp" />
  </OpChain>

  <OpChain name="ROLLBACK_NO_SALE_TRANS" >
    <OpChainRoute>
      <Choice chainKey="CANCEL_TRANSACTION" chainType="START" condition="dtv.pos.register.condition.NoTransRunCondition" />
      <Choice chainKey="CANCEL_NO_TRANSACTION" chainType="START" />
    </OpChainRoute>
  </OpChain>

  <!-- Chains related to the selling of items -->
  <OpChain name="PRE_SALE_TRANSACTION" contextKey="PRE_SALE" rollbackChainKey="ROLLBACK_TRANS_PROMPT">
    <OpChainRoute chainKey="PRE_TRANS_TILL_VALIDATION" />

    <Op class="dtv.pos.register.PreSaleTransactionOp" />
    <Op class="dtv.pos.register.itemmessages.DisplayInstructionsOp">
      <Parameter name="FILENAME" value="_instructionalMsg" />
    </Op>
    <Op class="dtv.pos.register.giftreceipt.GiftReceiptClearSelectedItemsOp" />
    <Op class="dtv.pos.security.op.StartAutoLogoutTimerOp" />
    <ValidationOp validationsBean="isNotInUpdateRequiredPeriodValidations"/>

    <OpChainRoute chainKey="PRE_TRANS_COMMISSIONED_ASSOCIATES" condition="!dtv.pos.commission.CommissionByItem" />

    <WorkerOp workersBean="registerWorkstationActiveWorkers"/>

    <!-- AIRSIDE CHAIN -->
    <OpChainRoute chainKey="AIRPORT_PRE_SALE" condition="dtv.pos.flight.AirsideEnabledCondition"/>

    <Op class="dtv.pos.common.TransactionPropertyPromptOp">
      <Parameter name="TransactionState" value="PRE_SALE" />
      <Parameter name="PromptWithoutSaleLines" value="true" />
    </Op>
    <OpChainRoute chainKey="PRE_SALE.1" />
    <Op class="dtv.pos.customer.RunCustAssociationChainOp" />
    <Op class="dtv.pos.register.HideCustomerInformationPanelOp" />
    <Op class="dtv.pos.register.RouteSalesChainFromConfigOp" contextKey="SALE" />
  </OpChain>
  <OpChain name="PRE_SALE.1" />
  <!-- Start Commissioned Associates Section -->
  <OpChain name="PRE_TRANS_COMMISSIONED_ASSOCIATES">
    <Op class="dtv.pos.commission.RouteCommAssocOp" />
    <Op class="dtv.pos.commission.SetDefaultCommissionAssociatesOp" />
  </OpChain>
  <!-- Start Commissioned Associates List Prompt Section -->
  <OpChain name="COMMISSIONED_ASSOC_LIST">
    <PromptOp class="dtv.pos.commission.PromptCommAssocListOp" />
  </OpChain>
  <!-- Start Commissioned Associates Focus Bar Prompt Section -->
  <OpChain name="COMMISSIONED_ASSOC_FOCUS_BAR">
    <PromptOp class="dtv.pos.commission.PromptCommAssocOp" validationsBean="commissionByIdRules" />
  </OpChain>
  <!-- change line change commissioned associates on a sale return line item -->
  <OpChain name="CHANGE_COMMISSIONED_ASSOCIATES" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.GetSelectedSaleLineOp" validationsBean="saleItemChangeCommissionRules" />
    <Op class="dtv.pos.commission.RouteChangeCommAssocOp" />
    <Op class="dtv.pos.commission.UpdateCommModifierOp" />
  </OpChain>
  <OpChain name="CHANGE_COMMISSIONED_ASSOCIATES_TOUCH" signal="TransactionModified">
    <ValidationOp class="dtv.pos.register.GetSelectedSaleLineFromTouchOp" validationsBean="saleItemChangeCommissionRules" />
    <Op class="dtv.pos.commission.RouteChangeCommAssocOp" />
    <Op class="dtv.pos.commission.UpdateCommModifierOp" />
  </OpChain>
  <OpChain name="ITEM_COMMISSIONED_ASSOCIATES">
    <Op class="dtv.pos.commission.RouteCommAssocOp" />
    <Op class="dtv.pos.commission.CreateModifiersFromSelectedEmployeesOp" />
  </OpChain>
  <OpChain name="ITEM_DEFAULT_COMMISSIONED_ASSOCIATES">
    <Op class="dtv.pos.commission.CreateModifiersFromDefaultOp" />
  </OpChain>
  <!-- End Commissioned Associates Section -->
  <OpChain name="RESET_REGISTER">
    <WorkerOp workersBean="clearActiveCashDrawerWorkers" />
    <Op class="dtv.pos.common.ClearStationModelOp" />
    <Op class="dtv.pos.customer.loyalty.ClearLoyaltyOp" />
    <Op class="dtv.pos.hardware.op.ItemCustDisplayOp" />
    <Op class="dtv.pos.order.ResetOrderMgrOp" />
    <Op class="dtv.pos.hardware.op.IdleCustomerDisplayOp" required="false" />
    <Op class="dtv.pos.customer.view.ClearCustomerMessageViewOp" />
<!--     <Op class="dtv.pos.register.UpdateCurrentTransListOp" /> -->
    <OpChainRoute chainKey="RESET_REGISTER.local.post" />
  </OpChain>
  <OpChain name="RESET_REGISTER.local.post" />
  <OpChain name="PROMPT_CANCEL_TRANSACTION">
    <PromptOp class="dtv.pos.common.op.PromptCancelTransactionOp" />
  </OpChain>
  <OpChain name="CANCEL_TRANSACTION" signal="TransactionCancelled">
  <!-- 03/03/2006 This chain is meant to be a simple cancel transation chain
      that can be used anywhere in the application and not just in the register -->
    <OpChainRoute chainKey="CANCEL_TRANSACTION.pre" />
    <Op class="dtv.pos.coupon.VoidAuthorizedCouponsOp" />
    <WorkerOp workersBean="completeCancelTransWorkers" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <Op class="dtv.pos.customer.view.ClearCustomerMessageViewOp" />
    <Op class="dtv.pos.hardware.op.BuildRcptsOp" />
    <WorkerOp workersBean="emailRcptsWorkers" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <WorkerOp workersBean="saveRcptsWorkers" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
    <OpChainRoute chainKey="CANCEL_TRANSACTION.post" />
  </OpChain>
  <OpChain name="CANCEL_NO_TRANSACTION" />
  <OpChain name="CANCEL_TRANSACTION.pre" />
  <OpChain name="CANCEL_TRANSACTION.post" />
  <OpChain name="RESET_AFTER_TRANS">
    <Op class="dtv.pos.framework.op.OpChainRollbackToTopOp">
      <Parameter name="ProcessTopChain" value="false" />
    </Op>
    <OpChainRoute chainKey="UPDATE_PROMPTS_ROLLBACK" condition="dtv.pos.register.condition.RegisterNotInTrainingModeRunCondition" />
    <WorkerOp workersBean="registerWorkstationActiveWorkers" />
    <WorkerOp workersBean="saveSystemTimeWorkers" />
    <PromptOp class="dtv.pos.register.StoreCloseWarningOp" key="WORKSTATION_WARNING" />
    <PromptOp class="dtv.pos.register.StoreCloseGraceOp" key="WORKSTATION_GRACE" />
    <PromptOp class="dtv.pos.register.StoreCloseGraceExpiredOp" key="WORKSTATION_GRACE_EXPIRED" />
    <Op class="dtv.pos.systemcycle.access.EndOfDayTimeCheckOp" />
    <Op class="dtv.pos.register.ResetAfterTransactionOp" />
  </OpChain>
  <OpChain name="VALIDATE_ALLOW_ROLLBACK_TRANS">
    <Op class="dtv.pos.register.ValidateAllowRollbackTransOp" validationsBean="postVoidRollBackRules" />
  </OpChain>
  <OpChain name="ROLLBACK_TRANS_PROMPT">
    <OpChainRoute chainKey="VALIDATE_ALLOW_ROLLBACK_TRANS" />
    <Op class="dtv.pos.register.PromptRollbackTransOp" />
  </OpChain>
  <OpChain name="ROLLBACK_TRANS_PROMPT_EXCHANGE">
    <PromptOp class="dtv.pos.tender.exchange.PromptRollbackExchangeOp" />
  </OpChain>
  <OpChain name="ROLLBACK_TRANS_EXCHANGE">
  <!-- A command needs to be used here to make sure we can load the current
         transaction.  This fixes a bug where you can cancel a just created
         transaction and get a null pointer exception because the running
         command doesn't have visibility on that transaction.  -->
    <PromptOp class="dtv.pos.register.PromptTransactionCancelReasonCodeOp" required="true" />
    <Op class="dtv.tenderauth.storedvalue.RouteReverseSVAuthOp" />
    <Op class="dtv.pos.houseaccount.op.RouteReverseARPaymentAuthOp" />
    <OpChainRoute chainKey="CANCEL_TRANSACTION" />
    <OpChainRoute chainKey="RESET_REGISTER" />
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>

  <OpChain name="ROLLBACK_TRANS_START">
    <!-- A command needs to be used here to make sure we can load the current
         transaction.  This fixes a bug where you can cancel a just created
         transaction and get a null pointer exception because the running
         command doesn't have visibility on that transaction.  -->
    <OpChainRoute chainKey="ROLLBACK_TRANS_START_IMPL" />
    <OpChainRoute chainKey="ROLLBACK_TRANS_FINISH" chainType="START" />
  </OpChain>

  <OpChain name="ROLLBACK_TRANS_START_IMPL">
    <PromptOp class="dtv.pos.register.PromptTransactionCancelReasonCodeOp" required="true" />
    <Op class="dtv.tenderauth.storedvalue.RouteReverseSVAuthOp" />
    <Op class="dtv.pos.houseaccount.op.RouteReverseARPaymentAuthOp" />
  </OpChain>
  <OpChain name="ROLLBACK_TRANS_FINISH" signal="TransactionCancelled">
    <OpChainRoute chainKey="ROLLBACK_TRANS_FINISH_IMPL" />
    <OpChainRoute chainKey="ROLLBACK_TRANS_FINISH.local" />
    <OpChainRoute chainKey="RESET_REGISTER" />
    <OpChainRoute chainKey="RESET_AFTER_TRANS" chainType="START" />
  </OpChain>
  <OpChain name="ROLLBACK_TRANS_FINISH_IMPL">
    <WorkerOp workersBean="calculateTlogSequenceWorkers" />
    <Op class="dtv.pos.customer.award.VoidAwardsFromTransactionOp" />
    <Op class="dtv.pos.customer.loyalty.VoidLoyaltyPurchaseFromTransactionOp" />
    <Op class="dtv.pos.coupon.VoidAuthorizedCouponsOp" />
    <WorkerOp workersBean="completeCancelTransWorkers" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <Op class="dtv.pos.hardware.op.BuildRcptsOp" />
    <WorkerOp workersBean="emailRcptsWorkers" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <WorkerOp workersBean="saveRcptsWorkers" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
  </OpChain>
  <OpChain name="ROLLBACK_TRANS_FINISH.local" />
  <OpChain name="CANCEL_SUSPENDED_TRANS" signal="TransactionCancelled">
    <OpChainRoute chainKey="RESUME_TRANSACTION_IMPL" />
    <Op class="dtv.tenderauth.storedvalue.RouteReverseSVAuthOp" />
    <Op class="dtv.pos.houseaccount.op.RouteReverseARPaymentAuthOp" />
    <OpChainRoute chainKey="ROLLBACK_TRANS_FINISH_IMPL" />
  </OpChain>
  <OpChain name="BACKTO_SALE_ITEM" signal="TransactionModified">
    <OpChainRoute chainKey="BACKTO_SALE_ITEM_START.local" />
    <Op class="dtv.pos.charity.VoidDonationLineItemOp" />
    <OpChainRoute chainKey="SALE_ITEM_START" chainType="START" />
  </OpChain>
  <OpChain name="BACKTO_SALE_ITEM_START.local">
    <OpChainRoute chainKey="BACKTO_SALE_ITEM_START.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="BACKTO_SALE_ITEM_START.post" />
  </OpChain>
  <OpChain name="BACKTO_SALE_ITEM_START.pre" />
  <OpChain name="BACKTO_SALE_ITEM_START.post" />
  <OpChain name="EXCHANGE_TRNSACTION_TOTAL_LESS_THAN_ZERO_MSG">
    <Op class="dtv.pos.register.itemmessages.DisplayExchangeTransInvalidTotalInstructionsOp">
      <Parameter name="FILENAME" value="_instructionalTransTotalTemplate" />
    </Op>
  </OpChain>
  <OpChain name="TRANSACTION_TOTAL_IS_GREATER_THAN_CONFIGURED_AMOUNT_MSG">
    <Op class="dtv.pos.register.itemmessages.DisplayTransTotalOverTheLimitInstructionsOp">
      <Parameter name="FILENAME" value="_instructionalTransTotalTemplate" />
    </Op>
  </OpChain>
  <OpChain name="USER_INPUT_IS_DISABLED_MSG">
    <Op class="dtv.pos.register.itemmessages.DisplayInstructionsOp">
      <Parameter name="FILENAME" value="_instructionalDisabledMsg" />
    </Op>
  </OpChain>
  <OpChain name="DISPLAY_REGULAR_MSG">
    <Op class="dtv.pos.register.itemmessages.DisplayInstructionsOp">
      <Parameter name="FILENAME" value="_instructionalMsg" />
    </Op>
  </OpChain>
  <OpChain name="DISPLAY_INFO_TAB_MESSAGE">
    <OpChainRoute>
      <Choice chainKey="EXCHANGE_TRNSACTION_TOTAL_LESS_THAN_ZERO_MSG" condition="dtv.pos.register.sale.condition.IsExchangeTransactionTotalLessThanZero" />
      <Choice chainKey="TRANSACTION_TOTAL_IS_GREATER_THAN_CONFIGURED_AMOUNT_MSG" condition="dtv.pos.register.sale.condition.IsTotalGreaterThanConfiguredAmount" />
      <Choice chainKey="USER_INPUT_IS_DISABLED_MSG" condition="dtv.pos.register.condition.IsInputDisabled" />
      <Choice chainKey="DISPLAY_REGULAR_MSG" />
    </OpChainRoute>
  </OpChain>
  <!-- Start Sale Item section -->
  <OpChain name="SALE_ITEM_START" contextKey="SALE" rollbackChainKey="ROLLBACK_TRANS_PROMPT"
    rollbackLevel="10">
    <OpChainRoute chainKey="DISPLAY_INFO_TAB_MESSAGE" />
    <Op class="dtv.pos.hardware.op.ItemCustDisplayOp" />
    <PromptOp class="dtv.pos.register.sale.PromptItemScanOp" contextKey="SALE" breakpoint="true" />
    <ValidationOp validationsBean="itemIdRules" />
    <ValidationOp class="dtv.pos.coupon.LookupCouponFromItemIdOp" validationsBean="couponVerificationRules" />
    <Op class="dtv.pos.document.bounceback.op.LookupBounceBackCouponOp" />
    <ValidationOp class="dtv.pos.register.sale.CheckItemNotOnFileOp" validationsBean="itemNotOnFileRules" />
    <ValidationOp validationsBean="sellingIdGroupRules" />
    <OpChainRoute chainKey="SALE_ITEM_AFTER_LOOKUP" />
  </OpChain>
  <OpChain name="SALE_ITEM_AFTER_LOOKUP">
    <ValidationOp validationsBean="itemAvailableForSaleRules" />
    <PromptOp class="dtv.pos.item.restriction.PromptForCashierAgeVerificationOp">
      <Parameter name="SaleItemType" value="SALE" />
    </PromptOp>
    <ValidationOp validationsBean="sellingIdGroupRules" />
    <Op class="dtv.pos.register.CreateSaleLineItemOp" />
    <Op class="dtv.pos.register.sale.CheckStyleLookupOp">
      <Parameter name="SaleItemType" value="SALE" />
    </Op>
    <ValidationOp validationsBean="itemAvailabilityRules" />
    <PromptOp class="dtv.pos.register.sale.PromptForItemWeightOp" validationsBean="itemWeightRules" />
    <PromptOp class="dtv.pos.register.PromptBirthDateScanOp" />
    <PromptOp class="dtv.pos.register.MinimumAgeValidationOp" />
<!-- <Op class="dtv.pos.register.sale.RouteSaleItemOp" /> -->
    <OpChainRoute>
      <!-- @todo add routing to more chains as more types of items are converted, see RouteSaleItemOp
           Warrantries and house account payments still need to be handled. -->
      <Choice chainKey="SALE_ITEM_FINISH" condition="dtv.pos.register.IsPhysicalItem" />
      <Choice chainKey="SALE_VOUCHER_START">
        <Condition class="dtv.pos.register.IsNonPhysicalItem">
          <Parameter name="ItemType" value="VOUCHER" />
        </Condition>
      </Choice>
      <Choice chainKey="CREDIT_PAYMENT">
        <Condition class="dtv.pos.register.IsNonPhysicalItem">
          <Parameter name="ItemType" value="CREDIT_PAYMENT" />
        </Condition>
      </Choice>
      <Choice chainKey="SALE_WARRANTY">
        <Condition class="dtv.pos.register.IsNonPhysicalItem">
          <Parameter name="ItemType" value="WARRANTY" />
        </Condition>
      </Choice>
      <Choice chainKey="SALE_WARRANTY_GIFT">
        <Condition class="dtv.pos.register.IsNonPhysicalItem">
          <Parameter name="ItemType" value="WARRANTY_GIFT" />
        </Condition>
      </Choice>
      <Choice chainKey="SALE_WARRANTY_RENEW">
        <Condition class="dtv.pos.register.IsNonPhysicalItem">
          <Parameter name="ItemType" value="WARRANTY_RENEWAL" />
        </Condition>
      </Choice>
      <Choice chainKey="SALE_NON_PHYSICAL_FINISH" condition="dtv.pos.register.IsNonPhysicalItem" />
    </OpChainRoute>
    <OpChainRoute chainKey="SALE_ITEM_AFTER_LOOKUP.finish" />
  </OpChain>
  <OpChain name="SALE_ITEM_AFTER_LOOKUP.finish" />
  <OpChain name="REDEEM_VOUCHER_COUPON_START">
    <Op class="dtv.pos.pricing.discount.voucher.GatherVoucherDiscountInformationOp" />
    <Op class="dtv.pos.pricing.discount.RouteDiscountOp" />
  </OpChain>
  <OpChain name="REDEEM_TRANSACTION_VOUCHER_COUPON_START">
    <PromptOp class="dtv.pos.tender.voucher.PromptVoucherNumberOp" validationsBean="voucherNumberItemRules">
      <Parameter name="LineItemType" value="DISCOUNT" />
    </PromptOp>
    <ValidationOp validationsBean="voucherTypeItemRules" />
    <PromptOp class="dtv.pos.tender.cid.PromptGiftCardCidOp" validationsBean="cidRules" />
    <PromptOp class="dtv.tenderauth.storedvalue.PromptForPINOp" validationsBean="voucherPinRules" />
    <Op class="dtv.pos.pricing.discount.voucher.SetDiscountVoucherAmountOp" />
    <ValidationOp validationsBean="transactionDiscountRules" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountReasonOp" />
    <PromptOp class="dtv.pos.pricing.discount.PromptForAmountPercentOp" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountSerialNumberOp" validationsBean="nonNullSerialNumberRules" />
    <Op class="dtv.pos.pricing.discount.AddDiscountLineItemToTransactionOp" />
    <Op class="dtv.pos.pricing.discount.voucher.AddVoucherToLineItemOp" />
    <Op class="dtv.tenderauth.storedvalue.AuthorizeCardOp">
      <Parameter name="amountChangedPromptKey" value="GIFT_CARD_CHANGE_AMT_NO_OLD" />
    </Op>
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
    <Op class="dtv.pos.pricing.discount.ValidateDiscountCompatibilityOp" />
    <Op class="dtv.pos.pricing.discount.AddTransDiscountPriceModifiersOp" />
    <Op class="dtv.pos.pricing.discount.PlayDiscountSoundOp" />
    <Op class="dtv.pos.pricing.discount.DisplayDiscountPromptOp" />
    <Op class="dtv.pos.sendsale.op.UpdateTransDiscSendSaleItemsOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>
  <OpChain name="REDEEM_LINE_ITEM_VOUCHER_COUPON_START">
    <PromptOp class="dtv.pos.register.GetSelectedSaleLineOp" validationsBean="saleItemModifyRules" />
    <PromptOp class="dtv.pos.tender.voucher.PromptVoucherNumberOp">
      <Parameter name="LineItemType" value="DISCOUNT" />
    </PromptOp>
    <ValidationOp validationsBean="voucherTypeItemRules" />
    <Op class="dtv.tenderauth.storedvalue.FindExistingAuthOp" />
    <PromptOp class="dtv.pos.tender.cid.PromptGiftCardCidOp" validationsBean="cidRules" />
    <PromptOp class="dtv.tenderauth.storedvalue.PromptForPINOp" validationsBean="voucherPinRules" />
    <Op class="dtv.pos.pricing.discount.voucher.SetDiscountVoucherAmountOp" />
    <ValidationOp validationsBean="discountRules" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountReasonOp" />
    <PromptOp class="dtv.pos.pricing.discount.PromptForAmountPercentOp" validationsBean="lineItemDiscountRules" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountSerialNumberOp" validationsBean="nonNullSerialNumberRules" />
    <Op class="dtv.pos.pricing.discount.AddDiscountLineItemToTransactionOp" />
    <Op class="dtv.pos.pricing.discount.voucher.AddVoucherToLineItemOp" />
    <Op class="dtv.tenderauth.storedvalue.AuthorizeCardOp">
      <Parameter name="amountChangedPromptKey" value="GIFT_CARD_CHANGE_AMT_NO_OLD" />
    </Op>
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
    <Op class="dtv.pos.pricing.discount.ValidateDiscountCompatibilityOp" />
    <Op class="dtv.pos.pricing.discount.AddPriceModifierToTransactionOp" />
    <Op class="dtv.pos.pricing.discount.PlayDiscountSoundOp" />
    <Op class="dtv.pos.pricing.discount.DisplayDiscountPromptOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
    <Op class="dtv.pos.sendsale.op.RouteSendSaleLineItemDiscOp" />
  </OpChain>
  <!-- End Sale Item section -->
  <!-- Start Sale Item Finish section -->
  <OpChain name="SALE_ITEM_FINISH" signal="TransactionModified">
    <OpChainRoute>
      <Choice chainKey="REQUIRED_CUSTOMER_ASSOCIATION" condition="dtv.pos.register.sale.CustomerRequiredForItem" />
      <Choice chainKey="OPTIONAL_CUSTOMER_ASSOCIATION" condition="dtv.pos.register.sale.CustomerOptionalForItem" />
    </OpChainRoute>
    <OpChainRoute chainKey="SALE_ITEM_VALIDATE" />
    <OpChainRoute chainKey="SALE_ITEM_ADD" />
    <OpChainRoute chainKey="SALE_ATTACHED_WARRANTY" />
  </OpChain>
  <OpChain name="SALE_ITEM_ADD">
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <WorkerOp workersBean="addTransDiscountsToNewItemWorkers" />
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <OpChainRoute chainKey="DISPLAY_INFO_TAB_MESSAGE" />
    <Op class="dtv.pos.register.itemmessages.DisplayItemMessagesOp" />
    <PromptOp class="dtv.pos.register.attacheditems.PromptAttachedItemsOp" />
    <Op class="dtv.pos.register.attacheditems.AttachedItemsIteratingOp">
      <Parameter name="chainKey" value="SALE_ITEM_AFTER_LOOKUP" />
    </Op>
    <OpChainRoute chainKey="NOTIFY_ATTACHED_ITEMS" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>
  <!-- Handles attached item notification if THIS item was an attached item -->
  <OpChain name="NOTIFY_ATTACHED_ITEMS">
    <Op class="dtv.pos.register.attacheditems.CreateAttachedItemAssociationOp" />
    <Op class="dtv.pos.register.attacheditems.NotifyAttachedItemOp" />
  </OpChain>
  <!-- This chain handles adding the attached items using the standard add item logic with the attached item in scope -->
  <!-- Start Sale Item Finish section -->
  <!-- Start Sale Item Sub-section -->
  <OpChain name="SALE_ITEM_VALIDATE">
    <OpChainRoute chainKey="SALE_ITEM_VALIDATE.local.pre" />
    <OpChainRoute chainKey="SALE_ITEM_VALIDATE.pre" />
    <PromptOp class="dtv.pos.register.PromptItemDescriptionOp" validationsBean="itemDescriptionRules" />
    <PromptOp class="dtv.pos.register.PromptItemQuantityOp" validationsBean="saleItemQuantityRules" />
    <ValidationOp class="dtv.pos.register.ValidateItemQtyWithoutPromptQtyOp" validationsBean="saleItemQtyNoPromptRules" />
    <Op class="dtv.pos.kits.CreateKitOp" />
    <Op class="dtv.pos.inventory.op.InventoryLocationWhileOp">
      <Parameter name="ChainKey" value="SALE_ALLOCATE_QUANTITY" />
    </Op>
    <Op class="dtv.pos.register.modifyitem.UpdateChangedQuantityOp" />
    <PromptOp class="dtv.pos.register.PromptItemSerialNumberOp" validationsBean="serialNumberSaleRules" />
    <Op class="dtv.pos.register.KitComponentIteratingOp">
      <Parameter name="ChainKey" value="KIT_COMPONENT_SERIAL_NUMBER" />
    </Op>
    <PromptOp class="dtv.pos.register.ItemPropertyPromptOp" validationsBean="itemPromptPropertyRules" />
    <PromptOp class="dtv.pos.register.PromptItemPriceOp" validationsBean="itemPriceRules" />
    <OpChainRoute chainKey="SALE_ITEM_VALIDATE.post" />
  </OpChain>
  <OpChain name="SALE_ITEM_VALIDATE.local.pre" />
  <OpChain name="SALE_ITEM_VALIDATE.pre" />
  <OpChain name="SALE_ITEM_VALIDATE.post" />
  <OpChain name="SALE_ALLOCATE_QUANTITY">
    <Op class="dtv.pos.inventory.op.DetermineInventoryLocationOp" />
    <PromptOp class="dtv.pos.register.PromptLocationQuantityOp" validationsBean="itemLocationQuantityRules" />
    <Op class="dtv.pos.kits.inventory.HandleKitComponentInventoryOp" />
  </OpChain>
  <OpChain name="SALE_ALLOCATE_QUANTITY_CHANGE">
    <Op class="dtv.pos.inventory.op.DetermineInventoryLocationOp" />
    <PromptOp class="dtv.pos.register.PromptLocationQuantityChangeOp" validationsBean="itemLocationQuantityRules" />
    <Op class="dtv.pos.kits.inventory.HandleKitComponentInventoryOp" />
  </OpChain>
  <OpChain name="KIT_COMPONENT_SERIAL_NUMBER">
    <PromptOp class="dtv.pos.register.PromptKitComponentSerialNumberOp" validationsBean="serialNumberSaleRules" />
  </OpChain>
  <!-- - - - - - - - start CHANGE ITEM TAX chains - - - - - - - -->
  <OpChain name="TAX_ITEM_CHANGE_LOCATION" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.GetSelectedSaleLineOp" validationsBean="saleItemModifyRules" />
    <PromptOp class="dtv.pos.register.tax.PromptPostalCodeOp" validationsBean="postalCodeRules" breakpoint="true" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxLocationOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxChangeReasonOp" />
    <Op class="dtv.pos.register.tax.ChangeTaxGroupRuleOp" />
  </OpChain>
  <OpChain name="TAX_ITEM_EXEMPT" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.GetSelectedSaleLineOp" validationsBean="saleItemModifyRules" />
    <Op class="dtv.pos.register.tax.op.SetTaxExemptScope" />
    <Op class="dtv.pos.register.tax.PromptSelectItemTaxOp" />
    <OpChainRoute chainKey="REQUIRED_CUSTOMER_ASSOCIATION" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxExemptionOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxExemptReasonOp" breakpoint="true" />
    <Op class="dtv.pos.register.tax.SaveTaxExemptOp" />
    <Op class="dtv.pos.register.tax.ChangeTaxToExemptOp" />
  </OpChain>
  <OpChain name="TAX_EXEMPTION_EDIT_WITHIN_SALE">
    <Op class="dtv.pos.register.tax.EditTaxExemptionOp" />
  </OpChain>
  <OpChain name="TAX_ITEM_CHANGE_AMOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.GetSelectedSaleLineOp" validationsBean="saleItemModifyRules" />
    <Op class="dtv.pos.register.tax.PromptSelectItemTaxOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxAmountOp" validationsBean="taxAmountRules" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxChangeReasonOp" />
    <Op class="dtv.pos.register.tax.ChangeTaxAmountOp" />
  </OpChain>
  <OpChain name="TAX_ITEM_CHANGE_PERCENT" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.GetSelectedSaleLineOp" validationsBean="saleItemModifyRules" />
    <Op class="dtv.pos.register.tax.PromptSelectItemTaxOp" />
    <OpChainRoute chainKey="TAX_CHANGE_PERCENT" />
    <Op class="dtv.pos.register.tax.ChangeTaxPercentOp" />
  </OpChain>
  <!-- - - - - - - - end CHANGE ITEM TAX chains - - - - - - - -->
  <!-- - - - - - - - start CHANGE TRAN TAX chains - - - - - - - -->
  <OpChain name="TAX_TRAN_EXEMPT" signal="TransactionModified">
    <Op class="dtv.pos.register.tax.op.SetTaxExemptScope" />
    <Op class="dtv.pos.register.tax.PromptSelectTranTaxOp" />
    <OpChainRoute chainKey="REQUIRED_CUSTOMER_ASSOCIATION" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxExemptionOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxExemptReasonOp" breakpoint="true" />
    <Op class="dtv.pos.register.tax.ChangeTranTaxToExemptOp" />
  </OpChain>
  <OpChain name="TAX_TRAN_CHANGE_LOCATION" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.tax.PromptPostalCodeOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxLocationOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxChangeReasonOp" />
    <Op class="dtv.pos.register.tax.ChangeTransTaxGroupRuleOp" />
  </OpChain>
  <OpChain name="TAX_TRAN_CHANGE_AMOUNT" signal="TransactionModified">
    <Op class="dtv.pos.register.tax.PromptSelectTranTaxOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxAmountOp" validationsBean="taxAmountRules" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxChangeReasonOp" />
    <Op class="dtv.pos.register.tax.ChangeTaxAmountOp" />
  </OpChain>
  <OpChain name="TAX_TRAN_CHANGE_PERCENT" signal="TransactionModified">
    <ValidationOp validationsBean="validateItemsTranChangeTaxRate" />
    <Op class="dtv.pos.register.tax.PromptSelectTranTaxOp" />
    <OpChainRoute chainKey="TAX_CHANGE_PERCENT"/>
    <Op class="dtv.pos.register.tax.ChangeTaxPercentOp" />
  </OpChain>
  <!-- - - - - - - - end CHANGE TRAN TAX chains - - - - - - - -->
  <OpChain name="REQUIRED_CUSTOMER_ASSOCIATION">
    <Op class="dtv.pos.customer.EnsureCustomerAssignedOp" />
  </OpChain>
  <OpChain name="OPTIONAL_CUSTOMER_ASSOCIATION">
    <Op class="dtv.pos.customer.PromptForCustomerOp" />
  </OpChain>
  <!-- START Change tax rate chain -->
  <OpChain name="TAX_CHANGE_PERCENT" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.tax.PromptTaxPercentOp" validationsBean="taxPercentRules" />
    <PromptOp class="dtv.pos.register.tax.op.PromptTaxPercentListOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxChangeReasonOp" />
    <OpChainRoute chainKey="TAX_CHANGE_PERCENT_CHANGE_OPS"/>
  </OpChain>

  <OpChain name="TAX_CHANGE_PERCENT_CHANGE_OPS" signal="TransactionModified">
    <Op class="dtv.pos.register.tax.op.ChangePriceByTaxChangeOp" />
    <Op class="dtv.pos.register.tax.op.ChangeTaxModifiers" />
  </OpChain>
  <!-- END Change tax rate chain -->
  <!-- - - - - - - - start NEW ITEM TAX chains - - - - - - - -->
  <OpChain name="SALE_TAXING">
    <OpChainRoute>
      <Choice chainKey="RETURN_ITEM_TAXING" condition="dtv.pos.register.sale.IsReturnLine" />
      <Choice chainKey="SENDSALE_ITEM_TAXING">
        <Condition class="dtv.pos.register.sale.IsSaleItemType">
          <Parameter name="SaleItemType" value="SEND_SALE" />
        </Condition>
      </Choice>
      <Choice chainKey="SALE_ITEM_TAXING" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="SALE_ITEM_TAXING">
    <Op class="dtv.pos.register.tax.CalculateSaleItemTaxOp" />
  </OpChain>
  <OpChain name="RETURN_ITEM_TAXING">
    <Op class="dtv.pos.register.tax.CalculateReturnItemTaxOp" />
  </OpChain>
  <OpChain name="SENDSALE_ITEM_TAXING">
    <Op class="dtv.pos.customer.account.op.InitCustAcctTypeOp">
      <Parameter name="TYPE" value="SEND_SALE" />
    </Op>
    <Op class="dtv.pos.register.tax.CalculateSendSaleItemTaxOp" />
  </OpChain>
  <!-- - - - - - - - end NEW ITEM TAX chains - - - - - - - -->
  <!-- - - - - - - - Start Sale Item Sub-section - - - - - - - -->
  <!-- Start Chains related to the selling of non-physical items -->
  <OpChain name="SALE_NON_PHYSICAL_START">
    <PromptOp class="dtv.pos.register.nonphysical.PromptSaleNonPhysicalItemOp">
      <Parameter name="EXCLUDE_NPI_TYPE" value="VOUCHER" />
    </PromptOp>
    <ValidationOp validationsBean="sellingIdGroupRules" />
    <PromptOp class="dtv.pos.register.PromptBirthDateScanOp" />
    <Op class="dtv.pos.register.MinimumAgeValidationOp" />
    <OpChainRoute>
      <!-- @todo add routing to more chains as more types of items are converted, see RouteSaleItemOp
           Warrantries and house account payments still need to be handled. -->
      <Choice chainKey="CREDIT_PAYMENT">
        <Condition class="dtv.pos.register.IsNonPhysicalItem">
          <Parameter name="ItemType" value="CREDIT_PAYMENT" />
        </Condition>
      </Choice>
      <Choice chainKey="SALE_WARRANTY">
        <Condition class="dtv.pos.register.IsNonPhysicalItem">
          <Parameter name="ItemType" value="WARRANTY" />
        </Condition>
      </Choice>
      <Choice chainKey="SALE_WARRANTY_GIFT">
        <Condition class="dtv.pos.register.IsNonPhysicalItem">
          <Parameter name="ItemType" value="WARRANTY_GIFT" />
        </Condition>
      </Choice>
      <Choice chainKey="SALE_WARRANTY_RENEW">
        <Condition class="dtv.pos.register.IsNonPhysicalItem">
          <Parameter name="ItemType" value="WARRANTY_RENEWAL" />
        </Condition>
      </Choice>
      <Choice chainKey="SALE_NON_PHYSICAL_FINISH" condition="dtv.pos.register.IsNonPhysicalItem" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="SALE_NON_PHYSICAL_FINISH" signal="TransactionModified">
    <Op class="dtv.pos.register.sale.CheckCustomerRequiredOp" />
    <OpChainRoute chainKey="SALE_NON_PHYSICAL_VALIDATE" />
    <OpChainRoute chainKey="SALE_NON_PHYSICAL_AUTHORIZE" />
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <WorkerOp workersBean="addTransDiscountsToNewItemWorkers" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.register.itemmessages.DisplayItemMessagesOp" />
    <PromptOp class="dtv.pos.register.attacheditems.PromptAttachedItemsOp" />
    <Op class="dtv.pos.register.attacheditems.AttachedItemsIteratingOp">
      <Parameter name="chainKey" value="SALE_ITEM_AFTER_LOOKUP" />
    </Op>
    <OpChainRoute chainKey="NOTIFY_ATTACHED_ITEMS" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>
  <OpChain name="SALE_NON_PHYSICAL_VALIDATE">
    <OpChainRoute chainKey="SALE_NON_PHYSICAL_VALIDATE_START.local" />
    <PromptOp class="dtv.pos.register.PromptItemDescriptionOp" validationsBean="itemDescriptionRules" />
    <PromptOp class="dtv.pos.register.PromptItemSerialNumberOp" validationsBean="serialNumberSaleExcludingInventoryRules" />
    <PromptOp class="dtv.pos.register.ItemPropertyPromptOp" validationsBean="itemPromptPropertyRules" />
    <PromptOp class="dtv.pos.register.PromptItemQuantityOp" validationsBean="saleItemQuantityRules" />
    <ValidationOp class="dtv.pos.register.ValidateItemQtyWithoutPromptQtyOp" validationsBean="saleItemQtyNoPromptRules" />
    <PromptOp class="dtv.pos.register.PromptItemPriceOp" validationsBean="itemPriceRules" />
    <OpChainRoute chainKey="SALE_NON_PHYSICAL_VALIDATE_FINISH.local" />
  </OpChain>
  <OpChain name="SALE_NON_PNYSICAL_VALDATE_START.local">
    <OpChainRoute chainKey="SALE_NON_PHSYICAL_VALIDATE_START.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="SALE_NON_PHSYICAL_VALIDATE_START.post" />
  </OpChain>
  <OpChain name="SALE_NON_PHSYICAL_VALIDATE_START.pre" />
  <OpChain name="SALE_NON_PHSYICAL_VALIDATE_START.post" />
  <OpChain name="SALE_NON_PNYSICAL_VALDATE_FINISH.local">
    <OpChainRoute chainKey="SALE_NON_PHSYICAL_VALIDATE_FINISH.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="SALE_NON_PHSYICAL_VALIDATE_FINISH.post" />
  </OpChain>
  <OpChain name="SALE_NON_PHSYICAL_VALIDATE_FINISH.pre" />
  <OpChain name="SALE_NON_PHSYICAL_VALIDATE_FINISH.post" />
  <OpChain name="SALE_NON_PHYSICAL_AUTHORIZE" />
  <OpChain name="SELLING_VOUCHER_EVENT">
    <Op class="dtv.pos.register.nonphysical.RouteVoucherSaleItemOp" />
  </OpChain>
  <!-- Chains related to the selling of voucher -->
  <OpChain name="SALE_VOUCHER_START" signal="TransactionModified">
    <Op class="dtv.pos.register.nonphysical.GatherVoucherSaleItemInfoOp">
      <Parameter name="VoucherActivityCodeType" value="ISSUED" />
    </Op>
    <PromptOp class="dtv.pos.register.nonphysical.PromptSelectVoucherItemOp" />
    <ValidationOp validationsBean="voucherTypeItemRules" />
    <OpChainRoute chainKey="SALE_VOUCHER_FINISH.pre" />
  </OpChain>
  <OpChain name="SALE_VOUCHER_FINISH.pre">
    <OpChainRoute chainKey="SALE_VOUCHER_FINISH" />
  </OpChain>
  <OpChain name="SALE_VOUCHER_FINISH">
    <PromptOp class="dtv.pos.tender.voucher.PromptVoucherNumberOp" validationsBean="voucherNumberItemRules">
      <Parameter name="LineItemType" value="ITEM" />
    </PromptOp>
    <PromptOp class="dtv.pos.register.nonphysical.PromptVoucherAmtOp" validationsBean="voucherItemPriceRules" />
    <Op class="dtv.pos.register.nonphysical.CreateVoucherSaleLineItemOp">
      <Parameter name="SaleItemType" value="SALE" />
    </Op>
    <PromptOp class="dtv.pos.tender.cid.PromptGiftCardCidOp" validationsBean="cidRules" />
    <PromptOp class="dtv.tenderauth.storedvalue.PromptForPINOp" validationsBean="voucherPinRules" />
    <OpChainRoute chainKey="SALE_VOUCHER_VALIDATE" />
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <OpChainRoute chainKey="SIGNAL_TRANSACTION_MODIFIED" />
    <OpChainRoute chainKey="SALE_VOUCHER_AUTHORIZE" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.register.itemmessages.DisplayItemMessagesOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
    <Op class="dtv.pos.register.UpdateCurrentTransListOp" />
  </OpChain>
  <OpChain name="SIGNAL_TRANSACTION_MODIFIED" signal="TransactionModified">
    <Op class="dtv.pos.register.UpdateCurrentTransListOp" />
  </OpChain>
  <OpChain name="SALE_VOUCHER_VALIDATE">
    <OpChainRoute chainKey="SALE_VOUCHER_VALIDATE.local" />
  </OpChain>
  <OpChain name="SALE_VOUCHER_VALIDATE.local">
    <OpChainRoute chainKey="SALE_VOUCHER_VALIDATE.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="SALE_VOUCHER_VALIDATE.post" />
  </OpChain>
  <OpChain name="SALE_VOUCHER_VALIDATE.pre" />
  <OpChain name="SALE_VOUCHER_VALIDATE.post" />
  <OpChain name="SALE_VOUCHER_AUTHORIZE">
    <Op class="dtv.tenderauth.storedvalue.AuthorizeCardOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>
  <!-- End Chains related to the selling of non-physical items -->

  <!-- Tendering related chains -->
  <OpChain name="PRE_TENDERING">
    <ValidationOp validationsBean="amountDueRules" />
    <ValidationOp class="dtv.pos.register.returns.ValidateBlindReturnsAmountOp" validationsBean="returnBlindAmountRules" />
    <OpChainRoute chainKey="PRE_TENDERING.pre" />
    <OpChainRoute chainKey="CHARITY" />
    <!-- Start 183622 -->
    <Op class="dtv.pos.common.TransactionPropertyPromptOp">
      <Parameter name="TransactionState" value="PRE_TENDER" />
    </Op>
    <!-- End 183622 -->
    <PromptOp class="dtv.pos.util.crypto.NagAboutBadEncryptionOp" />
    <OpChainRoute chainKey="PRE_TENDERING.CUSTOMER_CHECK" />
    <OpChainRoute chainKey="PRE_TENDERING.1" />
    <OpChainRoute chainKey="PRE_TENDERING.2" /> <!-- This additional hook can be helpful for supporting fiscal printers -->
    <OpChainRoute chainKey="PRE_TENDERING.3" />
    <OpChainRoute chainKey="REFUND_ORIG_CREDIT_CARD_TENDER" condition="dtv.pos.tender.check.RefundToOrigCreditCardCondition" />
    <Op class="dtv.pos.hardware.op.SubtotalCustomerDisplayOp" />
    <OpChainRoute chainKey="PRE_TENDERING.post" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>

  <OpChain name="PRE_TENDERING.CUSTOMER_CHECK" >
    <Op class="dtv.pos.register.returns.EnsureCustomerAssignedOnNegativeBalanceOp" />
  </OpChain>

  <OpChain name="SET_LAYAWAY_FEE_DEPOSIT_AMOUNT" signal="TransactionModified">
    <Op class="dtv.pos.register.layaway.payment.AddLayawaySetupFeeOp" />
    <PromptOp class="dtv.pos.register.layaway.payment.PromptLayawayDepositOp" validationsBean="depositAmountRules" />
    <ValidationOp class="dtv.pos.register.layaway.payment.ValidateLayawayDepositAmountOp" validationsBean="maxDepositAmountRules" />
    <Op class="dtv.pos.register.layaway.payment.VoidZeroDepositOp" />
  </OpChain>

  <OpChain name="PRE_TENDERING.pre">
    <OpChainRoute chainKey="SET_LAYAWAY_FEE_DEPOSIT_AMOUNT" condition="dtv.pos.register.layaway.LayawayFeesRunConditionOp" />
    <OpChainRoute chainKey="PRE_TENDERING_ACTIVITY.local" />
    <Op class="dtv.pos.coupon.ConfirmProceedWithUnusedCouponsOp" />
  </OpChain>

  <OpChain name="PRE_TENDERING.1" />
  <OpChain name="PRE_TENDERING.2" />
  <OpChain name="PRE_TENDERING.3" />
  <OpChain name="PRE_TENDERING.post" />
  <OpChain name="PRE_TENDERING_ACTIVITY.local">
    <OpChainRoute chainKey="PRE_TENDERING_ACTIVITY.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="PRE_TENDERING_ACTIVITY.local.pre" />
    <OpChainRoute chainKey="PRE_TENDERING_ACTIVITY.post" />
  </OpChain>
  <OpChain name="PRE_TENDERING_ACTIVITY.local.pre" />
  <OpChain name="PRE_TENDERING_ACTIVITY.pre" />
  <OpChain name="PRE_TENDERING_ACTIVITY.post" />
  <OpChain name="REFUND_ORIG_CREDIT_CARD_TENDER" signal="TransactionModified">
    <PromptOp class="dtv.pos.tender.PromptOrigCreditCardsToSelectOp" contextKey="CREDIT_CARD_REFUND" breakpoint="true" />
    <PromptOp class="dtv.pos.tender.PromptOrigCreditCardAmount" validationsBean="originalCardRefundTenderAmountRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.hardware.op.GetPINEntryOp" />
    <Op class="dtv.tenderauth.impl.op.AuthorizeTenderOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>
  <OpChain name="RETURN_RESTOCKING_FEE" signal="TransactionModified">
    <Op class="dtv.pos.register.returns.AddReturnRestockingFeeOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <OpChainRoute chainKey="SALE_TAXING" />
  </OpChain>
  <OpChain name="SAVE_CREDIT_CARD_INPUT">
    <Op class="dtv.pos.tender.SaveTenderInputOp" />
    <OpChainRoute chainKey="SAVE_CREDIT_CRAD_INPUT.post" />
  </OpChain>
  <OpChain name="SAVE_CREDIT_CRAD_INPUT.post" />
  <OpChain name="TENDER_CREDIT_CARD_FROM_ITEMS">
    <OpChainRoute chainKey="SAVE_CREDIT_CARD_INPUT" />
    <Op class="dtv.pos.customer.account.op.RouteCustAcctPreTenderOp" />
    <OpChainRoute chainKey="PRE_TENDERING" chainType="START" />
  </OpChain>
  <OpChain name="CHECK_SALE_COMPLETE">
    <Op class="dtv.pos.register.CheckSaleCompleteOp" />
  </OpChain>
  <OpChain name="RELOAD_VOUCHER_CHANGE_TENDER" signal="TransactionModified">
    <Op class="dtv.pos.tender.voucher.ClearPreviousVoucherOp" />
    <Op class="dtv.pos.tender.voucher.GatherVoucherTenderInformationOp">
      <Parameter name="TenderStatus" value="Change" />
      <Parameter name="VoucherActivityCodeType" value="RELOAD" />
    </Op>
    <OpChainRoute chainKey="VOUCHER_CHANGE_TENDER" />
  </OpChain>
  <OpChain name="ISSUE_VOUCHER_CHANGE_TENDER">
    <Op class="dtv.pos.tender.voucher.ClearPreviousVoucherOp" />
    <Op class="dtv.pos.tender.voucher.GatherVoucherTenderInformationOp">
      <Parameter name="TenderStatus" value="Change" />
      <Parameter name="VoucherActivityCodeType" value="ISSUED" />
    </Op>
    <OpChainRoute chainKey="VOUCHER_CHANGE_TENDER" />
  </OpChain>
  <OpChain name="VOUCHER_CHANGE_TENDER" signal="TransactionModified">
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.voucher.PromptVoucherNumberOp" validationsBean="voucherNumberTenderRules">
      <Parameter name="LineItemType" value="TENDER" />
    </PromptOp>
    <Op class="dtv.pos.tender.voucher.CreateVoucherTenderLineItemOp" />
    <Op class="dtv.pos.tender.change.UpdateChangeTenderAmountOp" />
    <PromptOp class="dtv.pos.tender.cid.PromptGiftCardCidOp" />
    <PromptOp class="dtv.tenderauth.storedvalue.PromptForPINOp" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <Op class="dtv.tenderauth.storedvalue.AuthorizeCardOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>
  <OpChain name="OFFICE_CHECK_CHANGE_TENDER" signal="TransactionModified">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Change" />
      <Parameter name="TenderId" value="HOME_OFFICE_CHECK" />
    </Op>
    <Op class="dtv.pos.tender.change.UpdateChangeTenderAmountOp" />
    <Op class="dtv.pos.tender.VoidTenderOnChainReverseOp">
      <Parameter name="TenderStatus" value="Change" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.homeofficecheck.PromptSendCheckToInfoOp" breakpoint="true"/>
    <OpChainRoute chainKey="FINISH_CHANGE_TENDER" />
  </OpChain>
  <OpChain name="LOCAL_CURRENCY_CHANGE_TENDER" signal="TransactionModified">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Change" />
      <Parameter name="TenderCategory" value="LOCAL_CURRENCY" />
    </Op>
    <Op class="dtv.pos.tender.VoidTenderOnChainReverseOp">
      <Parameter name="TenderStatus" value="Change" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.change.UpdateChangeTenderAmountOp" />
    <OpChainRoute chainKey="FINISH_CHANGE_TENDER" />
  </OpChain>

  <OpChain name="FOREIGN_CURRENCY_CHANGE_TENDER" signal="TransactionModified">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Change" />
    </Op>
    <Op class="dtv.pos.tender.VoidTenderOnChainReverseOp">
      <Parameter name="TenderStatus" value="Change" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.change.UpdateChangeTenderAmountOp">
      <Parameter name="ForeignTender" value="true" />
    </Op>
    <OpChainRoute chainKey="FINISH_CHANGE_TENDER" />
  </OpChain>

  <OpChain name="FINISH_CHANGE_TENDER">
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
  </OpChain>
  <OpChain name="SALE_COMPLETE">
    <OpChainRoute chainKey="SALE_COMPLETE_START" />
    <OpChainRoute chainKey="SALE_COMPLETE_AFTER_START.local.1" />
    <OpChainRoute chainKey="SALE_COMPLETE_AFTER_START.local.2" />
    <OpChainRoute chainKey="SALE_COMPLETE_AFTER_START" />
    <OpChainRoute chainKey="SALE_COMPLETE_BEFORE_FINISH" />
    <OpChainRoute chainKey="SALE_COMPLETE_BEFORE_FINISH.local" />
    <OpChainRoute chainKey="SALE_COMPLETE_ISSUE_DOCUMENT" />
    <OpChainRoute chainKey="SALE_COMPLETE_FINISH" chainType="START" />
  </OpChain>
  <OpChain name="SALE_COMPLETE_ISSUE_DOCUMENT">
    <Op class="dtv.pos.document.op.IssueDocumentOp" />
  </OpChain>
  <OpChain name="SALE_COMPLETE_BEFORE_FINISH.local">
    <OpChainRoute chainKey="SALE_COMPLETE_BEFORE_FINISH.local.pre" />
    <Op class="dtv.pos.hardware.op.CompleteFiscalTransactionOp" longRunning="true" />
    <OpChainRoute chainKey="SALE_COMPLETE_BEFORE_FINISH.local.post" />
    <OpChainRoute chainKey="SALE_COMPLETE_BEFORE_FINISH.invoice" />
  </OpChain>
  <OpChain name="SALE_COMPLETE_BEFORE_FINISH.local.pre" />
  <OpChain name="SALE_COMPLETE_BEFORE_FINISH.local.post" />
  <OpChain name="SALE_COMPLETE_BEFORE_FINISH.invoice" />
  <OpChain name="SALE_COMPLETE_AFTER_START.local.1" />
  <OpChain name="SALE_COMPLETE_AFTER_START.local.2" />
  <OpChain name="SALE_COMPLETE_START">
    <OpChainRoute chainKey="CHECK_FOR_REFUND" />
    <OpChainRoute chainKey="CHECK_FOR_CHANGE" />
    <OpChainRoute chainKey="BEFORE_COMPLETE_SALE" />
  </OpChain>
  <OpChain name="SALE_COMPLETE_AFTER_START" />
  <OpChain name="SALE_COMPLETE_BEFORE_FINISH" />

  <OpChain name="SALE_COMPLETE_FINISH" signal="TransactionComplete">
    <OpChainRoute chainKey="SALE_COMPLETE_FINISH.pre" />
    <PromptOp class="dtv.pos.coupon.PromptReturnUnusedCouponsToCustomerOp" />
    <OpChainRoute chainKey="SALE_COMPLETE_FINISH.pre.1" />
    <OpChainRoute chainKey="SALE_COMPLETE_FINISH.local" />
    <!-- Inventory must be processed before the transaction is persisted!! -->
    <WorkerOp workersBean="saleCompleteInventoryWorkers" />
    <WorkerOp workersBean="completeSaleTransWorkers" />
    <Op class="dtv.pos.common.TransactionPropertyPromptOp">
      <Parameter name="TransactionState" value="POST_TENDER" />
    </Op>
    <Op class="dtv.pos.tender.creditcard.PrepareImprintCreditCardOp" />
    <Op class="dtv.pos.customer.account.op.AddCustomerAccountRcptSourcesOp" />
    <Op class="dtv.pos.register.giftreceipt.GroupGiftReceiptsOp" />
    <Op class="dtv.pos.register.giftreceipt.AddMultipleGiftReceiptsOp" />
    <Op class="dtv.pos.register.giftreceipt.AddGiftRcptSourcesOp" />
    <WorkerOp workersBean="calculateTlogSequenceWorkers" />
    <OpChainRoute chainKey="SALE_COMPLETE_FINISH.1" />
    <OpChainRoute chainKey="SALE_COMPLETE_FINISH.local.1" />
    <OpChainRoute chainKey="SALE_COMPLETE_FINISH.order.1" />
    <!-- todo promote stuff -->
    <OpChainRoute chainKey="SALE_COMPLETE_FINISH.registry.1" />
    <OpChainRoute chainKey="SALE_COMPLETE_FINISH.digitalCart.1" />
    <Op class="dtv.pos.customer.wishlist.op.SellWishListItemsOp" />
    <WorkerOp workersBean="saleCompleteCustomerAccountWorkers" />
    <Op class="dtv.pos.hardware.op.BuildSaleRcptsOp" />
    <OpChainRoute chainKey="SALE_COMPLETE_FINISH.2" />
    <OpChainRoute chainKey="SALE_COMPLETE_FINISH.order.2" />
    <OpChainRoute chainKey="SALE_COMPLETE_FINISH.3" />
    <WorkerOp workersBean="calculateCreditTenderPropertiesWorkers" />
    <WorkerOp workersBean="buildReturnedItemJournalWorkers" />
    <OpChainRoute chainKey="CREATE_WARRANTY_ACTIVITY" />
    <WorkerOp workersBean="updateRainCheckRedemptionStatusWorkers" />
    <Op class="dtv.pos.hardware.op.OpenCashDrawerOp" />
    <WorkerOp workersBean="updateCashDrawerIdWorkers" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <WorkerOp workersBean="persistSystemTotalWorkers" />
    <OpChainRoute chainKey="SALE_COMPLETE_FINISH.FISCAL.AFTER_TRAN_SAVE" />
    <Op class="dtv.pos.customer.view.ClearCustomerMessageViewOp" />
    <WorkerOp workersBean="persistVoucherHistoryWorkers" />
    <!-- Flash sales update sales -->
    <WorkerOp workersBean="populateFlashSalesTablesWorkers" />
    <WorkerOp workersBean="refreshSalesGoalStatusWorkers" />
    <!-- Generate documents -->
    <Op class="dtv.pos.hardware.op.BuildTenderFrankingsOp" />
    <Op class="dtv.pos.hardware.op.FrankTendersOp" />
    <WorkerOp workersBean="emailRcptsWorkers" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <OpChainRoute chainKey="PRINT_DOCUMENTS" />
    <OpChainRoute chainKey="PRINT_WARRANTIES" />
    <WorkerOp workersBean="saveRcptsWorkers" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
    <PromptOp class="dtv.pos.hardware.op.DisplayChangeDueOp" validationsBean="cashDrawerCloseRules" breakpoint="true" />
    <Op class="dtv.pos.till.NotifyTenderMaxValueInTillOp" />
    <Op class="dtv.pos.till.NotifyTenderMinValueInTillOp" />
    <OpChainRoute chainKey="RESET_REGISTER" />
    <PromptOp class="dtv.pos.tender.creditcard.PromptImprintCreditCardOp" />
    <PromptOp class="dtv.tenderretail.PromptImprintNonSAFCreditCardOp" />
    <Op class="dtv.pos.tender.creditcard.PromptSignRcptMsgOp" />
    <WorkerOp workersBean="updateSAFQueueWorkers" />
    <OpChainRoute chainKey="RESET_AFTER_TRANS" chainType="START" />
  </OpChain>
  <OpChain name="SALE_COMPLETE_FINISH.pre" />
  <OpChain name="SALE_COMPLETE_FINISH.pre.1" />
  <OpChain name="SALE_COMPLETE_FINISH.1" />
  <OpChain name="SALE_COMPLETE_FINISH.2" />
  <OpChain name="SALE_COMPLETE_FINISH.3" />
  <OpChain name="SALE_COMPLETE_FINISH.order.1" />
  <OpChain name="SALE_COMPLETE_FINISH.order.2" />
  <OpChain name="SALE_COMPLETE_FINISH.registry.1" />
  <OpChain name="SALE_COMPLETE_FINISH.FISCAL.AFTER_TRAN_SAVE" />
  <OpChain name="SALE_COMPLETE_FINISH.local">
    <OpChainRoute chainKey="SALE_COMPLETE_FINISH.local.pre" />
    <OpChainRoute chainKey="SALE_COMPLETE_FINISH.local.post" />
  </OpChain>
  <OpChain name="SALE_COMPLETE_FINISH.local.pre" />
  <OpChain name="SALE_COMPLETE_FINISH.local.post" />
  <OpChain name="SALE_COMPLETE_FINISH.local.1" />

  <OpChain name="TRANSACTION_COMPLETE" signal="TransactionComplete">
    <WorkerOp workersBean="completeTransactionWorkers" />
    <Op class="dtv.pos.tender.creditcard.PrepareImprintCreditCardOp" />
    <Op class="dtv.pos.hardware.op.BuildTenderFrankingsOp" />
    <Op class="dtv.pos.hardware.op.FrankTendersOp" />
    <Op class="dtv.pos.hardware.op.OpenCashDrawerOp" />
    <Op class="dtv.pos.hardware.op.BuildRcptsOp" />
    <WorkerOp workersBean="updateCashDrawerIdWorkers" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <WorkerOp workersBean="emailRcptsWorkers" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <WorkerOp workersBean="saveRcptsWorkers" />
    <WorkerOp workersBean="persistSystemTotalWorkers" />
    <WorkerOp workersBean="persistVoucherHistoryWorkers" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
    <Op class="dtv.pos.till.NotifyTenderMaxValueInTillOp" />
    <Op class="dtv.pos.till.NotifyTenderMinValueInTillOp" />
    <OpChainRoute chainKey="RESET_REGISTER" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
  </OpChain>
  <OpChain name="SALE_TENDER" rollbackChainKey="ROLLBACK_TENDER_PROMPT" rollbackLevel="50">
    <Op class="dtv.pos.register.itemmessages.DisplayInstructionsOp">
      <Parameter name="FILENAME" value="_instructionalTenderMsg" />
    </Op>
    <!-- this operation REQUIRES this context to be active so
         that if it needs to route a credit card event,
          it will be routed correctly -->
    <Op class="dtv.pos.tender.ProcessSavedTenderInputOp" contextKey="SALE_TENDER" />
    <Op class="dtv.pos.hardware.op.SubtotalCustomerDisplayOp" />
    <Op class="dtv.pos.register.PromptTenderMenuOp">
      <Parameter name="MenuKey" value="SALE::TENDER_OPTIONS" />
    </Op>
  </OpChain>
  <OpChain name="ROLLBACK_TENDER_START" signal="TransactionModified">
    <OpChainRoute chainKey="ROLLBACK_TENDER.local" />
    <Op class="dtv.pos.charity.VoidDonationLineItemOp" />
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>
  <OpChain name="ROLLBACK_TENDER.local">
    <OpChainRoute chainKey="ROLLBACK_TENDER.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="ROLLBACK_TENDER.local.pre" />
    <OpChainRoute chainKey="ROLLBACK_TENDER.post" />
  </OpChain>
  <OpChain name="ROLLBACK_TENDER.local.pre" />
  <OpChain name="ROLLBACK_TENDER.pre" />
  <OpChain name="ROLLBACK_TENDER.post" />
  <OpChain name="ROLLBACK_TENDER_PROMPT">
    <PromptOp class="dtv.pos.tender.PromptRollbackTenderOp" />
  </OpChain>
  <OpChain name="REFUND_TENDER" rollbackChainKey="ROLLBACK_TENDER_PROMPT" rollbackLevel="50">
    <!--ContextKey dtype="String">REFUND_TENDER</ContextKey-->
    <Op class="dtv.pos.register.itemmessages.DisplayInstructionsOp">
      <Parameter name="FILENAME" value="_instructionalTenderReturnMsg" />
    </Op>
    <!-- this operation REQUIRES this context to be active so
         that if it needs to route a credit card event,
         it will be routed correctly -->
    <Op class="dtv.pos.tender.ProcessSavedTenderInputOp" contextKey="REFUND_TENDER" />
    <Op class="dtv.pos.hardware.op.SubtotalCustomerDisplayOp" />
    <!-- reasserting for this last op, because it is what gets rerun -->
    <Op class="dtv.pos.register.PromptTenderMenuOp">
      <Parameter name="MenuKey" value="RETURN::TENDER_OPTIONS" />
    </Op>
  </OpChain>
  <OpChain name="TENDER_LOCAL_CURRENCY" signal="TransactionModified" contextKey="SALE_TENDER_EMPTY_MENU_OPTION">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Tender" />
      <Parameter name="TenderCategory" value="LOCAL_CURRENCY" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.cashsuggestion.CashSuggestionPromptTenderAmtOp" />
	<!--<PromptOp class="dtv.pos.tender.cashsuggestion.CashSuggestionPromptTenderAmtOp" validationsBean="currencyTenderAmountRules" />-->
    <OpChainRoute chainKey="CHECK_TENDERED_CASH.local" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <Op class="dtv.pos.pricing.discount.AddTransDiscountForTenderRoundingOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="REFUND_LOCAL_CURRENCY" signal="TransactionModified" contextKey="REFUND_TENDER_EMPTY_MENU_OPTION">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Refund" />
      <Parameter name="TenderCategory" value="LOCAL_CURRENCY" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.PromptTenderAmtOp" validationsBean="currencyTenderAmountRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="TENDER_FOREIGN_CURRENCY" signal="TransactionModified" contextKey="SALE_TENDER_EMPTY_MENU_OPTION">
    <PromptOp class="dtv.pos.tender.foreigncurrency.PromptForeignCurrencyTenderOp">
      <Parameter name="AvailabilityCode" value="SALE" />
      <Parameter name="TenderStatus" value="Tender" />
    </PromptOp>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.cashsuggestion.CashSuggestionPromptForeignCurrencyAmountOp"
      validationsBean="currencyTenderAmountRules" contextKey="SALE_TENDER_EMPTY_MENU_OPTION" />
    <OpChainRoute chainKey="CHECK_TENDERED_CASH.local" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="TENDER_MISC" signal="TransactionModified" contextKey="SALE_TENDER_EMPTY_MENU_OPTION">
    <PromptOp class="dtv.pos.tender.misc.PromptMiscTenderOp" />
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.misc.PromptMiscTenderNumberOp" validationsBean="serialNumberRules" />
    <PromptOp class="dtv.pos.tender.PromptTenderAmtOp" validationsBean="tenderAmountRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="REFUND_MISC" contextKey="REFUND_TENDER_EMPTY_MENU_OPTION">
    <PromptOp class="dtv.pos.tender.misc.PromptMiscTenderOp">
      <Parameter name="TenderStatus" value="Refund" />
    </PromptOp>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.misc.PromptMiscTenderNumberOp" validationsBean="serialNumberRules" />
    <PromptOp class="dtv.pos.tender.PromptTenderAmtOp" validationsBean="tenderAmountRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="TENDER_CHECK" signal="TransactionModified" contextKey="SALE_TENDER_EMPTY_MENU_OPTION">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Tender" />
      <Parameter name="TenderId" value="CHECK" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.hardware.op.ReadMicrOp" />
    <ValidationOp validationsBean="checkNumberRules" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.check.PromptBirthdayOp" validationsBean="birthDateRules" />
    <PromptOp class="dtv.pos.tender.PromptTenderAmtOp" validationsBean="tenderAmountRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <Op class="dtv.tenderauth.impl.op.AuthorizeTenderOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
    <Op class="dtv.pos.assistance.NotifyTrainingTenderAuthOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="TENDER_MALL_CERTIFICATE_CHECK" signal="TransactionModified" contextKey="SALE_TENDER_EMPTY_MENU_OPTION">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Tender" />
      <Parameter name="TenderId" value="MALL_CERTIFICATE_CHECK" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <PromptOp class="dtv.pos.tender.check.PromptCheckNumberOp" validationsBean="validateCheckNumberRules" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.check.PromptBirthdayOp" />
    <PromptOp class="dtv.pos.tender.PromptTenderAmtOp" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>

  <OpChain name="TENDER_CHECK_NO_AUTH" signal="TransactionModified" contextKey="SALE_TENDER_EMPTY_MENU_OPTION">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Tender" />
      <Parameter name="TenderId" value="CHECK" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.hardware.op.ReadMicrOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.check.PromptBirthdayOp" />
    <PromptOp class="dtv.pos.tender.PromptTenderAmtOp" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>

  <OpChain name="CONTINUE_TENDER_AFTER_ZIP_ENTRY" signal="TransactionModified" contextKey="SALE_TENDER_EMPTY_MENU_OPTION">
    <Op class="dtv.tenderauth.impl.op.AuthorizeTenderOp" />
  </OpChain>


  <OpChain name="TENDER_CREDIT_CARD" signal="TransactionModified" contextKey="SALE_TENDER_EMPTY_MENU_OPTION">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Tender" />
      <Parameter name="TenderCategory" value="CREDIT_CARD" />
    </Op>
    <OpChainRoute chainKey="TENDER_CREDIT_CARD.pre" />
    <OpChainRoute chainKey="PROMPT_CREDIT_CARD" />
    <Op class="dtv.pos.tender.creditcard.CustomerPromptCreditDebitOp" />
    <PromptOp class="dtv.pos.tender.creditcard.PromptCreditDebitOp" />
    <PromptOp class="dtv.pos.tender.PromptTenderAmtOp" validationsBean="tenderAmountRules" />
    <Op class="dtv.tenderauth.impl.op.BINSmartLookupOp" />
    <ValidationOp validationsBean="creditPaymentAccountRules" />
    <!-- after PromptCreditDebitOp and CustomerPromptCreditDebitOp we should
         always have a tender ID on the tender line item -->
    <!-- may want to validate how the card was keyed/swiped here -->
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <ValidationOp validationsBean="tenderAvailabilityRules" />
    <PromptOp class="dtv.tenderauth.impl.op.PromptPrivateCreditPlanOp">
      <Parameter name="tenderId" value="PRIVATE_LABEL" />
    </PromptOp>
    <PromptOp class="dtv.pos.tender.cid.PromptCidOp" validationsBean="cidRules" />
    <Op class="dtv.pos.hardware.op.GetPINEntryOp" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <PromptOp class="dtv.pos.tender.PromptPostalCodeOp" validationsBean="postalCodeRules" />
    <Op class="dtv.tenderauth.impl.op.AuthorizeTenderOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
    <OpChainRoute chainKey="CAPTURE_SALE_TENDER_SIGNATURE" />
    <Op class="dtv.pos.assistance.NotifyTrainingTenderAuthOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="PROMPT_CREDIT_CARD">
    <PromptOp class="dtv.pos.tender.creditcard.PromptCreditCardInfoOp" validationsBean="creditCardInfoRules" />
  </OpChain>
  <OpChain name="TENDER_CREDIT_CARD.pre" />
  <OpChain name="EXT_WORKSTATION_CLOSE_CHECK">
    <OpChainRoute chainKey="EXT_WORKSTATION_CLOSE_CHECK.tr" />
    <OpChainRoute chainKey="EXT_WORKSTATION_CLOSE_CHECK.eftlink" />
  </OpChain>
  <OpChain name="EXT_WORKSTATION_CLOSE_CHECK.tr" />
  <OpChain name="EXT_WORKSTATION_CLOSE_CHECK.eftlink" />
  <OpChain name="EXT_WORKSTATION_OPEN_CHECK">
    <OpChainRoute chainKey="EXT_WORKSTATION_OPEN_CHECK.tr" />
    <OpChainRoute chainKey="EXT_WORKSTATION_OPEN_CHECK.local" />
  </OpChain>
  <OpChain name="EXT_WORKSTATION_OPEN_CHECK.tr" />
  <OpChain name="EXT_WORKSTATION_OPEN_CHECK.local" />
  <OpChain name="PRINT_ITEMS">
    <WorkerOp workersBean="emailRcptsWorkers" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" required="false" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
  </OpChain>
  <OpChain name="CAPTURE_SALE_TENDER_SIGNATURE">
    <Op class="dtv.pos.hardware.op.CaptureSignatureOp" contextKey="SALE_TENDER_SIGCAP" breakpoint="true" />
    <Op class="dtv.pos.hardware.op.VerifySignatureOp" />
    <Op class="dtv.pos.hardware.op.CreateTenderSignatureOp" />
  </OpChain>
  <OpChain name="REFUND_CREDIT_CARD" signal="TransactionModified" contextKey="REFUND_TENDER_EMPTY_MENU_OPTION">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Refund" />
      <Parameter name="TenderCategory" value="CREDIT_CARD" />
    </Op>
    <OpChainRoute chainKey="PROMPT_CREDIT_CARD" />
    <Op class="dtv.pos.tender.creditcard.CustomerPromptCreditDebitOp" />
    <PromptOp class="dtv.pos.tender.creditcard.PromptCreditDebitOp" />
    <ValidationOp validationsBean="tenderAvailabilityRules" />
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.tenderauth.impl.op.PromptPrivateCreditPlanOp">
      <Parameter name="tenderId" value="PRIVATE_LABEL" />
    </PromptOp>
    <PromptOp class="dtv.pos.tender.PromptTenderAmtOp" validationsBean="tenderAmountRules" />
    <Op class="dtv.pos.hardware.op.GetPINEntryOp" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <Op class="dtv.tenderauth.impl.op.AuthorizeTenderOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
    <Op class="dtv.pos.assistance.NotifyTrainingTenderAuthOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="ROUTE_VOUCHER_FROM_TENDER">
    <Op class="dtv.pos.tender.voucher.RouteVoucherEventFromTenderOp">
      <Parameter name="couponVoucherChain" value="REDEEM_VOUCHER_COUPON_START" />
      <Parameter name="tenderVoucherChain" value="STANDARD_TENDER_VOUCHER" />
    </Op>
  </OpChain>
  <OpChain name="STANDARD_TENDER_VOUCHER" signal="TransactionModified">
    <Op class="dtv.pos.tender.voucher.GatherVoucherTenderInformationOp" />
    <PromptOp class="dtv.pos.tender.voucher.PromptVoucherNumberOp" validationsBean="voucherNumberTenderRules">
      <Parameter name="LineItemType" value="TENDER" />
    </PromptOp>
    <Op class="dtv.pos.tender.voucher.CreateVoucherTenderLineItemOp" />
    <ValidationOp validationsBean="tenderAvailabilityRules" />
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.voucher.PromptVoucherTenderAmtOp" validationsBean="voucherTenderAmountRules" />
    <PromptOp class="dtv.pos.tender.cid.PromptGiftCardCidOp" validationsBean="cidRules" />
    <PromptOp class="dtv.tenderauth.storedvalue.PromptForPINOp" validationsBean="voucherPinRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <Op class="dtv.tenderauth.storedvalue.AuthorizeCardOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
    <OpChainRoute chainKey="CAPTURE_SALE_TENDER_SIGNATURE" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="TENDER_COUPON" signal="TransactionModified" contextKey="SALE_TENDER_EMPTY_MENU_OPTION">
    <Op class="dtv.pos.coupon.CreateCouponTenderOp">
      <Parameter name="TenderStatus" value="Tender" />
      <Parameter name="TenderCategory" value="COUPON" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.PromptTenderAmtOp" validationsBean="tenderAmountRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="TENDER_TRAVELERS_CHECK" signal="TransactionModified" contextKey="SALE_TENDER_EMPTY_MENU_OPTION">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Tender" />
      <Parameter name="TenderCategory" value="TRAVELERS_CHECK" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.PromptTenderAmtOp" validationsBean="travelersCheckAmountRules" />
    <PromptOp class="dtv.pos.tender.travelerscheck.PromptTravelersCheckSerialNumberOp" validationsBean="serialNumberRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="TENDER_MONEY_ORDER" signal="TransactionModified" contextKey="SALE_TENDER_EMPTY_MENU_OPTION">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Tender" />
      <Parameter name="TenderCategory" value="MISCELLANEOUS" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptTenderAmtOp" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="HOUSE_ACCOUNT_LOOKUP">
    <Op class="dtv.pos.houseaccount.op.HouseAccountSearchOp" longRunning="true" />
  </OpChain>
  <OpChain name="TENDER_HOUSE_ACCOUNT" signal="TransactionModified" contextKey="SALE_TENDER_EMPTY_MENU_OPTION">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Tender" />
      <Parameter name="TenderId" value="HOUSE_ACCOUNT" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <ValidationOp validationsBean="houseAccountAvailableRules" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptNoHouseAccountCustAssignedOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptHouseAccountNumberOp" validationsBean="houseAccountNumberRules" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptAvailableARAcctForCurrentCustOp" longRunning="true" />
    <ValidationOp validationsBean="houseAccountTenderRules" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptARUserInfoOp" validationsBean="houseAccountUserNameRules">
      <Parameter name="TYPE" value="TENDER" />
    </PromptOp>
    <PromptOp class="dtv.pos.houseaccount.op.PromptAREligibleUsersOp" longRunning="true" />
    <PromptOp class="dtv.pos.tender.PromptTenderAmtOp" validationsBean="tenderAmountRules" />
    <Op class="dtv.pos.houseaccount.op.UpdateARTenderAcctNumberOp" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptARPONumberOp" validationsBean="houseAccountPoNumberRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CAPTURE_SALE_TENDER_SIGNATURE" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="REFUND_HOUSE_ACCOUNT" signal="TransactionModified" contextKey="REFUND_TENDER_EMPTY_MENU_OPTION">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Refund" />
      <Parameter name="TenderId" value="HOUSE_ACCOUNT" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <ValidationOp validationsBean="houseAccountAvailableRules" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptNoHouseAccountCustAssignedOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptHouseAccountNumberOp" validationsBean="houseAccountNumberRules" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptAvailableARAcctForCurrentCustOp" longRunning="true" />
    <ValidationOp validationsBean="houseAccountTenderRules" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptARUserInfoOp" validationsBean="houseAccountUserNameRules">
      <Parameter name="TYPE" value="TENDER" />
    </PromptOp>
    <PromptOp class="dtv.pos.houseaccount.op.PromptAREligibleUsersOp" longRunning="true" />
    <PromptOp class="dtv.pos.tender.PromptTenderAmtOp" validationsBean="tenderAmountRules" />
    <Op class="dtv.pos.houseaccount.op.UpdateARTenderAcctNumberOp" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptARPONumberOp" validationsBean="houseAccountPoNumberRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="HOUSE_ACCOUNT_PAYMENT" signal="TransactionModified">
    <PromptOp class="dtv.pos.houseaccount.op.PromptHouseAccountNumberOp" validationsBean="houseAccountNumberRules" />
    <Op class="dtv.pos.houseaccount.op.ValidateCustAsscRequiredForARPaymentOp" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptAvailableARAcctForCurrentCustOp" longRunning="true" />
    <ValidationOp validationsBean="houseAccountPaymentRules" />
    <ValidationOp validationsBean="houseAccountBalanceRules" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptARAcctOpenInvoicesOp" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptARUserInfoOp" validationsBean="houseAccountUserNameRules">
      <Parameter name="TYPE" value="PAYMENT" />
    </PromptOp>
    <PromptOp class="dtv.pos.houseaccount.op.PromptAREligibleUsersOp" longRunning="true" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptAccountReceivablePaymentAmtOp" validationsBean="houseAccountPaymentAmountRules" />
    <Op class="dtv.pos.houseaccount.op.ProcessAccountReceivablePaymentAmtOp" />
    <Op class="dtv.pos.houseaccount.op.CreateAccountReceivablePaymentItemOp" />
    <ValidationOp validationsBean="saleLineSellingIdGroupRules" />
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptARPaymentStatementDateOp" validationsBean="houseAccountStatementDateRules" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptARPaymentInvoiceNumberOp" validationsBean="houseAccountInvoiceNumberRules" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <Op class="dtv.pos.houseaccount.op.CreateCustAcctModifierOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <Op class="dtv.pos.houseaccount.op.SetHouseAccountInvoiceDataOp" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.register.itemmessages.DisplayInstructionsOp">
      <Parameter name="FILENAME" value="_instructionalMsg" />
    </Op>
    <Op class="dtv.pos.register.itemmessages.DisplayItemMessagesOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>
  <OpChain name="HOUSE_ACCOUNT_REVERSAL" signal="TransactionModified">
    <PromptOp class="dtv.pos.houseaccount.op.PromptHouseAccountNumberOp" validationsBean="houseAccountNumberRules" />
    <Op class="dtv.pos.houseaccount.op.ValidateCustAsscRequiredForARPaymentOp" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptAvailableARAcctForCurrentCustOp" longRunning="true" />
    <ValidationOp validationsBean="houseAccountPaymentRules" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptArPaymentsMadeOp" longRunning="true" />
    <Op class="dtv.pos.houseaccount.op.ProcessAccountReceivablePaymentReversalOp" />
    <Op class="dtv.pos.houseaccount.op.CreateAccountReceivablePaymentReversalItemOp" />
    <ValidationOp validationsBean="saleLineSellingIdGroupRules" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptReversePaymentReasonCodeOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <Op class="dtv.pos.houseaccount.op.CreateCustAcctModifierOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.register.itemmessages.DisplayInstructionsOp">
      <Parameter name="FILENAME" value="_instructionalMsg" />
    </Op>
    <Op class="dtv.pos.register.itemmessages.DisplayItemMessagesOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>
  <OpChain name="REFUND_HOME_OFFICE_CHECK" signal="TransactionModified" contextKey="REFUND_TENDER_EMPTY_MENU_OPTION">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Refund" />
      <Parameter name="TenderId" value="HOME_OFFICE_CHECK" />
    </Op>
    <Op class="dtv.pos.tender.homeofficecheck.PromptSendCheckToInfoOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.PromptTenderAmtOp" validationsBean="tenderAmountRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="LIST_ALL_HOUSE_ACCOUNT" signal="TransactionModified" contextKey="SALE_TENDER_EMPTY_MENU_OPTION">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Tender" />
      <Parameter name="TenderId" value="HOUSE_ACCOUNT" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.PromptTenderAmtOp" validationsBean="tenderAmountRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="CHANGE_TENDER_AMOUNT" signal="TransactionModified" contextKey="SALE_TENDER_EMPTY_MENU_OPTION">
    <PromptOp class="dtv.pos.tender.modifytender.PromptTendersToChangeOp" />
    <PromptOp class="dtv.pos.tender.cashsuggestion.CashSuggestionPromptModifyTenderAmountOp" validationsBean="changeTenderAmountRules" />
    <WorkerOp workersBean="voidChangeTenderWorkers" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="CHANGE_REFUND_TENDER_AMOUNT" signal="TransactionModified" contextKey="REFUND_TENDER_EMPTY_MENU_OPTION">
    <PromptOp class="dtv.pos.tender.modifytender.PromptTendersToChangeOp" />
    <PromptOp class="dtv.pos.tender.modifytender.PromptModifyTenderAmountOp" validationsBean="tenderAmountRules" />
    <WorkerOp workersBean="voidChangeTenderWorkers" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="VOID_TENDER" signal="TransactionModified" contextKey="SALE_TENDER_EMPTY_MENU_OPTION">
    <PromptOp class="dtv.pos.tender.modifytender.PromptTendersToVoidOp">
      <Parameter name="disallowNonVoidableTenders" value="true" />
    </PromptOp>
    <OpChainRoute chainKey="GUEST_LOOKUP" />
    <OpChainRoute chainKey="VOID_ROOM_CHARGE" />
    <Op class="dtv.tenderauth.storedvalue.VoidTenderAuthorizationOp">
      <Parameter name="ContinueOnFailure" value="false" />
    </Op>
    <WorkerOp workersBean="updateTenderVoidWorkers" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="VOID_REFUND_TENDER" signal="TransactionModified" contextKey="REFUND_TENDER_EMPTY_MENU_OPTION">
    <PromptOp class="dtv.pos.tender.modifytender.PromptTendersToVoidOp">
    <!--Parameter name="disallowAuthorizedTenders" value="true" /-->
    </PromptOp>
    <OpChainRoute chainKey="GUEST_LOOKUP" />
    <OpChainRoute chainKey="VOID_ROOM_CHARGE" />
    <Op class="dtv.tenderauth.storedvalue.VoidTenderAuthorizationOp">
      <Parameter name="ContinueOnFailure" value="false" />
    </Op>
    <WorkerOp workersBean="updateTenderVoidWorkers" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="CHECK_FOR_REFUND" />
  <OpChain name="CHECK_FOR_CHANGE" signal="TransactionModified">
    <PromptOp class="dtv.pos.tender.change.PromptSelectChangeTenderOp" validationsBean="foreignChangeRules" breakpoint="true" />
    <Op class="dtv.pos.tender.rounding.UpdateRoundingOnChangeOp" />
    <OpChainRoute chainKey="ROUTE_CHANGE" condition="dtv.pos.tender.change.TransactionHasChangeDueCondition" />
  </OpChain>
  <OpChain name="ROUTE_CHANGE">
    <OpChainRoute>
      <Choice chainKey="LOCAL_CURRENCY_CHANGE_TENDER" condition="dtv.pos.tender.change.IsLocalCurrencyChangeTender" />
      <Choice chainKey="OFFICE_CHECK_CHANGE_TENDER" condition="dtv.pos.tender.change.IsOfficeCheckChangeTender" />
      <Choice chainKey="FOREIGN_CURRENCY_CHANGE_TENDER" condition="dtv.pos.tender.change.IsForeignCurrencyChangeTender" />
      <Choice chainKey="RELOAD_VOUCHER_CHANGE_TENDER" condition="dtv.pos.tender.change.IsReloadableVoucherChangeTender" />
      <Choice chainKey="ISSUE_VOUCHER_CHANGE_TENDER" condition="dtv.pos.tender.change.IsIssuedVoucherChangeTender" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="BEFORE_COMPLETE_SALE">
    <PromptOp class="dtv.pos.hardware.op.IpCashDrawerScanOp" validationsBean="scanIpCashDrawerRules" breakpoint="true" />
    <PromptOp class="dtv.pos.register.returns.PromptCreditVoucherOp" />
  </OpChain>
  <OpChain name="CHANGE_TENDER" />
  <OpChain name="EXCHANGE_TENDER" />
  <OpChain name="CLOCK_IN_OUT" contextKey="CLOCK_IN_OUT">
    <Op class="dtv.pos.security.op.PosLoginOp">
      <Parameter name="IdPrompt" value="TIMECLOCK_USER_ID" />
      <Parameter name="PasswordPrompt" value="TIMECLOCK_USER_PWD" />
    </Op>
    <Op class="dtv.pos.timeclock.DoClockInOrOutOp" />
    <OpChainRoute chainKey="CLOCK_IN_OUT_FINISH" chainType="START" />
  </OpChain>
  <OpChain name="CLOCK_IN_OUT_FROM_APP">
    <Op class="dtv.pos.hardware.op.PlaySoundOp" />
    <OpChainRoute chainKey="CLOCK_IN_OUT" chainType="START" />
  </OpChain>
  <OpChain name="CLOCK_IN_OUT_EVENT" contextKey="CLOCK_IN_OUT">
    <Op class="dtv.pos.security.op.PosLoginOp">
      <Parameter name="IdPrompt" value="TIMECLOCK_USER_ID" />
      <Parameter name="PasswordPrompt" value="TIMECLOCK_USER_PWD" />
    </Op>
    <Op class="dtv.pos.timeclock.DoClockInOrOutOp" />
    <OpChainRoute chainKey="CLOCK_IN_OUT_FINISH" />
  </OpChain>
  <OpChain name="CLOCK_IN_OUT_FINISH" signal="TransactionComplete">
    <PromptOp class="dtv.pos.timeclock.PromptWorkAssignmentOp" breakpoint="true" />
    <ValidationOp validationsBean="validateClockInOutRules" />
    <Op class="dtv.pos.timeclock.DoClockInOutTransOp" />
    <Op class="dtv.pos.common.PersistObjectsOp" />
    <Op class="dtv.pos.common.PersistCurrentTransactionOp">
      <Parameter name="clearTransaction" value="false" />
    </Op>
    <Op class="dtv.pos.hardware.op.BuildRcptsOp" />
    <Op class="dtv.pos.timeclock.BuildValidateClockOutReceiptOp" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <WorkerOp workersBean="saveRcptsWorkers" />
    <Op class="dtv.pos.timeclock.timecard.op.PersistTimecardLogOp" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
    <Op class="dtv.pos.i18n.AssertLocaleOp" />
  </OpChain>
  <OpChain name="CHANGE_WORK_ASSIGNMENT">
    <OpChainRoute chainKey="CLOCK_IN_OUT" />
  </OpChain>
  <OpChain name="SCAN_COUPON">
    <ValidationOp class="dtv.pos.coupon.LookupCouponOp" validationsBean="couponVerificationRules" />
  </OpChain>
  <OpChain name="SCAN_SMART_COUPON" signal="TransactionModified">
    <Op class="dtv.pos.coupon.LookupManufacturerCouponOp" />
  </OpChain>
  <OpChain name="ADD_COUPON_LINE_ITEM" signal="TransactionModified">
    <Op class="dtv.pos.coupon.AuthorizeSerializedCouponOp" />
    <Op class="dtv.pos.coupon.AddCouponLineItemOp" />
  </OpChain>
  <OpChain name="NO_SALE_MANUAL">
    <Op class="dtv.pos.nosale.PerformSilentManualNoSaleTransactionOp" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
  </OpChain>

  <OpChain name="PRE_CHANGE_ITEM_QUANTITY">
    <PromptOp class="dtv.pos.register.GetSelectedSaleLineOp" validationsBean="saleItemChangeQuantityRules" />
    <OpChainRoute>
      <Choice chainKey="CHANGE_SEND_SALE_ITEM_QUANTITY">
        <Condition class="dtv.pos.register.sale.IsSaleItemType">
          <Parameter name="SaleItemType" value="SEND_SALE" />
        </Condition>
      </Choice>
      <Choice chainKey="CHANGE_RETURN_ITEM_QUANTITY" condition="dtv.pos.register.sale.IsReturnLine" />
      <Choice chainKey="CHANGE_ITEM_QUANTITY" />
    </OpChainRoute>
  </OpChain>

  <OpChain name="PRE_CHANGE_ITEM_QUANTITY_TOUCH">
    <Op class="dtv.pos.hardware.op.PlaySoundOp" />
    <ValidationOp class="dtv.pos.register.GetSelectedSaleLineFromTouchOp" validationsBean="saleItemChangeQuantityRules" />
    <OpChainRoute>
      <Choice chainKey="CHANGE_SEND_SALE_ITEM_QUANTITY">
        <Condition class="dtv.pos.register.sale.IsSaleItemType">
          <Parameter name="SaleItemType" value="SEND_SALE" />
        </Condition>
      </Choice>
      <Choice chainKey="CHANGE_RETURN_ITEM_QUANTITY" condition="dtv.pos.register.sale.IsReturnLine" />
      <Choice chainKey="CHANGE_ITEM_QUANTITY" />
    </OpChainRoute>
  </OpChain>

  <OpChain name="CHANGE_RETURN_ITEM_QUANTITY">
    <PromptOp class="dtv.pos.register.returns.PromptItemChangeQtyOp" validationsBean="saleItemQuantityRules" />
    <PromptOp class="dtv.pos.register.returns.verification.PromptVerifiedReturnItemQtyChangeOp" validationsBean="allowVerifiedReturnInputQtySaleModeRules" />
    <ValidationOp class="dtv.pos.register.returns.ValidateTotalReturnPriceExistingItemOp" validationsBean="totalReturnItemAmountRules" />
    <Op class="dtv.pos.kits.UpdateKitComponentModifiersQtyOp" />
    <Op class="dtv.pos.kits.inventory.HandleKitComponentInventoryOp" />
    <Op class="dtv.pos.inventory.op.InventoryLocationChangeWhileOp">
      <Parameter name="ChainKey" value="SALE_ALLOCATE_QUANTITY_CHANGE" />
    </Op>
    <Op class="dtv.pos.register.modifyitem.UpdateChangedQuantityOp" />
    <Op class="dtv.pos.register.returns.UpdateReturnInventoryLocationModifierOp" />
    <Op class="dtv.pos.register.modifyitem.UpdateLineItemAsscModifierQtyOp" />
    <OpChainRoute chainKey="POST_CHANGE_ITEM_QUANTITY" chainType="START" />
  </OpChain>

  <OpChain name="CHANGE_ITEM_QUANTITY">
    <PromptOp class="dtv.pos.register.modifyitem.PromptItemQuantityChangeOp" validationsBean="saleItemQuantityRules" />
    <Op class="dtv.pos.kits.UpdateKitComponentModifiersQtyOp" />
    <Op class="dtv.pos.kits.inventory.HandleKitComponentInventoryOp" />
    <Op class="dtv.pos.inventory.op.InventoryLocationChangeWhileOp">
      <Parameter name="ChainKey" value="SALE_ALLOCATE_QUANTITY_CHANGE" />
    </Op>
    <Op class="dtv.pos.register.modifyitem.UpdateChangedQuantityOp" />
    <Op class="dtv.pos.register.modifyitem.UpdateLineItemAsscModifierQtyOp" />
    <Op class="dtv.pos.customer.award.AutoVoidAwardDiscountsOp" />
    <OpChainRoute chainKey="POST_CHANGE_ITEM_QUANTITY" chainType="START" />
  </OpChain>
    <!--START-Chain for updating Serial number of a Serialized Item or Kit with Serialized Item -->
  <OpChain name="PRE_CHANGE_COMPONENT_SERIAL_NUMBER">
    <PromptOp class="dtv.pos.register.GetSelectedSaleLineOp" validationsBean="validateChangeSerialNumberRules" />
    <OpChainRoute chainKey="CHANGE_COMPONENT_SERIAL_NUMBER"/>
  </OpChain>

  <OpChain name="CHANGE_COMPONENT_SERIAL_NUMBER">
  <PromptOp class="dtv.pos.register.modifyitem.PromptKitComponentChangeSerialOp"/>
    <PromptOp class="dtv.pos.register.modifyitem.PromptScanUpdatedSerialNumber" validationsBean="serialNumberSaleRules"/>
  </OpChain>
<!-- END-->

  <OpChain name="POST_CHANGE_ITEM_QUANTITY" signal="TransactionModified">
    <Op class="dtv.pos.warranty.common.SetupWarrantyItemDataOp">
      <Parameter name="CLEAR_ITEM" value="false" />
    </Op>
    <PromptOp class="dtv.pos.warranty.change.PromptWarrantyQtyChangeOp" validationsBean="warrantyItemQtyRules" />
    <Op class="dtv.pos.warranty.change.UpdateWarrantyQtyOp" />
  </OpChain>

  <OpChain name="PRE_CHANGE_ITEM_PRICE">
    <PromptOp class="dtv.pos.register.GetSelectedSaleLineOp" validationsBean="saleItemChangePriceRules" />
    <OpChainRoute>
      <Choice chainKey="CHANGE_SEND_SALE_ITEM_PRICE">
        <Condition class="dtv.pos.register.sale.IsSaleItemType">
          <Parameter name="SaleItemType" value="SEND_SALE" />
        </Condition>
      </Choice>
      <Choice chainKey="CHANGE_ITEM_PRICE" />
    </OpChainRoute>
  </OpChain>

  <OpChain name="PRE_CHANGE_ITEM_PRICE_TOUCH">
    <Op class="dtv.pos.hardware.op.PlaySoundOp" />
    <ValidationOp class="dtv.pos.register.GetSelectedSaleLineFromTouchOp" validationsBean="saleItemChangePriceRules" />
    <OpChainRoute>
      <Choice chainKey="CHANGE_SEND_SALE_ITEM_PRICE">
        <Condition class="dtv.pos.register.sale.IsSaleItemType">
          <Parameter name="SaleItemType" value="SEND_SALE" />
        </Condition>
      </Choice>
      <Choice chainKey="CHANGE_ITEM_PRICE" />
    </OpChainRoute>
  </OpChain>

  <OpChain name="CHANGE_ITEM_PRICE" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.modifyitem.PromptItemPriceChangeOp" validationsBean="itemPriceRules" />
    <ValidationOp class="dtv.pos.register.returns.ValidateTotalReturnPriceExistingItemOp" validationsBean="totalReturnItemAmountRules" />
    <PromptOp class="dtv.pos.register.modifyitem.PromptPriceChangeReasonCodeOp" />
    <Op class="dtv.pos.register.VoidAllDiscountsOp" />
    <Op class="dtv.pos.customer.award.AutoVoidAwardDiscountsOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
  </OpChain>
  <OpChain name="PRE_VOID_ITEM">
    <ValidationOp validationsBean="saleItemVoidRules" />
    <OpChainRoute>
      <Choice chainKey="VOID_SEND_SALE_ITEM">
        <Condition class="dtv.pos.register.sale.IsNotReturnSaleItemType">
          <Parameter name="SaleItemType" value="SEND_SALE" />
        </Condition>
      </Choice>
      <Choice chainKey="VOID_ITEM" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="VOID_ITEM.pre" />
  <OpChain name="VOID_ITEM" signal="TransactionModified">
    <OpChainRoute chainKey="VOID_ITEM.pre" />
    <PromptOp class="dtv.pos.pricing.discount.ConfirmGroupDiscountItemVoidOp" key="GROUP_DISCOUNT_ITEM_REMOVE_CONFIRM" />
    <PromptOp class="dtv.pos.register.PromptVoidLineItemReasonCodeOp" />
    <Op class="dtv.tenderauth.storedvalue.VoidAuthorizationOp">
      <Parameter name="ContinueOnFailure" value="false" />
    </Op>
    <Op class="dtv.tenderauth.impl.op.VoidARAuthorizationOp">
      <Parameter name="ContinueOnFailure" value="false" />
    </Op>
    <WorkerOp workersBean="updateVoidItemWorkers" />
    <Op class="dtv.pos.pricing.discount.VoidGroupDiscountOp">
      <Parameter name="ChainKey" value="VOID_DISCOUNT_MAIN" />
    </Op>
    <Op class="dtv.pos.register.returns.UpdateVoidVerifiedReturnItemOp" />
    <Op class="dtv.pos.customer.award.AutoVoidAwardDiscountsOp" />
    <OpChainRoute chainKey="UNASSIGN_LOYALTY_SALE" />
    <!-- <OpChainRoute chainKey="VOID_ITEM.post" /> -->
  </OpChain>
  <!-- <OpChain name="VOID_ITEM.post" /> -->
  <OpChain name="PRINT_TIMEOFF">
    <Op class="dtv.pos.scheduling.timeoff.PrintTimeOffReportOp" />
  </OpChain>
  <OpChain name="EDIT_TAX_EXEMPTION">
    <PromptOp class="dtv.pos.register.tax.PromptEditTaxExemptionOp" />
    <Op class="dtv.pos.register.tax.EditTaxExemptionOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxExemptReasonOp" />
    <Op class="dtv.pos.register.tax.SaveTaxExemptOp" />
  </OpChain>
  <!-- END TSC183621 -->
  <OpChain name="APPLY_CUST_TAX_EXEMPT">
    <PromptOp class="dtv.pos.register.tax.PromptApplyTransTaxExemptionOp" breakpoint="true" />
    <PromptOp class="dtv.pos.register.tax.PromptTransTaxExemptionOp" breakpoint="true" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxExemptReasonOp" />
  </OpChain>
  <OpChain name="ADD_COUPON">
    <PromptOp class="dtv.pos.coupon.PromptCouponOp" validationsBean="couponIdRules">
      <Parameter name="AcceptMissingCoupon" value="true" />
    </PromptOp>
    <ValidationOp class="dtv.pos.coupon.LookupCouponOp" validationsBean="couponVerificationRules" />
  </OpChain>
  <!--START: Tender Exchange-->
  <OpChain name="TENDER_EXCHANGE_MAINT" contextKey="TENDER_EXCHANGE">
    <Op class="dtv.pos.tender.exchange.DisplayTenderExchangeOp" />
    <Op class="dtv.pos.register.itemmessages.ClearMsgOp" />
    <OpChainRoute chainKey="PRE_TRANS_TILL_VALIDATION" />
    <Op class="dtv.pos.tender.exchange.CreateTenderControlTransactionOp" />
    <Op class="dtv.pos.hardware.op.UseIpCashDrawerPromptOp" />
    <PromptOp class="dtv.pos.hardware.op.IpCashDrawerScanOp" validationsBean="scanIpCashDrawerRules" breakpoint="true" />
    <OpChainRoute chainKey="TENDER_EXCHANGE_INCOMING" chainType="START" />
  </OpChain>
  <OpChain name="TENDER_EXCHANGE_INCOMING" contextKey="TENDER_EXCHANGE_INCOMING" rollbackChainKey="ROLLBACK_TRANS_PROMPT_EXCHANGE" rollbackLevel="100">
      <!-- this operation REQUIRES this context to be active so that if it needs to route a
           credit card event, it will be routed correctly -->
    <Op class="dtv.pos.tender.ProcessSavedTenderInputOp" contextKey="TENDER_EXCHANGE_INCOMING" />
    <!-- reasserting for this last op, because it is what gets rerun -->
    <Op class="dtv.pos.framework.op.DoNothingOp" contextKey="TENDER_EXCHANGE_INCOMING" />
  </OpChain>
  <OpChain name="TENDER_EXCHANGE_OUTGOING" contextKey="TENDER_EXCHANGE_OUTGOING" rollbackChainKey="ROLLBACK_TRANS_PROMPT_EXCHANGE" rollbackLevel="100">
      <!-- this operation REQUIRES this context to be active so that if it needs to route a credit card event,
           it will be routed correctly -->
    <Op class="dtv.pos.tender.ProcessSavedTenderInputOp" contextKey="TENDER_EXCHANGE_OUTGOING" />
    <!-- reasserting for this last op, because it is what gets rerun -->
    <Op class="dtv.pos.framework.op.DoNothingOp" contextKey="TENDER_EXCHANGE_OUTGOING" />
  </OpChain>
  <OpChain name="STANDARD_INCOMING_TENDER_EXCHANGE_VOUCHER_TENDER">
    <Op class="dtv.pos.tender.voucher.GatherVoucherTenderInformationOp">
      <Parameter name="TenderStatus" value="Tender" />
      <Parameter name="VoucherActivityCodeType" value="REDEEMED" />
    </Op>
    <PromptOp class="dtv.pos.tender.voucher.PromptVoucherNumberOp" validationsBean="voucherNumberTenderRules">
      <Parameter name="LineItemType" value="TENDER" />
    </PromptOp>
    <Op class="dtv.pos.tender.voucher.CreateVoucherTenderLineItemOp" />
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.exchange.PromptIncomingVoucherTenderExchangeAmtOp" validationsBean="tenderExchangeIncomingAmountRules" />
    <PromptOp class="dtv.pos.tender.cid.PromptGiftCardCidOp" validationsBean="cidRules" />
    <PromptOp class="dtv.tenderauth.storedvalue.PromptForPINOp" validationsBean="voucherPinRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <Op class="dtv.tenderauth.storedvalue.AuthorizeCardOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
    <OpChainRoute chainKey="CALCULATE_TENDER_EXCHANGE_TOTALS" />
    <PromptOp class="dtv.pos.tender.exchange.PromptWhetherMoreIncomingTendersOp" />
  </OpChain>
  <OpChain name="INCOMING_TENDER_EXCHANGE_TRAVELERS_CHECK">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Tender" />
      <Parameter name="TenderCategory" value="TRAVELERS_CHECK" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.exchange.PromptIncomingTenderExchangeAmountOp" validationsBean="tenderExchangeIncomingAmountRules" />
    <PromptOp class="dtv.pos.tender.travelerscheck.PromptTravelersCheckSerialNumberOp" validationsBean="serialNumberRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CALCULATE_TENDER_EXCHANGE_TOTALS" />
    <PromptOp class="dtv.pos.tender.exchange.PromptWhetherMoreIncomingTendersOp" />
  </OpChain>
  <OpChain name="INCOMING_TENDER_EXCHANGE_HOUSE_ACCOUNT">
    <ValidationOp validationsBean="houseAccountAvailableRules" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptNoHouseAccountCustAssignedOp" />
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Tender" />
      <Parameter name="TenderId" value="HOUSE_ACCOUNT" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.houseaccount.op.PromptHouseAccountNumberOp" validationsBean="houseAccountNumberRules" />
    <PromptOp class="dtv.pos.tender.PromptTenderAmtOp" validationsBean="tenderExchangeIncomingAmountRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CALCULATE_TENDER_EXCHANGE_TOTALS" />
    <PromptOp class="dtv.pos.tender.exchange.PromptWhetherMoreIncomingTendersOp" />
  </OpChain>
  <OpChain name="INCOMING_TENDER_EXCHANGE_LOCAL_CURRENCY">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Tender" />
      <Parameter name="TenderCategory" value="LOCAL_CURRENCY" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.exchange.PromptIncomingTenderExchangeAmountOp" validationsBean="tenderExchangeIncomingAmountRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CALCULATE_TENDER_EXCHANGE_TOTALS" />
    <PromptOp class="dtv.pos.tender.exchange.PromptWhetherMoreIncomingTendersOp" />
  </OpChain>
  <OpChain name="INCOMING_TENDER_EXCHANGE_FOREIGN_CURRENCY">
    <PromptOp class="dtv.pos.tender.foreigncurrency.PromptForeignCurrencyTenderOp">
      <Parameter name="AvailabilityCode" value="TENDER_EXCHANGE_IN" />
      <Parameter name="TenderStatus" value="Tender" />
    </PromptOp>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.foreigncurrency.PromptForeignCurrencyAmountOp" validationsBean="tenderExchangeIncomingAmountRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CALCULATE_TENDER_EXCHANGE_TOTALS" />
    <PromptOp class="dtv.pos.tender.exchange.PromptWhetherMoreIncomingTendersOp" />
  </OpChain>
  <OpChain name="INCOMING_TENDER_EXCHANGE_CHECK">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Tender" />
      <Parameter name="TenderId" value="CHECK" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.hardware.op.ReadMicrOp" />
    <ValidationOp validationsBean="checkNumberRules" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.check.PromptBirthdayOp" validationsBean="birthDateRules" />
    <PromptOp class="dtv.pos.tender.exchange.PromptIncomingTenderExchangeAmountOp" validationsBean="tenderExchangeIncomingAmountRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <Op class="dtv.pos.hardware.op.GetPINEntryOp" />
    <Op class="dtv.pos.hardware.op.CaptureSignatureOp" contextKey="TENDER_EXCHANGE_SIGCAP" breakpoint="true" />
    <Op class="dtv.pos.hardware.op.VerifySignatureOp" />
    <Op class="dtv.tenderauth.impl.op.AuthorizeTenderOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
    <OpChainRoute chainKey="CALCULATE_TENDER_EXCHANGE_TOTALS" />
    <PromptOp class="dtv.pos.tender.exchange.PromptWhetherMoreIncomingTendersOp" />
  </OpChain>
  <OpChain name="OUTGOING_TENDER_EXCHANGE_FOREIGN_CURRENCY">
    <PromptOp class="dtv.pos.tender.foreigncurrency.PromptForeignCurrencyTenderOp">
      <Parameter name="AvailabilityCode" value="TENDER_EXCHANGE_OUT" />
      <Parameter name="TenderStatus" value="Refund" />
    </PromptOp>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.exchange.PromptOutgoingForeignTenderExchangeAmountOp" validationsBean="tenderExchangeOutgoingAmountRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CALCULATE_TENDER_EXCHANGE_TOTALS" />
  </OpChain>
  <OpChain name="OUTGOING_TENDER_EXCHANGE_VOUCHER_TENDER">
    <Op class="dtv.pos.tender.voucher.GatherVoucherTenderInformationOp">
      <Parameter name="TenderStatus" value="Change" />
      <Parameter name="VoucherActivityCodeType" value="ISSUED" />
    </Op>
    <PromptOp class="dtv.pos.tender.voucher.PromptVoucherNumberOp">
      <Parameter name="LineItemType" value="TENDER" />
    </PromptOp>
    <Op class="dtv.pos.tender.voucher.CreateVoucherTenderLineItemOp" />
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.exchange.PromptOutgoingVoucherTenderExchangeAmtOp" key="ENTER_VOUCHER_AMOUNT" validationsBean="tenderExchangeOutgoingAmountRules" />
    <PromptOp class="dtv.pos.tender.cid.PromptGiftCardCidOp" validationsBean="cidRules" />
    <PromptOp class="dtv.tenderauth.storedvalue.PromptForPINOp" validationsBean="voucherPinRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <Op class="dtv.tenderauth.storedvalue.AuthorizeCardOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
    <OpChainRoute chainKey="CALCULATE_TENDER_EXCHANGE_TOTALS" />
  </OpChain>
  <OpChain name="OUTGOING_TENDER_EXCHANGE_HOME_OFFICE_CHECK">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Refund" />
      <Parameter name="TenderId" value="HOME_OFFICE_CHECK" />
    </Op>
    <Op class="dtv.pos.tender.homeofficecheck.PromptSendCheckToInfoOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.exchange.PromptOutgoingTenderExchangeAmountOp" validationsBean="tenderExchangeOutgoingAmountRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CALCULATE_TENDER_EXCHANGE_TOTALS" />
  </OpChain>
  <OpChain name="OUTGOING_TENDER_EXCHANGE_LOCAL_CURRENCY">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Refund" />
      <Parameter name="TenderCategory" value="LOCAL_CURRENCY" />
    </Op>
    <PromptOp class="dtv.pos.tender.PromptCustAsscRequiredForTenderOp" />
    <Op class="dtv.pos.tender.check.PromptIdentityVerificationOp" />
    <PromptOp class="dtv.pos.tender.exchange.PromptOutgoingTenderExchangeAmountOp" validationsBean="tenderExchangeOutgoingAmountRules" />
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <OpChainRoute chainKey="CALCULATE_TENDER_EXCHANGE_TOTALS" />
  </OpChain>
  <OpChain name="CALCULATE_TENDER_EXCHANGE_TOTALS" contextKey="TENDER_EXCHANGE">
    <Op class="dtv.pos.tender.exchange.CalculateTenderExchangeTotalsOp" />
    <PromptOp class="dtv.pos.tender.exchange.PromptTenderExchangeCompleteOp" />
  </OpChain>
  <OpChain name="COMPLETE_TENDER_EXCHANGE" contextKey="TENDER_EXCHANGE">
  <!-- TODO: insert IP cash drawer scan here -->
    <WorkerOp workersBean="calculateTlogSequenceWorkers" />
    <OpChainRoute chainKey="TRANSACTION_COMPLETE" />
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>
  <OpChain name="VOID_TENDER_FOR_TENDER_EXCHANGE" contextKey="TENDER_EXCHANGE">
    <PromptOp class="dtv.pos.tender.modifytender.PromptTendersToVoidOp">
      <Parameter name="disallowNonVoidableTenders" value="true" />
    </PromptOp>
    <Op class="dtv.tenderauth.storedvalue.VoidTenderAuthorizationForExchangeOp" />
    <WorkerOp workersBean="updateTenderVoidWorkers" />
    <OpChainRoute chainKey="CALCULATE_TENDER_EXCHANGE_TOTALS" />
    <OpChainRoute chainKey="TENDER_EXCHANGE_INCOMING" chainType="START" condition="dtv.pos.tender.exchange.NoIncomingTenders" />
  </OpChain>
  <OpChain name="CHANGE_TENDER_AMOUNT_FOR_TENDER_EXCHANGE" contextKey="TENDER_EXCHANGE">
    <PromptOp class="dtv.pos.tender.modifytender.PromptTendersToChangeOp" />
    <PromptOp class="dtv.pos.tender.exchange.PromptModifyTenderExchangeAmountOp" validationsBean="tenderExchangeIncomingAmountRules" />
    <OpChainRoute chainKey="CALCULATE_TENDER_EXCHANGE_TOTALS" />
  </OpChain>
  <!--END: Tender Exchange-->
  <OpChain name="ADD_BLIND_COUPON_TENDER">
    <PromptOp class="dtv.pos.coupon.PromptCouponOp" validationsBean="couponIdRules" />
    <Op class="dtv.pos.coupon.AddCouponOp" />
  </OpChain>
  <OpChain name="ROUTE_DISCOUNT">
    <Op class="dtv.pos.pricing.discount.RouteDiscountOp" />
  </OpChain>
  <OpChain name="ADD_DISCOUNT_FROM_GROUP">
    <PromptOp class="dtv.pos.register.GetSelectedSaleLineOp" validationsBean="saleItemModifyRules" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountOp" />
    <Op class="dtv.pos.pricing.discount.RouteDiscountOp" />
    <Op class="dtv.pos.pricing.discount.UpdateLineItemAsscModPriceUponDiscountOp" />
  </OpChain>
  <OpChain name="ADD_DISCOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.GetSelectedSaleLineOp" validationsBean="saleItemModifyRules" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountOp" />
    <Op class="dtv.pos.pricing.discount.RouteDiscountOp" />
    <Op class="dtv.pos.pricing.discount.UpdateLineItemAsscModPriceUponDiscountOp" />
  </OpChain>
  <OpChain name="ADD_TRAN_DISCOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountOp">
      <Parameter name="ApplicationMethodCode" value="TRANSACTION" />
    </PromptOp>
    <Op class="dtv.pos.pricing.discount.RouteDiscountOp" />
    <Op class="dtv.pos.pricing.discount.UpdateLineItemAsscModPriceUponDiscountOp" />
  </OpChain>
  <OpChain name="ADD_ITEM_DISCOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.GetSelectedSaleLineOp" validationsBean="saleItemModifyRules" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountOp">
      <Parameter name="ApplicationMethodCode" value="LINE_ITEM" />
    </PromptOp>
    <Op class="dtv.pos.pricing.discount.RouteDiscountOp" />
    <Op class="dtv.pos.pricing.discount.UpdateLineItemAsscModPriceUponDiscountOp" />
  </OpChain>
  <OpChain name="ADD_GROUP_DISCOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountOp">
      <Parameter name="ApplicationMethodCode" value="GROUP" />
    </PromptOp>
    <ValidationOp validationsBean="discountRules" />
    <PromptOp class="dtv.pos.pricing.discount.PromptForGroupDiscountItemsOp" validationsBean="groupItemSelectionDiscountRules" />
    <Op class="dtv.pos.pricing.discount.RouteDiscountOp" />
    <Op class="dtv.pos.pricing.discount.UpdateLineItemAsscModPriceUponDiscountOp" />
  </OpChain>
  <OpChain name="TRANSACTION_DISCOUNT" signal="TransactionModified">
    <ValidationOp validationsBean="transactionDiscountRules" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountReasonOp" />
    <PromptOp class="dtv.pos.pricing.discount.PromptForAmountPercentOp" />
    <OpChainRoute chainKey="TRANSACTION_DISCOUNT_APPLY" />
  </OpChain>
  <OpChain name="TRANSACTION_DISCOUNT_APPLY">
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountThresholdExceededOp" />
    <PromptOp class="dtv.pos.pricing.discount.ValidateDiscountCompatibilityOp" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountSerialNumberOp" validationsBean="nonNullSerialNumberRules" />
    <Op class="dtv.pos.pricing.discount.AddDiscountLineItemToTransactionOp" />
    <Op class="dtv.pos.pricing.discount.AddTransDiscountPriceModifiersOp" />
    <Op class="dtv.pos.pricing.discount.PlayDiscountSoundOp" />
    <PromptOp class="dtv.pos.pricing.discount.DisplayDiscountPromptOp" />
    <Op class="dtv.pos.sendsale.op.UpdateTransDiscSendSaleItemsOp" />
  </OpChain>
  <OpChain name="LINE_ITEM_DISCOUNT" signal="TransactionModified">
    <ValidationOp validationsBean="itemInTransRules" />
    <PromptOp class="dtv.pos.register.GetSelectedSaleLineOp" validationsBean="saleItemModifyRules" />
    <ValidationOp validationsBean="discountRules" />
    <Op class="dtv.pos.hardware.op.ForceCurrentLineDisplayOp" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountReasonOp" />
    <PromptOp class="dtv.pos.pricing.discount.PromptForAmountPercentOp" validationsBean="lineItemDiscountRules" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountThresholdExceededOp" />
    <PromptOp class="dtv.pos.pricing.discount.ValidateDiscountCompatibilityOp" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountSerialNumberOp" validationsBean="nonNullSerialNumberRules" />
    <Op class="dtv.pos.pricing.discount.AddPriceModifierToTransactionOp" />
    <Op class="dtv.pos.pricing.discount.PlayDiscountSoundOp" />
    <PromptOp class="dtv.pos.pricing.discount.DisplayDiscountPromptOp" />
    <Op class="dtv.pos.sendsale.op.RouteSendSaleLineItemDiscOp" />
  </OpChain>
  <OpChain name="GROUP_DISCOUNT" signal="TransactionModified">
    <ValidationOp validationsBean="itemInTransRules" />
    <PromptOp class="dtv.pos.pricing.discount.PromptForGroupDiscountItemsOp" validationsBean="groupItemSelectionDiscountRules" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountReasonOp" />
    <PromptOp class="dtv.pos.pricing.discount.PromptForAmountPercentOp" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountThresholdExceededOp" />
    <Op class="dtv.pos.pricing.discount.ValidateDiscountCompatibilityOp" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountSerialNumberOp" validationsBean="nonNullSerialNumberRules" />
    <Op class="dtv.pos.pricing.discount.AddDiscountLineItemToTransactionOp" />
    <Op class="dtv.pos.pricing.discount.AddGroupDiscountPriceModifiersOp" />
    <Op class="dtv.pos.pricing.discount.PlayDiscountSoundOp" />
    <Op class="dtv.pos.pricing.discount.DisplayDiscountPromptOp" />
    <Op class="dtv.pos.sendsale.op.UpdateTransDiscSendSaleItemsOp" />
  </OpChain>
  <OpChain name="VOID_DISCOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.pricing.discount.GetCurrentDiscountOp" validationsBean="changeSaleDiscountRules" />
    <ValidationOp validationsBean="voidDiscountRules" />
    <OpChainRoute chainKey="VOID_DISCOUNT_MAIN" />
    <Op class="dtv.pos.pricing.discount.UpdateLineItemAsscModPriceUponDiscountOp" />
  </OpChain>
  <OpChain name="VOID_GROUP_DISCOUNT" signal="TransactionModified">
    <ValidationOp validationsBean="voidDiscountRules" />
    <OpChainRoute chainKey="VOID_DISCOUNT_MAIN" />
  </OpChain>
  <OpChain name="VOID_DISCOUNT_MAIN" signal="TransactionModified">
    <WorkerOp workersBean="voidDiscountWorkers" />
    <OpChainRoute chainKey="VOID_DISCOUNT_MAIN.post" />
  </OpChain>
  <OpChain name="VOID_DISCOUNT_MAIN.post" />
  <OpChain name="CHANGE_DISCOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.pricing.discount.GetCurrentDiscountOp" validationsBean="changeSaleDiscountRules" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountOp" />
    <Op class="dtv.pos.pricing.discount.SelectLineItemForDiscountOp" />
    <PromptOp class="dtv.pos.pricing.discount.PromptForGroupDiscountItemsOp" validationsBean="groupItemSelectionDiscountRules" />
    <Op class="dtv.pos.pricing.discount.RouteDiscountOp" />
    <OpChainRoute chainKey="VOID_DISCOUNT_MAIN" />
    <Op class="dtv.pos.pricing.discount.UpdateLineItemAsscModPriceUponDiscountOp" />
  </OpChain>
  <OpChain name="PRE_LAYAWAY_MAINT_DETAIL" rollbackLevel="20" contextKey="BACK_OFFICE_MAIN_MENU">
    <Op class="dtv.pos.customer.account.op.InitCustAcctTypeOp">
      <Parameter name="TYPE" value="LAYAWAY" />
    </Op>
    <Op class="dtv.pos.register.layaway.account.LayawayMaintSearchOp" />
    <OpChainRoute chainKey="LAYAWAY_MAINT_DETAIL" chainType="START" />
  </OpChain>
  <OpChain name="LAYAWAY_MAINT_DETAIL" rollbackLevel="30" contextKey="LAYAWAY">
    <Op class="dtv.pos.customer.account.op.ViewCustAccountOp" breakpoint="true">
      <Parameter name="ChainKey" value="PRE_LAYAWAY_MAINT_DETAIL" />
      <Parameter name="FormKey" value="LAYAWAY_MAINTENANCE" />
    </Op>
  </OpChain>
  <OpChain name="PRE_LAYAWAY_CHAIN" signal="TransactionModified" contextKey="LAYAWAY" rollbackChainKey="BACKTO_SALE_ITEM" rollbackLevel="30">
    <Op class="dtv.pos.customer.account.op.InitCustAcctTypeOp">
      <Parameter name="TYPE" value="LAYAWAY" />
    </Op>
    <Op class="dtv.pos.register.layaway.account.LayawayRegisterSearchOp">
      <Parameter name="STATUS" value="OPEN" />
      <Parameter name="STATUS" value="OVERDUE" />
      <Parameter name="STATUS" value="DELINQUENT" />
    </Op>
    <Op class="dtv.pos.customer.AddCustToTransactionOp" />
    <Op class="dtv.pos.register.layaway.account.PromptLayawayDelinquentOp" />
    <OpChainRoute chainKey="LAYAWAY_MAINTENANCE_CHAIN" chainType="START" />
  </OpChain>
  <!-- Start 183582 -->
  <OpChain name="LAYAWAY_MAINT_CANCEL_ORDER">
    <PromptOp class="dtv.pos.customer.account.op.PromptCustomerPresentForCancelOp">
      <Parameter name="location" value="back_office" />
    </PromptOp>
    <ValidationOp validationsBean="layawayAllowEscrowRules" />
    <PromptOp class="dtv.pos.register.layaway.account.PromptCancelLayawayAcctConfirmationOp" />
    <Op class="dtv.pos.customer.account.op.CreateEscrowTransactionOp" />
    <Op class="dtv.pos.customer.account.op.EscrowCustAcctOp" />
    <Op class="dtv.pos.customer.account.op.CompleteEscrowTransactionOp" />
    <Op class="dtv.pos.common.PersistObjectsOp" />
    <Op class="dtv.pos.customer.account.op.ConfirmEscrowAccountOp" />
    <Op class="dtv.pos.customer.account.op.CreateBackOfficeLayawayCancelInvMovementOp" />
    <Op class="dtv.pos.customer.account.op.RemoveLayawayAccountModelOp" />
    <OpChainRoute chainKey="PRE_LAYAWAY_MAINT_DETAIL" chainType="START" />
  </OpChain>
  <!-- End 183582 -->
  <OpChain name="ROLLBACK_LAYAWAY_START">
    <Op class="dtv.pos.customer.account.op.CompleteCancelCustAcctOp" />
    <OpChainRoute chainKey="ROLLBACK_TRANS_PROMPT" chainType="START" />
  </OpChain>
  <OpChain name="ROLLBACK_LAYAWAY_PROMPT">
    <Op class="dtv.pos.register.layaway.PromptRollbackLayawayOp" />
  </OpChain>
  <OpChain name="ADD_NEW_LAYAWAY_ACCT">
    <Op class="dtv.pos.customer.EnsureCustomerAssignedOp" />
    <Op class="dtv.pos.register.layaway.account.CheckDelinquentAccountsOnCreateOp" />
    <PromptOp class="dtv.pos.register.layaway.account.PromptLayawayAccountIdOp" validationsBean="custAccountIdRules" />
    <Op class="dtv.pos.register.layaway.account.CheckIfLayawayAccountExistsOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustomerAccountOp" />
  </OpChain>
  <OpChain name="CLEAR_LAYAWAY_ACCT">
    <Op class="dtv.pos.register.layaway.account.ClearLayawayAccountOp" />
  </OpChain>
  <OpChain name="LAYAWAY_SEARCH_PAYMENT" rollbackChainKey="CLEAR_LAYAWAY_ACCT">
    <Op class="dtv.pos.customer.AddCustToTransactionOp" />
    <OpChainRoute chainKey="CUST_ASSOCIATION.LOYALTY" />
    <OpChainRoute chainKey="LAYAWAY_PAYMENT" />
  </OpChain>
  <OpChain name="LAYAWAY_PAYMENT" signal="TransactionModified">
    <Op class="dtv.pos.customer.account.op.InitCustAcctTypeOp">
      <Parameter name="TYPE" value="LAYAWAY" />
    </Op>
    <PromptOp class="dtv.pos.register.layaway.payment.PromptLayawayPaymentAmountOp" breakpoint="true"
      validationsBean="layawayPaymentAmountRules" />
    <PromptOp class="dtv.pos.register.layaway.payment.CheckRecommendedPaymentAmountOp" />
    <OpChainRoute chainKey="ADD_LAYAWAY_ITEM" />
    <Op class="dtv.pos.register.layaway.payment.AddLayawayDelinquencyFeeOp" />
    <Op class="dtv.pos.register.layaway.payment.RevertDelinquentOrOverdueAccountOp" />
    <Op class="dtv.pos.customer.account.op.CompleteCustomerAccountOp" />
    <OpChainRoute chainKey="BACKTO_SALE_ITEM" chainType="START" />
  </OpChain>
  <OpChain name="LAYAWAY_SCHEDULE">
    <Op class="dtv.pos.register.layaway.payment.schedule.UpdateLayawayPaymentScheduleOp" />
    <PromptOp class="dtv.pos.register.layaway.payment.schedule.PromptLayawayPaymentScheduleOp" />
  </OpChain>
  <OpChain name="LAYAWAY_PAYMENT_ACTIVITY">
    <PromptOp class="dtv.pos.register.layaway.payment.PromptLayawayPaymentActivityOp" />
  </OpChain>
  <OpChain name="LAYAWAY_ACTIVITY">
    <PromptOp class="dtv.pos.register.layaway.payment.PromptLayawayActivityOp" />
  </OpChain>
  <OpChain name="LAYAWAY_COMMENTS">
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountNotesOp" />
  </OpChain>
  <OpChain name="LAYAWAY_PICKUP_ITEM" contextKey="LAYAWAY" signal="TransactionModified">
    <OpChainRoute chainKey="LAYAWAY_PICKUP_ITEM_START" />
    <OpChainRoute chainKey="LAYAWAY_PICKUP_ITEM_FINISH" />
  </OpChain>
  <OpChain name="LAYAWAY_PICKUP_ITEM_START">
    <PromptOp class="dtv.pos.register.layaway.pickup.ListPickableItemsOp" />
    <Op class="dtv.pos.register.layaway.pickup.ForcePickupAllOp" />
    <Op class="dtv.pos.register.layaway.pickup.ForcePickupAllAssociatedOp" />
    <Op class="dtv.pos.register.layaway.pickup.ForcePickupAllAssociatedFeesOp" />
    <!-- Broke out ProcessPickedItemsOp into its own chain to force calculators to run so
      that any price modifiers applied to the setup item would be included in the pickup price -->
    <OpChainRoute chainKey="PROCESS_PICKED_LAYAWAY_ITEMS" />
    <Op class="dtv.pos.customer.account.op.UpdateItemStatusPickedOp" />
    <Op class="dtv.pos.warranty.common.WarrantyTransIteratingOp">
      <Parameter name="ChainKey" value="ISSUE_WARRANTIES" />
    </Op>
  </OpChain>
  <OpChain name="LAYAWAY_PICKUP_ITEM_FINISH">
    <Op class="dtv.pos.register.layaway.pickup.AddPickupTenderOp" />
    <Op class="dtv.pos.register.layaway.pickup.AddPickupPaymentOp" />
    <Op class="dtv.pos.register.layaway.payment.schedule.RebuildLayawayPaymentScheduleOp" />
  </OpChain>
  <OpChain name="PROCESS_PICKED_LAYAWAY_ITEMS" signal="TransactionModified">
    <Op class="dtv.pos.register.layaway.pickup.ProcessPickedItemsOp" />
    <Op class="dtv.pos.customer.account.op.PickedItemsInventoryLocationWhileOp">
      <Parameter name="ChainKey" value="PROCESS_PICKED_LAYAWAY_ITEMS_INVENTORY" />
    </Op>
  </OpChain>
  <OpChain name="PROCESS_PICKED_LAYAWAY_ITEMS_INVENTORY">
    <Op class="dtv.pos.inventory.op.InventoryLocationWhileOp">
      <Parameter name="ChainKey" value="LAYAWAY_PICKUP_ALLOCATE_QUANTITY" />
    </Op>
  </OpChain>
  <OpChain name="LAYAWAY_PICKUP_ALLOCATE_QUANTITY">
    <Op class="dtv.pos.inventory.op.DetermineInventoryLocationOp">
      <Parameter name="bucketId" value="LAYAWAY" />
    </Op>
    <PromptOp class="dtv.pos.register.PromptLocationQuantityOp" validationsBean="itemLocationQuantityRules" />
  </OpChain>
  <OpChain name="ADD_LAYAWAY_PICKUP_TENDER">
    <OpChainRoute chainKey="SALE_TAXING" condition="dtv.pos.customer.account.condition.CustomerAccountCreditAsReturnRunCondition"/>
    <Op class="dtv.pos.register.layaway.item.CreateLayawayItemOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctActivityOp" />
  </OpChain>
  <OpChain name="ADD_LAYAWAY_PICKUP_PAYMENT" signal="TransactionModified">
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <Op class="dtv.pos.customer.account.op.AddCustomerAccountModifierOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.register.layaway.item.CreateLayawayItemOp">
      <Parameter name="ForceDetailType" value="PICKUP_PAYMENT" />
    </Op>
    <Op class="dtv.pos.customer.account.op.CreateCustAcctActivityOp" />
  </OpChain>
  <!--
    BEGIN: SPECIAL ORDER OP CHAINS
  -->
  <OpChain name="MINIMAL_SPECIAL_ORDER" signal="TransactionModified" contextKey="MIN_SPECIAL_ORDER" rollbackChainKey="BACKTO_SALE_ITEM">
    <Op class="dtv.pos.register.specorder.item.CreateMinSpecialOrderLineItemOp" />
    <PromptOp class="dtv.pos.register.PromptItemDescriptionOp" validationsBean="itemDescriptionRules" />
    <PromptOp class="dtv.pos.register.PromptItemPriceOp" />
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.register.UpdateCurrentTransListOp" />
    <OpChainRoute chainKey="MINIMAL_SPECIAL_ORDER_PROMPT" chainType="START" />
  </OpChain>
  <OpChain name="MINIMAL_SPECIAL_ORDER_PROMPT" contextKey="MIN_SPECIAL_ORDER" rollbackChainKey="VOID_MIN_SPECIAL_ORDER" rollbackLevel="30">
    <Op class="dtv.pos.framework.op.ForceMenuSelectionOp" />
  </OpChain>
  <OpChain name="VOID_MIN_SPECIAL_ORDER" contextKey="MIN_SPECIAL_ORDER">
    <PromptOp class="dtv.pos.register.specorder.account.PromptCancelSpecOrderAccountOp" />
    <OpChainRoute chainKey="VOID_LINE" />
    <OpChainRoute chainKey="BACKTO_SALE_ITEM" chainType="START" />
  </OpChain>
  <OpChain name="PRE_SPECIAL_ORDER_CHAIN" contextKey="SPECIAL_ORDER" rollbackChainKey="BACKTO_SALE_ITEM"  signal="TransactionModified" rollbackLevel="30">
    <Op class="dtv.pos.customer.account.op.InitCustAcctTypeOp">
      <Parameter name="TYPE" value="SPECIAL_ORDER" />
    </Op>
    <!--  Uncomment to allow multiple special orders in the same transaction
    <Op class="dtv.pos.register.specorder.account.SpecOrderAccountSelectOp" />
    -->
    <Op class="dtv.pos.register.specorder.account.SpecOrderRegisterSearchOp">
      <Parameter name="STATUS" value="OPEN" />
      <Parameter name="STATUS" value="READY_TO_PICKUP" />
    </Op>
    <PromptOp class="dtv.pos.register.specorder.ship.PromptShippingDestOp" />
    <Op class="dtv.pos.register.specorder.ship.SpecOrderShippingFormOp" breakpoint="true" />
    <Op class="dtv.pos.customer.AddCustToTransactionOp" />
    <OpChainRoute chainKey="SPECIAL_ORDER_CHAIN" chainType="START" />
  </OpChain>
  <OpChain name="SPECIAL_ORDER_CHAIN" contextKey="SPECIAL_ORDER" rollbackChainKey="SPECIAL_ORDER_FINISH" rollbackLevel="40">
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
    <Op class="dtv.pos.register.specorder.PromptSpecOrderOptionsOp" />
  </OpChain>
  <OpChain name="ADD_NEW_SPECIAL_ORDER_ACCT">
    <Op class="dtv.pos.customer.EnsureCustomerAssignedOp" />
    <Op class="dtv.pos.customer.AddCustToTransactionOp" />
    <PromptOp class="dtv.pos.register.specorder.account.PromptSpecOrderAccountIdOp" validationsBean="custAccountIdRules" />
    <Op class="dtv.pos.customer.account.op.CreateCustomerAccountOp" />
  </OpChain>
  <OpChain name="ADD_NEW_SPECIAL_ORDER_ITEM" signal="TransactionModified" contextKey="SPECIAL_ORDER">
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountItemScanOp" validationsBean="maxSpecialOrderItemsRules" />
    <Op class="dtv.pos.register.specorder.item.CheckSpecOrderItemNotOnFileOp" />
    <ValidationOp validationsBean="sellingIdGroupRules" />
    <OpChainRoute chainKey="SPECIAL_ORDER_ITEM_AFTER_LOOKUP" />
  </OpChain>
  <OpChain name="SPECIAL_ORDER_ITEM_AFTER_LOOKUP">
    <OpChainRoute chainKey="SPECIAL_ORDER_ITEM_ID_VALIDATE" />
    <Op class="dtv.pos.kits.CreateKitOp" />
    <Op class="dtv.pos.register.specorder.nonphysical.RouteSpecOrderItemOp" />
    <OpChainRoute chainKey="SELECT_WARRANTY_PLANS_SETUP" />
    <Op class="dtv.pos.warranty.common.RunCoveredLineItemChainOp">
      <Parameter name="ChainKey" value="SPECIAL_ORDER_WARRANTY_FINISH" />
    </Op>
  </OpChain>
  <OpChain name="SPECIAL_ORDER_ITEM_ID_VALIDATE">
    <ValidationOp validationsBean="itemAvailableForSpecialOrderRules" />
    <PromptOp class="dtv.pos.item.restriction.PromptForCashierAgeVerificationOp">
      <Parameter name="SaleItemType" value="SPECIAL_ORDER" />
    </PromptOp>
    <ValidationOp validationsBean="allowSpecOrderItemRules" />
    <ValidationOp validationsBean="sellingIdGroupRules" />
    <Op class="dtv.pos.register.specorder.item.CreateSpecOrderLineItemOp" />
    <PromptOp class="dtv.pos.order.ConfirmOrderOnHandItemOp" key="SP_ORDER_CONFIRM_ONHAND" />
    <PromptOp class="dtv.pos.register.sale.PromptForItemWeightOp" validationsBean="itemWeightRules" />
    <PromptOp class="dtv.pos.register.PromptBirthDateScanOp" />
    <Op class="dtv.pos.register.MinimumAgeValidationOp" />
    <PromptOp class="dtv.pos.register.PromptItemDescriptionOp" validationsBean="itemDescriptionRules" />
    <PromptOp class="dtv.pos.register.ItemPropertyPromptOp" validationsBean="itemPromptPropertyRules" />
    <PromptOp class="dtv.pos.register.PromptItemQuantityOp" validationsBean="specialOrderQuantityRules" />
    <ValidationOp validationsBean="allowedItemQtyRules" />
    <Op class="dtv.pos.register.modifyitem.UpdateChangedQuantityOp" />
    <PromptOp class="dtv.pos.register.PromptItemPriceOp" />
    <Op class="dtv.pos.customer.account.op.CheckCustAcctStyleLookupOp" />
  </OpChain>
  <OpChain name="ADD_SPECIAL_ORDER_ITEM">
    <PromptOp class="dtv.pos.register.specorder.item.PromptItemExpectedDateOp" validationsBean="specialOrderExpectedDateRules" />
    <OpChainRoute chainKey="ADD_SPECIAL_ORDER_ITEM_FINISH" />
  </OpChain>
  <OpChain name="ADD_SPECIAL_ORDER_ITEM_FINISH" signal="TransactionModified">
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.shippingfee.EnsureSingleShippingFeeLineItemOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <Op class="dtv.pos.customer.account.op.AddCustomerAccountModifierOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <WorkerOp workersBean="addTransDiscountsToNewItemWorkers" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.register.specorder.item.CreateSpecOrderItemOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctActivityOp" />
     <OpChainRoute chainKey="ADD_SPECIAL_ORDER_ATTACHED_ITEMS" />
    <OpChainRoute chainKey="NOTIFY_ATTACHED_ITEMS" />
  </OpChain>
  <OpChain name="ADD_SPECIAL_ORDER_ATTACHED_ITEMS">
    <PromptOp class="dtv.pos.register.attacheditems.PromptAttachedItemsOp" />
    <Op class="dtv.pos.register.attacheditems.AttachedItemsIteratingOp">
      <Parameter name="chainKey" value="SPECIAL_ORDER_ITEM_AFTER_LOOKUP" />
    </Op>
  </OpChain>
  <OpChain name="SPECIAL_ORDER_FINISH">
    <ValidationOp validationsBean="minSpecialOrderTotalItemPriceRules" />
    <Op class="dtv.pos.customer.account.op.ValidateNewCustAcctOp" />
    <Op class="dtv.pos.register.specorder.payment.AddSpecOrderServiceFeeOp" />
    <PromptOp class="dtv.pos.register.specorder.payment.PromptSpecOrderDepositAmountOp" validationsBean="depositAmountRules" />
    <PromptOp class="dtv.pos.register.specorder.payment.CheckMaxSpecOrderDepositOp" />
    <ValidationOp class="dtv.pos.register.specorder.payment.ValidateSpecOrderDepositAmountOp" validationsBean="maxDepositAmountRules" />
    <OpChainRoute chainKey="SP_ORDER_SHIPPING_FEE" />
    <OpChainRoute chainKey="ISSUE_SP_ORDER_REFUND" />
    <Op class="dtv.pos.customer.account.op.CompleteCustomerAccountOp" />
    <OpChainRoute chainKey="BACKTO_SALE_ITEM" chainType="START" />
  </OpChain>
  <OpChain name="SP_ORDER_SHIPPING_FEE">
    <Op class="dtv.pos.customer.account.op.RemoveFeeFromAccountOp">
      <Parameter name="FeeType" value="SP_ORDER_SHIPPING_FEE" />
    </Op>
    <Op class="dtv.pos.customer.account.op.AddSpecialOrderShippingFeeOp" />
  </OpChain>
  <OpChain name="SPECIAL_ORDER_PRE_TENDERING">
    <ValidationOp validationsBean="minSpecialOrderTotalItemPriceRules" />
    <Op class="dtv.pos.customer.account.op.ValidateNewCustAcctPreTenderOp" />
    <Op class="dtv.pos.register.specorder.payment.AddSpecOrderServiceFeeOp" />
    <PromptOp class="dtv.pos.register.specorder.payment.PromptSpecOrderDepositAmountOp" validationsBean="depositAmountRules" />
    <PromptOp class="dtv.pos.register.specorder.payment.CheckMaxSpecOrderDepositOp" />
    <ValidationOp class="dtv.pos.register.specorder.payment.ValidateSpecOrderDepositAmountOp" validationsBean="maxDepositAmountRules" />
    <OpChainRoute chainKey="SP_ORDER_SHIPPING_FEE" />
    <OpChainRoute chainKey="ISSUE_SP_ORDER_REFUND" />
    <Op class="dtv.pos.customer.account.op.CompleteCustomerAccountOp" />
    <Op class="dtv.pos.register.UpdateCurrentTransListOp" />
    <OpChainRoute chainKey="PRE_TENDERING" chainType="START" />
  </OpChain>
  <OpChain name="ADD_SP_ORDER_FEE" signal="TransactionModified">
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <Op class="dtv.pos.customer.account.op.AddCustomerAccountModifierOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <OpChainRoute chainKey="SALE_TAXING" />
  </OpChain>
  <OpChain name="ADD_SP_ORDER_ITEM_FINISH" signal="TransactionModified">
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>
  <OpChain name="SP_ORDER_COMMENT">
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountCommentOp" validationsBean="commentRules" />
  </OpChain>
  <OpChain name="CANCEL_SP_ORDER" signal="TransactionModified">
    <!-- Start 183581 -->
    <!-- Prompt if customer is present.  Use Backoffice cancel for escrow transfers -->
    <PromptOp class="dtv.pos.customer.account.op.PromptCustomerPresentForCancelOp">
      <Parameter name="location" value="register" />
    </PromptOp>
    <!-- End 183581 -->
    <PromptOp class="dtv.pos.register.specorder.account.PromptCancelSpecOrderAccountOp" />
    <Op class="dtv.pos.register.specorder.payment.AddSpecOrderRestockingFeeOp" />
    <Op class="dtv.pos.register.specorder.account.HandleSpecOrderServiceFeeUponCancelOp" />
    <Op class="dtv.pos.register.specorder.account.HandleSpecOrderShippingFeeUponCancelOp" />
    <Op class="dtv.pos.register.specorder.account.CancelSpecOrderAccountOp" />
    <OpChainRoute chainKey="ISSUE_SP_ORDER_REFUND" />
    <Op class="dtv.pos.register.specorder.account.HandleSpecOrderServiceFeeUponCancelOp" />
    <Op class="dtv.pos.customer.account.op.CompleteCustomerAccountOp" />
    <Op class="dtv.pos.customer.account.op.CloseReceivingDocumentOnAccountCancellationOp" />
    <Op class="dtv.pos.customer.account.op.AddCancelledAccountToPersistablesBagOp" />
    <Op class="dtv.pos.register.UpdateCurrentTransListOp" />
    <OpChainRoute chainKey="SALE_ITEM_START" chainType="START" />
  </OpChain>
  <OpChain name="CANCEL_SP_ORDER_ITEM">
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.register.specorder.modifyitem.CreateSpecOrderCancelInventoryLocationModifierOp">
      <Parameter name="sourceBucketId" value="SPECIAL_ORDER" />
      <Parameter name="destinationBucketId" value="ON_HAND" />
    </Op>
    <Op class="dtv.pos.customer.account.op.UpdateVoidCustAcctItemOp">
      <Parameter name="detailStateCode" value="CANCEL" />
    </Op>
  </OpChain>
  <OpChain name="ISSUE_SP_ORDER_REFUND">
    <Op class="dtv.pos.register.specorder.item.CreateSpecOrderRefundItemOp" />
  </OpChain>
  <OpChain name="SP_ORDER_HISTORY">
    <PromptOp class="dtv.pos.register.specorder.account.PromptSpecOrderHistoryOp" />
  </OpChain>
  <OpChain name="SP_ORDER_COMMENTS">
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountNotesOp" />
  </OpChain>
  <OpChain name="SP_ORDER_PICKUP_ITEM" contextKey="SPECIAL_ORDER" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.specorder.pickup.ListPickableItemsOp" />
    <Op class="dtv.pos.register.specorder.pickup.ForcePickupAllOp" />
    <Op class="dtv.pos.register.specorder.pickup.ForcePickupAllAssociatedOp" />
    <Op class="dtv.pos.register.specorder.pickup.ProcessPickedItemsOp" />
    <Op class="dtv.pos.customer.account.op.PickedItemsInventoryLocationWhileOp">
      <Parameter name="ChainKey" value="PROCESS_PICKED_SP_ORDER_ITEMS_INVENTORY" />
    </Op>
    <Op class="dtv.pos.register.SaleReturnLineIteratingOp">
      <Parameter name="ChainKey" value="SPECIAL_ORDER_PICKUP_ITEM_VALIDATE" />
    </Op>
    <Op class="dtv.pos.customer.account.op.UpdateItemStatusPickedOp" />
    <Op class="dtv.pos.warranty.common.WarrantyTransIteratingOp">
      <Parameter name="ChainKey" value="ISSUE_WARRANTIES" />
    </Op>
    <Op class="dtv.pos.register.specorder.pickup.AddPickupTenderOp" />
    <OpChainRoute chainKey="SALE_TAXING" condition="dtv.pos.customer.account.condition.CustomerAccountCreditAsReturnRunCondition"/>
  </OpChain>
  <OpChain name="SPECIAL_ORDER_PICKUP_ITEM_VALIDATE">
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountItemSerialNumberOp" validationsBean="serialNumberSaleRules">
      <Parameter name="CANCELLABLE" value="false" />
    </PromptOp>
    <Op class="dtv.pos.giftregistry.op.ApplyRegistryItemGiftReceiptsOp" />
  </OpChain>
  <OpChain name="PROCESS_PICKED_SP_ORDER_ITEMS_INVENTORY">
    <Op class="dtv.pos.inventory.op.InventoryLocationWhileOp">
      <Parameter name="ChainKey" value="SP_ORDER_PICKUP_ALLOCATE_QUANTITY" />
    </Op>
  </OpChain>
  <OpChain name="SP_ORDER_PICKUP_ALLOCATE_QUANTITY">
    <Op class="dtv.pos.inventory.op.DetermineInventoryLocationOp">
      <Parameter name="bucketId" value="SPECIAL_ORDER" />
    </Op>
    <PromptOp class="dtv.pos.register.PromptLocationQuantityOp" validationsBean="itemLocationQuantityRules" />
  </OpChain>
  <OpChain name="ADD_SP_ORDER_PICKUP_TENDER">
    <Op class="dtv.pos.register.specorder.item.CreateSpecOrderItemOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctActivityOp" />
    <Op class="dtv.pos.register.specorder.account.CalculateSpecOrderRounding" />
  </OpChain>
  <OpChain name="VOID_CUSTOMER_ACCOUNT_ITEM_TOUCH">
    <OpChainRoute>
      <Choice chainKey="VOID_LAYAWAY_ITEM_TOUCH">
        <Condition class="dtv.pos.customer.account.AccountTypeCondition">
          <Parameter name="AccountType" value="LAYAWAY" />
        </Condition>
      </Choice>
      <Choice chainKey="VOID_SP_ORDER_ITEM_TOUCH">
        <Condition class="dtv.pos.customer.account.AccountTypeCondition">
          <Parameter name="AccountType" value="SPECIAL_ORDER" />
        </Condition>
      </Choice>
      <Choice chainKey="VOID_CUSTOMER_ACCOUNT_LINE_ITEM_TOUCH" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="CUSTOMER_ACCOUNT_CHANGE_LINE_QUANTITY_TOUCH">
    <OpChainRoute>
      <Choice chainKey="CHANGE_LAYAWAY_ITEM_QUANTITY_TOUCH">
        <Condition class="dtv.pos.customer.account.AccountTypeCondition">
          <Parameter name="AccountType" value="LAYAWAY" />
        </Condition>
      </Choice>
      <Choice chainKey="CHANGE_SP_ORDER_ITEM_QUANTITY_TOUCH">
        <Condition class="dtv.pos.customer.account.AccountTypeCondition">
          <Parameter name="AccountType" value="SPECIAL_ORDER" />
        </Condition>
      </Choice>
      <Choice chainKey="CHANGE_CUSTOMER_ACCOUNT_ITEM_QUANTITY_TOUCH" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="CUSTOMER_ACCOUNT_CHANGE_LINE_PRICE_TOUCH">
    <OpChainRoute>
      <Choice chainKey="CHANGE_LAYAWAY_ITEM_PRICE_TOUCH">
        <Condition class="dtv.pos.customer.account.AccountTypeCondition">
          <Parameter name="AccountType" value="LAYAWAY" />
        </Condition>
      </Choice>
      <Choice chainKey="CHANGE_SP_ORDER_ITEM_PRICE_TOUCH">
        <Condition class="dtv.pos.customer.account.AccountTypeCondition">
          <Parameter name="AccountType" value="SPECIAL_ORDER" />
        </Condition>
      </Choice>
      <Choice chainKey="CHANGE_CUSTOMER_ACCOUNT_ITEM_PRICE_TOUCH" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="VOID_SP_ORDER_ITEM_TOUCH">
    <ValidationOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemFromTouchOp" validationsBean="custAccountItemVoidRules" />
    <OpChainRoute chainKey="VOID_SP_ORDER_ITEM_IMPL" />
  </OpChain>
  <OpChain name="VOID_SP_ORDER_ITEM" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemVoidOp" validationsBean="custAccountItemVoidRules">
      <Parameter name="VoidDiscountChainKey" value="VOID_CUSTOMER_ACCOUNT_DISCOUNT" />
    </PromptOp>
    <OpChainRoute chainKey="VOID_SP_ORDER_ITEM_IMPL" />
  </OpChain>
  <OpChain name="VOID_SP_ORDER_ITEM_IMPL" signal="TransactionModified">
    <Op class="dtv.pos.pricing.discount.ConfirmGroupDiscountItemVoidOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="CANCEL" />
    </Op>
    <PromptOp class="dtv.pos.register.PromptVoidLineItemReasonCodeOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="CANCEL" />
    </Op>
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.customer.account.op.UpdateVoidCustAcctItemOp" />
    <Op class="dtv.pos.pricing.discount.VoidGroupDiscountOp">
      <Parameter name="ChainKey" value="VOID_CUSTOMER_ACCOUNT_DISCOUNT_MAIN" />
    </Op>
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
  </OpChain>
  <OpChain name="CHANGE_SP_ORDER_ITEM_PRICE_TOUCH">
    <ValidationOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemFromTouchOp" validationsBean="custAccountChangePriceRules" />
    <OpChainRoute chainKey="CHANGE_SP_ORDER_ITEM_PRICE_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_SP_ORDER_ITEM_PRICE">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" validationsBean="custAccountChangePriceRules" />
    <OpChainRoute chainKey="CHANGE_SP_ORDER_ITEM_PRICE_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_SP_ORDER_ITEM_PRICE_IMPL" signal="TransactionModified">
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_PRICE" />
    </Op>
    <PromptOp class="dtv.pos.register.modifyitem.PromptItemPriceChangeOp" />
    <PromptOp class="dtv.pos.register.modifyitem.PromptPriceChangeReasonCodeOp" />
    <Op class="dtv.pos.register.VoidAllDiscountsOp" />
    <OpChainRoute chainKey="CHANGE_SP_ORDER_ITEM_PRICE_FINISH" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
    <OpChainRoute chainKey="POST_CHANGE_SP_ORDER_ITEM_PRICE" chainType="START" />
  </OpChain>
  <OpChain name="CHANGE_SP_ORDER_ITEM_PRICE_FINISH" signal="TransactionModified">
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
  </OpChain>
  <OpChain name="POST_CHANGE_SP_ORDER_ITEM_PRICE" signal="TransactionModified">
    <OpChainRoute chainKey="UPDATE_WARRANTY_SPECIAL_ORDER_PRICE" />
  </OpChain>
  <OpChain name="CHANGE_SP_ORDER_ITEM_QUANTITY_TOUCH">
    <ValidationOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemFromTouchOp" validationsBean="custAccountChangeQuantityRules" />
    <OpChainRoute chainKey="CHANGE_SP_ORDER_ITEM_QUANTITY_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_SP_ORDER_ITEM_QUANTITY">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" validationsBean="custAccountChangeQuantityRules" />
    <OpChainRoute chainKey="CHANGE_SP_ORDER_ITEM_QUANTITY_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_SP_ORDER_ITEM_QUANTITY_IMPL" signal="TransactionModified">
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_QUANTITY" />
    </Op>
    <PromptOp class="dtv.pos.register.modifyitem.PromptItemQuantityChangeOp" validationsBean="specialOrderQuantityRules" />
    <OpChainRoute chainKey="CHANGE_CUSTOMER_ACCOUNT_ITEM_QUANTITY_FINISH" />
    <Op class="dtv.pos.kits.UpdateKitComponentModifiersQtyOp" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
    <OpChainRoute chainKey="POST_CHANGE_CUSTOMER_ACCOUNT_ITEM_QUANTITY" chainType="START" />
  </OpChain>
  <OpChain name="CHANGE_CUSTOMER_ACCOUNT_ITEM_QUANTITY_FINISH">
    <Op class="dtv.pos.register.modifyitem.UpdateChangedQuantityOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
  </OpChain>
  <OpChain name="POST_CHANGE_CUSTOMER_ACCOUNT_ITEM_QUANTITY" signal="TransactionModified">
    <OpChainRoute chainKey="UPDATE_WARRANTY_CUSTOMER_ACCOUNT_QUANTITY" />
  </OpChain>
  <OpChain name="CHANGE_SP_ORDER_EXPECTED_DATE">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_EXPECTED_DATE" />
    </Op>
    <PromptOp class="dtv.pos.register.specorder.modifyitem.PromptItemChangeExpectedDateOp" validationsBean="specialOrderExpectedDateRules" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
  </OpChain>
  <OpChain name="CHANGE_SP_ORDER_COMMISSIONED_ASSOCIATES">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" validationsBean="changeItemCommissionRules" />
    <OpChainRoute chainKey="CHANGE_SP_ORDER_COMMISSIONED_ASSOCIATES_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_SP_ORDER_COMMISSIONED_ASSOCIATES_TOUCH">
    <Op class="dtv.pos.customer.account.op.GetSelectedCustAcctItemFromTouchOp" />
    <OpChainRoute chainKey="CHANGE_SP_ORDER_COMMISSIONED_ASSOCIATES_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_SP_ORDER_COMMISSIONED_ASSOCIATES_IMPL">
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_COMMISSION_ASSOCIATES" />
    </Op>
    <Op class="dtv.pos.commission.RouteChangeCommAssocOp" />
    <Op class="dtv.pos.commission.UpdateCommModifierOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
  </OpChain>
  <OpChain name="TAX_SP_ORDER_ITEM_CHANGE_LOCATION" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_TAX" />
    </Op>
    <PromptOp class="dtv.pos.register.tax.PromptPostalCodeOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxLocationOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxChangeReasonOp" />
    <Op class="dtv.pos.register.tax.ChangeTaxGroupRuleOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
  </OpChain>
  <OpChain name="TAX_SP_ORDER_ITEM_EXEMPT" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_TAX" />
    </Op>
    <Op class="dtv.pos.register.tax.PromptSelectItemTaxOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxExemptionOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxExemptReasonOp" breakpoint="true" />
    <Op class="dtv.pos.register.tax.SaveTaxExemptOp" />
    <Op class="dtv.pos.register.tax.ChangeTaxToExemptOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
  </OpChain>
  <OpChain name="TAX_SP_ORDER_ITEM_CHANGE_AMOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_TAX" />
    </Op>
    <Op class="dtv.pos.register.tax.PromptSelectItemTaxOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxAmountOp" validationsBean="taxAmountRules" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxChangeReasonOp" />
    <Op class="dtv.pos.register.tax.ChangeTaxAmountOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
  </OpChain>
  <OpChain name="TAX_SP_ORDER_ITEM_CHANGE_PERCENT" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_TAX" />
    </Op>
    <Op class="dtv.pos.register.tax.PromptSelectItemTaxOp" />
    <OpChainRoute chainKey="TAX_CHANGE_PERCENT" />
    <Op class="dtv.pos.register.tax.ChangeTaxPercentOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
  </OpChain>
  <OpChain name="CHANGE_SP_ORDER_DISCOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.GetCurrentCustAcctDiscountOp" validationsBean="changeDiscountRules" />
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountDiscountOp">
      <Parameter name="ApplicationMethodCode" value="LINE_ITEM" />
    </PromptOp>
    <PromptOp class="dtv.pos.pricing.discount.PromptForGroupDiscountItemsOp" validationsBean="groupItemSelectionDiscountRules" />
    <Op class="dtv.pos.register.cca.op.discount.RouteCustomerAccountDiscountOp" />
    <OpChainRoute chainKey="VOID_CUSTOMER_ACCOUNT_DISCOUNT_MAIN" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="REMOVE_DISCOUNT" />
    </Op>
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
  </OpChain>
  <OpChain name="SP_ORDER_NON_PHYSICAL_START">
    <PromptOp class="dtv.pos.register.specorder.nonphysical.PromptSpecOrderNonPhysicalItemOp">
      <Parameter name="EXCLUDE_NPI_TYPE" value="VOUCHER" />
      <Parameter name="EXCLUDE_NPI_TYPE" value="WARRANTY" />
    </PromptOp>
    <ValidationOp validationsBean="sellingIdGroupRules" />
    <Op class="dtv.pos.register.specorder.nonphysical.RouteSpecOrderItemOp" />
  </OpChain>
  <OpChain name="SP_ORDER_NON_PHYSICAL_FINISH" signal="TransactionModified">
    <OpChainRoute chainKey="SP_ORDER_NON_PHYSICAL_VALIDATE" />
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.shippingfee.EnsureSingleShippingFeeLineItemOp" />
    <Op class="dtv.pos.shippingfee.FlagManualShippingFeeOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <Op class="dtv.pos.customer.account.op.AddCustomerAccountModifierOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.register.specorder.item.CreateSpecOrderItemOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctActivityOp" />
  </OpChain>
  <OpChain name="SP_ORDER_NON_PHYSICAL_VALIDATE">
    <PromptOp class="dtv.pos.register.PromptItemDescriptionOp" validationsBean="itemDescriptionRules" />
    <PromptOp class="dtv.pos.register.PromptItemQuantityOp" />
    <PromptOp class="dtv.pos.register.PromptItemPriceOp" />
  </OpChain>
  <OpChain name="ADD_SPECIAL_ORDER_SHIPPING_FEE_ITEM" signal="TransactionModified">
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.sendsale.op.AddShippingFeeItemToSaleTranOp" />
    <Op class="dtv.pos.register.specorder.item.CreateSpecOrderItemOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctActivityOp" />
    <Op class="dtv.pos.customer.account.op.AddCustomerAccountModifierOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.register.UpdateCurrentTransListOp" />
  </OpChain>
  <!--
    END: SPECIAL ORDER OP CHAINS
  -->
  <!--
    BEGIN: SEND SALE OP CHAINS
  -->
  <OpChain name="ADD_NEW_SEND_SALE" contextKey="SEND_SALE" rollbackChainKey="BACKTO_SALE_ITEM">
    <Op class="dtv.pos.customer.account.op.InitCustAcctTypeOp">
      <Parameter name="TYPE" value="SEND_SALE" />
    </Op>
    <Op class="dtv.pos.customer.EnsureCustomerAssignedOp" />
    <Op class="dtv.pos.customer.AddCustToTransactionOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustomerAccountOp" />
    <OpChainRoute chainKey="ADD_NEW_SEND_SALE_FINISH" />
  </OpChain>
  <OpChain name="DISPLAY_SEND_SALE_REGULAR_MSG">
    <Op class="dtv.pos.register.itemmessages.DisplayInstructionsOp">
      <Parameter name="FILENAME" value="_instructionalSendSaleMsg" />
    </Op>
  </OpChain>
  <OpChain name="DISPLAY_SEND_SALE_INFO_TAB_MESSAGE">
    <OpChainRoute>
      <Choice chainKey="EXCHANGE_TRNSACTION_TOTAL_LESS_THAN_ZERO_MSG" condition="dtv.pos.register.sale.condition.IsExchangeTransactionTotalLessThanZero" />
      <Choice chainKey="TRANSACTION_TOTAL_IS_GREATER_THAN_CONFIGURED_AMOUNT_MSG" condition="dtv.pos.register.sale.condition.IsTotalGreaterThanConfiguredAmount" />
      <Choice chainKey="DISPLAY_SEND_SALE_REGULAR_MSG" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="ADD_NEW_SEND_SALE_FINISH">
    <PromptOp class="dtv.pos.sendsale.op.PromptShipToPartyXrefsOp" />
    <Op class="dtv.pos.sendsale.op.PromptSendSaleDestinationOp" breakpoint="true"/>
    <Op class="dtv.pos.sendsale.op.AddDeliveryModifierToCurrentAcctOp" />
    <OpChainRoute chainKey="DISPLAY_SEND_SALE_INFO_TAB_MESSAGE" />
    <!--
    <OpChainRoute chainKey="ADD_SEND_SALE_ITEM" />
    -->
    <OpChainRoute chainKey="ADD_NEW_SEND_SALE_ITEM" chainType="START" />
  </OpChain>
  <OpChain name="SEND_SALE_DESTINATION_SEARCH">
    <Op class="dtv.pos.sendsale.op.SendSaleDestCustomerSearchOp">
      <Parameter name="RESULTS_PROMPT" value="SHIP_TO_CUSTOMER_LIST" />
      <Parameter name="AddCustomerChain" value="ADD_NEW_CUST_ASSOC" />
      <Parameter name="EditCustomerChain" value="CUST_ASSOCIATION_EDIT" />
    </Op>
  </OpChain>
  <OpChain name="EDIT_SEND_SALE_DESTINATION" signal="TransactionModified" contextKey="SEND_SALE">
    <Op class="dtv.pos.sendsale.op.PromptEditSendSaleDestinationOp" />
    <Op class="dtv.pos.sendsale.op.UpdateSendSaleLineTaxUponDestModOp" />
    <Op class="dtv.pos.sendsale.op.AddDeliveryModifierToCurrentAcctOp" />
    <Op class="dtv.pos.sendsale.op.RouteSendSaleShippingFeeOp" />
    <OpChainRoute chainKey="ADD_SHIPPING_FEE" />
  </OpChain>
  <OpChain name="EDIT_SEND_SALE">
    <Op class="dtv.pos.customer.account.op.InitCustAcctTypeOp">
      <Parameter name="TYPE" value="SEND_SALE" />
    </Op>
    <PromptOp class="dtv.pos.sendsale.op.SendSaleAccountSelectOp" />
  </OpChain>
  <OpChain name="ADD_NEW_SEND_SALE_ITEM" signal="TransactionModified" contextKey="SEND_SALE" rollbackLevel="35">
    <OpChainRoute chainKey="DISPLAY_SEND_SALE_INFO_TAB_MESSAGE" />
    <PromptOp class="dtv.pos.sendsale.item.PromptSendSaleItemScanOp" contextKey="SEND_SALE" breakpoint="true" validationsBean="itemIdRules" />
    <Op class="dtv.pos.register.sale.CheckItemNotOnFileOp" />
    <ValidationOp validationsBean="sellingIdGroupRules" />
    <OpChainRoute chainKey="SEND_SALE_ITEM_AFTER_LOOKUP" />
  </OpChain>
  <OpChain name="SEND_SALE_ITEM_AFTER_LOOKUP">
    <OpChainRoute chainKey="SEND_SALE_ITEM_ID_VALIDATE" />
    <OpChainRoute chainKey="ADD_SEND_SALE_ITEM" />
  </OpChain>
  <OpChain name="SEND_SALE_ITEM_ID_VALIDATE">
    <ValidationOp validationsBean="itemAvailableForSendSaleRules" />
    <PromptOp class="dtv.pos.item.restriction.PromptForCashierAgeVerificationOp">
      <Parameter name="SaleItemType" value="SEND_SALE" />
    </PromptOp>
    <ValidationOp validationsBean="allowSendSaleItemRules" />
    <ValidationOp validationsBean="sellingIdGroupRules" />
    <Op class="dtv.pos.sendsale.item.CreateSendSaleLineItemOp" />
    <PromptOp class="dtv.pos.register.sale.PromptForItemWeightOp" validationsBean="itemWeightRules" />
    <PromptOp class="dtv.pos.register.PromptBirthDateScanOp" />
    <Op class="dtv.pos.register.MinimumAgeValidationOp" />
    <Op class="dtv.pos.customer.account.op.CheckCustAcctStyleLookupOp" />
    <PromptOp class="dtv.pos.register.PromptItemDescriptionOp" validationsBean="itemDescriptionRules" />
    <PromptOp class="dtv.pos.register.PromptItemQuantityOp" validationsBean="saleItemQuantityRules" />
    <ValidationOp class="dtv.pos.register.ValidateItemQtyWithoutPromptQtyOp" validationsBean="saleItemQtyNoPromptRules" />
    <Op class="dtv.pos.kits.CreateKitOp" />
    <Op class="dtv.pos.inventory.op.InventoryLocationWhileOp">
      <Parameter name="ChainKey" value="SALE_ALLOCATE_QUANTITY" />
    </Op>
    <OpChainRoute>
      <Choice chainKey="SEND_SALE_VOUCHER_START">
        <Condition class="dtv.pos.register.IsNonPhysicalItem">
          <Parameter name="ItemType" value="VOUCHER" />
        </Condition>
      </Choice>
    </OpChainRoute>
    <PromptOp class="dtv.pos.register.PromptItemSerialNumberOp" validationsBean="serialNumberSaleRules" />
    <PromptOp class="dtv.pos.register.ItemPropertyPromptOp" validationsBean="itemPromptPropertyRules" />
    <ValidationOp validationsBean="itemAvailabilityRules" />
    <Op class="dtv.pos.register.modifyitem.UpdateChangedQuantityOp" />
    <PromptOp class="dtv.pos.register.PromptItemPriceOp" />
    <Op class="dtv.pos.register.tax.SendSalePromptTaxLocationOp" />
    <Op class="dtv.pos.register.itemmessages.DisplayItemMessagesOp" />
  </OpChain>
  <OpChain name="ADD_SEND_SALE_ITEM">
    <OpChainRoute chainKey="ADD_SEND_SALE_ITEM_START" />
    <OpChainRoute chainKey="ADD_SEND_SALE_ITEM_FINISH" />
  </OpChain>
  <OpChain name="ADD_SEND_SALE_ITEM_START" signal="TransactionModified">
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.shippingfee.EnsureSingleShippingFeeLineItemOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <Op class="dtv.pos.customer.account.op.AddCustomerAccountModifierOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <WorkerOp workersBean="addTransDiscountsToNewItemWorkers" />
    <Op class="dtv.pos.sendsale.item.CreateSendSaleItemOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctActivityOp" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.sendsale.op.AddDeliveryModifierToCurrentAcctOp" />
    <OpChainRoute chainKey="ADD_SEND_SALE_ATTACHED_ITEMS" />
    <OpChainRoute chainKey="NOTIFY_ATTACHED_ITEMS" />
  </OpChain>
  <OpChain name="ADD_SEND_SALE_ATTACHED_ITEMS">
    <PromptOp class="dtv.pos.register.attacheditems.PromptAttachedItemsOp" />
    <Op class="dtv.pos.register.attacheditems.AttachedItemsIteratingOp">
      <Parameter name="chainKey" value="SEND_SALE_ITEM_AFTER_LOOKUP" />
    </Op>
  </OpChain>
  <OpChain name="ADD_SEND_SALE_ITEM_FINISH">
    <OpChainRoute chainKey="SELECT_WARRANTY_PLANS_SETUP" />
    <Op class="dtv.pos.warranty.common.RunCoveredLineItemChainOp">
      <Parameter name="ChainKey" value="SEND_SALE_WARRANTY_FINISH" />
    </Op>
    <OpChainRoute chainKey="ADD_SHIPPING_FEE" />
  </OpChain>
  <OpChain name="SEND_SALE_FINISH">
    <Op class="dtv.pos.customer.account.op.ValidateNewCustAcctOp" />
    <Op class="dtv.pos.customer.account.op.CompleteCustomerAccountOp" />
    <OpChainRoute chainKey="BACKTO_SALE_ITEM" chainType="START" />
  </OpChain>
  <OpChain name="SEND_SALE_PRE_TENDER">
    <Op class="dtv.pos.customer.account.op.ValidateNewCustAcctOp" />
    <Op class="dtv.pos.customer.account.op.CompleteCustomerAccountOp" />
    <OpChainRoute chainKey="PRE_TENDERING" chainType="START" />
  </OpChain>
  <OpChain name="FINISH_THEN_ADD_NEW_SEND_SALE">
    <Op class="dtv.pos.customer.account.op.ValidateNewCustAcctOp" />
    <Op class="dtv.pos.customer.account.op.CompleteCustomerAccountOp" />
    <OpChainRoute chainKey="ADD_NEW_SEND_SALE" chainType="START" />
  </OpChain>
  <OpChain name="ADD_SHIPPING_FEE">
    <Op class="dtv.pos.sendsale.op.RouteSendSaleShippingFeeOp" />
  </OpChain>
  <OpChain name="ADD_DEFAULT_SHIPPING_FEE" signal="TransactionModified">
    <Op class="dtv.pos.sendsale.op.AddShipOrderShippingFeeOp" />
  </OpChain>
  <OpChain name="ROUTE_SEND_SALE_WEIGHTED_SHIPPING_FEE">
    <PromptOp class="dtv.pos.sendsale.op.PromptForShippingWeightOp" validationsBean="itemWeightRules" />
    <Op class="dtv.pos.sendsale.op.AddWeightedShippingFeeOp" />
  </OpChain>
  <OpChain name="ADD_SEND_SALE_WEIGHTED_SHIPPING_FEE">
    <!-- For now, adding the shipping fee is just like adding the item itself. -->
    <OpChainRoute chainKey="ADD_SEND_SALE_ITEM_START" />
  </OpChain>
  <OpChain name="UPDATE_SEND_SALE_WEIGHTED_SHIPPING_FEE" signal="TransactionModified">
    <!-- Currently, this chain only updates the quantity of the shipping fee. It's -->
    <!-- basically the same as the CHANGE_SEND_SALE_ITEM_QUANTITY, but without -->
    <!-- prompting for the quantity. -->
    <Op class="dtv.pos.customer.account.op.GetCustItemDetailForSelectedLineItemOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_QUANTITY" />
    </Op>
    <Op class="dtv.pos.register.modifyitem.UpdateChangedQuantityOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
  </OpChain>
  <OpChain name="ADD_SHIPPING_FEE_ITEM" signal="TransactionModified">
    <Op class="dtv.pos.sendsale.op.AddShippingFeeItemToSaleTranOp" />
    <Op class="dtv.pos.customer.account.op.AddCustomerAccountModifierOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.sendsale.item.CreateSendSaleItemOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctActivityOp" />
  </OpChain>
  <OpChain name="UPDATE_SHIPPING_FEE" signal="TransactionModified">
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
  </OpChain>
  <OpChain name="CHANGE_SEND_SALE_ITEM_QUANTITY" signal="TransactionModified">
    <Op class="dtv.pos.customer.account.op.InitCustAcctTypeOp">
      <Parameter name="TYPE" value="SEND_SALE" />
    </Op>
    <Op class="dtv.pos.customer.account.op.GetCustItemDetailForSelectedLineItemOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_QUANTITY" />
    </Op>
    <PromptOp class="dtv.pos.register.modifyitem.PromptItemQuantityChangeOp" validationsBean="saleItemQuantityRules" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.kits.UpdateKitComponentModifiersQtyOp" />
    <Op class="dtv.pos.inventory.op.InventoryLocationChangeWhileOp">
      <Parameter name="ChainKey" value="SALE_ALLOCATE_QUANTITY_CHANGE" />
    </Op>
    <Op class="dtv.pos.register.modifyitem.UpdateChangedQuantityOp" />
    <OpChainRoute chainKey="POST_CHANGE_ITEM_QUANTITY" />
    <OpChainRoute chainKey="ADD_SHIPPING_FEE" />
  </OpChain>
  <OpChain name="CHANGE_SEND_SALE_ITEM_PRICE" signal="TransactionModified">
    <Op class="dtv.pos.customer.account.op.InitCustAcctTypeOp">
      <Parameter name="TYPE" value="SEND_SALE" />
    </Op>
    <OpChainRoute chainKey="CHANGE_SHIP_ACCOUNT_ITEM_PRICE" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <OpChainRoute chainKey="ADD_SHIPPING_FEE" />
  </OpChain>
  <OpChain name="CHANGE_SHIP_ACCOUNT_ITEM_PRICE" signal="TransactionModified">
    <Op class="dtv.pos.customer.account.op.GetCustItemDetailForSelectedLineItemOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_PRICE" />
    </Op>
    <PromptOp class="dtv.pos.register.modifyitem.PromptItemPriceChangeOp" />
    <PromptOp class="dtv.pos.register.modifyitem.PromptPriceChangeReasonCodeOp" />
    <Op class="dtv.pos.register.VoidAllDiscountsOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
  </OpChain>
  <OpChain name="VOID_SEND_SALE_ITEM" signal="TransactionModified">
    <OpChainRoute chainKey="VOID_SEND_SALE_ITEM_IMPL" />
    <OpChainRoute chainKey="ADD_SHIPPING_FEE" />
  </OpChain>
  <OpChain name="VOID_SEND_SALE_ITEM_IMPL" signal="TransactionModified">
    <Op class="dtv.pos.customer.account.op.InitCustAcctTypeOp">
      <Parameter name="TYPE" value="SEND_SALE" />
    </Op>
    <Op class="dtv.pos.customer.account.op.GetCustItemDetailForSelectedLineItemOp" />
    <ValidationOp validationsBean="voidSendSaleItemRules" />
    <Op class="dtv.pos.pricing.discount.ConfirmGroupDiscountItemVoidOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="CANCEL" />
    </Op>
    <Op class="dtv.pos.pricing.discount.VoidGroupDiscountOp">
      <Parameter name="ChainKey" value="VOID_DISCOUNT_MAIN" />
    </Op>
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="CANCEL" />
    </Op>
    <PromptOp class="dtv.pos.register.PromptVoidLineItemReasonCodeOp" />
    <Op class="dtv.tenderauth.storedvalue.VoidAuthorizationOp">
      <Parameter name="ContinueOnFailure" value="false" />
    </Op>
    <Op class="dtv.tenderauth.impl.op.VoidARAuthorizationOp">
      <Parameter name="ContinueOnFailure" value="false" />
    </Op>
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.customer.account.op.UpdateVoidCustAcctItemOp" />
  </OpChain>
  <OpChain name="ADD_SEND_SALE_LINE_ITEM_DISCOUNT" signal="TransactionModified">
    <Op class="dtv.pos.customer.account.op.GetCustItemDetailForSelectedLineItemOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="ADD_DISCOUNT" />
    </Op>
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <!-- <OpChainRoute chainKey="ADD_SHIPPING_FEE" /> -->
  </OpChain>
  <OpChain name="UPDATE_SEND_SALE_ITEM_AFTER_DISCOUNT">
    <Op class="dtv.pos.customer.account.op.GetCustItemDetailForSelectedLineItemOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="ADD_DISCOUNT" />
    </Op>
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <!-- <OpChainRoute chainKey="ADD_SHIPPING_FEE" /> -->
  </OpChain>
  <OpChain name="SEND_SALE_VOUCHER_START" signal="TransactionModified">
    <Op class="dtv.pos.register.nonphysical.GatherVoucherSaleItemInfoOp">
      <Parameter name="VoucherActivityCodeType" value="ISSUED" />
    </Op>
    <PromptOp class="dtv.pos.register.nonphysical.PromptSendSaleSelectVoucherItemOp" />
    <ValidationOp validationsBean="voucherTypeItemRules" />
    <OpChainRoute chainKey="SEND_SALE_VOUCHER_FINISH" chainType="START" />
  </OpChain>
  <OpChain name="RELOAD_SEND_SALE_VOUCHER_START">
    <OpChainRoute chainKey="SEND_SALE_VOUCHER_FINISH" chainType="START" />
  </OpChain>
  <OpChain name="SEND_SALE_VOUCHER_FINISH">
    <PromptOp class="dtv.pos.tender.voucher.PromptVoucherNumberOp" validationsBean="voucherNumberItemRules">
      <Parameter name="LineItemType" value="ITEM" />
    </PromptOp>
    <PromptOp class="dtv.pos.register.nonphysical.PromptVoucherAmtOp" validationsBean="voucherItemPriceRules" />
    <Op class="dtv.pos.register.nonphysical.CreateVoucherSaleLineItemOp">
      <Parameter name="SaleItemType" value="SEND_SALE" />
    </Op>
    <PromptOp class="dtv.pos.tender.cid.PromptGiftCardCidOp" validationsBean="cidRules" />
    <PromptOp class="dtv.tenderauth.storedvalue.PromptForPINOp" validationsBean="voucherPinRules" />
    <OpChainRoute chainKey="SALE_VOUCHER_VALIDATE" />
    <OpChainRoute chainKey="ADD_SEND_SALE_ITEM_START" />
    <OpChainRoute chainKey="SALE_VOUCHER_AUTHORIZE" />
    <OpChainRoute chainKey="ADD_SEND_SALE_ITEM_FINISH" />
  </OpChain>
  <OpChain name="SEND_SALE_COMMENT">
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountCommentOp" validationsBean="commentRules" />
  </OpChain>
  <OpChain name="SEND_SALE_COMMENTS">
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountNotesOp" />
  </OpChain>
  <!--
    END: SEND SALE OP CHAINS
  -->
  <!--
    BEGIN: RETURN OP CHAINS
  -->
  <OpChain name="PRE_RETURN_CHAIN">
    <Op class="dtv.pos.common.op.CreateTransactionAsNeededOp">
      <Parameter name="TransactionType" value="RETAIL_SALE" />
    </Op>
    <Op class="dtv.pos.register.returns.PromptReturnCustomerInfoOp" required="true" />
    <OpChainRoute chainKey="DISPLAY_RETURN_INFO_TAB_MESSAGE" />
  </OpChain>

  <OpChain name="RETURN_INFORMATION_CHAIN">
    <OpChainRoute chainKey="RETURN_INFORMATION_CHAIN.local.pre" />
    <PromptOp class="dtv.pos.kits.returns.PromptReturnKitOp" />
    <PromptOp class="dtv.pos.register.returns.PromptReturnReasonCodeOp" />
    <Op class="dtv.pos.register.returns.CreateInventoryLocationModifierOp" />
    <PromptOp class="dtv.pos.register.returns.PromptScanGiftRcptPriceOp" validationsBean="encodedItemPriceRules" />
    <PromptOp class="dtv.pos.register.returns.PromptReturnItemPriceOp" validationsBean="returnItemPriceValRules" />
    <Op class="dtv.pos.register.returns.UseCurrentItemPriceOp" />
    <PromptOp class="dtv.pos.register.returns.PromptReturnPriceHistoryOp" />
    <PromptOp class="dtv.pos.register.returns.PromptLowestReturnPriceInfoOp" />
    <Op class="dtv.pos.register.returns.GetPriceHistoryPriceByRuleOp" />
    <ValidationOp class="dtv.pos.register.returns.ValidateTotalReturnPriceNewItemOp" validationsBean="returnNewItemPriceRules" />
  </OpChain>
  <OpChain name="RETURN_INFORMATION_CHAIN.local.pre">
    <ValidationOp validationsBean="countryPack.returnValidations" />
  </OpChain>
  <OpChain name="RETURN_PRORATION_VERIFIED" signal="TransactionModified">
    <Op class="dtv.pos.register.returns.prorate.CalculateProratedVerifiedReturnPricesOp" />
  </OpChain>
  <OpChain name="RETURN_PRORATION_VERIFIED_IMPL">
    <Op class="dtv.pos.register.returns.prorate.CalculateProratedReturnPriceOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
  </OpChain>

  <!-- Chains related to the return of items NEW!!-->
  <OpChain name="RETURN_ITEM_START" contextKey="RETURN" rollbackChainKey="BACKTO_SALE_ITEM" rollbackLevel="20">
    <PromptOp class="dtv.pos.register.returns.PromptReturnWithReceiptOp" />
  </OpChain>
  <OpChain name="NEW_RETURN" contextKey="RETURN" rollbackChainKey="BACKTO_SALE_ITEM" rollbackLevel="20">
    <OpChainRoute chainKey="PRE_RETURN_CHAIN" />
    <Op class="dtv.pos.register.returns.InitializePreviousReturnInfoOp" />
    <OpChainRoute chainKey="RETURN_ITEM_START" chainType="START" />
  </OpChain>
  <OpChain name="NEW_RETURN_ROLLBACK" contextKey="RETURN" rollbackChainKey="BACKTO_SALE_ITEM" rollbackLevel="20">
    <Op class="dtv.pos.register.returns.InitializePreviousReturnInfoOp" />
    <OpChainRoute chainKey="RETURN_ITEM_START" chainType="START" />
  </OpChain>
  <OpChain name="RETURN_ITEM_FINISH">
    <OpChainRoute chainKey="RETURN_INFORMATION_CHAIN" />
    <OpChainRoute chainKey="ADD_RETURN_ITEM_TO_TRAN" />
  </OpChain>
  <OpChain name="VERIFY_RETURN">
    <PromptOp class="dtv.pos.register.returns.verification.PromptForGiftRcptOp" />
    <Op class="dtv.pos.register.returns.verification.VerifyReturnOp" />
  </OpChain>
  <OpChain name="BLIND_RETURN" signal="TransactionModified" contextKey="RETURN" rollbackChainKey="NEW_RETURN_ROLLBACK" rollbackLevel="30">
    <OpChainRoute chainKey="DISPLAY_RETURN_INFO_TAB_MESSAGE" />
    <OpChainRoute chainKey="BLIND_RETURN_VALIDATE.local" />
    <PromptOp class="dtv.pos.register.returns.PromptReturnItemScanOp" validationsBean="itemIdRules" breakpoint="true" />
    <Op class="dtv.pos.register.returns.CheckReturnItemNotOnFileOp" />
    <OpChainRoute chainKey="RETURN_BLIND_ITEM" />
  </OpChain>
  <OpChain name="BLIND_RETURN_VALIDATE.local" />
  <OpChain name="RETURN_BLIND_ITEM">
    <OpChainRoute chainKey="RETURN_ITEM_ID_VALIDATE" />
    <PromptOp class="dtv.pos.register.returns.PromptReturnCommAssocOp" />
    <PromptOp class="dtv.pos.register.returns.customerhistory.PromptReturnTransByHistoryOp" />
    <Op class="dtv.pos.register.returns.verification.CompleteUnverifiedBlindReturnOp" />
    <Op class="dtv.pos.kits.CreateKitOp" />
     <Op class="dtv.pos.register.KitComponentIteratingOp">
      <Parameter name="ChainKey" value="UNVERIFIED_RETURN_KIT_COMPONENT_SERIAL_NUMBER" />
    </Op>
    <OpChainRoute chainKey="RETURN_INFORMATION_CHAIN" />
    <Op class="dtv.pos.kits.inventory.HandleKitComponentInventoryOp" />
    <Op class="dtv.pos.register.returns.prorate.CalculateProratedReturnPriceOp" />
    <OpChainRoute chainKey="ADD_RETURN_ITEM_TO_TRAN" />
    <PromptOp class="dtv.pos.register.attacheditems.PromptAttachedItemsOp" />
    <Op class="dtv.pos.register.attacheditems.AttachedItemsIteratingOp">
      <Parameter name="chainKey" value="RETURN_BLIND_ITEM" />
    </Op>
    <OpChainRoute chainKey="NOTIFY_ATTACHED_ITEMS" />
    <OpChainRoute chainKey="RETURN_ATTACHED_WARRANTY" />
  </OpChain>
  <OpChain name="PRE_UNVERIFIED_RETURN" contextKey="RETURN">
    <OpChainRoute chainKey="VALIDATE_RETURN_INFO" />
    <PromptOp class="dtv.pos.register.returns.PromptReturnSecurityOp" />
    <PromptOp class="dtv.pos.register.returns.PromptReturnSendSaleOp" />
    <Op class="dtv.pos.register.returns.PromptReturnSendSaleDestinationOp" breakpoint="true" />
    <OpChainRoute chainKey="PRE_UNVERIFIED_RETURN.local" />
    <OpChainRoute chainKey="UNVERIFIED_RETURN" chainType="START" />
  </OpChain>
  <OpChain name="PRE_UNVERIFIED_RETURN.local" />
  <OpChain name="UNVERIFIED_RETURN" signal="TransactionModified" contextKey="RETURN" rollbackChainKey="BACK_RETURN_ORIG_INFO" rollbackLevel="30">
    <OpChainRoute chainKey="DISPLAY_RETURN_INFO_TAB_MESSAGE" />
    <PromptOp class="dtv.pos.register.returns.PromptReturnItemScanOp" validationsBean="itemIdRules" breakpoint="true" />
    <Op class="dtv.pos.register.returns.CheckReturnItemNotOnFileOp" />
    <OpChainRoute chainKey="RETURN_UNVERIFIED_ITEM" />
  </OpChain>
  <OpChain name="RETURN_UNVERIFIED_ITEM">
    <OpChainRoute chainKey="RETURN_ITEM_ID_VALIDATE" />
    <PromptOp class="dtv.pos.register.returns.PromptReturnCommAssocOp" />
    <Op class="dtv.pos.register.returns.verification.CompleteUnverifiedBlindReturnOp" />
    <Op class="dtv.pos.kits.CreateKitOp" />
     <Op class="dtv.pos.register.KitComponentIteratingOp">
      <Parameter name="ChainKey" value="UNVERIFIED_RETURN_KIT_COMPONENT_SERIAL_NUMBER" />
    </Op>
    <OpChainRoute chainKey="RETURN_INFORMATION_CHAIN" />
    <Op class="dtv.pos.register.returns.prorate.CalculateProratedReturnPriceOp" />
    <OpChainRoute chainKey="ADD_RETURN_ITEM_TO_TRAN" />
    <PromptOp class="dtv.pos.register.attacheditems.PromptAttachedItemsOp" />
    <Op class="dtv.pos.register.attacheditems.AttachedItemsIteratingOp">
      <Parameter name="chainKey" value="RETURN_UNVERIFIED_ITEM" />
    </Op>
    <OpChainRoute chainKey="NOTIFY_ATTACHED_ITEMS" />
    <OpChainRoute chainKey="RETURN_ATTACHED_WARRANTY" chainType="START" />
  </OpChain>
  <OpChain name="BACK_RETURN_ORIG_INFO">
    <Op class="dtv.pos.register.returns.InitializeOriginalReceiptInfoOp" />
    <OpChainRoute chainKey="RETURN_ITEM_AUTHORIZE" chainType="START" />
  </OpChain>
  <OpChain name="VERIFIED_RETURN" signal="TransactionModified" contextKey="VERIFIED_RETURN" rollbackChainKey="BACK_RETURN_ORIG_INFO" rollbackLevel="40">
    <OpChainRoute chainKey="DISPLAY_RETURN_INFO_TAB_MESSAGE" />
    <Op class="dtv.pos.kits.returns.UpdateAllKitsComponentsQtyForReturnOp" />
    <Op class="dtv.pos.register.returns.verification.SetOriginalTransactionListUponEntryOp" />
    <PromptOp class="dtv.pos.register.returns.verification.PromptVerifiedReturnItemScanOp" validationsBean="itemIdRules" contextKey="VERIFIED_RETURN" breakpoint="true" />
    <Op class="dtv.pos.register.returns.verification.SetReturnItemTypeOp"/>
    <Op class="dtv.pos.register.sale.CheckStyleLookupOp">
      <Parameter name="SaleItemType" value="SALE" />
    </Op>
    <Op class="dtv.pos.register.returns.verification.ValidateReturnVerificationItemScanOp" />
    <PromptOp class="dtv.pos.register.returns.verification.PromptVerifiedReturnReasonCodeOp" />
    <Op class="dtv.pos.register.returns.verification.VerifiedReturnIteratingOp">
      <Parameter name="ChainKey" value="VERIFIED_RETURN_ITEM_IMPL.pre" />
    </Op>
  </OpChain>

  <OpChain name="VERIFIED_RETURN_ITEM_IMPL.pre">
    <OpChainRoute chainKey="VERIFIED_RETURN_ITEM_IMPL" />
  </OpChain>
  <OpChain name="VERIFIED_RETURN_ITEM_IMPL">
    <ValidationOp validationsBean="allowItemVerifiedReturnRules" />
    <ValidationOp class="dtv.pos.register.returns.ValidateReturnItemPriceOp" validationsBean="returnOrigPriceRules" />
    <PromptOp class="dtv.pos.register.returns.PromptReturnItemSerialNumberOp" validationsBean="returnSerialNumberRules" />
    <Op class="dtv.pos.register.KitComponentIteratingOp">
      <Parameter name="ChainKey" value="VERIFIED_RETURN_KIT_COMPONENT_SERIAL_NUMBER" />
    </Op>
    <ValidationOp class="dtv.pos.register.returns.verification.ValidateVoucherAlreadyOnTransOp" validationsBean="returnVoucherOnTransRules" />
    <Op class="dtv.pos.register.returns.MatchSerializedReturnItemOp" />
    <Op class="dtv.pos.register.returns.verification.ValidateReturnItemOp" />
    <PromptOp class="dtv.pos.register.PromptItemDescriptionOp" validationsBean="itemDescriptionRules" />
    <PromptOp class="dtv.pos.register.returns.verification.PromptReturnVerificationItemQuantityOp" validationsBean="allowVerifiedReturnInputQtyRules" />
    <PromptOp class="dtv.pos.warranty.returns.PromptReturnWarrantiesOp" validationsBean="returnVerifiedWarrantyRules" />
    <ValidationOp class="dtv.pos.register.returns.verification.ValidateTotalReturnPriceNewVerifiedItemOp" validationsBean="returnNewItemPriceRules" />
    <PromptOp class="dtv.pos.register.returns.PromptReturnCommAssocOp" />
    <Op class="dtv.pos.register.returns.verification.UpdateVerifiedReturnLineOp" />
    <Op class="dtv.pos.register.returns.verification.UpdateVerifiedReturnVoucherOp" />
    <Op class="dtv.pos.register.returns.verification.RouteReturnVerificationOp" />
    <Op class="dtv.pos.kits.returns.UpdateReturnKitComponentsQtyOp" />
    <Op class="dtv.pos.kits.inventory.HandleKitComponentInventoryOp" />
    <Op class="dtv.pos.register.returns.verification.CompleteReturnVerificationOp" />
  </OpChain>
  <OpChain name="VERIFIED_RETURN_KIT_COMPONENT_SERIAL_NUMBER">
    <PromptOp class="dtv.pos.register.returns.PromptReturnKitItemSerialNumberOp" validationsBean="returnKitComponentSerialNumberRules">
    <Parameter name="VerifiedReturn" value="true" />
    </PromptOp>
  </OpChain>
  <OpChain name="ADD_RETURN_ITEM_TO_TRAN" signal="TransactionModified">
    <Op class="dtv.pos.register.tax.ext.op.SetLineItemTaxSystemLocationOp" />
    <Op class="dtv.pos.register.returns.AddReturnItemToSaleTranOp" />
    <Op class="dtv.pos.register.returns.CopyCrossChannelTransPropertiesOp" />
    <Op class="dtv.pos.register.itemmessages.DisplayItemMessagesOp" />
    <Op class="dtv.pos.register.returns.verification.UpdateReturnPriceModsOp" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.register.returns.verification.UpdateVerifiedReturnTaxOp" />
    <Op class="dtv.pos.register.returns.AddRestockingFeeOp" />
    <Op class="dtv.pos.kits.returns.CopyKitComponentModifiersOp" />
    <Op class="dtv.pos.kits.inventory.HandleKitComponentInventoryOp" />
    <OpChainRoute chainKey="ADD_RETURN_ITEM_TO_TRAN.local.post" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>
  <OpChain name="ADD_RETURN_ITEM_TO_TRAN.local.post" />
  <OpChain name="RETURN_ITEM_ID_VALIDATE">
    <ValidationOp validationsBean="itemAvailableForReturnRules" />
    <PromptOp class="dtv.pos.item.restriction.PromptForCashierAgeVerificationOp">
      <Parameter name="SaleItemType" value="RETURN" />
    </PromptOp>
    <ValidationOp validationsBean="returnItemIdRules" />
    <Op class="dtv.pos.register.returns.CreateReturnSaleLineItemOp" />
    <ValidationOp class="dtv.pos.register.returns.ValidateReturnItemPriceOp" validationsBean="returnShelfItemPriceRules" />
    <Op class="dtv.pos.register.returns.RouteReturnItemOp" />
  </OpChain>
  <OpChain name="RETURN_ITEM_VALIDATE">
    <PromptOp class="dtv.pos.register.returns.PromptReturnItemSerialNumberOp" validationsBean="returnSerialNumberRules" />
    <PromptOp class="dtv.pos.register.PromptItemDescriptionOp" validationsBean="itemDescriptionRules" />
    <PromptOp class="dtv.pos.register.ItemPropertyPromptOp" validationsBean="itemPromptPropertyRules" />
    <PromptOp class="dtv.pos.register.PromptItemQuantityOp" validationsBean="saleItemQuantityRules" />
    <PromptOp class="dtv.pos.register.sale.PromptForItemWeightOp" validationsBean="itemWeightRules" />
    <PromptOp class="dtv.pos.register.returns.PromptReturnItemPriceIfNeededOp" validationsBean="returnItemPriceValRules" />
    <Op class="dtv.pos.register.returns.CheckReturnStyleLookupOp" />
  </OpChain>
  <OpChain name="UNVERIFIED_RETURN_KIT_COMPONENT_SERIAL_NUMBER">
    <PromptOp class="dtv.pos.register.returns.PromptReturnKitItemSerialNumberOp" validationsBean="returnKitComponentSerialNumberRules" >
         <Parameter name="VerifiedReturn" value="false" />
    </PromptOp>
  </OpChain>
  <OpChain name="RETURN_ITEM_AUTHORIZE" rollbackChainKey="NEW_RETURN_ROLLBACK" rollbackLevel="30">
    <Op class="dtv.pos.register.returns.PromptOrigReceiptInformationOp">
      <Parameter name="CREDIT_CARD" value="RETURN_BY_CREDIT_CARD" />
      <Parameter name="EXTERNAL_ORDER" value="RETURN_BY_ORDER" />
      <Parameter name="SERIALIZED_ITEM" value="RETURN_BY_SERIALIZED_ITEM" />
      <Parameter name="FISCAL_NUMBER" value="RETURN_BY_FISCAL_NUMBER" />
    </Op>
    <OpChainRoute chainKey="VERIFY_RETURN" />
  </OpChain>
  <OpChain name="RETURN_BY_CREDIT_CARD" contextKey="RETURN">
    <ValidationOp class="dtv.pos.register.returns.verification.ValidateCreditCardTransOp" validationsBean="returnByCreditCardRules" />
    <Op class="dtv.pos.register.itemmessages.DisplayInstructionsOp">
      <Parameter name="FILENAME" value="_instructionalReturnItemScanMsg" />
    </Op>
    <PromptOp class="dtv.pos.register.returns.verification.PromptTransactionListItemScanOp" validationsBean="itemIdRules" />
    <OpChainRoute chainKey="RETURN_BY_CREDIT_CARD.post" />
  </OpChain>
  <OpChain name="RETURN_BY_CREDIT_CARD.post">
    <Op class="dtv.pos.register.returns.verification.RetrieveReturnableTransactionsFromItemOp" />
    <Op class="dtv.pos.register.itemmessages.DisplayInstructionsOp">
      <Parameter name="FILENAME" value="_instructionalReturnMsg" />
    </Op>
    <PromptOp class="dtv.pos.register.returns.verification.PromptReturnCreditCardTransListOp" />
    <OpChainRoute chainKey="PRE_RETURN_VERIFICATION" />
  </OpChain>
  <OpChain name="RETURN_ADD_ITEM_FROM_LOOKUP">
    <OpChainRoute>
      <Choice chainKey="RETURN_BLIND_ITEM" condition="dtv.pos.register.returns.verification.condition.IsBlindOrUnverifiedReturnCondition" />
      <Choice chainKey="RETURN_BY_CREDIT_CARD.post" condition="!dtv.pos.register.returns.verification.condition.IsBlindOrUnverifiedReturnCondition" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="RETURN_BY_ORDER">
    <Op class="dtv.pos.register.returns.verification.LookupExternalOrderOp" />
    <OpChainRoute chainKey="VERIFY_RETURN" />
  </OpChain>
  <OpChain name="RETURN_BY_SERIALIZED_ITEM">
    <PromptOp class="dtv.pos.register.returns.verification.PromptReturnSerializedItemsOp" />
    <OpChainRoute chainKey="VERIFY_RETURN" />
  </OpChain>
  <OpChain name="RETURN_BY_FISCAL_NUMBER">
    <PromptOp class="dtv.pos.register.returns.verification.PromptReturnFiscalTransListOp" />
    <OpChainRoute chainKey="VERIFY_RETURN" />
  </OpChain>
  <OpChain name="DISPLAY_RETURN_REGULAR_MSG">
    <Op class="dtv.pos.register.itemmessages.DisplayInstructionsOp">
      <Parameter name="FILENAME" value="_instructionalReturnMsg" />
    </Op>
  </OpChain>
  <OpChain name="DISPLAY_RETURN_INFO_TAB_MESSAGE">
    <OpChainRoute>
      <Choice chainKey="EXCHANGE_TRNSACTION_TOTAL_LESS_THAN_ZERO_MSG" condition="dtv.pos.register.sale.condition.IsExchangeTransactionTotalLessThanZero" />
      <Choice chainKey="TRANSACTION_TOTAL_IS_GREATER_THAN_CONFIGURED_AMOUNT_MSG" condition="dtv.pos.register.sale.condition.IsTotalGreaterThanConfiguredAmount" />
      <Choice chainKey="DISPLAY_RETURN_REGULAR_MSG" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="VALIDATE_RETURN_INFO">
    <PromptOp class="dtv.pos.register.returns.verification.PromptCrossBorderReturnOp" />
    <ValidationOp validationsBean="countryPack.returnValidations" />
  </OpChain>
  <OpChain name="PRE_RETURN_VERIFICATION">
    <OpChainRoute chainKey="PRE_RETURN_VERIFICATION.local.pre" />
    <OpChainRoute chainKey="PRE_RETURN_VERIFICATION.local.invoice" />
    <OpChainRoute chainKey="DISPLAY_RETURN_INFO_TAB_MESSAGE" />
    <OpChainRoute chainKey="VALIDATE_RETURN_INFO" />
    <PromptOp class="dtv.pos.register.returns.CheckTransactionMissingDataOp" />
    <PromptOp class="dtv.pos.register.returns.PromptReturnSecurityOp" />
    <OpChainRoute chainKey="RETURN_PRORATION_VERIFIED" />
    <Op class="dtv.pos.register.returns.verification.DisplayReturnOriginalTransOp" />
    <OpChainRoute chainKey="VERIFIED_RETURN" chainType="START" />
  </OpChain>
  <OpChain name="PRE_RETURN_VERIFICATION.local.pre" />
  <OpChain name="PRE_RETURN_VERIFICATION.local.invoice" />
  <OpChain name="VERIFIED_RETURN_PRE_TENDERING">
    <Op class="dtv.pos.register.UpdateCurrentTransListOp" />
    <OpChainRoute chainKey="PRE_TENDERING" chainType="START" />
  </OpChain>
  <!-- Chains related to the selling of non-physical items -->
  <OpChain name="RETURN_NON_PHYSICAL_START">
    <OpChainRoute chainKey="PRE_RETURN_CHAIN" />
    <PromptOp class="dtv.pos.register.returns.PromptReturnWithReceiptOp">
      <Parameter name="RETURN_ITEM_TYPE" value="NON_PHYSICAL_ITEM" />
    </PromptOp>
  </OpChain>
  <OpChain name="UNVERIFIED_NON_PHYSICAL_RETURN">
    <OpChainRoute chainKey="RETURN_NON_PHYSICAL_SELECT" />
    <PromptOp class="dtv.pos.register.returns.PromptReturnCommAssocOp" />
    <Op class="dtv.pos.register.returns.verification.CompleteUnverifiedBlindReturnOp" />
    <OpChainRoute chainKey="RETURN_NON_PHYSICAL_FINISH" />
  </OpChain>
  <OpChain name="BLIND_NON_PHYSICAL_RETURN">
    <OpChainRoute chainKey="UNVERIFIED_NON_PHYSICAL_RETURN" />
  </OpChain>
  <OpChain name="RETURN_NON_PHYSICAL_FINISH" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.returns.PromptReturnReasonCodeOp" />
    <OpChainRoute chainKey="ADD_RETURN_ITEM_TO_TRAN" />
  </OpChain>
  <OpChain name="RETURN_NON_PHYSICAL_SELECT">
    <PromptOp class="dtv.pos.register.nonphysical.PromptReturnNonPhysicalItemOp">
      <Parameter name="EXCLUDE_NPI_TYPE" value="VOUCHER" />
    </PromptOp>
    <ValidationOp validationsBean="sellingIdGroupRules" />
    <Op class="dtv.pos.register.returns.RouteReturnItemOp" />
  </OpChain>
  <OpChain name="RETURN_NON_PHYSICAL_VALIDATE">
    <PromptOp class="dtv.pos.register.PromptItemDescriptionOp" validationsBean="itemDescriptionRules" />
    <PromptOp class="dtv.pos.register.PromptItemSerialNumberOp" validationsBean="serialNumberSaleExcludingInventoryRules" />
    <PromptOp class="dtv.pos.register.ItemPropertyPromptOp" validationsBean="itemPromptPropertyRules" />
    <PromptOp class="dtv.pos.register.PromptItemQuantityOp" validationsBean="saleItemQuantityRules" />
    <PromptOp class="dtv.pos.register.PromptItemPriceOp" validationsBean="itemPriceRules" />
    <ValidationOp class="dtv.pos.register.returns.ValidateTotalReturnPriceNewItemOp" validationsBean="returnNewItemPriceRules" />
  </OpChain>
  <!-- Chains related to the selling of voucher -->
  <OpChain name="RETURN_VOUCHER_START">
    <OpChainRoute chainKey="RETURN_VOUCHER_START.base" />
  </OpChain>
  <OpChain name="RETURN_VOUCHER_START.base">
    <!-- this chain is called 2 ways.
       1) from a menu button
       2) from RouteVoucherSaleItemOp
     -->
    <Op class="dtv.pos.register.nonphysical.GatherVoucherSaleItemInfoOp">
      <Parameter name="VoucherActivityCodeType" value="CASHOUT" />
    </Op>
    <OpChainRoute chainKey="PRE_RETURN_CHAIN" />
    <PromptOp class="dtv.pos.register.nonphysical.PromptSelectVoucherItemOp" />
    <ValidationOp validationsBean="sellingIdGroupRules" />
    <PromptOp class="dtv.pos.tender.voucher.PromptVoucherNumberOp" validationsBean="returnVoucherNumberItemRules">
      <Parameter name="LineItemType" value="ITEM" />
    </PromptOp>
    <PromptOp class="dtv.pos.register.returns.PromptReturnWithReceiptOp">
      <Parameter name="RETURN_ITEM_TYPE" value="VOUCHER" />
    </PromptOp>
  </OpChain>
  <OpChain name="UNVERIFIED_VOUCHER_RETURN">
    <OpChainRoute chainKey="RETURN_VOUCHER_VALIDATE.pre" />
    <PromptOp class="dtv.pos.register.returns.PromptReturnCommAssocOp" />
    <Op class="dtv.pos.register.returns.verification.CompleteUnverifiedBlindReturnOp" />
    <OpChainRoute chainKey="RETURN_VOUCHER_FINISH" chainType="START" />
  </OpChain>
  <OpChain name="VOUCHER_RETURN_FROM_ITEM">
    <OpChainRoute chainKey="VOUCHER_RETURN_FROM_ITEM.base" />
  </OpChain>
  <OpChain name="VOUCHER_RETURN_FROM_ITEM.base">
    <Op class="dtv.pos.register.nonphysical.GatherVoucherSaleItemInfoOp">
      <Parameter name="VoucherActivityCodeType" value="CASHOUT" />
    </Op>
    <PromptOp class="dtv.pos.register.nonphysical.PromptReturnVoucherAmtOp" validationsBean="itemPriceRules" />
    <PromptOp class="dtv.pos.tender.voucher.PromptVoucherNumberOp" validationsBean="returnVoucherNumberItemRules">
      <Parameter name="LineItemType" value="ITEM" />
    </PromptOp>
    <Op class="dtv.pos.register.nonphysical.CreateVoucherSaleLineItemOp">
      <Parameter name="SaleItemType" value="RETURN" />
    </Op>
    <ValidationOp class="dtv.pos.register.returns.ValidateTotalReturnPriceNewItemOp" validationsBean="returnNewItemPriceRules" />
    <Op class="dtv.pos.register.returns.verification.CompleteUnverifiedBlindReturnOp" />
    <OpChainRoute chainKey="RETURN_VOUCHER_FINISH" chainType="START" />
  </OpChain>
  <OpChain name="RETURN_VOUCHER_FINISH" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.returns.PromptReturnReasonCodeOp" />
    <OpChainRoute chainKey="ADD_RETURN_ITEM_TO_TRAN" />
    <OpChainRoute chainKey="RETURN_VOUCHER_AUTHORIZE.pre" />
  </OpChain>
  <OpChain name="RETURN_VOUCHER_VALIDATE">
    <Op class="dtv.pos.register.nonphysical.GatherVoucherSaleItemInfoOp">
      <Parameter name="VoucherActivityCodeType" value="CASHOUT" />
    </Op>
    <Op class="dtv.pos.register.nonphysical.CreateVoucherSaleLineItemOp">
      <Parameter name="SaleItemType" value="RETURN" />
    </Op>
    <PromptOp class="dtv.pos.tender.cid.PromptGiftCardCidOp" />
    <ValidationOp class="dtv.pos.register.returns.ValidateTotalReturnPriceNewItemOp" validationsBean="returnNewItemPriceRules" />
  </OpChain>
  <OpChain name="RETURN_VOUCHER_VALIDATE.pre">
    <OpChainRoute chainKey="RETURN_VOUCHER_VALIDATE" />
  </OpChain>
  <OpChain name="RETURN_VOUCHER_AUTHORIZE.pre">
    <OpChainRoute chainKey="RETURN_VOUCHER_AUTHORIZE" />
  </OpChain>
  <OpChain name="RETURN_VOUCHER_AUTHORIZE">
    <!-- apply any pending prompted amount -->
    <Op class="dtv.pos.register.VoidAllDiscountsOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <Op class="dtv.tenderauth.storedvalue.AuthorizeCardOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
    <!-- same op after the authorization in case was authorized for a different amount -->
    <PromptOp class="dtv.pos.register.nonphysical.PromptReturnVoucherAmtOp" validationsBean="itemPriceRules" />
    <Op class="dtv.pos.register.VoidAllDiscountsOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
  </OpChain>
  <OpChain name="BACK_OFFICE_ITEM_LOOKUP">
    <OpChainRoute chainKey="GENERIC_ITEM_LOOKUP" />
  </OpChain>
  <!-- - - - - - - - - Chain for Item Lookup - - - - - - - - -->
  <OpChain name="GENERIC_ITEM_LOOKUP">
    <Op class="dtv.pos.inventory.lookup.ItemSearchOp" breakpoint="true" />
    <Op class="dtv.pos.inventory.lookup.DisplayFoundItemOp" breakpoint="true" />
  </OpChain>
  <!-- - - - - - - - - Chain for Item Matrix - - - - - - - - -->
  <OpChain name="GENERIC_ITEM_MATRIX">
    <Op class="dtv.pos.itemmatrix.op.PromptItemMatrixOp" breakpoint="true" />
  </OpChain>
  <!-- - - - - - - - - Chain for Inventory Locator Lookup - - - - - - - - -->
  <OpChain name="GENERIC_INVENTORY_LOCATOR">
    <Op class="dtv.pos.inventory.locator.InventoryLocatorOp" />
  </OpChain>
  <OpChain name="INVENTORY_LOCATOR_FROM_ITEM_LOOKUP">
    <Op class="dtv.pos.inventory.locator.InventoryLocatorKnownItemOp" />
  </OpChain>
  <!-- - - - - - - - - Chain for Reprint Document - - - - - - - - -->
  <OpChain name="GENERIC_REPRINT_DOCUMENT">
    <Op class="dtv.pos.document.op.PromptDocumentSearchFormOp" breakpoint="true" />
    <PromptOp class="dtv.pos.document.op.PromptDocumentListOp" validationsBean="documentReprintSelectRules" />
    <Op class="dtv.pos.document.op.BuildDocumentRcptsOp" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <OpChainRoute chainKey="PRINT_DOCUMENTS" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
  </OpChain>
  <OpChain name="SUSPEND_TRANSACTION" signal="TransactionComplete">
    <Op class="dtv.pos.common.op.DisablePromptActionsOp" />
    <ValidationOp validationsBean="suspendTransactionRules" />
    <Op class="dtv.pos.register.suspendresume.CheckVouchersOnSuspendOp" />
    <OpChainRoute chainKey="COMPLETE_SUSPEND" />
    <WorkerOp workersBean="calculateTlogSequenceWorkers" />
    <Op class="dtv.pos.register.suspendresume.BuildSuspendRcptsOp" />
    <Op class="dtv.pos.register.suspendresume.PrintSuspendRcptsOp" />
    <WorkerOp workersBean="saveRcptsWorkers" />
    <Op class="dtv.pos.common.PersistCurrentTransactionOp" />
    <Op class="dtv.pos.warranty.common.WarrantyTransIteratingOp">
      <Parameter name="ChainKey" value="SUSPEND_WARRANTIES" />
    </Op>
    <WorkerOp workersBean="addCustAccountPersistableWorkers" />
    <Op class="dtv.pos.common.PersistObjectsOp" />
    <WorkerOp workersBean="populateFlashSalesTablesWorkers" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
    <OpChainRoute chainKey="RESET_REGISTER" />
    <OpChainRoute chainKey="RESET_AFTER_TRANS" chainType="START" />
  </OpChain>
  <OpChain name="COMPLETE_SUSPEND" signal="TransactionModified">
    <WorkerOp workersBean="completeSuspendTransWorkers" />
  </OpChain>
  <OpChain name="SUSPEND_TRANSACTION_BACKOFFICE" signal="TransactionComplete">
    <ValidationOp validationsBean="suspendTransactionRules" />
    <Op class="dtv.pos.register.suspendresume.CheckVouchersOnSuspendOp" />
    <WorkerOp workersBean="completeSuspendTransWorkers" />
    <Op class="dtv.pos.register.suspendresume.BuildSuspendRcptsOp" />
    <Op class="dtv.pos.register.suspendresume.PrintSuspendRcptsOp" />
    <WorkerOp workersBean="saveRcptsWorkers" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
    <!--OpChainRoute chainKey="RESET_REGISTER" /-->
    <Op class="dtv.pos.common.ClearStationModelOp" />
    <Op class="dtv.pos.customer.loyalty.ClearLoyaltyOp" />
    <Op class="dtv.pos.hardware.op.IdleCustomerDisplayOp" required="false" />
  </OpChain>
  <!-- Till validation need to be performed before all pre transaction -->
  <OpChain name="PRE_TRANS_TILL_VALIDATION">
    <!-- This is a little heavy-handed, but refreshing the session info from the DB helps ensure that stale
        data in memory doesn't cause the till count screen to appear at inappropriate times. -->
    <Op class="dtv.pos.assistance.ReinitializeSessionManagerOp" />
    <PromptOp class="dtv.pos.till.ValidateRegisterBeginCountedOp" />
    <Op class="dtv.pos.till.ValidateEmployeeTillAttachedOp" />
    <ValidationOp class="dtv.pos.till.ValidateUseOtherTillOp" validationsBean="useOtherTillRules" />
    <PromptOp class="dtv.pos.till.PromptSelectOtherTillOp">
      <Parameter name="ShowListIfOne" value="true" />
    </PromptOp>
    <Op class="dtv.pos.till.CheckCurrentSessionStatusOp">
      <Parameter name="AcceptedStatus" value="BEGINCOUNT" />
    </Op>
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
  </OpChain>
  <!-- attach cash drawer -->
  <OpChain name="ATTACH_TILL_TO_WORKSTATION" signal="TransactionComplete">
    <PromptOp class="dtv.pos.till.PromptAttachTillOp" validationsBean="tillAvailableToAttachRules">
      <Parameter name="CancelAfterFailedValidation" value="true" />
    </PromptOp>
    <PromptOp class="dtv.pos.till.PromptCashDrawerForTillOp" />
    <Op class="dtv.pos.hardware.op.AlwaysOpenCashDrawerOp" />
    <Op class="dtv.pos.till.EnsureTillBeginCountedOp" />
    <!-- This operation is to ensure that the receipts from the begin count that may have just
         occurred do not print again with the receipts for the attach till that print below -->
    <Op class="dtv.pos.till.ClearTillCountReceiptsOp" />
    <Op class="dtv.pos.till.AttachTillOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
    <Op class="dtv.pos.framework.op.DoNothingOp" contextKey="TEXT_PROMPT_ONLY">
      <Parameter name="RESPONSE" value="COMPLETE" />
    </Op>
  </OpChain>
  <OpChain name="ATTACH_OTHER_TILL" signal="TransactionComplete">
    <PromptOp class="dtv.pos.till.PromptAttachOtherTillOp" validationsBean="tillAvailableToAttachRules" />
    <PromptOp class="dtv.pos.till.PromptCashDrawerForTillOp" />
    <Op class="dtv.pos.hardware.op.AlwaysOpenCashDrawerOp" />
    <Op class="dtv.pos.till.EnsureTillBeginCountedOp" />
    <!-- This operation is to ensure that the receipts from the begin count that may have just
         occurred do not print again with the receipts for the attach till that print below -->
    <Op class="dtv.pos.till.ClearTillCountReceiptsOp" />
    <Op class="dtv.pos.till.AttachTillOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <PromptOp class="dtv.pos.till.NotifyTillActionOp" key="NOTIFY_OTHER_TILL_ATTACHED" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
  </OpChain>
  <!-- remove cash drawer -->
  <OpChain name="REMOVE_TILL_FROM_WORKSTATION" signal="TransactionComplete">
    <ValidationOp class="dtv.pos.till.ValidateTillActionOp" validationsBean="tillAvailableToRemoveRules" />
    <PromptOp class="dtv.pos.till.PromptRemoveTillOp" />
    <Op class="dtv.pos.till.RemoveTillOp" />
    <Op class="dtv.pos.hardware.op.AlwaysOpenCashDrawerOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <PromptOp class="dtv.pos.till.NotifyTillActionOp" key="NOTIFY_TILL_REMOVED" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
  </OpChain>
  <OpChain name="REMOVE_OTHER_TILL" signal="TransactionComplete">
    <PromptOp class="dtv.pos.till.PromptRemoveOtherTillOp" />
    <Op class="dtv.pos.till.RemoveTillOp" />
    <Op class="dtv.pos.hardware.op.AlwaysOpenCashDrawerOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <PromptOp class="dtv.pos.till.NotifyTillActionOp" key="NOTIFY_TILL_REMOVED" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
  </OpChain>
  <OpChain name="RETURN_TILL" signal="TransactionComplete" contextKey="ISSUE_TILL">
    <PromptOp class="dtv.pos.till.PromptReturnTillOp" />
    <Op class="dtv.pos.till.ReturnTillOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <PromptOp class="dtv.pos.till.NotifyTillActionOp" key="NOTIFY_TILL_RETURNED" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
  </OpChain>
  <OpChain name="REVIEW_TILL_DETAILS" rollbackLevel="20">
    <Op class="dtv.pos.till.ReviewTillDetailsOp" />
  </OpChain>
  <OpChain name="ISSUE_TILL" signal="TransactionComplete" contextKey="ISSUE_TILL">
    <ValidationOp validationsBean="preIssueTillRules" />
    <PromptOp class="dtv.pos.till.PromptAvailableTillsOp" />
    <Op class="dtv.pos.till.IssueTillEmployeeSearchOp" contextKey="DEFAULT" />
    <ValidationOp validationsBean="issueTillRules" />
    <Op class="dtv.pos.till.PromptMultipleIssueTillStartingCashOp" contextKey="ISSUE_TILL">
      <Parameter name="ChainKey" value="PROMPT_ISSUE_TILL_STARTING_CASH" />
    </Op>
    <ValidationOp validationsBean="tillUnavailableRules" />
    <Op class="dtv.pos.till.IssueTillOp" longRunning="true" />
    <Op class="dtv.pos.common.PersistCurrentTransactionOp" />
    <Op class="dtv.pos.till.CreateIssuedStartingCashTransactionOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <PromptOp class="dtv.pos.till.NotifyTillActionOp" key="NOTIFY_TILL_ISSUED" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
  </OpChain>
  <OpChain name="PROMPT_ISSUE_TILL_STARTING_CASH">
    <PromptOp class="dtv.pos.till.PromptIssueTillStartingCashOp" validationsBean="issueStartingCashRules" />
  </OpChain>
  <OpChain name="ROLLBACK_ATTACH_TILL">
    <!-- Rollback of dtv.pos.till.AttachTillOp /> -->
    <Op class="dtv.pos.till.RemoveTillOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
  </OpChain>
  <OpChain name="ROLLBACK_ISSUE_TILL">
    <!-- Rollback of dtv.pos.till.IssueTillOp /> -->
    <Op class="dtv.pos.till.ReturnTillAndClearSessionOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
  </OpChain>
  <OpChain name="REGISTER_START_TILL_COUNT_CANCEL">
    <OpChainRoute chainKey="ROLLBACK_ATTACH_TILL" condition="dtv.pos.till.AttachTillCondition" />
    <OpChainRoute chainKey="ROLLBACK_ISSUE_TILL" />
    <OpChainRoute chainKey="TILL_COUNT_CANCEL" />
  </OpChain>
  <OpChain name="TILL_COUNT_CANCEL" signal="TransactionCancelled">
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
    <WorkerOp workersBean="clearActiveCashDrawerWorkers" />
    <!-- Ensure that when returning to the register menu, a count form won't be left in the transaction list area -->
    <Op class="dtv.pos.framework.op.DoNothingOp" contextKey="TEXT_PROMPT_ONLY">
      <Parameter name="RESPONSE" value="COMPLETE" />
    </Op>
  </OpChain>
  <OpChain name="INITIALIZE_TILL_COUNT">
    <ValidationOp class="dtv.pos.till.ValidateTillActionOp" validationsBean="tillCountAllowedRules" />
    <Op class="dtv.pos.till.RouteTillCountOp" />
  </OpChain>
  <OpChain name="STARTING_COUNT" signal="TransactionComplete" contextKey="BEGIN_COUNT">
    <Op class="dtv.pos.till.count.PromptStartTillCountOp" />
    <WorkerOp workersBean="createTillStartCountObjectsWorkers" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
  </OpChain>
  <!-- mid day desposit/ transfer/ pickup-->
  <OpChain name="MID_DAY_DEPOSIT" signal="TransactionComplete" contextKey="MIDDAY_DEPOSIT">
    <OpChainRoute chainKey="PRE_TRANS_TILL_VALIDATION" />
    <Op class="dtv.pos.hardware.op.UseIpCashDrawerAlwaysPromptOp" />
    <PromptOp class="dtv.pos.hardware.op.IpCashDrawerAlwaysScanOp" validationsBean="scanIpCashDrawerRules" breakpoint="true" />
    <Op class="dtv.pos.till.CheckCurrentSessionStatusOp">
      <Parameter name="AcceptedStatus" value="BEGINCOUNT" />
    </Op>
    <Op class="dtv.pos.hardware.op.AlwaysOpenCashDrawerOp" />
    <Op class="dtv.pos.till.count.PromptMidDayDepositCountOp" contextKey="MIDDAY_DEPOSIT" breakpoint="true" />
    <Op class="dtv.pos.till.count.CreateTillMidDepositCountObjectsOp" />
    <WorkerOp workersBean="updateCashDrawerIdWorkers" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
    <WorkerOp workersBean="clearActiveCashDrawerWorkers" />
    <!-- Ensure that when returning to the register menu, a count form won't be left in the transaction list area -->
    <Op class="dtv.pos.framework.op.DoNothingOp" contextKey="TEXT_PROMPT_ONLY">
      <Parameter name="RESPONSE" value="COMPLETE" />
    </Op>
  </OpChain>
  <OpChain name="CLOSING_COUNT_AT_REGISTER_FORCE_CLOSE">
    <Op class="dtv.pos.till.count.CreateTillAutoEndCountOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
  </OpChain>
  <OpChain name="QUICK_CLOSING_COUNT_AT_REGISTER">
    <Op class="dtv.pos.till.count.SetTillSessionFromSessionManagerOp" />
    <Op class="dtv.pos.till.count.CreateTillAutoEndCountOp" />
    <Op class="dtv.pos.till.UpdateRemoveDrawerFromCurrentWkstnOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
  </OpChain>
  <OpChain name="CLOSING_COUNT_AT_REGISTER_CLOSE" contextKey="CLOSE_COUNT">
    <Op class="dtv.pos.till.CheckCurrentSessionStatusOp">
      <Parameter name="AcceptedStatus" value="BEGINCOUNT" />
    </Op>
    <OpChainRoute chainKey="CLOSING_COUNT_LOGIC" />
    <OpChainRoute chainKey="CLOSING_COUNT_AT_REGISTER_CLOSE.post" />
  </OpChain>
  <OpChain name="CLOSING_COUNT_AT_REGISTER_CLOSE.post" />
  <OpChain name="END_COUNT_OTHER_TILL">
    <PromptOp class="dtv.pos.till.PromptEndCountOtherTillOp" />
    <OpChainRoute chainKey="CLOSING_COUNT_LOGIC" />
  </OpChain>
  <OpChain name="CLOSING_COUNT_LOGIC" signal="TransactionComplete" contextKey="CLOSE_COUNT">
    <OpChainRoute chainKey="CLOSING_COUNT_LOGIC_START.local" />
    <Op class="dtv.pos.till.count.EndCountOpenCashDrawerOp" />
    <Op class="dtv.pos.till.count.PromptTillCountOp" breakpoint="true" />
    <Op class="dtv.pos.till.count.PromptClosingDepositAmountsOp">
      <Parameter name="ChainKey" value="PROMPT_CLOSING_DEPOSIT" />
    </Op>
    <OpChainRoute chainKey="CLOSING_COUNT_LOGIC_ENDCOUNT.pre" />
    <Op class="dtv.pos.till.count.CreateTillEndCountObjectsOp" />
    <OpChainRoute chainKey="CLOSING_COUNT_LOGIC_ENDCOUNT.post" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <Op class="dtv.pos.till.UpdateRemoveDrawerFromCurrentWkstnOp" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
  </OpChain>
  <OpChain name="CLOSING_COUNT_LOGIC_START.local">
    <OpChainRoute chainKey="CLOSING_COUNT_START.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="CLOSING_COUNT_START.post" />
  </OpChain>
  <OpChain name="CLOSING_COUNT_START.pre" />
  <OpChain name="CLOSING_COUNT_START.post" />
  <OpChain name="CLOSING_COUNT_LOGIC_ENDCOUNT.pre" />
  <OpChain name="CLOSING_COUNT_LOGIC_ENDCOUNT.post" />
  <OpChain name="PROMPT_CLOSING_DEPOSIT">
    <Op class="dtv.pos.till.count.PromptClosingDepositAmtOp" contextKey="CLOSE_COUNT" />
  </OpChain>
  <OpChain name="TILL_COUNT_REMOVE_ITEM">
    <PromptOp class="dtv.pos.till.count.GetSelectedTillCountItemOp" />
  </OpChain>
  <!-- manager reconcile count -->
  <OpChain name="RECONCILE_COUNT" signal="TransactionComplete" contextKey="RECONCILE_COUNT">
    <PromptOp class="dtv.pos.till.count.PromptReconcileTillOp" />
    <Op class="dtv.pos.till.count.PromptReconcileTillCountOp" breakpoint="true" />
    <Op class="dtv.pos.till.count.CreateTillReconcileCountObjectsOp" longRunning="true" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
  </OpChain>
  <OpChain name="TILL_COUNT_DISCREPANCY_REASON">
    <PromptOp class="dtv.pos.till.count.PromptTillCountDiscrepancyReasonOp">
      <Parameter name="ReasonTypeCode" value="TILL_COUNT_DISCREPANCY" />
    </PromptOp>
  </OpChain>
  <OpChain name="VIEW_TILL_COUNT_DISCREPANCIES">
    <PromptOp class="dtv.pos.till.count.DisplayTillCountDiscrepanciesOp" />
  </OpChain>
  <OpChain name="CASH_PICKUP_COUNT" signal="TransactionComplete" rollbackChainKey="RUN_CASH_PICKUP_ROLLBACK_CHAIN">
    <Op class="dtv.pos.register.itemmessages.ClearMsgOp" />
    <OpChainRoute chainKey="PRE_TRANS_TILL_VALIDATION" />
    <Op class="dtv.pos.hardware.op.UseIpCashDrawerAlwaysPromptOp" />
    <PromptOp class="dtv.pos.hardware.op.IpCashDrawerAlwaysScanOp" validationsBean="scanIpCashDrawerRules" breakpoint="true" />
    <Op class="dtv.pos.till.CheckCurrentSessionStatusOp">
      <Parameter name="AcceptedStatus" value="BEGINCOUNT" />
    </Op>
    <PromptOp class="dtv.pos.till.PromptCountableCashTendersOp" validationsBean="cashPickupTenderListSelectionRules" contextKey="TILL_PROMPT" >
      <Parameter name="TillAction" value="_promptCashPickupCurrencyListMessage" />
      <Parameter name="Title" value="_tillCountContextTitleCashPickup" />
      <Parameter name="Instruction" value="_promptCashPickupCurrencyListMessage" />
    </PromptOp>
    <Op class="dtv.pos.hardware.op.AlwaysOpenCashDrawerOp" contextKey="CASH_PICKUP" />
    <Op class="dtv.pos.till.NotifyTenderMaxValueInTillOp" />
    <Op class="dtv.pos.till.count.PromptCashPickupCountOp" />
    <WorkerOp workersBean="createCashPickupObjectsWorkers" />
    <WorkerOp workersBean="updateCashDrawerIdWorkers" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
    <WorkerOp workersBean="clearActiveCashDrawerWorkers" />
  </OpChain>
  <OpChain name="RUN_DEPOSIT_CALCULATOR">
    <Op class="dtv.pos.till.count.PromptDepositCalculatorOp" />
  </OpChain>
  <OpChain name="RUN_CASH_PICKUP_ROLLBACK_CHAIN">
    <OpChainRoute chainKey="CASH_PICKUP_ROLLBACK" chainType="START" />
  </OpChain>
  <OpChain name="CASH_PICKUP_ROLLBACK">
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
  </OpChain>
  <OpChain name="CASH_TRANSFER_COUNT" signal="TransactionComplete">
    <Op class="dtv.pos.register.itemmessages.ClearMsgOp" />
    <OpChainRoute chainKey="PRE_TRANS_TILL_VALIDATION" />
    <Op class="dtv.pos.hardware.op.UseIpCashDrawerAlwaysPromptOp" />
    <PromptOp class="dtv.pos.hardware.op.IpCashDrawerAlwaysScanOp" validationsBean="scanIpCashDrawerRules" breakpoint="true" />
    <Op class="dtv.pos.till.CheckCurrentSessionStatusOp">
      <Parameter name="AcceptedStatus" value="BEGINCOUNT" />
    </Op>
    <Op class="dtv.pos.hardware.op.AlwaysOpenCashDrawerOp" />
    <PromptOp class="dtv.pos.till.PromptCountableCashTendersOp" validationsBean="cashTenderListSelectionRules" contextKey="TILL_PROMPT" >
      <Parameter name="TillAction" value="_promptCashTransferCurrencyListMessage" />
      <Parameter name="Title" value="_cashTransferMenuText" />
      <Parameter name="Instruction" value="_promptCashTransferCurrencyListMessage" />
    </PromptOp>
    <Op class="dtv.pos.till.count.PromptCashTransferCountOp" contextKey="CASH_TRANSFER" />
    <WorkerOp workersBean="processCashTransferCountWorkers" />
    <WorkerOp workersBean="updateCashDrawerIdWorkers" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
    <WorkerOp workersBean="clearActiveCashDrawerWorkers" />
  </OpChain>
  <!-- Bank deposit -->
  <OpChain name="BANK_DEPOSIT" signal="TransactionComplete" contextKey="BANK_DEPOSIT_COUNT">
    <PromptOp class="dtv.pos.till.count.PromptBankInstituteForDepositOp" />
    <Op class="dtv.pos.till.count.PromptBankDepositTillCountOp" breakpoint="true" />
    <PromptOp class="dtv.pos.till.count.PromptConfirmDepositAmountsOp">
      <Parameter name="PromptKey" value="CONFIRM_BANK_DEPOSIT" />
    </PromptOp>
    <Op class="dtv.pos.till.count.CreateBankDepositCountObjectsOp" contextKey="ISSUE_TILL" longRunning="true" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
  </OpChain>
  <!-- paid in  -->
  <OpChain name="PAID_IN" signal="TransactionComplete" contextKey="TILL">
    <Op class="dtv.pos.register.itemmessages.ClearMsgOp" />
    <OpChainRoute chainKey="PRE_TRANS_TILL_VALIDATION" />
    <Op class="dtv.pos.hardware.op.UseIpCashDrawerAlwaysPromptOp" />
    <PromptOp class="dtv.pos.hardware.op.IpCashDrawerAlwaysScanOp" validationsBean="scanIpCashDrawerRules" breakpoint="true" />
    <Op class="dtv.pos.till.CheckCurrentSessionStatusOp">
      <Parameter name="AcceptedStatus" value="BEGINCOUNT" />
    </Op>
    <PromptOp class="dtv.pos.till.fundxfer.PromptPaidOutTransBarCodeOp" breakpoint="true" validationsBean="paidOutTransactionRules" />
    <PromptOp class="dtv.pos.till.fundxfer.PromptPaidInReasonCodeOp" breakpoint="true" />
    <PromptOp class="dtv.pos.till.fundxfer.PromptFundXferAmountOp" breakpoint="true" validationsBean="paidInOutRules">
      <Parameter name="PromptKey" value="ENTER_FUND_TRANSFER_AMOUNT" />
    </PromptOp>
    <OpChainRoute chainKey="PAID_IN.1.local" />
    <Op class="dtv.pos.hardware.op.AlwaysOpenCashDrawerOp" />
    <Op class="dtv.pos.till.fundxfer.CreatePaidInTransactionOp">
      <Parameter name="persistOnReverse" value="true" />
    </Op>
    <OpChainRoute chainKey="PAID_IN.2.local" />
    <Op class="dtv.pos.till.fundxfer.PopulatePaidInTransactionOp" />
    <WorkerOp workersBean="updateCashDrawerIdWorkers" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PAID_IN.3.local" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
    <!-- Flash sales update paid in -->
    <WorkerOp workersBean="populateFlashSalesTablesWorkers" />
    <WorkerOp workersBean="clearActiveCashDrawerWorkers" />
  </OpChain>
  <OpChain name="PAID_IN.1.local">
    <OpChainRoute chainKey="PAID_IN.1.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="PAID_IN.1.post" />
  </OpChain>
  <OpChain name="PAID_IN.2.local">
    <OpChainRoute chainKey="PAID_IN.2.pre" />
    <Op class="dtv.pos.hardware.op.CompleteFiscalTransactionOp" />
    <OpChainRoute chainKey="PAID_IN.2.post" />
  </OpChain>
  <OpChain name="PAID_IN.3.local">
    <OpChainRoute chainKey="PAID_IN.3.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="PAID_IN.3.post" />
  </OpChain>
  <OpChain name="PAID_IN.1.pre" />
  <OpChain name="PAID_IN.1.post" />
  <OpChain name="PAID_IN.2.pre" />
  <OpChain name="PAID_IN.2.post" />
  <OpChain name="PAID_IN.3.pre" />
  <OpChain name="PAID_IN.3.post" />
  <!-- paid out  -->
  <OpChain name="PAID_OUT" signal="TransactionComplete" contextKey="TILL">
    <Op class="dtv.pos.register.itemmessages.ClearMsgOp" />
    <OpChainRoute chainKey="PRE_TRANS_TILL_VALIDATION" />
    <Op class="dtv.pos.hardware.op.UseIpCashDrawerAlwaysPromptOp" />
    <PromptOp class="dtv.pos.hardware.op.IpCashDrawerAlwaysScanOp" validationsBean="scanIpCashDrawerRules" breakpoint="true" />
    <Op class="dtv.pos.till.CheckCurrentSessionStatusOp">
      <Parameter name="AcceptedStatus" value="BEGINCOUNT" />
    </Op>
    <PromptOp class="dtv.pos.till.fundxfer.PromptPaidOutReasonCodeOp" breakpoint="true" />
    <PromptOp class="dtv.pos.till.fundxfer.PromptFundXferAmountOp" breakpoint="true" validationsBean="paidInOutRules">
      <Parameter name="PromptKey" value="ENTER_FUND_TRANSFER_AMOUNT" />
    </PromptOp>
    <OpChainRoute chainKey="CHECK_TILL_BALANCE" />
    <OpChainRoute chainKey="PAID_OUT.1.local" />
    <Op class="dtv.pos.hardware.op.AlwaysOpenCashDrawerOp" />
    <Op class="dtv.pos.till.fundxfer.CreatePaidOutTransactionOp">
      <Parameter name="persistOnReverse" value="true" />
    </Op>
    <OpChainRoute chainKey="PAID_OUT.2.local" />
    <Op class="dtv.pos.till.fundxfer.PopulatePaidOutTransactionOp" />
    <WorkerOp workersBean="updateCashDrawerIdWorkers" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PAID_OUT.3.local" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
    <!-- Flash sales update paid out -->
    <WorkerOp workersBean="populateFlashSalesTablesWorkers" />
    <WorkerOp workersBean="clearActiveCashDrawerWorkers" />
  </OpChain>
  <OpChain name="CHECK_TILL_BALANCE" />
  <OpChain name="PAID_OUT.1.local">
    <OpChainRoute chainKey="PAID_OUT.1.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="PAID_OUT.1.post" />
  </OpChain>
  <OpChain name="PAID_OUT.2.local">
    <OpChainRoute chainKey="PAID_OUT.2.pre" />
    <Op class="dtv.pos.hardware.op.CompleteFiscalTransactionOp" />
    <OpChainRoute chainKey="PAID_OUT.2.post" />
  </OpChain>
  <OpChain name="PAID_OUT.3.local">
    <OpChainRoute chainKey="PAID_OUT.3.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="PAID_OUT.3.post" />
  </OpChain>
  <OpChain name="PAID_OUT.1.pre" />
  <OpChain name="PAID_OUT.1.post" />
  <OpChain name="PAID_OUT.2.pre" />
  <OpChain name="PAID_OUT.2.post" />
  <OpChain name="PAID_OUT.3.pre" />
  <OpChain name="PAID_OUT.3.post" />
  <!-- Change till float amount -->
  <OpChain name="CHANGE_TILL_FLOAT_SETUP" contextKey="CHANGE_TILL_FLOAT">
    <PromptOp class="dtv.pos.till.PromptChangeFloatReasonCodeOp" />
    <PromptOp class="dtv.pos.till.PromptCountableCashTendersOp" validationsBean="cashTenderListSelectionRules">
      <Parameter name="Instruction" value="_promptChangeFloatCurrencyListMessage" />
      <Parameter name="Title" value="_promptChangeFloatCurrencyListTitle" />
    </PromptOp>
    <PromptOp class="dtv.pos.till.PromptTenderRepositoryListOp" validationsBean="tenderRepositoryListSelectionRules" />
    <Op class="dtv.pos.till.CreateTillControlTransactionOp" />
    <Op class="dtv.pos.till.CreateChangeFloatDetailsOp" />
    <OpChainRoute chainKey="CHANGE_TILL_FLOAT" chainType="START" />
  </OpChain>
  <OpChain name="CHANGE_TILL_FLOAT" contextKey="CHANGE_TILL_FLOAT" rollbackChainKey="PROMPT_CANCEL_TRANSACTION">
    <PromptOp class="dtv.pos.till.PromptChangeFloatAmountOp" validationsBean="changeTillFloatRules" />
    <PromptOp class="dtv.pos.till.PromptSaveChangeFloatOp" />
  </OpChain>
  <OpChain name="SIMPLE_COMPLETE_TRANSACTION" signal="TransactionComplete">
    <WorkerOp workersBean="completeTransactionWorkers" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
  </OpChain>
  <OpChain name="VOID_LINE" signal="TransactionModified">
    <Op class="dtv.pos.register.RouteVoidLineOp" />
  </OpChain>
  <OpChain name="VOID_LINE_TOUCH" signal="TransactionModified">
    <Op class="dtv.pos.register.RouteVoidLineFromTouchOp" />
  </OpChain>
  <!-- <OpChain name="CALCULATE_DEALS">  -->
    <!--Operation class="dtv.pos.pricing.deal.CalculateDealsOp" /-->
  <!-- </OpChain> -->
  <OpChain name="VOID_DEAL" signal="TransactionModified">
    <!-- <Op class="dtv.pos.pricing.deal.VoidDealOp" /> [RXPS-17352] -->
    <PromptOp class="dtv.pos.pricing.deal.VoidDealLineOp" />
  </OpChain>
  <!-- till audit -->
  <OpChain name="TILL_AUDIT" signal="TransactionComplete" contextKey="TILL_AUDIT">
    <OpChainRoute chainKey="PRE_TRANS_TILL_VALIDATION" />
    <Op class="dtv.pos.hardware.op.UseIpCashDrawerAlwaysPromptOp" />
    <PromptOp class="dtv.pos.hardware.op.IpCashDrawerAlwaysScanOp" validationsBean="scanIpCashDrawerRules" breakpoint="true" />
    <Op class="dtv.pos.till.CheckCurrentSessionStatusOp">
      <Parameter name="AcceptedStatus" value="BEGINCOUNT" />
    </Op>
    <Op class="dtv.pos.hardware.op.AlwaysOpenCashDrawerOp" />
    <Op class="dtv.pos.till.count.PromptAuditTillCountOp" contextKey="TILL_AUDIT" breakpoint="true">
      <Parameter name="TenderAvailability" value="TILL_COUNT" />
    </Op>
    <Op class="dtv.pos.till.count.CreateTillAuditObjectsOp" longRunning="true" />
    <WorkerOp workersBean="updateCashDrawerIdWorkers" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
    <WorkerOp workersBean="clearActiveCashDrawerWorkers" />
    <!-- Ensure that when returning to the register menu, a count form won't be left in the transaction list area -->
    <Op class="dtv.pos.framework.op.DoNothingOp" contextKey="TEXT_PROMPT_ONLY">
      <Parameter name="RESPONSE" value="COMPLETE" />
    </Op>
  </OpChain>
  <OpChain name="OPEN_STORE_BANK" signal="TransactionComplete" contextKey="STOREBANK_OPEN">
    <ValidationOp validationsBean="openStoreBankRules" />
    <Op class="dtv.pos.till.count.GetStoreBankSessionOp" />
    <Op class="dtv.pos.till.count.PromptStoreBankOpeningCountOp" breakpoint="true" />
    <Op class="dtv.pos.till.count.ProcessStoreBankOpeningCountOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
  </OpChain>
  <OpChain name="RECONCILE_STORE_BANK" signal="TransactionComplete" contextKey="STOREBANK_RECONCILE">
    <ValidationOp validationsBean="reconcileStoreBankRules" />
    <Op class="dtv.pos.till.count.GetStoreBankSessionOp" />
    <Op class="dtv.pos.till.count.PromptStoreBankEndCountOp" breakpoint="true" />
    <Op class="dtv.pos.till.count.ProcessStoreBankEndCountOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
  </OpChain>
  <OpChain name="STORE_BANK_CASH_DEPOSIT" signal="TransactionComplete">
    <Op class="dtv.pos.register.itemmessages.ClearMsgOp" />
    <ValidationOp validationsBean="storeBankCashDepositRules" />
    <Op class="dtv.pos.till.count.GetStoreBankSessionOp" />
    <PromptOp class="dtv.pos.till.PromptCountableCashTendersOp" contextKey="TILL_PROMPT" validationsBean="cashTenderListSelectionRules" >
      <Parameter name="TillAction" value="_promptDepositCurrencyListMessage" />
      <Parameter name="Title" value="_storeBankCashDepositMenuText" />
    </PromptOp>
    <Op class="dtv.pos.till.count.PromptStoreBankCashDepositOp" contextKey="STORE_BANK_CASH_DEPOSIT" />
    <Op class="dtv.pos.till.count.ProcessStoreBankCashDepositOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
  </OpChain>
  <!-- store bank audit -->
  <OpChain name="STOREBANK_AUDIT" signal="TransactionComplete" contextKey="STOREBANK_AUDIT">
    <Op class="dtv.pos.till.count.GetStoreBankSessionOp" />
    <Op class="dtv.pos.till.count.PromptAuditTillCountOp">
      <Parameter name="TenderAvailability" value="DEPOSIT" />
      <Parameter name="TenderControlTransType" value="STORE_BANK_AUDIT" />
    </Op>
    <Op class="dtv.pos.till.count.CreateTillAuditObjectsOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
  </OpChain>
  <OpChain name="STOREBANK_COMPLETE_ENDCOUNT">
    <Op class="dtv.pos.till.count.PromptBankDepositTillCountOp" breakpoint="true" />
    <PromptOp class="dtv.pos.till.count.PromptConfirmDepositAmountsOp" />
    <Op class="dtv.pos.till.count.CreateBankDepositCountObjectsOp" contextKey="ISSUE_TILL" />
  </OpChain>
  <OpChain name="STOREBANK_DEPOSIT_ALL_ENDCOUNT">
    <Op class="dtv.pos.till.count.CreateStoreBankCompleteDepositOp" />
  </OpChain>
  <OpChain name="STOREBANK_PROMPT_REMAIN_CASH_ENDCOUNT">
    <Op class="dtv.pos.till.count.PromptEndCountRemainingCashOp" />
    <Op class="dtv.pos.till.count.CreateStoreBankCompleteDepositOp" />
  </OpChain>
  <OpChain name="STOREBANK_CLOSING_COUNT_STORE_CLOSING" signal="TransactionComplete" contextKey="STOREBANK_CLOSING_COUNT">
    <Op class="dtv.pos.till.count.GetStoreBankSessionOp" longRunning="true" />
    <PromptOp class="dtv.pos.till.count.PromptBankInstituteForDepositOp" />
    <Op class="dtv.pos.till.count.RouteStoreBankTillCountAtStoreCloseOp" longRunning="true" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <!-- This operation is to ensure that the receipts from store bank that may have just
         occurred do not print again with the receipts for the cancelled transactions -->
    <Op class="dtv.pos.till.ClearTillCountReceiptsOp" />
  </OpChain>
  <!-- register mode assign drawer  -->
  <OpChain name="REGISTER_MODE_ISSUE_ATTACH_TILL" signal="TransactionComplete">
    <Op class="dtv.pos.till.GetRegisterModeIssueTillInfoOp" longRunning="true" />
    <Op class="dtv.pos.till.IssueTillOp" />
    <Op class="dtv.pos.common.PersistCurrentTransactionOp" />
    <PromptOp class="dtv.pos.till.PromptCashDrawerForTillOp" />
    <Op class="dtv.pos.till.AttachTillOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
  </OpChain>
  <!-- Begin count for all tills in register mode -->
  <OpChain name="REGISTER_MODE_STARTING_COUNT" signal="TransactionComplete">
    <Op class="dtv.pos.till.GetCurrentSessionOp" longRunning="true" />
    <Op class="dtv.pos.hardware.op.AlwaysOpenCashDrawerOp" />
    <Op class="dtv.pos.till.count.PromptRegisterStartTillCountOp" breakpoint="true" />
    <WorkerOp workersBean="createTillStartCountObjectsWorkers" contextKey="ISSUE_TILL" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="ROLLING_CLOSE_FIRST_WORKSTATION_TO_OPEN" condition="dtv.pos.register.RollingCloseFirstRegisterToOpenCondition" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
  </OpChain>
  <OpChain name="REGISTER_MODE_QUICK_STARTING_COUNT" signal="TransactionComplete">
    <Op class="dtv.pos.till.GetCurrentSessionOp" longRunning="true" />
    <Op class="dtv.pos.till.count.PromptRegisterStartTillCountOp" />
    <WorkerOp workersBean="createTillStartCountObjectsWorkers" contextKey="ISSUE_TILL" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="ROLLING_CLOSE_FIRST_WORKSTATION_TO_OPEN" condition="dtv.pos.register.RollingCloseFirstRegisterToOpenCondition" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
  </OpChain>
  <!-- Register mode starting count opchain -->
  <OpChain name="REGISTER_MODE_STARTING_COUNT_CHAIN_SET" contextKey="BEGIN_COUNT">
    <OpChainRoute chainKey="REGISTER_MODE_ISSUE_ATTACH_TILL" condition="dtv.pos.till.UseTillAccountability" />
    <OpChainRoute chainKey="REGISTER_MODE_STARTING_COUNT" />
  </OpChain>
  <OpChain name="REGISTER_MODE_QUICK_STARTING_COUNT_CHAIN_SET" contextKey="BEGIN_COUNT">
    <OpChainRoute chainKey="REGISTER_MODE_ISSUE_ATTACH_TILL" condition="dtv.pos.till.UseTillAccountability" />
    <OpChainRoute chainKey="REGISTER_MODE_QUICK_STARTING_COUNT" />
  </OpChain>
  <OpChain name="EMPLOYEE_BORROW">
    <Op class="dtv.pos.employee.borrow.EmployeeBorrowSearchOp" />
    <Op class="dtv.pos.employee.borrow.EmployeeBorrowFormOp" />
    <WorkerOp workersBean="saveEmployeeBorrowWorkers" />
    <PromptOp class="dtv.pos.employee.borrow.NotifyEmployeeBorrowSuccessfulOp" />
  </OpChain>
  <!-- ASSOCIATE_ADVANCE  -->
  <OpChain name="ASSOCIATE_ADVANCE" contextKey="TEXT_PROMPT_ONLY_EMPTY_MENU" signal="TransactionComplete">
    <OpChainRoute chainKey="PRE_TRANS_TILL_VALIDATION" />
    <Op class="dtv.pos.employee.EmployeeSearchActiveOp" />
    <Op class="dtv.pos.till.advance.CreateAssocAdvanceTransactionOp" />
    <ValidationOp class="dtv.pos.till.advance.ValidateAssocAdvanceIdOp" validationsBean="associateAdvanceRules" />
    <PromptOp class="dtv.pos.till.advance.PromptAssocAdvanceAmountOp" validationsBean="associateAdvanceAmountRules" breakpoint="true" />
    <PromptOp class="dtv.pos.till.advance.PromptAssocAdvanceAuthNoOp" />
    <PromptOp class="dtv.pos.till.advance.PromptAssocAdvanceRepaymentAmountOp" />
    <Op class="dtv.pos.hardware.op.UseIpCashDrawerAlwaysPromptOp" />
    <PromptOp class="dtv.pos.hardware.op.IpCashDrawerAlwaysScanOp" validationsBean="scanIpCashDrawerRules" breakpoint="true" />
    <Op class="dtv.pos.hardware.op.AlwaysOpenCashDrawerOp" />
    <WorkerOp workersBean="updateCashDrawerIdWorkers" />
    <WorkerOp workersBean="saveAssociateAdvanceTransWorkers" longRunning="true" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
    <WorkerOp workersBean="clearActiveCashDrawerWorkers" />
  </OpChain>
  <!-- ASSOCIATE_ADVANCE  -->
  <!--  START: EMPLOYEE SCHEDULING  -->
  <OpChain name="PRE_SCHEDULE_MAINTENANCE" rollbackLevel="30">
    <PromptOp class="dtv.pos.scheduling.maint.op.PromptNewScheduleWeeksOp" />
    <OpChainRoute chainKey="SCHEDULE_MAINTENANCE" chainType="START" />
  </OpChain>
  <OpChain name="SCHEDULE_MAINTENANCE" rollbackLevel="40">
    <Op class="dtv.pos.scheduling.maint.op.HandleScheduleMaintActionsOp" breakpoint="true" />
  </OpChain>
  <OpChain name="PRE_SCHEDULE_VIEW">
    <Op class="dtv.pos.scheduling.employeeview.PromptLogInToViewScheduleOp" contextKey="VIEW_TIMECARD_LOGIN" />
    <OpChainRoute chainKey="SCHEDULE_VIEW" chainType="START" />
  </OpChain>
  <OpChain name="SCHEDULE_VIEW" rollbackLevel="40">
    <Op class="dtv.pos.scheduling.employeeview.HandleScheduleViewActionsOp" breakpoint="true" />
  </OpChain>
  <OpChain name="PRINT_SCHEDULE_RECEIPT">
    <Op class="dtv.pos.scheduling.employeeview.PrepScheduleForPrintingOp" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
  </OpChain>
  <OpChain name="CHANGE_SCHEDULE_VIEW">
    <PromptOp class="dtv.pos.scheduling.maint.op.PromptNewScheduleWeeksOp">
      <Parameter name="ChangingWeeks" value="true" />
    </PromptOp>
  </OpChain>
  <OpChain name="SCHEDULE_VIEW_NEXT_WEEK">
    <Op class="dtv.pos.scheduling.maint.op.PromptChangeSchedWeekOp">
      <Parameter name="NEXT" value="1" />
    </Op>
  </OpChain>
  <OpChain name="SCHEDULE_VIEW_PREV_WEEK">
    <Op class="dtv.pos.scheduling.maint.op.PromptChangeSchedWeekOp">
      <Parameter name="PREVIOUS" value="1" />
    </Op>
  </OpChain>
  <OpChain name="PRE_SCHEDULED_EMPLOYEES_VIEW">
    <Op class="dtv.pos.scheduling.employeeview.PromptLogInToViewScheduleOp" contextKey="VIEW_TIMECARD_LOGIN" />
    <OpChainRoute chainKey="SCHEDULED_EMPLOYEES_VIEW" chainType="START" />
  </OpChain>
  <OpChain name="SCHEDULED_EMPLOYEES_VIEW">
    <Op class="dtv.pos.scheduling.employeeview.DisplayScheduledEmployeesOp" />
  </OpChain>
  <OpChain name="CHANGE_SCHEDULE_RECORD">
    <Op class="dtv.pos.scheduling.maint.op.GetCurrentScheduleDateOp" />
    <Op class="dtv.pos.scheduling.maint.op.GetCurrentScheduleOp" />
    <Op class="dtv.pos.scheduling.maint.op.PromptScheduleRecordOp">
      <Parameter name="ACTION_TYPE" value="CHANGE" />
    </Op>
  </OpChain>
  <OpChain name="ADD_SCHEDULE_RECORD">
    <Op class="dtv.pos.scheduling.maint.op.GetCurrentScheduleDateOp" />
    <Op class="dtv.pos.scheduling.maint.op.PromptScheduleRecordOp">
      <Parameter name="ACTION_TYPE" value="ADD" />
    </Op>
  </OpChain>
  <OpChain name="ADD_SCHEDULE_RECORD_FROM_LIST">
    <Op class="dtv.pos.scheduling.maint.op.GetCurrentScheduleDateOp" />
    <PromptOp class="dtv.pos.scheduling.maint.op.PromptScheduleRecordFromListOp" />
  </OpChain>
  <OpChain name="COPY_DAY_SCHEDULE">
    <Op class="dtv.pos.scheduling.maint.op.GetCurrentScheduleDateOp" />
    <PromptOp class="dtv.pos.scheduling.maint.op.PromptDaysOfWeekOp" />
  </OpChain>
  <OpChain name="COPY_WEEK_SCHEDULE">
    <PromptOp class="dtv.pos.scheduling.maint.op.PromptCopyScheduleWeeksOp" />
  </OpChain>
  <OpChain name="DELETE_SCHEDULE_ENTRY">
    <Op class="dtv.pos.scheduling.maint.op.GetCurrentScheduleDateOp" />
    <Op class="dtv.pos.scheduling.maint.op.GetCurrentScheduleOp" />
    <Op class="dtv.pos.scheduling.maint.op.PromptDeleteScheduleConfirmationOp" />
  </OpChain>
  <OpChain name="SHIFT_MAINTENANCE" rollbackLevel="20">
    <Op class="dtv.pos.scheduling.shift.ShiftSearchOp" breakpoint="true" />
    <Op class="dtv.pos.scheduling.shift.EditShiftOp" />
  </OpChain>
  <OpChain name="PRE_TIME_OFF">
    <PromptOp class="dtv.pos.scheduling.timeoff.PromptTimeOffWeeksOp" />
    <OpChainRoute chainKey="TIME_OFF_MAINTENANCE" chainType="START" />
  </OpChain>
  <OpChain name="TIME_OFF_MAINTENANCE" rollbackLevel="90">
    <Op class="dtv.pos.scheduling.timeoff.TimeOffMaintOp" breakpoint="true" />
  </OpChain>
  <OpChain name="TIME_OFF_ADD">
    <Op class="dtv.pos.scheduling.timeoff.EmployeeTimeOffSearchOp" />
    <OpChainRoute chainKey="TIME_OFF_SELECT_DETAILS" />
  </OpChain>
  <OpChain name="TIME_OFF_EDIT">
    <Op class="dtv.pos.scheduling.timeoff.EditTimeOffOp" />
    <OpChainRoute chainKey="TIME_OFF_SELECT_DETAILS" />
  </OpChain>
  <OpChain name="TIME_OFF_SELECT_DETAILS">
    <PromptOp class="dtv.pos.scheduling.timeoff.PromptTimeOffTypeOp" breakpoint="true" />
    <Op class="dtv.pos.scheduling.timeoff.PromptTimeOffDateFormOp" />
    <OpChainRoute>
      <Choice chainKey="TIME_OFF_ADD_FULL_DAY">
        <Condition class="dtv.pos.scheduling.timeoff.IsTimeOffType">
          <Parameter name="TimeOffType" value="FULL_DAY" />
        </Condition>
      </Choice>
      <Choice chainKey="TIME_OFF_ADD_HALF_DAY">
        <Condition class="dtv.pos.scheduling.timeoff.IsTimeOffType">
          <Parameter name="TimeOffType" value="HALF_DAY" />
        </Condition>
      </Choice>
      <Choice chainKey="TIME_OFF_ADD_PART_DAY">
        <Condition class="dtv.pos.scheduling.timeoff.IsTimeOffType">
          <Parameter name="TimeOffType" value="PART_DAY" />
        </Condition>
      </Choice>
    </OpChainRoute>
  </OpChain>
  <OpChain name="TIME_OFF_ADD_FULL_DAY">
    <Op class="dtv.pos.scheduling.timeoff.PromptTimeOffDaysFormOp" />
    <OpChainRoute chainKey="TIME_OFF_ADD_FINISH" />
  </OpChain>
  <OpChain name="TIME_OFF_ADD_HALF_DAY">
    <PromptOp class="dtv.pos.scheduling.timeoff.PromptHalfDayTypeOp" />
    <OpChainRoute chainKey="TIME_OFF_ADD_FINISH" />
  </OpChain>
  <OpChain name="TIME_OFF_ADD_PART_DAY">
    <Op class="dtv.pos.scheduling.timeoff.PromptTimeOffTimeFormOp" />
    <OpChainRoute chainKey="TIME_OFF_ADD_FINISH" />
  </OpChain>
  <OpChain name="TIME_OFF_ADD_FINISH">
    <PromptOp class="dtv.pos.scheduling.timeoff.PromptTimeOffReasonOp" />
    <Op class="dtv.pos.scheduling.timeoff.CompleteTimeOffOp" />
  </OpChain>
  <OpChain name="TIME_OFF_REMOVE">
    <Op class="dtv.pos.scheduling.timeoff.VoidTimeOffOp" />
    <Op class="dtv.pos.scheduling.timeoff.CompleteTimeOffOp" />
  </OpChain>
  <OpChain name="TIME_OFF_CHANGE_WEEK">
    <PromptOp class="dtv.pos.scheduling.timeoff.PromptTimeOffWeeksOp" />
  </OpChain>
  <OpChain name="TIME_OFF_NEXT_WEEK">
    <Op class="dtv.pos.scheduling.timeoff.PromptWeekChangeOp">
      <Parameter name="NEXT" value="1" />
    </Op>
  </OpChain>
  <OpChain name="TIME_OFF_PREV_WEEK">
    <Op class="dtv.pos.scheduling.timeoff.PromptWeekChangeOp">
      <Parameter name="PREVIOUS" value="1" />
    </Op>
  </OpChain>

  <!--  END: EMPLOYEE SCHEDULING  -->
  <OpChain name="EMPLOYEE_MAINTENANCE" rollbackLevel="30">
    <Op class="dtv.pos.employee.EmployeeSearchOp" required="true" breakpoint="true" />
    <OpChainRoute chainKey="EMPLOYEE_MAINTENANCE_EDIT" chainType="START" />
  </OpChain>
  <OpChain name="EMPLOYEE_MAINTENANCE_EDIT" rollbackLevel="40">
    <Op class="dtv.pos.hardware.biometric.fingerprint.op.DisableFingerprintReaderIdentityForEmployeeMaintOp" />
    <Op class="dtv.pos.employee.EditEmployeeOp" breakpoint="true" />
  </OpChain>
  <OpChain name="ADD_EMPLOYEE_COMMENT">
    <PromptOp class="dtv.pos.employee.PromptEmployeeCommentOp" validationsBean="commentRules" />
  </OpChain>
  <OpChain name="CREATE_EMPLOYEE" contextKey="CREATE_EMPLOYEE_BACK_OFFICE">
    <Op class="dtv.pos.register.itemmessages.DefaultIdleMsgOp" />
    <PromptOp class="dtv.pos.employee.PromptNewEmployeeIdFromSearchOp" validationsBean="newEmployeeIdRules" />
    <PromptOp class="dtv.pos.employee.PromptNewEmployeeCustomerIdFromSearchOp" validationsBean="newCustomerIdRules" />
    <ValidationOp class="dtv.pos.employee.PromptNewPasswordForNewEmployeeOp" validationsBean="newPasswordRules" />
    <Op class="dtv.pos.hardware.biometric.fingerprint.op.DisableFingerprintReaderIdentityForEmployeeMaintOp" />
    <Op class="dtv.pos.employee.CreateEmployeeOp" breakpoint="true"/>
  </OpChain>
  <OpChain name="CREATE_EMPLOYEE_FROM_MAINTENENCE" contextKey="CREATE_EMPLOYEE_BACK_OFFICE">
    <Op class="dtv.pos.register.itemmessages.DefaultIdleMsgOp" />
    <PromptOp class="dtv.pos.employee.PromptNewEmployeeIdOp" validationsBean="newEmployeeIdRules" />
    <PromptOp class="dtv.pos.employee.PromptNewEmployeeCustomerIdOp" validationsBean="newCustomerIdRules" />
    <ValidationOp class="dtv.pos.employee.PromptNewPasswordForNewEmployeeOp" validationsBean="newPasswordRules">
      <Parameter name="InsideEmpMaintenence" value="true" />
    </ValidationOp>
    <Op class="dtv.pos.hardware.biometric.fingerprint.op.DisableFingerprintReaderIdentityForEmployeeMaintOp" />
    <Op class="dtv.pos.employee.CreateEmployeeFromMaintenenceOp" breakpoint="true"/>
  </OpChain>
  <OpChain name="CHANGE_EMPLOYEE_PASSWORD" contextKey="CHANGE_EMPLOYEE_PASSWORD">
    <Op class="dtv.pos.security.op.PromptLoginPwdChangeOp" />
    <OpChainRoute chainKey="CHANGE_PASSWORD" chainType="START" />
  </OpChain>
  <OpChain name="CHANGE_PASSWORD" contextKey="CHANGE_PASSWORD">
    <Op class="dtv.pos.employee.PromptNewPasswordOp" />
    <PromptOp key="NEW_PASSWORD_SAVED" />
  </OpChain>
  <OpChain name="CHANGE_PASSWORD_FROM_MAINTENENCE" contextKey="CHANGE_PASSWORD">
    <ValidationOp class="dtv.pos.employee.PromptNewPasswordForExistingEmployeeOp" validationsBean="newPasswordForExistingEmployeeRules">
      <Parameter name="InsideEmpMaintenence" value="true" />
    </ValidationOp>
    <PromptOp key="NEW_PASSWORD_SAVED" />
  </OpChain>
  <OpChain name="CHANGE_CHALLENGE_QUESTIONS">
    <Op class="dtv.pos.employee.PromptPasswordChallengeMaintOp" />
    <PromptOp class="dtv.pos.employee.SaveChallengeQuestionAnswersOp" />
  </OpChain>
  <OpChain name="FORGOT_PASSWORD" contextKey="CHANGE_EMPLOYEE_PASSWORD">
    <PromptOp class="dtv.pos.employee.PromptLastNameVerificationOp" />
    <Op class="dtv.pos.employee.PromptForgotPasswordQuestionsOp" />
  </OpChain>
  <OpChain name="EJOURNAL_MICR_CHECKNUMER_PROMPT">
    <Op class="dtv.pos.ejournal.PromptTranCheckNumberOp" />
  </OpChain>
  <OpChain name="EJOURNAL_MICR_SCAN">
    <Op class="dtv.pos.ejournal.ReadMicrOp" />
  </OpChain>
  <OpChain name="ELECTRONIC_JOURNAL" rollbackLevel="30">
    <Op class="dtv.pos.ejournal.PromptTranSearchOp" />
    <!-- following would be used instead of PromptTranSearchOp if you wanted to start with a detail -->
    <!--   view of current register, current day -->
    <!--Operation class="dtv.pos.ejournal.SelectCurrentDayOp" /-->
    <OpChainRoute chainKey="ELECTRONIC_JOURNAL_VIEW" chainType="START" />
  </OpChain>
  <OpChain name="ELECTRONIC_JOURNAL_VIEW" contextKey="ELECTRONIC_JOURNAL_VIEW" rollbackLevel="40">
    <Op class="dtv.pos.ejournal.ViewEJournalOp" />
  </OpChain>
  <OpChain name="ELECTRONIC_JOURNAL_SEARCH">
    <Op class="dtv.pos.ejournal.PromptTranSearchOp" />
    <OpChainRoute chainKey="ELECTRONIC_JOURNAL_VIEW" chainType="START" />
  </OpChain>
  <OpChain name="ELECTRONIC_JOURNAL_DETAIL" rollbackLevel="50">
    <Op class="dtv.pos.ejournal.ViewEJournalDetailOp" />
  </OpChain>
  <OpChain name="POST_VOID_MAIN" signal="TransactionComplete">
    <OpChainRoute chainKey="POST_VOID_MAIN_START.local" />
    <ValidationOp validationsBean="postVoidRules" longRunning="true" />
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="POST_VOID_CONFIRM" />
    <PromptOp class="dtv.pos.ejournal.postvoid.PromptExtendedTransactionOp" />
    <PromptOp class="dtv.pos.ejournal.postvoid.PromptPostVoidReasonOp" />
    <Op class="dtv.pos.ejournal.postvoid.ValidateCustAcctTransForVoidOp" />
    <OpChainRoute chainKey="POST_VOID_MAIN.1.local" />
    <Op class="dtv.pos.ejournal.postvoid.CreatePostVoidTransactionOp" />
    <Op class="dtv.pos.ejournal.postvoid.PostVoidCustomerAccountsOp" />
    <OpChainRoute chainKey="POST_VOID_MAIN.2" />
    <OpChainRoute chainKey="POST_VOID_MAIN.2.local" />
    <OpChainRoute chainKey="PRE_POST_VOID_TENDER_AUTH" condition="dtv.pos.ejournal.postvoid.condition.HasReverseTenderAuth" />
    <Op class="dtv.pos.hardware.op.UseIpCashDrawerPostVoidPromptOp" />
    <PromptOp class="dtv.pos.hardware.op.IpCashDrawerPostVoidScanOp" validationsBean="scanIpCashDrawerRules" breakpoint="true" />
    <OpChainRoute chainKey="POST_VOID_BASE" />
    <OpChainRoute chainKey="POST_VOID_SOLD_VOUCHER" condition="dtv.pos.ejournal.postvoid.condition.HasSoldVouchers" />
    <OpChainRoute chainKey="POST_VOID_ISSUED_VOUCHER" condition="dtv.pos.ejournal.postvoid.condition.HasIssuedVouchers" />
    <OpChainRoute chainKey="POST_VOID_BOUNCE_BACK_COUPON" condition="dtv.pos.ejournal.postvoid.condition.HasIssuedBounceBackCoupons" />
    <WorkerOp workersBean="postVoidInventoryWorkers" />
    <OpChainRoute chainKey="POST_VOID_WARRANTY_ACTIVITY" condition="dtv.pos.ejournal.postvoid.condition.HasWarrantyActivities" />
    <OpChainRoute chainKey="PRE_POST_VOID_STORED_VALUE" condition="dtv.pos.ejournal.postvoid.condition.HasStoredValueAuthorizations" />
    <OpChainRoute chainKey="PRE_POST_VOID_AR_PAYMENT" condition="dtv.pos.ejournal.postvoid.condition.HasAccountReceivableAuthorizations" />
    <WorkerOp workersBean="ejBuildReturnedItemJournalWorkers" />
    <Op class="dtv.pos.customer.award.VoidAwardsFromPostVoidTransactionOp" />
    <Op class="dtv.pos.customer.loyalty.VoidLoyaltyPurchaseFromPostVoidTransactionOp">
      <Parameter name="ShowLoyaltyNotification" value="true" />
    </Op>
    <Op class="dtv.pos.coupon.VoidAuthorizeCouponsFromPostVoidTransactionOp" />
    <Op class="dtv.pos.houseaccount.op.PostVoidChargeAcctHistoryOp" />
    <OpChainRoute chainKey="POST_VOID_MAIN.3.local" />
    <!-- Start 183574 -->
    <Op class="dtv.pos.hardware.op.OpenCashDrawerForPostVoidsOp" />
    <!-- End 183574 -->
    <WorkerOp workersBean="updateCashDrawerIdWorkers" />
    <WorkerOp workersBean="persistPostVoidWorkers" />
    <Op class="dtv.pos.common.PersistObjectsOp" />
    <Op class="dtv.pos.tender.voucher.PersistVoucherPostVoidHistoryOp" />
    <Op class="dtv.pos.hardware.op.BuildTenderFrankingsOnSelectedTransactionOp" />
    <Op class="dtv.pos.hardware.op.FrankTendersOp" />
    <OpChainRoute chainKey="PRINT_POST_VOID_RECIPTS" />
    <!-- Start 183574 -->
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
    <!-- End 183574 -->
    <!-- Flash sales update for post void  -->
    <!-- Moved this to a chain so it can be easily overriden without having to copy the
      entire post void chain -->
    <OpChainRoute chainKey="POST_VOID_POPULATE_FLASH_SALES" />
    <WorkerOp workersBean="updateSAFQueueForPostVoidsWorkers" />
    <Op class="dtv.pos.common.ClearStationModelOp" />
    <OpChainRoute chainKey="POST_VOID_MAIN_FINISH.local" />
    <WorkerOp workersBean="clearActiveCashDrawerWorkers" />
  </OpChain>
  <OpChain name="PRINT_POST_VOID_RECIPTS">
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
  </OpChain>
  <OpChain name="ROLLBACK_POST_VOID_TRANS">
    <OpChainRoute>
      <Choice chainKey="CANCEL_TRANSACTION" chainType="START" condition="dtv.pos.register.condition.NoTransRunCondition" />
      <Choice chainKey="CANCEL_NO_TRANSACTION" chainType="START" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="POST_VOID_MAIN_START.local">
    <OpChainRoute chainKey="POST_VOID_MAIN_START.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="POST_VOID_MAIN_START.post" />
  </OpChain>
  <OpChain name="POST_VOID_MAIN.1.local">
    <OpChainRoute chainKey="POST_VOID_MAIN.1.pre" />
    <!-- Fiscal logic goes here -->
    <Op class="oracle.retail.xstore.countrypack.common.hardware.fiscal.op.CheckFiscalTransactionForVoidOp" longRunning="true" />      
    <OpChainRoute chainKey="POST_VOID_MAIN.1.post" />
  </OpChain> 
  <OpChain name="POST_VOID_MAIN.2" />
  <OpChain name="POST_VOID_MAIN.2.local">
    <OpChainRoute chainKey="POST_VOID_MAIN.2.pre" />
<!--     <Op class="dtv.pos.hardware.op.CompleteFiscalTransactionOp" longRunning="true" /> -->
    <OpChainRoute chainKey="POST_VOID_MAIN.2.local.pre" />
    <OpChainRoute chainKey="POST_VOID_MAIN.2.post" />
  </OpChain>
  <OpChain name="POST_VOID_MAIN.2.local.pre" />
  <OpChain name="POST_VOID_MAIN.3.local">
    <OpChainRoute chainKey="POST_VOID_MAIN.3.pre" />
    <!-- Fiscal logic goes here -->
    <Op class="oracle.retail.xstore.countrypack.common.hardware.fiscal.op.CompleteFiscalTransactionForVoidOp" longRunning="true" />
    <OpChainRoute chainKey="POST_VOID_MAIN.3.post" />
  </OpChain>
  <OpChain name="POST_VOID_MAIN_FINISH.local">
    <OpChainRoute chainKey="POST_VOID_MAIN_FINISH.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="POST_VOID_MAIN_FINISH.post" />
  </OpChain>
  <OpChain name="POST_VOID_MAIN_START.pre" />
  <OpChain name="POST_VOID_MAIN_START.post" />
  <OpChain name="POST_VOID_MAIN.1.pre" />
  <OpChain name="POST_VOID_MAIN.1.post" />
  <OpChain name="POST_VOID_MAIN.2.pre" />
  <OpChain name="POST_VOID_MAIN.2.post" />
  <OpChain name="POST_VOID_MAIN_FINISH.pre" />
  <OpChain name="POST_VOID_MAIN_FINISH.post" />
  <OpChain name="PRE_POST_VOID_TENDER_AUTH">
    <Op class="dtv.pos.tender.postvoid.PostVoidTenderIteratingOp">
      <Parameter name="ChainKey" value="POST_VOID_TENDER_AUTH" />
    </Op>
  </OpChain>
  <OpChain name="PRE_POST_VOID_STORED_VALUE">
    <Op class="dtv.pos.tender.postvoid.PostVoidVouchersIteratingOp">
      <Parameter name="ChainKey" value="POST_VOID_STORED_VALUE" />
    </Op>
  </OpChain>
  <OpChain name="PRE_POST_VOID_AR_PAYMENT">
    <Op class="dtv.pos.tender.postvoid.PostVoidAccountReceivableIteratingOp">
      <Parameter name="ChainKey" value="POST_VOID_AR_PAYMENT" />
    </Op>
  </OpChain>
  <OpChain name="POST_VOID_POPULATE_FLASH_SALES">
    <WorkerOp workersBean="populateFlashSalesTablesOnPostVoidWorkers" />
  </OpChain>
  <OpChain name="POST_VOID" contextKey="TEXT_PROMPT_ONLY">
    <OpChainRoute chainKey="PRE_TRANS_TILL_VALIDATION" />
    <Op class="dtv.pos.till.CheckCurrentSessionStatusOp">
      <Parameter name="AcceptedStatus" value="BEGINCOUNT" />
    </Op>
    <Op class="dtv.pos.ejournal.postvoid.PromptPostVoidTransInfoOp" longRunning="true" />
    <OpChainRoute chainKey="POST_VOID_MAIN" />
  </OpChain>
  <OpChain name="POST_VOID_BASE">
    <Op class="dtv.pos.ejournal.postvoid.VoidPosTransactionOp" />
    <Op class="dtv.pos.ejournal.postvoid.PostVoidPersistSystemTotalOp" />
  </OpChain>
  <OpChain name="POST_VOID_ISSUED_VOUCHER">
    <Op class="dtv.pos.ejournal.postvoid.PostVoidIssuedVouchersOp" />
  </OpChain>
  <OpChain name="POST_VOID_SOLD_VOUCHER">
    <Op class="dtv.pos.ejournal.postvoid.PostVoidSoldVoucherOp" />
  </OpChain>
  <OpChain name="POST_VOID_STORED_VALUE">
    <Op class="dtv.tenderauth.storedvalue.VoidAuthorizationOp">
      <Parameter name="ContinueOnFailure" value="false" />
    </Op>
  </OpChain>
  <OpChain name="CANCEL_STORED_VALUE.pre" />
  <OpChain name="CANCEL_STORED_VALUE">
    <OpChainRoute chainKey="CANCEL_STORED_VALUE.pre" />
    <Op class="dtv.tenderauth.storedvalue.VoidAuthorizationOp">
      <Parameter name="ContinueOnFailure" value="false" />
    </Op>
  </OpChain>
  <OpChain name="POST_VOID_AR_PAYMENT">
    <Op class="dtv.tenderauth.impl.op.VoidARAuthorizationOp">
      <Parameter name="ContinueOnFailure" value="true" />
    </Op>
  </OpChain>
  <OpChain name="CANCEL_AR_PAYMENT">
    <Op class="dtv.tenderauth.impl.op.VoidARAuthorizationOp">
      <Parameter name="ContinueOnFailure" value="false" />
    </Op>
  </OpChain>
  <OpChain name="POST_VOID_TENDER_AUTH">
    <OpChainRoute chainKey="POSTVOID_GUEST_LOOKUP" />
    <Op class="dtv.tenderauth.impl.op.PostVoidTenderOp" />
  </OpChain>
  <OpChain name="POST_VOID_EJOURNAL">
    <Op class="dtv.pos.ejournal.postvoid.RoutePostVoidFromEjournalOp" />
  </OpChain>
  <!-- - - - - - - - - - - - - - -->
  <!-- START OF RECEIVING CHAINS -->
  <!-- - - - - - - - - - - - - - -->
  <OpChain name="RECEIVING" rollbackLevel="30">
    <Op class="dtv.pos.inventory.op.CheckForOldDocumentsOp">
      <Parameter name="DocumentType" value="RECEIVING" />
    </Op>
    <Op class="dtv.pos.inventory.receive.op.ReceivingDocSearchOp" breakpoint="true" />
    <PromptOp class="dtv.pos.inventory.receive.op.PromptPONumberOp" contextKey="RECEIVING" />
    <OpChainRoute chainKey="CARTON_RECEIVING" chainType="START" />
  </OpChain>
  <OpChain name="CARTON_RECEIVING" rollbackChainKey="PROMPT_CANCEL_INVENTORY" rollbackLevel="40" contextKey="RECEIVING">
    <Op class="dtv.pos.inventory.op.DisplayInventoryFeatureOp">
      <Parameter name="headerFormKey" value="RECEIVING_DOCUMENT_HEADER" />
      <Parameter name="primaryFormKey" value="RECEIVING_DOCUMENT_LIST" />
      <Parameter name="modelKey" value="RECEIVING_DOCUMENT" />
    </Op>
    <PromptOp class="dtv.pos.inventory.receive.op.PromptCartonScanOp" breakpoint="true" />
    <PromptOp class="dtv.pos.inventory.receive.op.PromptControlNumberOp" validationsBean="controlNumberRules" />
    <OpChainRoute chainKey="LINE_RECEIVING" chainType="START" />
  </OpChain>
  <OpChain name="PROMPT_CANCEL_INVENTORY">
    <PromptOp class="dtv.pos.inventory.op.PromptRollbackInventoryOp" key="CANCEL_INVENTORY">
      <Parameter name="rollbackChain" value="CANCEL_INVENTORY" />
    </PromptOp>
  </OpChain>
  <OpChain name="CANCEL_INVENTORY" signal="InventoryOperationsCancelled">
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>
  <OpChain name="RECEIVING_DOCUMENT_COMMENT">
    <ValidationOp validationsBean="changableDocumentRules" />
    <Op class="dtv.pos.inventory.receive.op.PromptReceivingDocumentNoteOp" />
  </OpChain>
  <OpChain name="LINE_RECEIVING" rollbackLevel="50" contextKey="RECEIVING_CARTON">
    <PromptOp class="dtv.pos.inventory.receive.op.PromptReceivingItemScanOp" contextKey="RECEIVING_CARTON" validationsBean="receivingItemRules" breakpoint="true" />
    <Op class="dtv.pos.inventory.receive.op.CheckItemNotOnFileOp" />
    <OpChainRoute chainKey="RECEIVING_ITEM_AFTER_LOOKUP" />
  </OpChain>
  <OpChain name="RECEIVING_ITEM_AFTER_LOOKUP">
    <Op class="dtv.pos.common.PromptStyleLookupOp" />
    <Op class="dtv.pos.inventory.receive.op.MatchInventoryLineItemOp" />
    <PromptOp class="dtv.pos.inventory.op.PromptInventoryItemQuantityOp" validationsBean="receivingItemQuantityRules" />
    <PromptOp class="dtv.pos.inventory.op.PromptInventoryItemCostOp" validationsBean="itemCostRules" />
    <Op class="dtv.pos.inventory.receive.op.PromptReceivingLocationOp" />
    <PromptOp class="dtv.pos.inventory.receive.op.PromptReceiveItemSerialNumberOp" validationsBean="receivingSerialNumberRules" />
    <Op class="dtv.pos.inventory.receive.op.ProcessReceivingDocLineOp" />
    <Op class="dtv.pos.inventory.receive.op.SyncReceivingDocLineOp" />
  </OpChain>
  <OpChain name="INVENTORY_CLOSE_SAVE_EXIT_RECEIVING" signal="InventoryOperationsComplete,TransactionComplete">
    <Op class="dtv.pos.inventory.receive.op.SyncReceivingDocLineOp" />
    <Op class="dtv.pos.inventory.op.PostInventoryItemsOp" />
    <OpChainRoute chainKey="RECEIVING_CLOSE_DOCUMENT" />
    <OpChainRoute chainKey="SAVE_RECEIVING.ORDER" />
    <WorkerOp workersBean="saveReceivingWorkers" />
    <Op class="dtv.pos.inventory.replenishment.op.UpdateLinkedReplenishmentOrdersOp" />
    <Op class="dtv.pos.inventory.replenishment.op.LinkedReplenishmentOrdersTransactionIteratingOp">
      <Parameter name="ChainKey" value="PERSIST_LINKED_REPLENISHMENT_ORDER_IMPL" />
    </Op>
    <OpChainRoute chainKey="RECEIVING" chainType="START" />
  </OpChain>
  <OpChain name="RECEIVING_CLOSE_DOCUMENT">
    <PromptOp class="dtv.pos.inventory.receive.op.PromptForCloseDocumentOp" />
  </OpChain>
  <OpChain name="RECEIVE_ENTIRE_ASN_CHAIN" contextKey="RECEIVING">
    <Op class="dtv.pos.inventory.receive.op.AutoReceiveQuantityAsnOp" />
    <OpChainRoute chainKey="INVENTORY_CLOSE_SAVE_EXIT_RECEIVING" />
  </OpChain>
  <OpChain name="RECEIVE_ENTIRE_CARTON_CHAIN">
    <Op class="dtv.pos.inventory.receive.op.AutoReceiveQuantityCartonOp" />
    <Op class="dtv.pos.inventory.receive.op.SyncReceivingDocLineOp" />
    <OpChainRoute chainKey="CARTON_RECEIVING" chainType="START" />
  </OpChain>
  <OpChain name="ADD_NEW_INV_CTL_DOC">
    <Op class="dtv.pos.inventory.receive.op.PromptAddReceivingDocumentOp" />
  </OpChain>
  <OpChain name="RECEIVE_CHANGE_QUANTITY">
    <PromptOp class="dtv.pos.inventory.op.GetSelectedInventoryItemOp" validationsBean="changableQtyInventoryItemRules" />
    <PromptOp class="dtv.pos.inventory.receive.op.PromptReceivingItemChangeQuantityOp" validationsBean="receivingItemChangeQuantityRules" />
    <Op class="dtv.pos.inventory.receive.op.PromptReceivingLocationOp" />
    <Op class="dtv.pos.inventory.receive.op.ChangeReceivingLocationModifierOp" />
    <Op class="dtv.pos.inventory.receive.op.SyncReceivingDocLineOp" />
  </OpChain>
  <OpChain name="RECEIVE_VOID_LINE_ITEM">
    <PromptOp class="dtv.pos.inventory.op.GetSelectedInventoryItemOp" validationsBean="receivedVoidItemRules" />
    <PromptOp class="dtv.pos.inventory.op.PromptForVoidItemOp" />
  </OpChain>
  <!-- - - - - - - - - - - - - -->
  <!-- END OF RECEIVING CHAINS -->
  <!-- - - - - - - - - - - - - -->
  <OpChain name="INV_CTL_DOC_EXCEPTIONS">
    <PromptOp class="dtv.pos.inventory.op.PromptInvDocExceptionsOp" />
  </OpChain>
  <OpChain name="SHIP_DOC_EXCEPTIONS">
    <PromptOp class="dtv.pos.inventory.ship.op.PromptShippingDocExceptionsOp" />
  </OpChain>
  <!-- - - - - - - - - - - - - - -->
  <!-- START OF SHIPPING CHAINS  -->
  <!-- - - - - - - - - - - - - - -->
  <OpChain name="SHIPPING" rollbackLevel="30">
    <Op class="dtv.pos.inventory.op.CheckForOldDocumentsOp">
      <Parameter name="DocumentType" value="SHIPPING" />
    </Op>
    <Op class="dtv.pos.inventory.ship.op.ShippingDocSearchOp" breakpoint="true" />
    <OpChainRoute chainKey="LINE_SHIPPING" chainType="START" />
  </OpChain>
  <OpChain name="ADD_NEW_SHIPPING_INV_CTL_DOC">
    <Op class="dtv.pos.inventory.ship.op.PromptAddShippingDocumentOp" />
    <OpChainRoute chainKey="LINE_SHIPPING" chainType="START" />
  </OpChain>
  <OpChain name="LINE_SHIPPING" rollbackChainKey="PROMPT_CANCEL_INVENTORY" rollbackLevel="50" contextKey="SHIPPING">
    <PromptOp class="dtv.pos.inventory.ship.op.PromptShippingItemScanOp" contextKey="SHIPPING" validationsBean="shippingItemRules" breakpoint="true" />
    <ValidationOp class="dtv.pos.inventory.ship.op.CheckItemNotOnFileOp" validationsBean="itemNotOnFileRules" />
    <OpChainRoute chainKey="SHIPPING_ITEM_AFTER_LOOKUP" />
  </OpChain>
  <OpChain name="SHIPPING_ITEM_AFTER_LOOKUP">
    <ValidationOp class="dtv.pos.inventory.ship.op.ValidateAddItemByItemLookupOp" validationsBean="shippingDocAddLineAllowedRules" />
    <Op class="dtv.pos.common.PromptStyleLookupOp" />
    <Op class="dtv.pos.inventory.ship.op.MatchInventoryLineItemOp" />
    <PromptOp class="dtv.pos.inventory.op.PromptInventoryItemQuantityOp" validationsBean="itemQuantityRules" />
    <Op class="dtv.pos.inventory.op.InventoryLocationWhileOp">
      <Parameter name="chainKey" value="SHIPPING_ALLOCATE_QUANTITY" />
    </Op>
    <PromptOp class="dtv.pos.inventory.ship.op.PromptShipItemSerialNumberOp" validationsBean="serialNumberInvDocRules" />
    <Op class="dtv.pos.inventory.ship.op.ProcessShippingDocLineOp" />
  </OpChain>
  <OpChain name="SHIPPING_ALLOCATE_QUANTITY">
    <Op class="dtv.pos.inventory.ship.op.DetermineInventoryLocationOp" />
    <PromptOp class="dtv.pos.inventory.ship.op.PromptLocationQuantityOp" validationsBean="itemLocationQuantityRules" />
  </OpChain>
  <OpChain name="SHIPPING_ALLOCATE_QUANTITY_CHANGE">
    <Op class="dtv.pos.inventory.ship.op.DetermineInventoryLocationOp" />
    <PromptOp class="dtv.pos.inventory.ship.op.PromptLocationQuantityChangeOp" validationsBean="itemLocationQuantityRules" />
  </OpChain>
  <OpChain name="SAVE_EXIT_SHIPPING" signal="InventoryOperationsComplete,TransactionComplete">
    <PromptOp class="dtv.pos.inventory.ship.op.PromptForShipNowOp" />
    <PromptOp class="dtv.pos.inventory.ship.op.PromptForCloseShippingDocumentOp" />
    <OpChainRoute chainKey="SHIPPING_PROCESS_SHIPMENT" condition="dtv.pos.inventory.ship.op.HaveItemsShipped" />
    <WorkerOp workersBean="saveShippingWorkers" />
    <OpChainRoute chainKey="PRINT_PACKING_SLIP" condition="dtv.pos.inventory.ship.op.HaveItemsShipped" />
    <OpChainRoute chainKey="SHIPPING" chainType="START" />
  </OpChain>
  <OpChain name="SHIPPING_PROCESS_SHIPMENT">
    <PromptOp class="dtv.pos.framework.op.PromptRunChainOp" key="PRINT_SHIPPING_LABEL">
      <Parameter name="ChainKey" value="SHIPPING_PROCESS_LABEL" />
    </PromptOp>
    <Op class="dtv.pos.inventory.ship.label.PromptTrackingNumberOp" />
  </OpChain>
  <OpChain name="PRINT_PACKING_SLIP">
    <PromptOp class="dtv.pos.framework.op.PromptRunChainOp" key="PRINT_PACKING_SLIP">
      <Parameter name="ChainKey" value="SHIPPING_PRINT_PACKING_SLIP" />
      <Parameter name="PromptKey" value="PRINT_PACKING_SLIP" />
    </PromptOp>
  </OpChain>
  <OpChain name="SHIPPING_PROCESS_LABEL">
    <PromptOp class="dtv.pos.inventory.ship.label.PromptShipperMethodOp" />
    <OpChainRoute chainKey="SHIPPING_PRINT_GENERIC_LABEL" />
  </OpChain>
  <OpChain name="SHIPPING_PRINT_GENERIC_LABEL">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="SHIPPING_LABEL" />
    </Op>
    <Op class="dtv.pos.reporting.label.PromptLabelPositionOp" />
    <Op class="dtv.pos.inventory.ship.op.SetShipmentLabelReportDatasourceOp" />
    <Op class="dtv.pos.reporting.fill.FillReportOp">
      <Parameter name="FormKey" value="LABEL_LAYOUT_CALCULATING" />
    </Op>
    <PromptOp class="dtv.pos.reporting.label.PromptInsertLabelStockOp" />
    <Op class="dtv.pos.reporting.print.PrintReportOp">
      <Parameter name="continueOnError" value="true" />
    </Op>
  </OpChain>
  <OpChain name="MANUAL_SHIPPING_PRINT_LABEL">
    <OpChainRoute chainKey="SHIPPING_PRINT_GENERIC_LABEL" />
  </OpChain>
  <OpChain name="SHIPPING_PRINT_PACKING_SLIP">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="SHIPPING_DOCUMENT_REPORT" />
    </Op>
    <Op class="dtv.pos.inventory.op.SetShipmentReportDatasourceOp" />
    <Op class="dtv.pos.reporting.fill.FillReportOp" />
    <Op class="dtv.pos.reporting.print.PrintReportOp">
      <Parameter name="continueOnError" value="true" />
    </Op>
  </OpChain>
  <OpChain name="SHIPPING_ITEM_CHANGE_QTY">
    <PromptOp class="dtv.pos.inventory.op.GetSelectedInventoryItemOp" validationsBean="changableQtyInventoryItemRules" />
    <PromptOp class="dtv.pos.inventory.ship.op.PromptShippingItemChangeQuantityOp" validationsBean="shippingItemChangeQuantityRules" />
    <Op class="dtv.pos.inventory.ship.op.ShippingLocationChangeWhileOp">
      <Parameter name="ChainKey" value="SHIPPING_ALLOCATE_QUANTITY_CHANGE" />
    </Op>
    <Op class="dtv.pos.inventory.ship.op.UpdateUnitCountOp" />
  </OpChain>
  <OpChain name="SHIPPING_ITEM_VOID">
    <PromptOp class="dtv.pos.inventory.op.GetSelectedInventoryItemOp" validationsBean="selectedInventoryItemRules" />
    <Op class="dtv.pos.inventory.op.PromptForVoidItemOp" />
  </OpChain>

  <OpChain name="SHIPPING_DOCUMENT_VIEW">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="SHIPPING_DOCUMENT_REPORT" />
    </Op>
    <Op class="dtv.pos.inventory.op.SetShipmentReportDatasourceOp" />
    <Op class="dtv.pos.reporting.fill.FillReportOp" />
    <Op class="dtv.pos.reporting.DisplayReportOp" />
  </OpChain>
  <OpChain name="SHIPPING_EDIT_DOCUMENT_CHAIN">
    <ValidationOp validationsBean="changableDocumentRules" />
    <Op class="dtv.pos.inventory.ship.op.PromptEditShippingDocumentOp" />
  </OpChain>
  <OpChain name="SHIPPING_ADD_COMMENT_CHAIN">
    <PromptOp class="dtv.pos.inventory.ship.op.PromptAddDocumentCommentOp" />
  </OpChain>

  <!--end:  menu button op chains - shipping document -->
  <!-- - - - - - - - - - - - - - -->
  <!-- END OF SHIPPING CHAINS -->
  <!-- - - - - - - - - - - - - - -->

  <!-- ********************************************************************* -->
  <!-- ** REPORTING CHAINS ************************************************* -->
  <!-- ********************************************************************* -->
  <OpChain name="REPORT_FILL_AND_DISPLAY">
    <Op class="dtv.pos.reporting.fill.FillReportOp" />
    <Op class="dtv.pos.reporting.DisplayReportOp" breakpoint="true" />
  </OpChain>
  <OpChain name="REPORT_DISPLAY">
    <Op class="dtv.pos.reporting.DisplayReportOp" breakpoint="true" />
  </OpChain>
  <OpChain name="REPORT_SAVE">
    <Op class="dtv.pos.reporting.save.PromptSaveReportOptionsOp" />
    <Op class="dtv.pos.reporting.save.SaveReportOp" />
  </OpChain>
  <OpChain name="REPORT_FILL_AND_PRINT">
    <Op class="dtv.pos.reporting.fill.FillAndPrintReportOp" />
  </OpChain>
  <OpChain name="REPORT_PRINT">
    <PromptOp class="dtv.pos.reporting.fill.PromptReportPageRangeOp" />
    <Op class="dtv.pos.reporting.print.PrintReportOp">
      <Parameter name="continueOnError" value="true" />
    </Op>
  </OpChain>
  <OpChain name="REPORT_VIEW_SAVED">
    <PromptOp class="dtv.pos.reporting.save.PromptSelectSavedReportOp" breakpoint="true" />
  </OpChain>
  <OpChain name="REPORT_RUN_CLOSE_GROUP">
    <Op class="dtv.pos.reporting.run.RunReportGroupOp">
      <Parameter name="groupName" value="CLOSE" />
      <Parameter name="errorMessagePrompt" value="_reportGroupWillNotRunClose" />
    </Op>
  </OpChain>
  <OpChain name="REPORT_RUN_OPEN_GROUP">
    <Op class="dtv.pos.reporting.run.RunReportGroupOp">
      <Parameter name="groupName" value="OPEN" />
      <Parameter name="errorMessagePrompt" value="_reportGroupWillNotRunClose" />
    </Op>
  </OpChain>
  <OpChain name="REPORT_SAVE_QUIET">
    <Op class="dtv.pos.reporting.save.SaveReportQuietOp" />
  </OpChain>
  <OpChain name="REPORT_PRINT_QUIET">
    <Op class="dtv.pos.reporting.print.PrintReportQuietOp" />
  </OpChain>
  <OpChain name="REPORT_EMAIL_QUIET">
    <Op class="dtv.pos.reporting.send.EmailReportQuietOp" />
  </OpChain>
  <OpChain name="REPORT_DELETE">
    <PromptOp class="dtv.pos.reporting.delete.PromptConfirmDeleteReportOp" />
    <ValidationOp validationsBean="deleteReportRules" />
    <Op class="dtv.pos.reporting.delete.DeleteReportOp" />
  </OpChain>
  <!-- ***** specific reports **** -->
  <!-- INVENTORY MOVED REPORT -->
  <OpChain name="INVENTORY_MOVEMENT_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="INVENTORY_MOVEMENT_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- INVENTORY STOCK COST -->
  <OpChain name="INVENTORY_STOCK_COST">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="INVENTORY_STOCK_COST_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- RECEIVING_REPORT -->
  <OpChain name="RECEIVING_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="RECEIVING_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- INVENTORY EXCEPTIONS REPORT -->
  <OpChain name="INVENTORY_SHIPPING_EXCEPTION_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="INVENTORY_SHIPPING_EXCEPTION_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="INVENTORY_RECEIVING_EXCEPTION_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="INVENTORY_RECEIVING_EXCEPTION_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!--  Employee Productivity Report -->
  <OpChain name="EMPLOYEE_PRODUCTIVITY_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="EMPLOYEE_PRODUCTIVITY_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="EMPLOYEE_TASKS_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="EMPLOYEE_TASKS_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- OPEN TIMECARD REPORT -->
  <OpChain name="OPEN_TIMECARD_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="OPEN_TIMECARD_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="MARK_DOWN_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="MARK_DOWN_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Daily Sales Report -->
  <OpChain name="DAILY_SALES_CASH_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="DAILY_SALES_CASH_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>

  <!-- Daily Sales Report -->
  <OpChain name="DAILY_SALES_TOTAL_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="DAILY_SALES_TOTAL_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>

  <!-- Daily Sales Report -->
  <OpChain name="DAILY_SALES_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="DAILY_SALES_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Tax Exemption report -->
  <OpChain name="TAX_EXEMPTION_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="TAX_EXEMPTION_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Gift Certificate Report -->
  <OpChain name="GIFT_CERTIFICATE_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="GIFT_CERTIFICATE_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Restock Report -->
  <OpChain name="RESTOCK_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="RESTOCK_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Scheduling Employee Time off Report -->
  <OpChain name="TIME_OFF_REPORT">
    <OpChainRoute chainKey="REPORT_TIME_OFF" chainType="START" />
  </OpChain>
  <OpChain name="REPORT_TIME_OFF">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="TIME_OFF_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Scheduling Employee Detail Report -->
  <OpChain name="SCHEDULE_DETAIL_REPORT">
    <OpChainRoute chainKey="REPORT_SCHED_DETAIL" chainType="START" />
  </OpChain>
  <OpChain name="REPORT_SCHED_DETAIL">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="SCHEDULE_DETAIL_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Scheduling Employee Detail Report -->
  <OpChain name="REPORT_EMP_PERF">
    <OpChainRoute chainKey="EMPLOYEE_PERFORMANCE_REPORT" chainType="START" />
  </OpChain>
  <OpChain name="EMPLOYEE_PERFORMANCE_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="EMPLOYEE_PERFORMANCE_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Sale By Dept Report -->
  <OpChain name="SALE_BY_MERCHLVL1_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="SALES_BY_MERCHLVL1_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Sale By Hour Analysis Report -->
  <OpChain name="SALE_BY_HOUR_ANALYSIS_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="SALES_BY_HOUR_ANALYSIS_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Return Merchandise Log Report -->
  <OpChain name="RETURN_MERCHANDISE_LOG_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="RETURN_MERCHANDISE_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Paid in Paid out report-->
  <OpChain name="PAIDIN_PAIDOUT_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="PAIDIN_PAIDOUT_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- End paid in paid out report-->
  <!-- Start Nightly control report-->
  <OpChain name="NIGHTLY_CONTROL">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="NIGHTLY_CONTROL_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- End Nightly control report -->
  <!-- - - Start Journal Report - - - - - - - - - - -->
  <OpChain name="JOURNAL_ROLL_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="JOURNAL_ROLL_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- - - End Journal Report - - - - - - - - - - -->
  <!-- Store Locations Report -->
  <OpChain name="STORE_LOCATIONS_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="STORE_LOCATIONS_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Daily sales by hour report-->
  <OpChain name="SALES_BY_HOUR_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="SALES_BY_HOUR_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="ADD_CUSTOMER_COMMENT">
    <PromptOp class="dtv.pos.customer.PromptCustomerCommentOp" validationsBean="commentRules" />
  </OpChain>
  <!-- Customer List report-->
  <OpChain name="CUSTOMER_LIST_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="CUSTOMER_LIST_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- End -Customer List report-->
  <!-- Start - Payroll Report -->
  <OpChain name="PAYROLL_REPORT">
    <Op class="dtv.pos.payroll.op.PromptPayrollNotYetPostMsgOp" />
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="PAYROLL_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- End Payroll Report -->
  <!-- Start - Payroll Detail (Employee) Report -->
  <OpChain name="PAYROLL_REPORT_DRILLDOWN">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="PAYROLL_REPORT_DRILLDOWN" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- End Payroll Detail (Employee) Report -->
  <!-- Start - TimeCard Report -->
  <OpChain name="TIMECARD_REPORT">
    <Op class="dtv.pos.payroll.op.PromptPayrollNotYetPostMsgOp" />
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="TIMECARD_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- End TimeCard Report -->
  <!-- Start - Best Sellers Report -->
  <OpChain name="BEST_SELLERS_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="BEST_SELLERS_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- End Best Sellers Report -->
  <!-- Cash Drawer Reconciliation Report -->
  <OpChain name="CASH_DRAWER_RECONCILIATION">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="CASH_DRAWER_RECONCILIATION_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Associate Reconciliation Report -->
  <OpChain name="ASSOCIATE_RECONCILIATION">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="ASSOCIATE_RECONCILIATION" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Start of Activity #177160  -->
  <OpChain name="CASH_DRAWER_AUDIT_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="CASH_DRAWER_AUDIT_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.SetCurrentLocalCurrencyConfigElementOnReportOp" />
    <Op class="dtv.pos.reporting.fill.FillReportOp" />
    <Op class="dtv.pos.reporting.DisplayReportOp" breakpoint="true" />
  </OpChain>
  <!-- End of Activity #177160  -->

  <!-- Cash Drawer Report -->
  <OpChain name="CASH_DRAWER_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="CASH_DRAWER_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="CUSTOMER_LIST_CLASS_DETAIL">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="CUSTOMER_LIST_CLASS_DETAIL" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="CUSTOMER_LIST_CLASS_TRANS_DETAIL">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="CUSTOMER_LIST_CLASS_TRANS_DETAIL" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="CUSTOMER_LIST_DEPT_DETAIL">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="CUSTOMER_LIST_DEPT_DETAIL" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="CUSTOMER_LIST_ITEM_DETAIL">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="CUSTOMER_LIST_ITEM_DETAIL" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="CUSTOMER_LIST_TRANS_DETAIL">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="CUSTOMER_LIST_TRANS_DETAIL" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="CUSTOMER_LIST_ITEM_TRANS_DETAIL">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="CUSTOMER_LIST_ITEM_TRANS_DETAIL" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="DAILY_SALES_CASH_REPORT_TAX_DETAIL">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="DAILY_SALES_CASH_REPORT_TAX_DETAIL" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Price Change Report -->
  <OpChain name="PRICE_CHANGE_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="PRICE_CHANGE_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- No Sale Report -->
  <OpChain name="NO_SALE_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="NO_SALE_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- start Price override report chain -->
  <OpChain name="PRICE_OVERRIDE_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="PRICE_OVERRIDE_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Credit Card Report -->
  <OpChain name="CREDIT_CARD_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="CREDIT_CARD_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- end Price override report chain -->
  <!-- start Layaway Reports -->
  <OpChain name="LAYAWAY_AGING_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="LAYAWAY_AGING_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="LAYAWAY_ACCOUNT_ACTIVITY_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="LAYAWAY_ACCOUNT_ACTIVITY_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- end Layaway Reports -->
  <!-- CCA Report-->
  <OpChain name="CONFIGURABLE_CUST_ACCT_ACTIVITY_SUMMARY_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="CONFIGURABLE_CUST_ACCT_ACTIVITY_SUMMARY_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- end CCA Report-->
  <!--  Start of code for the ACTIVITY# 165258  -->
  <OpChain name="SPECIAL_ORDERS_REPORTS">
    <OpChainRoute chainKey="SPECIAL_ORDERS_REPORT" chainType="START" />
  </OpChain>
  <OpChain name="SPECIAL_ORDERS_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="SPECIAL_ORDERS_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!--  End of code for the ACTIVITY# 165258  -->
  <!-- Shipping Manifest Report -->
  <OpChain name="SHIPPING_MANIFEST_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="SHIPPING_MANIFEST_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>

  <!-- ********************************************************************* -->
  <!-- ** END REPORTING CHAINS ********************************************* -->
  <!-- ********************************************************************* -->
  <!-- - - - - - - - - - - - - -->
  <!-- START OF LAYAWAY CHAINS -->
  <!-- - - - - - - - - - - - - -->
  <OpChain name="LAYAWAY_MAINTENANCE_CHAIN" contextKey="LAYAWAY" rollbackChainKey="LAYAWAY_FINISH" rollbackLevel="40">
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
    <Op class="dtv.pos.register.layaway.PromptLayawayMaintOptionsOp" />
  </OpChain>
  <OpChain name="ADD_NEW_LAYAWAY_ITEM" signal="TransactionModified" contextKey="LAYAWAY">
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountItemScanOp" validationsBean="maxLayawayItemsRules" />
    <Op class="dtv.pos.register.layaway.item.CheckLayawayItemNotOnFileOp" />
    <ValidationOp validationsBean="sellingIdGroupRules" />
    <OpChainRoute chainKey="LAYAWAY_ITEM_AFTER_LOOKUP" />
  </OpChain>
  <OpChain name="LAYAWAY_ITEM_AFTER_LOOKUP">
    <OpChainRoute chainKey="LAYAWAY_ITEM_ID_VALIDATE" />
    <Op class="dtv.pos.register.layaway.item.RouteLayawayItemOp" />
    <OpChainRoute chainKey="SELECT_WARRANTY_PLANS_SETUP" />
    <Op class="dtv.pos.warranty.common.RunCoveredLineItemChainOp">
      <Parameter name="ChainKey" value="LAYAWAY_WARRANTY_FINISH" />
    </Op>
  </OpChain>
  <OpChain name="LAYAWAY_ITEM_ID_VALIDATE">
    <ValidationOp validationsBean="itemAvailableForLayawayRules" />
    <PromptOp class="dtv.pos.item.restriction.PromptForCashierAgeVerificationOp">
      <Parameter name="SaleItemType" value="LAYAWAY" />
    </PromptOp>
    <ValidationOp validationsBean="maxLayawayItemsRules" />
    <ValidationOp validationsBean="allowLayawayItemRules" />
    <ValidationOp validationsBean="sellingIdGroupRules" />
    <Op class="dtv.pos.register.layaway.item.CreateLayawayLineItemOp" />
    <Op class="dtv.pos.register.MinimumAgeValidationOp" />
    <Op class="dtv.pos.customer.account.op.CheckCustAcctStyleLookupOp" />
    <PromptOp class="dtv.pos.register.sale.PromptForItemWeightOp" validationsBean="itemWeightRules" />
    <PromptOp class="dtv.pos.register.PromptItemDescriptionOp" validationsBean="itemDescriptionRules" />
    <PromptOp class="dtv.pos.register.PromptItemQuantityOp" validationsBean="layawayQuantityRules" />
    <ValidationOp class="dtv.pos.register.ValidateItemQtyWithoutPromptQtyOp" validationsBean="saleItemQtyNoPromptRules" />
    <Op class="dtv.pos.kits.CreateKitOp" />
    <Op class="dtv.pos.inventory.op.InventoryLocationWhileOp">
      <Parameter name="ChainKey" value="LAYAWAY_ALLOCATE_QUANTITY" />
    </Op>
    <Op class="dtv.pos.register.modifyitem.UpdateChangedQuantityOp" />
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountItemSerialNumberOp" validationsBean="serialNumberSaleRules" />
    <PromptOp class="dtv.pos.register.ItemPropertyPromptOp" />
    <ValidationOp validationsBean="itemAvailabilityRules" />
    <PromptOp class="dtv.pos.register.PromptItemPriceOp" />
  </OpChain>
  <OpChain name="LAYAWAY_ALLOCATE_QUANTITY">
    <Op class="dtv.pos.inventory.op.DetermineInventoryLocationOp" />
    <PromptOp class="dtv.pos.register.PromptLocationQuantityChangeOp" validationsBean="itemLocationQuantityRules">
      <Parameter name="destinationBucketId" value="LAYAWAY" />
    </PromptOp>
  </OpChain>
  <OpChain name="LAYAWAY_FINISH" signal="TransactionModified">
    <ValidationOp validationsBean="minLayawayTotalItemPriceRules" />
    <Op class="dtv.pos.customer.account.op.ValidateNewCustAcctOp" />
    <Op class="dtv.pos.register.layaway.payment.AddLayawaySetupFeeOp" />
    <OpChainRoute chainKey="LAYAWAY_DEPOSIT_FINISH" />
    <OpChainRoute chainKey="BACKTO_SALE_ITEM" chainType="START" />
  </OpChain>
  <OpChain name="CANCEL_LAYAWAY" signal="TransactionModified">
    <!-- Prompt if customer is present.  Use Backoffice cancel for escrow transfers -->
    <PromptOp class="dtv.pos.customer.account.op.PromptCustomerPresentForCancelOp">
      <Parameter name="location" value="register" />
    </PromptOp>
    <PromptOp class="dtv.pos.register.layaway.account.PromptCancelLayawayAcctConfirmationOp" />
    <Op class="dtv.pos.register.layaway.payment.AddLayawayRestockingFeeOp" />
    <Op class="dtv.pos.register.layaway.account.HandleLayawaySetupFeeUponCancelOp" />
    <Op class="dtv.pos.register.layaway.account.CancelLayawayAccountOp" />
    <OpChainRoute chainKey="ISSUE_LAYAWAY_REFUND" />
    <Op class="dtv.pos.register.layaway.account.HandleLayawaySetupFeeUponCancelOp" />
    <Op class="dtv.pos.customer.account.op.AddCancelledAccountToPersistablesBagOp" />
    <Op class="dtv.pos.register.UpdateCurrentTransListOp" />
    <OpChainRoute chainKey="SALE_ITEM_START" chainType="START" />
  </OpChain>
  <OpChain name="CANCEL_LAYAWAY_ITEM" signal="TransactionModified">
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.customer.account.op.UpdateVoidCustAcctItemOp">
      <Parameter name="detailStateCode" value="CANCEL" />
    </Op>
  </OpChain>
  <OpChain name="ADD_LAYAWAY_ITEM_FINISH" signal="TransactionModified">
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>
  <OpChain name="ADD_LAYAWAY_FEE" signal="TransactionModified">
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <Op class="dtv.pos.customer.account.op.AddCustomerAccountModifierOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <OpChainRoute chainKey="SALE_TAXING" />
  </OpChain>
  <OpChain name="ISSUE_LAYAWAY_REFUND" signal="TransactionModified">
    <Op class="dtv.pos.register.layaway.item.CreateLayawayRefundItemOp" />
  </OpChain>
  <OpChain name="ADD_LAYAWAY_ITEM" signal="TransactionModified">
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <Op class="dtv.pos.customer.account.op.AddCustomerAccountModifierOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <WorkerOp workersBean="addTransDiscountsToNewItemWorkers" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.register.layaway.item.CreateLayawayItemOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctActivityOp" />
    <Op class="dtv.pos.register.layaway.payment.schedule.RebuildLayawayPaymentScheduleOp" />
    <OpChainRoute chainKey="ADD_LAYAWAY_ATTACHED_ITEMS" />
    <OpChainRoute chainKey="NOTIFY_ATTACHED_ITEMS" />
  </OpChain>
  <OpChain name="ADD_LAYAWAY_ATTACHED_ITEMS">
    <PromptOp class="dtv.pos.register.attacheditems.PromptAttachedItemsOp" />
    <Op class="dtv.pos.register.attacheditems.AttachedItemsIteratingOp">
      <Parameter name="chainKey" value="LAYAWAY_ITEM_ID_VALIDATE" />
    </Op>
  </OpChain>
  <OpChain name="LAYAWAY_PRE_TENDERING" signal="TransactionModified">
    <Op class="dtv.pos.register.layaway.LayawaySetPretenderingStateOp" />
    <ValidationOp validationsBean="minLayawayTotalItemPriceRules" />
    <Op class="dtv.pos.customer.account.op.ValidateNewCustAcctPreTenderOp" />
    <Op class="dtv.pos.register.layaway.payment.AddLayawaySetupFeeOp" />
    <OpChainRoute chainKey="LAYAWAY_DEPOSIT_FINISH" />
    <OpChainRoute chainKey="PRE_TENDERING" chainType="START" />
  </OpChain>
  <OpChain name="LAYAWAY_DEPOSIT_FINISH" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.layaway.payment.PromptLayawayDepositOp" validationsBean="depositAmountRules" />
    <ValidationOp class="dtv.pos.register.layaway.payment.ValidateLayawayDepositAmountOp" validationsBean="maxDepositAmountRules" />
    <Op class="dtv.pos.register.layaway.payment.VoidZeroDepositOp" />
    <Op class="dtv.pos.register.layaway.item.CreateLayawayRefundItemOp" />
    <Op class="dtv.pos.customer.account.op.CompleteCustomerAccountOp" />
    <OpChainRoute chainKey="BUILD_PAYMENT_SCHED" condition="dtv.pos.register.layaway.payment.schedule.RunPaymentScheduleCondition" />
    <Op class="dtv.pos.register.UpdateCurrentTransListOp" />
  </OpChain>
  <OpChain name="BUILD_PAYMENT_SCHED">
    <PromptOp class="dtv.pos.register.layaway.payment.schedule.PromptLayawayPaymentPeriodLengthOp"
      validationsBean="paymentIntervalRules" />
    <PromptOp class="dtv.pos.register.layaway.payment.schedule.PromptLayawayPaymentPeriodCountOp"
      validationsBean="paymentPeriodCountRules" />
    <Op class="dtv.pos.register.layaway.payment.schedule.CompleteLayawayPaymentScheduleOp" />
    <PromptOp class="dtv.pos.register.layaway.payment.schedule.PromptLayawayPaymentScheduleStartOp" />
    <Op class="dtv.pos.register.layaway.payment.schedule.RebuildLayawayPaymentScheduleOp" />
  </OpChain>
  <OpChain name="LAYAWAY_MAINTENANCE_ADD_COMMENT">
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountCommentOp" validationsBean="commentRules" />
    <Op class="dtv.pos.customer.account.op.RefreshCustAccountCommentOp" />
    <Op class="dtv.pos.common.LogPersistablesOp" longRunning="true" />
    <Op class="dtv.pos.common.PersistObjectsOp" />
  </OpChain>
  <OpChain name="LAYAWAY_COMMENT">
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountCommentOp" validationsBean="commentRules" />
  </OpChain>
  <!-- Change quantity chains -->
  <OpChain name="CHANGE_LAYAWAY_ITEM_QUANTITY_TOUCH">
    <ValidationOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemFromTouchOp" validationsBean="custAccountChangeQuantityRules" />
    <OpChainRoute chainKey="CHANGE_LAYAWAY_ITEM_QUANTITY_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_LAYAWAY_ITEM_QUANTITY">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" validationsBean="custAccountChangeQuantityRules" />
    <OpChainRoute chainKey="CHANGE_LAYAWAY_ITEM_QUANTITY_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_LAYAWAY_ITEM_QUANTITY_IMPL">
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_QUANTITY" />
    </Op>
    <PromptOp class="dtv.pos.register.modifyitem.PromptItemQuantityChangeOp" validationsBean="layawayQuantityRules" />
    <Op class="dtv.pos.kits.UpdateKitComponentModifiersQtyOp" />
    <Op class="dtv.pos.inventory.op.InventoryLocationChangeWhileOp">
      <Parameter name="ChainKey" value="LAYAWAY_ALLOCATE_QUANTITY" />
    </Op>
    <OpChainRoute chainKey="CHANGE_LAYAWAY_ITEM_QUANTITY_FINISH" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
    <OpChainRoute chainKey="POST_CHANGE_LAYAWAY_ITEM_QUANTITY" chainType="START" />
  </OpChain>
  <OpChain name="CHANGE_LAYAWAY_ITEM_QUANTITY_FINISH" signal="TransactionModified">
    <Op class="dtv.pos.register.modifyitem.UpdateChangedQuantityOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.register.layaway.payment.schedule.RebuildLayawayPaymentScheduleOp" />
  </OpChain>
  <OpChain name="POST_CHANGE_LAYAWAY_ITEM_QUANTITY" signal="TransactionModified">
    <OpChainRoute chainKey="UPDATE_WARRANTY_LAYAWAY_QUANTITY" />
  </OpChain>
  <!-- Change price chains -->
  <OpChain name="CHANGE_LAYAWAY_ITEM_PRICE_TOUCH">
    <ValidationOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemFromTouchOp" validationsBean="custAccountChangePriceRules" />
    <OpChainRoute chainKey="CHANGE_LAYAWAY_ITEM_PRICE_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_LAYAWAY_ITEM_PRICE">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" validationsBean="custAccountChangePriceRules" />
    <OpChainRoute chainKey="CHANGE_LAYAWAY_ITEM_PRICE_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_LAYAWAY_ITEM_PRICE_IMPL">
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_PRICE" />
    </Op>
    <PromptOp class="dtv.pos.register.modifyitem.PromptItemPriceChangeOp" />
    <PromptOp class="dtv.pos.register.modifyitem.PromptPriceChangeReasonCodeOp" />
    <Op class="dtv.pos.register.VoidAllDiscountsOp" />
    <OpChainRoute chainKey="CHANGE_LAYAWAY_ITEM_PRICE_FINISH" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
    <OpChainRoute chainKey="POST_CHANGE_LAYAWAY_ITEM_PRICE" chainType="START" />
  </OpChain>
  <OpChain name="CHANGE_LAYAWAY_ITEM_PRICE_FINISH" signal="TransactionModified">
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.register.layaway.payment.schedule.RebuildLayawayPaymentScheduleOp" />
  </OpChain>
  <OpChain name="POST_CHANGE_LAYAWAY_ITEM_PRICE" signal="TransactionModified">
    <OpChainRoute chainKey="UPDATE_WARRANTY_LAYAWAY_PRICE" />
  </OpChain>
  <!-- Void item chains -->
  <OpChain name="VOID_LAYAWAY_ITEM_TOUCH">
    <ValidationOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemFromTouchOp" validationsBean="custAccountItemVoidRules" />
    <OpChainRoute chainKey="VOID_LAYAWAY_ITEM_IMPL" />
  </OpChain>
  <OpChain name="VOID_LAYAWAY_ITEM">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemVoidOp" validationsBean="custAccountItemVoidRules">
      <Parameter name="VoidDiscountChainKey" value="VOID_LAYAWAY_DISCOUNT" />
    </PromptOp>
    <OpChainRoute chainKey="VOID_LAYAWAY_ITEM_IMPL" />
  </OpChain>
  <OpChain name="VOID_LAYAWAY_ITEM_IMPL" signal="TransactionModified">
    <Op class="dtv.pos.pricing.discount.ConfirmGroupDiscountItemVoidOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="CANCEL" />
    </Op>
    <PromptOp class="dtv.pos.register.PromptVoidLineItemReasonCodeOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="CANCEL" />
    </Op>
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.customer.account.op.UpdateVoidCustAcctItemOp" />
    <Op class="dtv.pos.pricing.discount.VoidGroupDiscountOp">
      <Parameter name="ChainKey" value="VOID_CUSTOMER_ACCOUNT_DISCOUNT_MAIN" />
    </Op>
    <Op class="dtv.pos.register.layaway.payment.VoidZeroDepositOp" />
    <Op class="dtv.pos.register.layaway.payment.schedule.RebuildLayawayPaymentScheduleOp" />
    <Op class="dtv.pos.register.UpdateCurrentTransListOp" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
    <OpChainRoute chainKey="LAYAWAY_MAINTENANCE_CHAIN" chainType="START" />
  </OpChain>
  <OpChain name="CHANGE_LAYAWAY_DISCOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.GetCurrentCustAcctDiscountOp" validationsBean="changeDiscountRules" />
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountDiscountOp">
      <Parameter name="ApplicationMethodCode" value="LINE_ITEM" />
    </PromptOp>
    <PromptOp class="dtv.pos.pricing.discount.PromptForGroupDiscountItemsOp" validationsBean="groupItemSelectionDiscountRules" />
    <OpChainRoute chainKey="VOID_CUSTOMER_ACCOUNT_DISCOUNT_MAIN" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="REMOVE_DISCOUNT" />
    </Op>
    <Op class="dtv.pos.register.cca.op.discount.RouteCustomerAccountDiscountOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemsForGroupDiscountModificationOp">
      <Parameter name="CreateActivity" value="false" />
    </Op>
    <Op class="dtv.pos.register.layaway.payment.schedule.RebuildLayawayPaymentScheduleOp" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
  </OpChain>
  <OpChain name="VOID_LAYAWAY_DISCOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.GetCurrentCustAcctDiscountOp" validationsBean="changeDiscountRules" />
    <OpChainRoute chainKey="VOID_CUSTOMER_ACCOUNT_DISCOUNT_MAIN" />
    <Op class="dtv.pos.register.layaway.payment.schedule.RebuildLayawayPaymentScheduleOp" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
  </OpChain>
  <OpChain name="CHANGE_LAYAWAY_COMMISSIONED_ASSOCIATES">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" validationsBean="changeItemCommissionRules" />
    <OpChainRoute chainKey="CHANGE_LAYAWAY_COMMISSIONED_ASSOCIATES_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_LAYAWAY_COMMISSIONED_ASSOCIATES_TOUCH">
    <Op class="dtv.pos.customer.account.op.GetSelectedCustAcctItemFromTouchOp" />
    <OpChainRoute chainKey="CHANGE_LAYAWAY_COMMISSIONED_ASSOCIATES_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_LAYAWAY_COMMISSIONED_ASSOCIATES_IMPL" signal="TransactionModified">
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_COMMISSION_ASSOCIATES" />
    </Op>
    <Op class="dtv.pos.commission.RouteChangeCommAssocOp" />
    <Op class="dtv.pos.commission.UpdateCommModifierOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
  </OpChain>
  <OpChain name="TAX_LAYAWAY_ITEM_CHANGE_LOCATION" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_TAX" />
    </Op>
    <PromptOp class="dtv.pos.register.tax.PromptPostalCodeOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxLocationOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxChangeReasonOp" />
    <Op class="dtv.pos.register.tax.ChangeTaxGroupRuleOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.register.layaway.payment.schedule.RebuildLayawayPaymentScheduleOp" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
  </OpChain>
  <OpChain name="TAX_LAYAWAY_ITEM_EXEMPT" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_TAX" />
    </Op>
    <Op class="dtv.pos.register.tax.PromptSelectItemTaxOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxExemptionOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxExemptReasonOp" breakpoint="true" />
    <Op class="dtv.pos.register.tax.SaveTaxExemptOp" />
    <Op class="dtv.pos.register.tax.ChangeTaxToExemptOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.register.layaway.payment.schedule.RebuildLayawayPaymentScheduleOp" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
  </OpChain>
  <OpChain name="TAX_LAYAWAY_ITEM_CHANGE_AMOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_TAX" />
    </Op>
    <Op class="dtv.pos.register.tax.PromptSelectItemTaxOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxAmountOp" validationsBean="taxAmountRules" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxChangeReasonOp" />
    <Op class="dtv.pos.register.tax.ChangeTaxAmountOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.register.layaway.payment.schedule.RebuildLayawayPaymentScheduleOp" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
  </OpChain>
  <OpChain name="TAX_LAYAWAY_ITEM_CHANGE_PERCENT" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_TAX" />
    </Op>
    <Op class="dtv.pos.register.tax.PromptSelectItemTaxOp" />
    <OpChainRoute chainKey="TAX_CHANGE_PERCENT" />
    <Op class="dtv.pos.register.tax.ChangeTaxPercentOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.register.layaway.payment.schedule.RebuildLayawayPaymentScheduleOp" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
  </OpChain>
  <OpChain name="LAYAWAY_NON_PHYSICAL_START">
    <PromptOp class="dtv.pos.register.layaway.nonphysical.PromptLayawayNonPhysicalItemOp">
      <Parameter name="EXCLUDE_NPI_TYPE" value="VOUCHER" />
    </PromptOp>
    <ValidationOp validationsBean="sellingIdGroupRules" />
    <Op class="dtv.pos.register.layaway.item.RouteLayawayItemOp" />
  </OpChain>
  <OpChain name="LAYAWAY_NON_PHYSICAL_FINISH" signal="TransactionModified">
    <OpChainRoute chainKey="LAYAWAY_NON_PHYSICAL_VALIDATE" />
    <OpChainRoute chainKey="LAYAWAY_NON_PHYSICAL_AUTHORIZE" />
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <Op class="dtv.pos.customer.account.op.AddCustomerAccountModifierOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.register.layaway.item.CreateLayawayItemOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctActivityOp" />
    <Op class="dtv.pos.register.layaway.payment.schedule.RebuildLayawayPaymentScheduleOp" />
  </OpChain>
  <OpChain name="LAYAWAY_NON_PHYSICAL_VALIDATE">
    <PromptOp class="dtv.pos.register.PromptItemDescriptionOp" validationsBean="itemDescriptionRules" />
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountItemSerialNumberOp" validationsBean="serialNumberSaleExcludingInventoryRules" />
    <PromptOp class="dtv.pos.register.PromptItemQuantityOp" />
    <PromptOp class="dtv.pos.register.PromptItemPriceOp" />
  </OpChain>
  <OpChain name="LAYAWAY_NON_PHYSICAL_AUTHORIZE" />
  <OpChain name="ADD_LAYAWAY_DISCOUNT" signal="TransactionModified">
    <OpChainRoute chainKey="ADD_CUSTOMER_ACCOUNT_DISCOUNT" />
    <Op class="dtv.pos.register.layaway.payment.schedule.RebuildLayawayPaymentScheduleOp" />
  </OpChain>
  <OpChain name="ADD_LAYAWAY_GROUP_DISCOUNT" signal="TransactionModified">
    <OpChainRoute chainKey="ADD_CUSTOMER_ACCOUNT_GROUP_DISCOUNT" />
    <Op class="dtv.pos.register.layaway.payment.schedule.RebuildLayawayPaymentScheduleOp" />
  </OpChain>
  <!-- - - - - - - - - - - - -->
  <!-- END OF LAYAWAY CHAINS -->
  <!-- - - - - - - - - - - - -->
  <!-- - - - - - - - SECURITY CHAINS - - - - - - - - -->
  <OpChain name="SECURITY">
    <Op class="dtv.pos.security.op.RouteSecurityOp" />
  </OpChain>
  <OpChain name="SECURITY_COMPLETE">
    <Op class="dtv.pos.security.op.GenerateSecurityResponseOp" />
  </OpChain>
  <OpChain name="SECURITY_LOGOUT">
    <WorkerOp workersBean="unregisterWorkstationActiveWorkers" />
    <Op class="dtv.pos.security.op.LogoutOp" />
  </OpChain>
  <OpChain name="SECURITY_AUTHENTICATE">
    <Op class="dtv.pos.hardware.biometric.fingerprint.op.EnableFingerprintReaderIdentityOp" />
    <OpChainRoute>
      <Choice chainKey="SECURITY_AUTHENTICATE_BY_PROMPT" condition="dtv.pos.security.ShowUserIdAndPasswordAsPromptsCondition" />
      <Choice chainKey="SECURITY_AUTHENTICATE_BY_FORM" />
    </OpChainRoute>
    <Op class="dtv.pos.security.op.AuthenticateUserOp" />
    <PromptOp class="dtv.pos.security.op.ForcePasswordChangeOp" />
    <PromptOp class="dtv.pos.security.op.NotifyBadAuthenticationOp" />
  </OpChain>
  <OpChain name="SECURITY_AUTHENTICATE_BY_PROMPT">
    <PromptOp class="dtv.pos.security.op.PromptUserIdOp" />
    <PromptOp class="dtv.pos.security.op.PromptPasswordOp" />
  </OpChain>
  <OpChain name="SECURITY_AUTHENTICATE_BY_FORM">
    <Op class="dtv.pos.security.op.PromptIdPasswordFormOp" />
  </OpChain>
  <OpChain name="SECURITY_AUTHORIZE">
    <Op class="dtv.pos.security.op.AuthorizeUserOp" />
  </OpChain>
  <OpChain name="SECURITY_LOGIN">
    <Op class="dtv.pos.security.op.LoginOp" />
  </OpChain>
  <OpChain name="RESET_AFTER_NO_TRANS" signal="TransactionCancelled">
    <Op class="dtv.pos.hardware.op.IdleCustomerDisplayOp" required="false" />
    <Op class="dtv.pos.security.op.LogoutOp" />
    <OpChainRoute chainKey="REGISTER_LOGIN" chainType="START" />
  </OpChain>

  <OpChain name="VALIDATE_BACKOFFICE_STARTUP">
    <Op class="dtv.pos.assistance.access.ValidateEmployeeRestrictedAccessOp" />
    <Op class="dtv.pos.systemcycle.access.SynchStateJournalOp" />
  </OpChain>
  <OpChain name="VALIDATE_REGISTER_STARTUP">
    <OpChainRoute chainKey="VALIDATE_REGISTER_STARTUP_START.local" />
    <Op class="dtv.pos.assistance.access.ValidateEmployeeRestrictedAccessOp" />
    <Op class="dtv.pos.systemcycle.access.SynchStateJournalOp" />
    <Op class="dtv.pos.systemcycle.access.RetailLocationOpenAccessCheckOp" />
    <Op class="dtv.pos.systemcycle.access.WorkstationOpenAccessCheckOp" />
    <Op class="dtv.pos.timeclock.ValidateNeedToClockInOp" />
    <WorkerOp workersBean="saveSystemTimeWorkers" />
    <PromptOp class="dtv.pos.register.StoreCloseWarningOp" key="WORKSTATION_WARNING" />
    <PromptOp class="dtv.pos.register.StoreCloseGraceOp" key="WORKSTATION_GRACE" />
    <PromptOp class="dtv.pos.register.StoreCloseGraceExpiredOp" key="WORKSTATION_GRACE_EXPIRED" />
    <Op class="dtv.pos.systemcycle.access.EndOfDayTimeCheckOp" />
    <OpChainRoute chainKey="VALIDATE_REGISTER_STARTUP_FINISH.local" />
  </OpChain>
  <OpChain name="VALIDATE_REGISTER_STARTUP_START.local">
    <OpChainRoute chainKey="VALIDATE_REGISTER_STARTUP_START.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="VALIDATE_REGISTER_STARTUP_START.post" />
  </OpChain>
  <OpChain name="VALIDATE_REGISTER_STARTUP_START.pre" />
  <OpChain name="VALIDATE_REGISTER_STARTUP_START.post" />
  <OpChain name="VALIDATE_REGISTER_STARTUP_FINISH.local">
    <OpChainRoute chainKey="VALIDATE_REGISTER_STARTUP_FINISH.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="VALIDATE_REGISTER_STARTUP_FINISH.post" />
  </OpChain>
  <OpChain name="VALIDATE_REGISTER_STARTUP_FINISH.pre" />
  <OpChain name="VALIDATE_REGISTER_STARTUP_FINISH.post" />
  <OpChain name="VALIDATE_REGISTER_STARTUP_REGISTER_OPTION">
    <Op class="dtv.pos.assistance.access.ValidateEmployeeRestrictedAccessOp" />
    <Op class="dtv.pos.systemcycle.access.SynchStateJournalOp" />
    <Op class="dtv.pos.timeclock.ValidateNeedToClockInOp" />
  </OpChain>
  <OpChain name="REGISTER_OPTIONS_LOGIN" contextKey="REGISTER_OPTIONS_LOGIN">
    <Op class="dtv.pos.common.op.PromptLoginIfNeededOp">
      <Parameter name="FailedPromptKey" value="TILL_MANAGEMENT_LOGIN_FAILED" />
      <Parameter name="UserIdPromptKey" value="LOGIN_USER_ID_ESC" />
      <Parameter name="PrivilegeType" value="TILL_MANAGEMENT" />
    </Op>
    <OpChainRoute chainKey="VALIDATE_REGISTER_STARTUP_REGISTER_OPTION" />
    <PromptOp class="dtv.pos.payroll.op.PromptPayrollNotYetPostMsgOp" />
    <OpChainRoute chainKey="REGISTER_OPTIONS_MAIN_MENU" chainType="START" />
  </OpChain>
  <OpChain name="REGISTER_OPTIONS_MAIN_MENU" contextKey="REGISTER_OPTIONS_MAIN_MENU" rollbackLevel="10">
    <Op class="dtv.pos.security.op.StartAutoLogoutTimerOp" />
    <Op class="dtv.pos.framework.op.ForceMenuSelectionOp" contextKey="REGISTER_OPTIONS_MAIN_MENU" />
  </OpChain>
  <OpChain name="PRE_CHANGE_APPLICATION">
    <Op class="dtv.pos.appmanagement.op.SetupChangeAppOp" />
    <OpChainRoute chainKey="CHANGE_APPLICATION" />
  </OpChain>
  <OpChain name="REGISTER_LOGIN" contextKey="REGISTER_LOGIN" rollbackLevel="0">
    <!-- Handles the post processing of the orphaned transactions. -->
    <Op class="dtv.pos.startup.orphanedtrans.PostProcessOrphanedTransactionsOp">
      <!-- This additional hook can be helpful in adding additional handling for orphaned transactions -->
      <Parameter name="chainKey" value="POST_PROCESS_ORPHANED_TRANSACTIONS" />
    </Op>
    <!--The user is logging in to the register from within the register app. -->
    <Op class="dtv.pos.security.op.StopAutoLogoutTimerOp" />
    <Op class="dtv.pos.register.itemmessages.DefaultIdleMsgOp" />
    <Op class="dtv.pos.security.op.PosLoginOp" />
    <OpChainRoute chainKey="VALIDATE_REGISTER_STARTUP" />
    <PromptOp class="dtv.pos.payroll.op.PromptPayrollNotYetPostMsgOp" />
    <OpChainRoute chainKey="PRE_SALE_TRANSACTION" chainType="START" />
<!--     <Op class="dtv.pos.common.StartPreSaleOp" /> -->
  </OpChain>
  <OpChain name="POST_PROCESS_ORPHANED_TRANSACTIONS" />
  <OpChain name="TO_REGISTER_LOGIN">
    <!--The user is logging in to the register from another app. -->
    <Op class="dtv.pos.appmanagement.op.LoginToNewAppOp" contextKey="TO_REGISTER_LOGIN" />
    <OpChainRoute chainKey="VALIDATE_REGISTER_STARTUP" />
    <PromptOp class="dtv.pos.payroll.op.PromptPayrollNotYetPostMsgOp" />
  </OpChain>
  <OpChain name="TO_BACK_OFFICE_LOGIN">
    <!--The user is logging in to the back office from another app. -->
    <Op class="dtv.pos.appmanagement.op.LoginToNewAppOp" contextKey="TO_BACK_OFFICE_LOGIN">
      <Parameter name="IdPrompt" value="BACK_OFFICE_LOGIN_USER_ID" />
      <Parameter name="PasswordPrompt" value="BACK_OFFICE_LOGIN_USER_PWD" />
    </Op>
    <PromptOp class="dtv.pos.security.op.PromptPasswordChallengeQuestionsOp" />
    <OpChainRoute chainKey="VALIDATE_BACKOFFICE_STARTUP" />
    <Op class="dtv.pos.security.op.StopAutoLogoutTimerOp" />
    <PromptOp class="dtv.pos.payroll.op.PromptPayrollNotYetPostMsgOp" />
  </OpChain>
  <OpChain name="CHANGE_APPLICATION">
    <Op class="dtv.pos.appmanagement.op.ChangeAppOp" />
    <Op class="dtv.pos.i18n.AssertLocaleOp" />
    <Op class="dtv.pos.appmanagement.op.StartNewAppOp" />
  </OpChain>
  <OpChain name="POST_CHANGE_APPLICATION">
    <Op class="dtv.pos.appmanagement.op.StartNewUserOpChainOp" />
  </OpChain>
  <!--END: LOGIN AND NAVIGATION CHAINS-->
  <OpChain name="RESUME_TRANSACTION">
    <PromptOp class="dtv.pos.register.suspendresume.PromptSuspendedTransOp" />
    <ValidationOp validationsBean="resumeTransactionRules" />
    <OpChainRoute chainKey="RESUME_TRANSACTION_IMPL" />
    <OpChainRoute chainKey="BACKTO_SALE_ITEM" chainType="START" />
  </OpChain>
  <OpChain name="RESUME_TRANSACTION_IMPL" signal="TransactionModified">
    <Op class="dtv.pos.register.suspendresume.CreateResumeTransOp" />
    <WorkerOp workersBean="entireChainResumeTransWorkers" />
    <Op class="dtv.pos.warranty.common.WarrantyTransIteratingOp">
      <Parameter name="ChainKey" value="RESUME_WARRANTIES" />
    </Op>
    <Op class="dtv.tenderauth.impl.ajb.ResumePendingAuthOp">
      <Parameter name="applicationResumeChain" value="RESUME_CREDIT_APP_AUTHORIZATION" />
      <Parameter name="tenderResumeChain" value="RESUME_TENDER_AUTHORIZATION" />
    </Op>
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>
  <OpChain name="RESUME_TENDER_AUTHORIZATION">
    <Op class="dtv.tenderauth.impl.op.AuthorizeTenderOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
    <OpChainRoute chainKey="CAPTURE_SALE_TENDER_SIGNATURE" />
    <Op class="dtv.pos.assistance.NotifyTrainingTenderAuthOp" />
    <OpChainRoute chainKey="CHECK_SALE_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="RESUME_CREDIT_APP_AUTHORIZATION">
    <Op class="dtv.tenderauth.impl.ajb.SendCreditAppOp">
      <Parameter name="suspendChain" value="SUSPEND_TRANSACTION_BACKOFFICE" />
    </Op>
    <Op class="dtv.pos.customer.credit.op.VoidLineItemOp" />
  </OpChain>
  <OpChain name="ADD_EJOURNAL_COMMENT">
    <PromptOp class="dtv.pos.ejournal.AddTransactionCommentOp" validationsBean="commentRules" />
  </OpChain>

  <OpChain name="FLASH_SALES_REPORT_VER2">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="FLASH_SALES_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="PRE_VIEW_TIMECARD">
    <Op class="dtv.pos.timeclock.timecard.op.PromptLogInToViewTimeCardOp" contextKey="VIEW_TIMECARD_LOGIN" />
    <Op class="dtv.pos.timeclock.timecard.op.SetCurrentUserOp" />
    <Op class="dtv.pos.timeclock.timecard.op.GetCurrentPayrollWeekOp" />
    <OpChainRoute chainKey="VIEW_TIMECARD" chainType="START" />
  </OpChain>
  <OpChain name="VIEW_TIMECARD" rollbackLevel="40">
    <Op class="dtv.pos.timeclock.timecard.op.ViewTimecardSummaryOp" />
  </OpChain>
  <OpChain name="DONE_VIEW_TIMECARD">
    <Op class="dtv.pos.timeclock.timecard.op.ResetLocalePostViewTimecaredOp" />
  </OpChain>
  <OpChain name="ADD_VIEW_TIMECARD_COMMENT">
    <Op class="dtv.pos.timeclock.timecard.op.AddViewTimecardCommentOp" />
    <Op class="dtv.pos.common.LogPersistablesOp" longRunning="true" />
    <Op class="dtv.pos.common.PersistObjectsOp" />
  </OpChain>
  <OpChain name="ACTIVE_TIMECARD_EMPLOYEE">
    <PromptOp class="dtv.pos.timeclock.timecard.op.PromptTimecardActiveEmployeeOp" />
  </OpChain>
  <OpChain name="ACTIVE_PAYROLL_EMPLOYEE">
    <PromptOp class="dtv.pos.timeclock.timecard.op.PromptTimecardActiveEmployeeOp" />
  </OpChain>
  <OpChain name="EXCEPTION_TIMECARD_LIST">
    <PromptOp class="dtv.pos.timeclock.timecard.op.PromptTimecardExceptionsOp" />
  </OpChain>
  <OpChain name="NEW_TIMECARD_PAYROLL_DATE">
    <PromptOp class="dtv.pos.timeclock.timecard.op.ChangePayrollWeeksOp" />
  </OpChain>
  <OpChain name="ADD_TIMECARD_RECORD_COMMENT">
    <PromptOp class="dtv.pos.timeclock.timecard.op.PromptTimecardRecordCommentOp" validationsBean="commentRules" />
    <Op class="dtv.pos.common.LogPersistablesOp" longRunning="true" />
    <Op class="dtv.pos.common.PersistObjectsOp" />
  </OpChain>
  <OpChain name="CHANGE_TIMECARD_RECORD" signal="TransactionComplete">
    <ValidationOp class="dtv.pos.payroll.op.PayrollValidationWithoutPromptOp" validationsBean="timecardModificationRules" />
    <PromptOp class="dtv.pos.payroll.op.CheckUserPrivilageToModifyPayrollOp" />
    <Op class="dtv.pos.timeclock.timecard.op.PromptChangeTimecardRecordOp" breakpoint="true" />
    <PromptOp class="dtv.pos.timeclock.timecard.op.PromptTransTimecardCommentOp" validationsBean="commentRules" />
    <Op class="dtv.pos.timeclock.timecard.op.PersistTimecardRecordOp" />
    <Op class="dtv.pos.timeclock.timecard.op.PersistTimecardLogOp" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" condition="dtv.pos.timeclock.timecard.conditions.ShouldPrintTimeCardAcceptence" />
  </OpChain>
  <OpChain name="ADD_TIMECARD_RECORD" signal="TransactionComplete">
    <ValidationOp class="dtv.pos.payroll.op.PayrollValidationWithoutPromptOp" validationsBean="addNewTimecardRules" />
    <PromptOp class="dtv.pos.payroll.op.CheckUserPrivilageToModifyPayrollOp" />
    <Op class="dtv.pos.timeclock.timecard.op.PromptAddTimecardRecordOp" breakpoint="true" />
    <PromptOp class="dtv.pos.timeclock.timecard.op.PromptTransTimecardCommentOp" validationsBean="commentRules" />
    <Op class="dtv.pos.timeclock.timecard.op.PersistTimecardRecordOp" />
    <Op class="dtv.pos.timeclock.timecard.op.PersistTimecardLogOp" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" condition="dtv.pos.timeclock.timecard.conditions.ShouldPrintTimeCardAcceptence" />
  </OpChain>
  <OpChain name="DELETE_TIMECARD_ENTRY" signal="TransactionComplete">
    <ValidationOp class="dtv.pos.payroll.op.PayrollValidationWithoutPromptOp" validationsBean="timecardModificationRules" />
    <PromptOp class="dtv.pos.payroll.op.CheckUserPrivilageToModifyPayrollOp" />
    <PromptOp class="dtv.pos.timeclock.timecard.op.PromptDeleteTimecardConfirmationOp" />
    <PromptOp class="dtv.pos.timeclock.timecard.op.PromptTransTimecardCommentOp" validationsBean="commentRules" />
    <Op class="dtv.pos.common.PersistObjectsOp" longRunning="true" />
    <Op class="dtv.pos.timeclock.timecard.op.PersistTimecardLogOp" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" condition="dtv.pos.timeclock.timecard.conditions.ShouldPrintTimeCardAcceptence" />
  </OpChain>
  <OpChain name="VIEW_TIMECARD_RECORD_HISTORY">
    <ValidationOp class="dtv.pos.payroll.op.PayrollValidationWithoutPromptOp" validationsBean="validateTimecardSelectionRules" />
    <PromptOp class="dtv.pos.timeclock.timecard.op.PromptTimecardHistoryOp" />
  </OpChain>
  <OpChain name="DISPLAY_TIMECARD_RECORD_COMMENT">
    <Op class="dtv.pos.timeclock.timecard.op.DisplayTimecardCommentsOp" />
  </OpChain>
  <!-- START: BROWSER CHAINS -->
  <OpChain name="BROWSER_START">
    <Op class="dtv.pos.browser.BrowserOp" /><!-- longRunning="true" -->
  </OpChain>
  <!-- END:   BROWSER CHAINS -->
  <OpChain name="LOCK_REGISTER" contextKey="REGISTER_LOCKED" rollbackChainKey="LOCK_REGISTER" rollbackLevel="90">
    <Op class="dtv.pos.security.op.StopAutoLogoutTimerOp" />
    <Op class="dtv.pos.register.lock.LockRegisterOp" />
  </OpChain>
  <OpChain name="AUTOMATIC_LOGOUT">
    <OpChainRoute chainKey="AIRPORT_AUTOMATIC_LOGOUT" condition="dtv.pos.flight.AirsideEnabledCondition"/>
    <Op class="dtv.pos.order.ResetOrderMgrOp" />
    <Op class="dtv.pos.security.op.RouteAutoLogoutOp" />
    <Op class="dtv.pos.hardware.op.IdleCustomerDisplayOp" />
    <Op class="dtv.pos.framework.op.OpChainRollbackToTopOp" />
  </OpChain> 
  <OpChain name="AIRPORT_AUTOMATIC_LOGOUT">
    <Op class="dtv.pos.flight.op.FlightAutoLogoutOp" />
  </OpChain>
  <OpChain name="RETURN_TO_LOGIN">
    <OpChainRoute chainKey="SECURITY_LOGOUT" />
    <Op class="dtv.pos.hardware.op.IdleCustomerDisplayOp" />
    <Op class="dtv.pos.framework.op.OpChainRollbackToTopOp" />
  </OpChain>
  <OpChain name="PRE_PAYROLL_MAINTENANCE" rollbackLevel="30">
    <PromptOp class="dtv.pos.timeclock.timecard.op.PromptPayrollWeeksOp" />
    <Op class="dtv.pos.timeclock.timecard.op.GetActiveEmpTimecardPayrollOp" />
    <Op class="dtv.pos.timeclock.timecard.op.TimecardEmployeeSearchOp" />
    <OpChainRoute chainKey="PAYROLL_MAINTENANCE" chainType="START" />
  </OpChain>
  <OpChain name="PREVIOUS_ACTIVE_TIMECARD_EMPLOYEE">
    <Op class="dtv.pos.payroll.op.GetPreviousEmployeeOp" />
  </OpChain>
  <OpChain name="ABORT_PAYROLL_CHANGES">
    <PromptOp class="dtv.pos.payroll.op.AbortPayrollChangesOp" />
    <OpChainRoute chainKey="SAVE_ALL_PAYROLL_CHANGES" />
  </OpChain>
  <OpChain name="NEXT_ACTIVE_TIMECARD_EMPLOYEE">
    <Op class="dtv.pos.payroll.op.GetNextEmployeeOp" />
  </OpChain>
  <OpChain name="PAYROLL_MAINTENANCE" rollbackLevel="40" rollbackChainKey="EXIT_PAYROLL_SUMMARY">
    <OpChainRoute chainKey="VIEW_PAYROLL.1" breakpoint="true"/>
  </OpChain>
  <OpChain name="VIEW_PAYROLL.1">
  <OpChainRoute>
      <Choice chainKey="VIEW_PAYROLL" condition="dtv.pos.payroll.IsEmployeeSelectedOp" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="VIEW_PAYROLL">
    <Op class="dtv.pos.payroll.op.ViewPayrollOp"/>
  </OpChain>
  <OpChain name="EXIT_PAYROLL_SUMMARY">
    <PromptOp class="dtv.pos.payroll.op.PromptRollbackPayrollOp">
      <Parameter name="RollbackChain" value="EXIT_TO_PRE_PAYROLL_MAINTENANCE" />
    </PromptOp>
  </OpChain>
  <OpChain name="EXIT_TO_PRE_PAYROLL_MAINTENANCE">
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>
  <OpChain name="NEW_PAYROLL_WEEK">
    <Op class="dtv.pos.payroll.op.CheckPayrollChangesOp" />
    <PromptOp class="dtv.pos.timeclock.timecard.op.PromptPayrollWeeksOp" />
  </OpChain>
  <OpChain name="SAVE_ALL_PAYROLL_CHANGES">
    <Op class="dtv.pos.payroll.op.PersistChangedPayrollsOp" />
  </OpChain>
  <OpChain name="DISPLAY_PAYROLL_COMMENTS">
    <PromptOp class="dtv.pos.payroll.op.PromptPayrollCommentsOp" />
  </OpChain>
  <OpChain name="POST_PAYROLL">
    <PromptOp class="dtv.pos.payroll.op.CheckPayrollChangesOp" />
    <PromptOp class="dtv.pos.payroll.op.CheckPayrollPostedOp" />
    <PromptOp class="dtv.pos.payroll.op.PromptSomeEmpHaveBeenPostedOp" />
    <Op class="dtv.pos.payroll.op.CheckEnforcePostPayrollDateTimeOp" />
    <PromptOp class="dtv.pos.payroll.op.PromptPostPayrollConfirmationOp" />
    <PromptOp class="dtv.pos.payroll.op.PromptPayrollErrorsOp" />
    <PromptOp class="dtv.pos.payroll.op.CheckAllPayrollReviewedOp" />
    <Op class="dtv.pos.timeclock.timecard.op.PersistPostedTimecardLogOp" longRunning="true" />
    <PromptOp class="dtv.pos.payroll.op.PostPayrollsOp" longRunning="true" />
  </OpChain>
  <OpChain name="POST_PAYROLL_PER_EMPLOYEE">
    <PromptOp class="dtv.pos.payroll.op.CheckPayrollChangesOp" />
    <Op class="dtv.pos.payroll.op.CheckPayrollPostedPerEmpOp" />
    <ValidationOp class="dtv.pos.payroll.op.PayrollValidationWithoutPromptOp" validationsBean="payrollPostRules" />
    <PromptOp class="dtv.pos.payroll.op.CheckEnforcePostPayrollDateTimeOp" />
    <PromptOp class="dtv.pos.payroll.op.PromptPostEmpPayrollConfirmationOp" />
    <PromptOp class="dtv.pos.payroll.op.CheckEmployeePayrollReviewedOp" />
    <Op class="dtv.pos.timeclock.timecard.op.PersistPostedTimecardLogPerEmpOp" longRunning="true" />
    <PromptOp class="dtv.pos.payroll.op.PostEmployeePayrollOp" longRunning="true" />
  </OpChain>
  <OpChain name="REVIEW_PAYROLL">
    <PromptOp class="dtv.pos.payroll.op.CheckPayrollChangesOp" />
    <Op class="dtv.pos.payroll.op.CheckPayrollPostedPerEmpOp" />
    <ValidationOp class="dtv.pos.payroll.op.PayrollValidationWithoutPromptOp" validationsBean="payrollReviewRules" />
    <Op class="dtv.pos.payroll.op.UpdateViewedPayrollOp" longRunning="true" />
    <Op class="dtv.pos.payroll.op.PayrollReviewedConfirmationMsgOp" />
  </OpChain>
  <OpChain name="ADD_PAYROLL_COMMENT">
    <PromptOp class="dtv.pos.payroll.op.PromptNewPayrollCommentOp" validationsBean="commentRules" />
    <Op class="dtv.pos.common.PersistObjectsOp" longRunning="true" />
  </OpChain>
  <OpChain name="XPAY_BALANCE_INQUIRY">
    <Op class="dtv.tenderauth.storedvalue.GatherVoucherInfoOp">
      <Parameter name="VoucherActivityCodeType" value="INQUIRE_BALANCE" />
      <Parameter name="VoucherType" value="XPAY_GIFT_CARD" />
    </Op>
    <PromptOp class="dtv.tenderauth.storedvalue.PromptVoucherForBalanceOp" key="GIFT_CARD_SERIAL_NEEDED_BALANCE" validationsBean="voucherNumberRules" />
    <PromptOp class="dtv.tenderauth.storedvalue.PromptForPINOp" />
    <Op class="dtv.tenderauth.storedvalue.AuthorizeBalanceOp" />
    <PromptOp class="dtv.tenderauth.storedvalue.DisplayBalanceOp" />
    <Op class="dtv.pos.hardware.op.BuildRcptsOp" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
  </OpChain>
  <OpChain name="MENU_TRAVERSAL_FORWARD">
    <Op class="dtv.pos.framework.op.ForceMenuSelectionOp" breakpoint="true" />
  </OpChain>
  <OpChain name="FOREIGN_CURRENCY_MAINTENANCE" signal="TransactionComplete" contextKey="FOREIGN_CURRENCY_MAINTENANCE">
    <Op class="dtv.pos.tender.foreigncurrency.maint.ListFCurrencyOp" />
    <Op class="dtv.pos.tender.foreigncurrency.maint.PromptRateFormOp" />
    <PromptOp class="dtv.pos.tender.foreigncurrency.maint.PromptConfirmRateChangeOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
  </OpChain>
  <!--
    BEGIN: WORK ORDER OP CHAINS
  -->
  <OpChain name="PRE_WORK_ORDER_CHAIN" contextKey="WORK_ORDER" rollbackChainKey="BACKTO_SALE_ITEM" rollbackLevel="30">
    <Op class="dtv.pos.customer.account.op.InitCustAcctTypeOp">
      <Parameter name="TYPE" value="WORK_ORDER" />
    </Op>
    <Op class="dtv.pos.workorder.account.WorkOrderAccountSelectOp" />
    <Op class="dtv.pos.workorder.account.WorkOrderRegisterSearchOp" />
    <Op class="dtv.pos.customer.AddCustToTransactionOp" />
    <OpChainRoute chainKey="WORK_ORDER_CHAIN" chainType="START" />
  </OpChain>
  <OpChain name="WORK_ORDER_CHAIN" contextKey="WORK_ORDER" rollbackChainKey="WORK_ORDER_FINISH" rollbackLevel="40">
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
    <Op class="dtv.pos.workorder.common.PromptWorkOrderOptionsOp" />
  </OpChain>
  <OpChain name="ADD_NEW_WORK_ORDER_ACCT" rollbackChainKey="WORK_ORDER_SETUP_FINISH">
    <Op class="dtv.pos.customer.EnsureCustomerAssignedOp" />
    <Op class="dtv.pos.customer.AddCustToTransactionOp" />
    <PromptOp class="dtv.pos.workorder.account.PromptWorkOrderAccountIdOp" validationsBean="custAccountIdRules" />
    <Op class="dtv.pos.workorder.account.CreateWorkOrderAccountOp" />
    <OpChainRoute chainKey="WORK_ORDER_ITEM_MENU" chainType="START" />
  </OpChain>
  <OpChain name="ADD_NEW_WORK_ORDER_ACCT_FINISH" contextKey="WORK_ORDER">
    <PromptOp class="dtv.pos.workorder.account.PromptWorkOrderCategoryOp" breakpoint="true" />
    <PromptOp class="dtv.pos.workorder.account.PromptWorkOrderPriceCodeOp" breakpoint="true" />
    <OpChainRoute chainKey="WORK_ORDER_WARRANTY" />
    <PromptOp class="dtv.pos.workorder.account.PromptWorkOrderServiceLocOp" breakpoint="true" />
    <Op class="dtv.pos.workorder.account.PromptAllWorkOrderServiceLocSearchOp" breakpoint="true" />
    <Op class="dtv.pos.workorder.account.AddWorkOrderAccountToManagerOp" />
    <PromptOp class="dtv.pos.workorder.task.PromptAvailableTasksOp" validationsBean="taskSelectionRules" />
    <Op class="dtv.pos.workorder.task.CreateWorkOrderTaskOp" />
    <Op class="dtv.pos.warranty.common.AddWarrantiesToManagerOp" />
    <OpChainRoute chainKey="WORK_ORDER_CHAIN" chainType="START" />
  </OpChain>
  <OpChain name="WORK_ORDER_ITEM_MENU" rollbackChainKey="WORK_ORDER_SETUP_FINISH" rollbackLevel="50">
    <PromptOp class="dtv.pos.workorder.item.PromptWorkOrderItemTypeSelectOp" breakpoint="true" />
  </OpChain>
  <OpChain name="MODIFY_WORK_ORDER_ADD_ITEM_MENU">
    <PromptOp class="dtv.pos.workorder.item.PromptWorkOrderItemTypeSelectOp" />
  </OpChain>
  <OpChain name="WO_CURRENT_TRANS_ITEM_SELECT">
    <PromptOp class="dtv.pos.workorder.item.PromptAddItemFromCurrentTransOp" validationsBean="nonNullWorkItemsRules" />
    <PromptOp class="dtv.pos.workorder.item.PromptWorkItemSerialNumberOp" validationsBean="workOrderSerialNumberRules" />
    <Op class="dtv.pos.workorder.item.AddWorkItemsToWorkOrderOp" />
    <Op class="dtv.pos.workorder.item.PromptSelectMoreItemsOp" />
  </OpChain>
  <OpChain name="WO_CUST_HIST_ITEM_SELECT">
    <PromptOp class="dtv.pos.workorder.item.PromptAddItemFromCustHistOp" longRunning="true" />
    <PromptOp class="dtv.pos.workorder.item.PromptWorkItemSerialNumberOp" validationsBean="workOrderSerialNumberRules" />
    <Op class="dtv.pos.workorder.item.AddWorkItemsToWorkOrderOp" />
    <Op class="dtv.pos.workorder.item.PromptSelectMoreItemsOp" />
  </OpChain>
  <OpChain name="WO_PREV_TRAN_ITEM_SELECT">
    <Op class="dtv.pos.workorder.item.PromptAddItemFromOrigRcptOp" />
    <Op class="dtv.pos.workorder.item.VerifyWorkOrderItemOp" />
    <PromptOp class="dtv.pos.workorder.item.PromptWorkItemSerialNumberOp" validationsBean="workOrderSerialNumberRules" />
    <Op class="dtv.pos.workorder.item.AddWorkItemsToWorkOrderOp" />
    <Op class="dtv.pos.workorder.item.PromptSelectMoreItemsOp" />
  </OpChain>
  <OpChain name="WO_ITEM_PROMPT">
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountItemScanOp" validationsBean="itemIdRules" />
    <ValidationOp class="dtv.pos.workorder.CheckItemNotOnFileOp" validationsBean="itemNotOnFileRules" />
    <ValidationOp validationsBean="itemAvailableForWorkOrderRules" />
    <PromptOp class="dtv.pos.item.restriction.PromptForCashierAgeVerificationOp">
      <Parameter name="SaleItemType" value="WORK_ORDER" />
    </PromptOp>
    <ValidationOp validationsBean="allowWorkOrderItemRules" />
    <ValidationOp validationsBean="sellingIdGroupRules" />
    <Op class="dtv.pos.workorder.item.CreateWorkOrderLineItemOp" />
    <OpChainRoute chainKey="WORK_ITEM_ADD" />
    <Op class="dtv.pos.workorder.item.PromptSelectMoreItemsOp" />
  </OpChain>
  <OpChain name="WO_DEFAULT_ITEM_ADD">
    <Op class="dtv.pos.workorder.item.AddDefaultItemNotOnFileOp" />
    <OpChainRoute chainKey="WORK_ITEM_ADD" />
    <Op class="dtv.pos.workorder.item.PromptSelectMoreItemsOp" />
  </OpChain>
  <OpChain name="WORK_ITEM_ADD">
    <Op class="dtv.pos.register.itemmessages.DisplayInstructionsOp">
      <Parameter name="FILENAME" value="_instructionalWorkOrderMsg" />
    </Op>
    <PromptOp class="dtv.pos.workorder.item.PromptWorkItemDescriptionOp" validationsBean="itemDescriptionRules" />
    <PromptOp class="dtv.pos.workorder.item.PromptWorkItemValueOp" validationsBean="workOrderItemValueRules" />
    <PromptOp class="dtv.pos.workorder.item.PromptWorkItemSerialNumberOp" validationsBean="workOrderSerialNumberRules" />
    <Op class="dtv.pos.workorder.item.AddWorkItemToWorkOrderOp" />
  </OpChain>
  <OpChain name="WORK_ORDER_SETUP_FINISH">
    <PromptOp class="dtv.pos.workorder.account.PromptCancelAccountSetupOp" />
  </OpChain>
  <OpChain name="WORK_ORDER_FINISH" signal="TransactionModified">
    <Op class="dtv.pos.workorder.validation.ValidateNewWorkOrderAccountOp" />
    <OpChainRoute chainKey="WORK_ORDER_COMPLETE" />
    <OpChainRoute chainKey="BACKTO_SALE_ITEM" chainType="START" />
  </OpChain>
  <OpChain name="WORK_ORDER_PRE_TENDER" signal="TransactionModified">
    <Op class="dtv.pos.workorder.validation.ValidateNewWorkOrderAccountPreTenderOp" />
    <OpChainRoute chainKey="WORK_ORDER_COMPLETE" />
    <Op class="dtv.pos.register.UpdateCurrentTransListOp" />
    <OpChainRoute chainKey="PRE_TENDERING" chainType="START" />
  </OpChain>
  <OpChain name="WORK_ORDER_COMPLETE" signal="TransactionModified">
    <ValidationOp validationsBean="workOrderItemsRules" />
    <ValidationOp validationsBean="totalNumberPartTaskRules" />
    <PromptOp class="dtv.pos.workorder.payment.PromptWorkOrderDepositAmountOp" breakpoint="true" validationsBean="depositAmountRules" />
    <ValidationOp class="dtv.pos.workorder.payment.ValidateWorkOrderDepositOp" validationsBean="maxDepositAmountRules" />
    <OpChainRoute chainKey="ISSUE_WORK_ORDER_REFUND" />
    <Op class="dtv.pos.workorder.account.CompleteWorkOrderAccountOp" />
  </OpChain>
  <OpChain name="ISSUE_WORK_ORDER_REFUND">
    <Op class="dtv.pos.workorder.account.CreateWorkOrderRefundItemOp" />
  </OpChain>
  <OpChain name="ADD_WORK_ORDER_TASK_REGISTER">
    <OpChainRoute chainKey="ADD_WORK_ORDER_TASK" />
    <OpChainRoute chainKey="WORK_ORDER_CHAIN" chainType="START" />
  </OpChain>
  <OpChain name="ADD_WORK_ORDER_TASK_BO">
    <OpChainRoute chainKey="ADD_WORK_ORDER_TASK" />
  </OpChain>
  <OpChain name="ADD_WORK_ORDER_TASK">
    <PromptOp class="dtv.pos.workorder.task.PromptAvailableTasksOp" validationsBean="taskSelectionRules" />
    <Op class="dtv.pos.workorder.task.CreateWorkOrderTaskOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" />
  </OpChain>
  <OpChain name="DELETE_WORK_ORDER_TASK">
    <PromptOp class="dtv.pos.workorder.task.PromptCurrentTasksToModifyOp" validationsBean="workOrderModifyTasksRules" />
    <Op class="dtv.pos.workorder.common.UpdateCustAccountActivityTypeCancelOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.customer.account.op.UpdateVoidCustAcctItemOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" />
  </OpChain>
  <OpChain name="CONVERT_WORK_ORDER_ESTIMATE_TASK">
    <PromptOp class="dtv.pos.workorder.task.PromptEstimatedTasksToConvertOp" />
    <PromptOp class="dtv.pos.workorder.task.PromptAvailableActualTasksOp" validationsBean="taskSelectionRules" />
    <Op class="dtv.pos.customer.account.op.UpdateVoidCustAcctItemOp" />
    <Op class="dtv.pos.workorder.task.CreateWorkOrderTaskOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" />
  </OpChain>
  <OpChain name="WORK_ORDER_TASK_INSTRUCTION">
    <PromptOp class="dtv.pos.workorder.task.PromptCurrentTasksToModifyOp" validationsBean="workOrderModifyTasksRules" />
    <PromptOp class="dtv.pos.workorder.task.PromptTaskInstructionToModifyOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.workorder.task.UpdateTaskInstructionOp" />
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
  </OpChain>
  <OpChain name="ADD_WORK_ORDER_ITEM" signal="TransactionModified">
    <ValidationOp validationsBean="workOrderSellingIdGroupRules" />
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <Op class="dtv.pos.customer.account.op.AddCustomerAccountModifierOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <WorkerOp workersBean="addTransDiscountsToNewItemWorkers" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.workorder.item.CreateWorkOrderDetailOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctActivityOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" />
  </OpChain>
  <OpChain name="ADD_WORK_ORDER_ITEM_BACKOFFICE" signal="TransactionModified">
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.workorder.item.AddWorkOrderItemBackOfficeOp" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.workorder.item.CreateWorkOrderDetailOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctActivityOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" />
  </OpChain>
  <OpChain name="ADD_WORK_ORDER_ITEM_FINISH">
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>
  <OpChain name="DELETE_WORK_ORDER_ITEM">
    <PromptOp class="dtv.pos.workorder.item.PromptCurrentItemsToModifyOp" />
    <Op class="dtv.pos.workorder.item.UpdateVoidWorkItemOp" />
    <Op class="dtv.pos.workorder.item.MarkWorkItemChangedOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" />
  </OpChain>
  <OpChain name="EDIT_WORK_ORDER_ITEM_VALUE">
    <OpChainRoute chainKey="EDIT_WORK_ORDER_ITEM_VALUE_BACK_OFFICE" />
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
  </OpChain>
  <OpChain name="EDIT_WORK_ORDER_ITEM_VALUE_BACK_OFFICE">
    <PromptOp class="dtv.pos.workorder.item.PromptCurrentItemsToModifyOp" />
    <PromptOp class="dtv.pos.workorder.item.PromptModifyWorkItemValueOp" validationsBean="workOrderItemValueRules" />
  </OpChain>
  <OpChain name="EDIT_WORK_ORDER_ITEM_DESCRIPTION">
    <PromptOp class="dtv.pos.workorder.item.PromptCurrentItemsToModifyOp" />
    <PromptOp class="dtv.pos.workorder.item.PromptModifyWorkItemDescriptionOp" validationsBean="itemDescriptionRules" />
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
  </OpChain>
  <OpChain name="ADD_WORK_ORDER_PARTS">
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
    <PromptOp class="dtv.pos.workorder.part.PromptWorkOrderPartScanOp" validationsBean="itemIdRules" />
    <Op class="dtv.pos.workorder.part.CreateWorkOrderPartOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" />
  </OpChain>
  <OpChain name="ADD_WORK_ORDER_PARTS_BACKOFFICE">
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
    <PromptOp class="dtv.pos.workorder.part.PromptWorkOrderPartScanOp" validationsBean="itemIdRules" />
    <Op class="dtv.pos.workorder.part.CreateWorkOrderPartBackOfficeOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" />
  </OpChain>
  <OpChain name="DELETE_WORK_ORDER_PARTS">
    <PromptOp class="dtv.pos.workorder.part.PromptCurrentPartsToModifyOp" />
    <Op class="dtv.pos.workorder.common.UpdateCustAccountActivityTypeCancelOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.customer.account.op.UpdateVoidCustAcctItemOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" />
  </OpChain>
  <OpChain name="CHANGE_WORK_ORDER_LINE_ITEM_QTY_TOUCH">
    <ValidationOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemFromTouchOp" validationsBean="custAccountChangeQuantityRules" />
    <OpChainRoute chainKey="CHANGE_WORK_ORDER_LINE_ITEM_QTY_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_WORK_ORDER_LINE_ITEM_QTY">
    <PromptOp class="dtv.pos.workorder.modifylineitem.PromptWorkOrderLineItemToModifyOp" />
    <ValidationOp validationsBean="custAccountChangeQuantityRules"/>
    <OpChainRoute chainKey="CHANGE_WORK_ORDER_LINE_ITEM_QTY_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_WORK_ORDER_LINE_ITEM_QTY_IMPL" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.modifyitem.PromptItemQuantityChangeOp" validationsBean="itemQuantityRules" />
    <Op class="dtv.pos.register.modifyitem.UpdateChangedQuantityOp" />
    <Op class="dtv.pos.workorder.modifylineitem.UpdateCustAcctActTypeModifyQtyOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" />
  </OpChain>
  <OpChain name="CHANGE_WORK_ORDER_LINE_ITEM_PRICE_TOUCH">
    <ValidationOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemFromTouchOp" validationsBean="custAccountChangePriceRules" />
    <OpChainRoute chainKey="CHANGE_WORK_ORDER_LINE_ITEM_PRICE_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_WORK_ORDER_LINE_ITEM_PRICE">
    <PromptOp class="dtv.pos.workorder.modifylineitem.PromptWorkOrderLineItemToModifyOp" />
    <ValidationOp validationsBean="custAccountChangePriceRules"/>
    <OpChainRoute chainKey="CHANGE_WORK_ORDER_LINE_ITEM_PRICE_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_WORK_ORDER_LINE_ITEM_PRICE_IMPL" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.modifyitem.PromptItemPriceChangeOp" />
    <Op class="dtv.pos.register.VoidAllDiscountsOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <Op class="dtv.pos.workorder.modifylineitem.UpdateCustAcctActTypeModifyPriceOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" chainType="START" />
  </OpChain>
  <OpChain name="CHANGE_WORK_ORDER_PRICE_TYPE" signal="TransactionModified">
    <Op class="dtv.pos.register.VoidAllDiscountsOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" />
  </OpChain>
  <OpChain name="REFRESH_REGISTER_WORK_ORDER_DATA">
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
  </OpChain>
  <OpChain name="TAX_WORK_ORDER_ITEM_CHANGE_LOCATION" signal="TransactionModified">
    <PromptOp class="dtv.pos.workorder.modifylineitem.PromptWorkOrderLineItemToModifyOp" />
    <PromptOp class="dtv.pos.register.tax.PromptPostalCodeOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxLocationOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxChangeReasonOp" />
    <Op class="dtv.pos.register.tax.ChangeTaxGroupRuleOp" />
    <Op class="dtv.pos.workorder.modifylineitem.UpdateCustAcctActTypeModifyTaxOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" />
  </OpChain>
  <OpChain name="TAX_WORK_ORDER_ITEM_EXEMPT" signal="TransactionModified">
    <PromptOp class="dtv.pos.workorder.modifylineitem.PromptWorkOrderLineItemToModifyOp" />
    <Op class="dtv.pos.register.tax.PromptSelectItemTaxOp" />
    <PromptOp class="dtv.pos.workorder.account.PromptWorkOrderTaxExemptionOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxExemptReasonOp" breakpoint="true" />
    <Op class="dtv.pos.register.tax.SaveTaxExemptOp" />
    <Op class="dtv.pos.register.tax.ChangeTaxToExemptOp" />
    <Op class="dtv.pos.workorder.modifylineitem.UpdateCustAcctActTypeModifyTaxOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" />
  </OpChain>
  <OpChain name="TAX_WORK_ORDER_ITEM_CHANGE_AMOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.workorder.modifylineitem.PromptWorkOrderLineItemToModifyOp" />
    <Op class="dtv.pos.register.tax.PromptSelectItemTaxOp" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxAmountOp" validationsBean="taxAmountRules" />
    <PromptOp class="dtv.pos.register.tax.PromptTaxChangeReasonOp" />
    <Op class="dtv.pos.register.tax.ChangeTaxAmountOp" />
    <Op class="dtv.pos.workorder.modifylineitem.UpdateCustAcctActTypeModifyTaxOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" />
  </OpChain>
  <OpChain name="TAX_WORK_ORDER_ITEM_CHANGE_PERCENT" signal="TransactionModified">
    <PromptOp class="dtv.pos.workorder.modifylineitem.PromptWorkOrderLineItemToModifyOp" />
    <Op class="dtv.pos.register.tax.PromptSelectItemTaxOp" />
    <OpChainRoute chainKey="TAX_CHANGE_PERCENT" />
    <Op class="dtv.pos.register.tax.ChangeTaxPercentOp" />
    <Op class="dtv.pos.workorder.modifylineitem.UpdateCustAcctActTypeModifyTaxOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" />
  </OpChain>
  <OpChain name="CANCEL_WORK_ORDER" signal="TransactionModified">
    <PromptOp class="dtv.pos.workorder.account.PromptCancelWorkOrderAcctConfirmationOp" />
    <Op class="dtv.pos.workorder.account.CancelWorkOrderAccountOp" />
    <OpChainRoute chainKey="ISSUE_WORK_ORDER_REFUND" />
    <Op class="dtv.pos.customer.account.op.AddCancelledAccountToPersistablesBagOp" />
    <OpChainRoute chainKey="SALE_ITEM_START" chainType="START" />
  </OpChain>
  <OpChain name="CANCEL_WORK_ORDER_ITEM">
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.customer.account.op.UpdateVoidCustAcctItemOp">
      <Parameter name="detailStateCode" value="CANCEL" />
    </Op>
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
  </OpChain>
  <OpChain name="CHANGE_WORK_ORDER_PRICE_CATEGORY" signal="TransactionModified">
    <PromptOp class="dtv.pos.workorder.account.PromptModifyPriceCodeOp" />
    <Op class="dtv.pos.workorder.modifylineitem.ChangeWorkOrderLineItemPriceTypeOp" />
    <OpChainRoute chainKey="WORK_ORDER_WARRANTY" />
    <Op class="dtv.pos.warranty.common.AddWarrantiesToManagerOp" />
    <OpChainRoute chainKey="REFRESH_REGISTER_WORK_ORDER_DATA" />
  </OpChain>
  <OpChain name="EDIT_WORK_ORDER_APPROVED_AMOUNT">
    <PromptOp class="dtv.pos.workorder.account.PromptApprovalAmountOp" validationsBean="workOrderApprovalAmtRules" />
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
  </OpChain>
  <OpChain name="EDIT_WORK_ORDER_PRIORITY">
    <PromptOp class="dtv.pos.workorder.account.PromptWorkOrderPriorityOp" />
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
  </OpChain>
  <OpChain name="EDIT_WORK_ORDER_CONTACT_METHOD">
    <PromptOp class="dtv.pos.workorder.account.PromptWorkOrderContactMethodOp" />
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
  </OpChain>
  <OpChain name="EDIT_WORK_ORDER_LAST_NOTICE_DATE">
    <PromptOp class="dtv.pos.workorder.account.PromptLastNoticeDateOp" validationsBean="lastNoticeDateRules" />
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
  </OpChain>
  <OpChain name="EDIT_WORK_ORDER_EXPECTED_FINISH_DATE">
    <PromptOp class="dtv.pos.workorder.account.PromptWorkOrderExpectedFinishDateOp" validationsBean="workOrderFinishDateRules" />
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
  </OpChain>
  <OpChain name="EDIT_WORK_ORDER_SERVICE_LOCATION">
    <PromptOp class="dtv.pos.workorder.account.PromptWorkOrderServiceLocOp" />
    <Op class="dtv.pos.workorder.account.PromptModifyAllServiceLocsOp" />
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
  </OpChain>
  <OpChain name="EDIT_WORK_ORDER_SERVICE_LOCATION_BACK_OFFICE">
    <PromptOp class="dtv.pos.workorder.account.PromptWorkOrderServiceLocOp" />
    <Op class="dtv.pos.workorder.account.PromptModifyAllServiceLocsOp" />
    <Op class="dtv.pos.workorder.account.UpdateNewServiceLocationOp" />
  </OpChain>
  <OpChain name="EDIT_WORK_ORDER_STATUS">
    <PromptOp class="dtv.pos.workorder.account.PromptWorkOrderStatusOp" validationsBean="workOrderStatusRules" />
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
  </OpChain>
  <OpChain name="PICKUP_WORK_ORDER" signal="TransactionModified">
    <Op class="dtv.pos.workorder.pickup.SetWorkOrderPickupListOp" />
    <Op class="dtv.pos.customer.account.op.UpdateItemStatusPickedOp" />
    <Op class="dtv.pos.workorder.pickup.ProcessPickupWorkOrderOp" />
    <Op class="dtv.pos.workorder.pickup.AddWorkOrderPickupTenderOp" />
    <Op class="dtv.pos.workorder.pickup.CreatePickupTenderWorkOrderLineItemOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctActivityOp" />
    <OpChainRoute chainKey="BACKTO_SALE_ITEM" chainType="START" />
  </OpChain>
  <OpChain name="VIEW_WORK_ORDER_HISTORY">
    <PromptOp class="dtv.pos.workorder.account.PromptWorkOrderHistoryOp" />
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
  </OpChain>
  <OpChain name="VIEW_WORK_ORDER_COMMENT">
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountNotesOp" />
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
  </OpChain>
  <OpChain name="ADD_WORK_ORDER_COMMENT">
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountCommentOp" validationsBean="commentRules" />
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
  </OpChain>
  <OpChain name="ADD_WORK_ORDER_COMMENT_BACK_OFFICE">
    <PromptOp class="dtv.pos.workorder.account.PromptNewWorkOrderCommentBackOfficeOp" validationsBean="commentRules"  />
    <Op class="dtv.pos.common.PersistObjectsOp" longRunning="true" />
  </OpChain>
  <OpChain name="WORK_ORDER_BATCH_RECEIVE" rollbackLevel="60">
    <Op class="dtv.pos.workorder.inventory.ServiceLocationSearchOp">
      <Parameter name="TITLE" value="_serviceLocSearchTitleRec" />
    </Op>
    <PromptOp class="dtv.pos.workorder.inventory.PromptAlreadyShippedWorkOrdersOp" />
    <ValidationOp validationsBean="workOrderBatchReceiveRules" />
    <Op class="dtv.pos.common.op.CreateTransactionAsNeededOp" longRunning="true">
      <Parameter name="TransactionType" value="INVENTORY_CONTROL" />
    </Op>
    <Op class="dtv.pos.workorder.inventory.ProcessWorkOrderInventoryOp">
      <Parameter name="sourceBucket" value="AT_VENDOR" />
      <Parameter name="destinationBucket" value="WORK_ORDER" />
    </Op>
    <Op class="dtv.pos.workorder.inventory.CreateReceivingDocFromSearchResultsOp" longRunning="true">
      <Parameter name="DOC_NAME" value="WORK_ORDER" />
    </Op>
    <Op class="dtv.pos.customer.account.op.SearchResultIteratingOp">
      <Parameter name="ChainKey" value="CREATE_WORK_ORDER_JOURNAL_FROM_SEARCH" />
    </Op>
    <WorkerOp workersBean="addCustAccountPersistableWorkers" />
    <OpChainRoute chainKey="SIMPLE_COMPLETE_TRANSACTION" />
    <OpChainRoute chainKey="SHIPPING_PRINT_PACKING_SLIP" />
  </OpChain>
  <OpChain name="CREATE_WORK_ORDER_JOURNAL_FROM_SEARCH">
    <Op class="dtv.pos.workorder.account.LookupAccountBySearchResultOp" />
    <Op class="dtv.pos.workorder.account.CreateAccountJournalOp" />
  </OpChain>
  <OpChain name="WORK_ORDER_BATCH_SHIP" rollbackLevel="60">
    <Op class="dtv.pos.workorder.inventory.ServiceLocationSearchOp">
      <Parameter name="TITLE" value="_serviceLocSearchTitleShip" />
    </Op>
    <PromptOp class="dtv.pos.workorder.inventory.PromptUnShippedWorkOrdersOp" />
    <ValidationOp validationsBean="workOrderBatchShipRules" />
    <Op class="dtv.pos.common.op.CreateTransactionAsNeededOp" longRunning="true">
      <Parameter name="TransactionType" value="INVENTORY_CONTROL" />
    </Op>
    <Op class="dtv.pos.workorder.inventory.CreateShippingDocFromSearchResultsOp" longRunning="true">
      <Parameter name="DOC_NAME" value="WORK_ORDER" />
    </Op>
    <Op class="dtv.pos.workorder.inventory.ProcessWorkOrderInventoryOp">
      <Parameter name="sourceBucket" value="WORK_ORDER" />
      <Parameter name="destinationBucket" value="AT_VENDOR" />
    </Op>
    <OpChainRoute chainKey="SIMPLE_COMPLETE_TRANSACTION" />
    <OpChainRoute chainKey="SHIPPING_PROCESS_SHIPMENT" />
  </OpChain>
  <OpChain name="WORK_ORDER_INVOICING" rollbackLevel="60" contextKey="BACK_OFFICE_MAIN_MENU">
    <Op class="dtv.pos.workorder.inventory.ServiceLocationSearchOp">
      <Parameter name="TITLE" value="_serviceLocSearchTitleInvoice" />
    </Op>
    <Op class="dtv.pos.workorder.invoice.PromptInvoiceFormOp" />
    <PromptOp class="dtv.pos.workorder.invoice.PromptWorkOrdersToInvoiceOp" />
    <OpChainRoute chainKey="WORK_ORDER_INVOICING_COMPLETE" chainType="START" />
  </OpChain>
  <OpChain name="WORK_ORDER_INVOICING_COMPLETE" rollbackLevel="90" contextKey="WORK_ORDER">
    <Op class="dtv.pos.workorder.invoice.HandleInvoiceDetailActionsOp" />
  </OpChain>
  <OpChain name="ADD_MISC_INVOICE_ACCT">
    <Op class="dtv.pos.workorder.invoice.PromptMiscInvoiceAccountOp" />
  </OpChain>

  <OpChain name="PRINT_WORK_ORDER_INVOICE">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="REPAIR_INVOICE_REPORT" />
    </Op>
    <Op class="dtv.pos.workorder.common.SetInvoiceReportParamOp" />
    <Op class="dtv.pos.reporting.fill.FillReportOp" />
    <Op class="dtv.pos.reporting.print.PrintReportOp" />
  </OpChain>
  <OpChain name="WORK_ORDER_INVOICING_FINISH">
    <PromptOp class="dtv.pos.workorder.invoice.PersistInvoiceOp" />
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="REPAIR_INVOICE_REPORT" />
    </Op>
    <Op class="dtv.pos.workorder.common.SetInvoiceReportParamOp" />
    <Op class="dtv.pos.reporting.fill.FillReportOp" />
    <Op class="dtv.pos.reporting.print.PrintReportOp">
      <Parameter name="ContinueOnError" value="true" />
    </Op>
    <OpChainRoute chainKey="BACK_OFFICE_MAIN_MENU" chainType="START" />
  </OpChain>
  <OpChain name="WORK_ORDER_INVOICE_LOOKUP" rollbackLevel="60">
    <Op class="dtv.pos.workorder.inventory.ServiceLocationSearchOp">
      <Parameter name="TITLE" value="_serviceLocSearchTitleInvoice" />
    </Op>
    <PromptOp class="dtv.pos.workorder.invoice.PromptInvoiceListOp" />
    <PromptOp class="dtv.pos.workorder.invoice.PromptInvoiceDetailListOp" />
  </OpChain>
  <OpChain name="PRE_WORK_ORDER_MAINTENANCE" rollbackLevel="60" contextKey="BACK_OFFICE_MAIN_MENU">
    <Op class="dtv.pos.customer.account.op.InitCustAcctTypeOp">
      <Parameter name="TYPE" value="WORK_ORDER" />
    </Op>
    <Op class="dtv.pos.workorder.account.WorkOrderBackOfficeSearchOp" />
    <OpChainRoute chainKey="WORK_ORDER_MAINTENANCE" chainType="START" />
  </OpChain>
  <OpChain name="WORK_ORDER_MAINTENANCE" rollbackLevel="70" contextKey="WORK_ORDER">
    <Op class="dtv.pos.workorder.account.HandleWorkOrderMaintActionsOp" breakpoint="true" />
  </OpChain>
  <!--
    END: WORK ORDER OP CHAINS
  -->
  <OpChain name="REPOLL">
    <Op class="dtv.pos.appmanagement.op.SendIpcMessageOp">
      <Parameter name="SERVICE" value="xstore" />
      <Parameter name="METHOD" value="RepollRequest" />
    </Op>
  </OpChain>
  <OpChain name="SHELF_LABEL_ITEM_SETUP">
    <Op class="dtv.pos.reporting.label.LabelShelfItemSetupOp" />
    <OpChainRoute chainKey="ITEM_AND_SHELF_LABELS" chainType="START" />
  </OpChain>
  <OpChain name="ITEM_AND_SHELF_LABELS" contextKey="ITEM_AND_SHELF_LABELS" rollbackLevel="20" rollbackChainKey="ITEM_AND_SHELF_LABELS_EXIT">
    <Op class="dtv.pos.register.itemmessages.DisplayInstructionsOp">
      <Parameter name="FILENAME" value="_shelfLabelHeaderInstructions" />
    </Op>
    <PromptOp class="dtv.pos.reporting.label.PromptLabelItemScanOp" validationsBean="itemIdRules" breakpoint="true" />
    <Op class="dtv.pos.reporting.label.CheckItemNotOnFileOp" />
    <OpChainRoute chainKey="ITEM_AND_SHELF_LABELS_LOOKUP" />
  </OpChain>
  <OpChain name="ITEM_AND_SHELF_LABELS_LOOKUP">
    <ValidationOp validationsBean="itemsForShelfLabelRules" />
    <Op class="dtv.pos.common.PromptStyleLookupOp" />
    <PromptOp class="dtv.pos.reporting.label.PromptLabelQuantityOp" validationsBean="labelQuantityRules" />
    <Op class="dtv.pos.reporting.label.AddItemToLabelModelOp" />
    <OpChainRoute>
      <Choice chainKey="ZPL_PRINTER" condition="dtv.pos.reporting.label.IsUsingZPLPrinter" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="ZPL_PRINTER">
    <OpChainRoute chainKey="ITEM_HAS_DEFINED_LABEL" />
    <Op class="dtv.pos.reporting.label.AssignLabelToAllOp" />
  </OpChain>
  <OpChain name="ITEM_AND_SHELF_LABELS_PRINT">
    <Op class="dtv.pos.reporting.label.SetLabelCountOp" />
    <OpChainRoute>
      <Choice chainKey="ITEM_AND_SHELF_LABELS_THERMAL_PRINT" condition="dtv.pos.reporting.label.IsUsingZPLPrinter" />
      <Choice chainKey="ITEM_AND_SHELF_LABELS_LASER_PRINT" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="ITEM_AND_SHELF_LABELS_LASER_PRINT">
    <PromptOp class="dtv.pos.reporting.label.PromptSelectLabelTypeOp" />
    <Op class="dtv.pos.reporting.label.PromptLabelPositionOp" />
    <Op class="dtv.pos.reporting.label.SetLabelTagReportDataSourceOp" />
    <Op class="dtv.pos.reporting.fill.FillReportOp">
      <Parameter name="FormKey" value="LABEL_LAYOUT_CALCULATING" />
    </Op>
    <PromptOp class="dtv.pos.reporting.label.PromptInsertLabelStockOp" />
    <Op class="dtv.pos.reporting.print.PrintReportOp" />
  </OpChain>
  <OpChain name="ITEM_AND_SHELF_LABELS_THERMAL_PRINT">
    <Op class="dtv.pos.reporting.label.AllItemsHaveDefinedStockIteratingOp">
      <Parameter name="ChainKey" value="ITEM_HAS_DEFINED_LABEL" />
    </Op>
    <Op class="dtv.pos.reporting.label.PrintStockLabelByGroupsIteratingOp">
      <Parameter name="ChainKey" value="PROMPT_PRINT_LABEL_GROUP" />
    </Op>
    <PromptOp class="dtv.pos.reporting.label.PromptSaveBatchOp" />
    <OpChainRoute chainKey="LABEL_BATCH_SAVE" />
  </OpChain>
  <OpChain name="ITEM_HAS_DEFINED_LABEL">
    <PromptOp class="dtv.pos.reporting.label.PromptSelectLabelOp" />
  </OpChain>
  <OpChain name="PROMPT_PRINT_LABEL_GROUP">
    <PromptOp class="dtv.pos.reporting.label.PromptStockLoadedConfirmationOp" />
  </OpChain>
  <OpChain name="PRINT_LABEL_GROUP">
    <Op class="dtv.pos.reporting.label.PrintLabelGroupIteratingOp">
      <Parameter name="ChainKey" value="PRINT_LABEL" />
    </Op>
  </OpChain>
  <OpChain name="PRINT_LABEL">
    <Op class="dtv.pos.reporting.label.PrintLabelOp" />
  </OpChain>
  <OpChain name="LABEL_BATCH_LOOKUP">
    <PromptOp class="dtv.pos.reporting.label.PromptBatchListOp" breakpoint="true" />
    <Op class="dtv.pos.reporting.label.AddLabelSelectionsFromBatchOp" />
  </OpChain>
  <OpChain name="LABEL_BATCH_DELETE">
    <PromptOp class="dtv.pos.reporting.label.PromptBatchListDeleteOp" />
    <PromptOp class="dtv.pos.reporting.label.PromptLabelBatchDeleteOp" />
    <Op class="dtv.pos.reporting.label.DeleteLabelBatchOp" />
  </OpChain>
  <OpChain name="LABEL_BATCH_SAVE">
    <PromptOp class="dtv.pos.reporting.label.PromptBatchNameOp" validationsBean="batchNameRules" breakpoint="true"/>
    <PromptOp class="dtv.pos.reporting.label.PromptConfirmOverwriteBatchOp" />
    <Op class="dtv.pos.reporting.label.SaveBatchOp" />
  </OpChain>
  <OpChain name="LABEL_ITEM_DELETE">
    <Op class="dtv.pos.reporting.label.GetSelectedLabelItemOp" />
    <Op class="dtv.pos.reporting.label.DeleteSelectedLabelItemOp" />
  </OpChain>
  <OpChain name="LABEL_ITEM_DELETE_TOUCH">
    <Op class="dtv.pos.reporting.label.GetSelectedLabelItemFromTouchOp" />
    <Op class="dtv.pos.reporting.label.DeleteSelectedLabelItemOp" />
  </OpChain>
  <OpChain name="ITEM_AND_SHELF_LABELS_EXIT">
    <PromptOp class="dtv.pos.reporting.label.PromptConfirmLoseChangesOp" />
    <Op class="dtv.pos.register.itemmessages.ClearMsgOp" />
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>
  <OpChain name="LABEL_ITEM_CHANGE_QUANTITY">
    <Op class="dtv.pos.reporting.label.GetSelectedLabelItemOp" />
    <OpChainRoute chainKey="LABEL_ITEM_CHANGE_QUANTITY_IMPL" />
  </OpChain>
  <OpChain name="LABEL_ITEM_CHANGE_QUANTITY_TOUCH">
    <Op class="dtv.pos.reporting.label.GetSelectedLabelItemFromTouchOp" />
    <OpChainRoute chainKey="LABEL_ITEM_CHANGE_QUANTITY_IMPL" />
  </OpChain>
  <OpChain name="LABEL_ITEM_CHANGE_QUANTITY_IMPL">
    <PromptOp class="dtv.pos.reporting.label.PromptLabelQuantityOp" validationsBean="labelQuantityRules" />
    <Op class="dtv.pos.reporting.label.SetNewLabelCountOp" />
  </OpChain>
  <OpChain name="LABEL_ITEM_CHANGE_PRICE">
    <Op class="dtv.pos.reporting.label.GetSelectedLabelItemOp" />
    <PromptOp class="dtv.pos.reporting.label.PromptNewLabelPriceOp" validationsBean="itemPriceRules" />
  </OpChain>
  <OpChain name="LABEL_ITEM_CHANGE_PRICE_TOUCH">
    <Op class="dtv.pos.reporting.label.GetSelectedLabelItemFromTouchOp" />
    <PromptOp class="dtv.pos.reporting.label.PromptNewLabelPriceOp" validationsBean="itemPriceRules" />
  </OpChain>
  <OpChain name="LABEL_ITEM_CHANGE_STOCK">
    <Op class="dtv.pos.reporting.label.GetSelectedLabelItemOp" />
    <PromptOp class="dtv.pos.reporting.label.PromptSelectLabelOp">
      <Parameter name="force" value="true" />
    </PromptOp>
  </OpChain>
  <OpChain name="LABEL_RECEIVING_LOOKUP">
    <Op class="dtv.pos.reporting.label.LabelDocSearchOp" />
    <Op class="dtv.pos.reporting.label.AddLabelSelectionsFromInvCtlDocOp" />
  </OpChain>

  <OpChain name="SALE_VOUCHER_ITEM_EVENT_ROUTING">
    <Op class="dtv.pos.reporting.label.GetSelectedLabelItemOp" />
    <PromptOp class="dtv.pos.reporting.label.PromptLabelQuantityOp" />
    <Op class="dtv.pos.reporting.label.SetNewLabelCountOp" />
  </OpChain>
  <OpChain name="CANCEL_TIMECLOCK_TRANSACTION" signal="TransactionCancelled">
    <WorkerOp workersBean="completeCancelTimeclockTransWorkers" />
    <Op class="dtv.pos.common.PersistCurrentTransactionOp" />
  </OpChain>
  <OpChain name="ADD_HOUSE_ACCOUNT_COMMENT">
    <PromptOp class="dtv.pos.houseaccount.op.PromptARCommentOp" validationsBean="commentRules" />
    <Op class="dtv.pos.common.PersistObjectsOp" longRunning="true" />
  </OpChain>
  <OpChain name="REMOVE_HOUSE_ACCOUNT_USER">
    <PromptOp class="dtv.pos.houseaccount.op.PromptAREligibleUsersOp" />
    <Op class="dtv.pos.houseaccount.op.RemoveSelectedARUserOp" />
    <Op class="dtv.pos.common.PersistObjectsOp" longRunning="true" />
  </OpChain>
  <OpChain name="ADD_HOUSE_ACCOUNT_USER">
    <Op class="dtv.pos.houseaccount.op.PromptARCustomerToAddOp" />
    <Op class="dtv.pos.houseaccount.op.CreateChargeAcctUserOp" />
    <Op class="dtv.pos.common.PersistObjectsOp" longRunning="true" />
  </OpChain>

  <OpChain name="REPOST_PAYROLL">
    <PromptOp class="dtv.pos.timeclock.timecard.op.PromptRepostPayrollWeeksOp" />
    <Op class="dtv.pos.payroll.op.RePostPayrollOp" />
    <Op class="dtv.pos.payroll.op.ReWritePayrollLogOp" longRunning="true" />
  </OpChain>
  <OpChain name="REPRINT_LAST_RECEIPT" signal="TransactionComplete">
    <Op class="dtv.pos.register.reprint.SelectLastTransactionOp" />
    <ValidationOp validationsBean="receiptReprintRules" />
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="REPRINT_RECEIPT" />
    <Op class="dtv.pos.tender.creditcard.PrepareImprintCreditCardOp" />
    <Op class="dtv.pos.hardware.op.BuildTenderFrankingsOnSelectedTransactionOp" />
    <PromptOp class="dtv.pos.register.reprint.PromptRefrankDocsOp" />
    <OpChainRoute chainKey="REPRINT_PREPARE_RECEIPTS" />
    <OpChainRoute chainKey="REPRINT_LAST_EJ_RECEIPTS.local" />
    <Op class="dtv.pos.hardware.op.FrankTendersOp" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <OpChainRoute chainKey="PRINT_DOCUMENTS" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
    <PromptOp class="dtv.pos.register.reprint.PromptImprintCreditCardOp" />
    <PromptOp class="dtv.tenderretail.PromptImprintNonSAFCreditCardOnReprintOp" />
  </OpChain>
  <OpChain name="REPRINT_LAST_EJ_RECEIPTS.local">
    <OpChainRoute chainKey="REPRINT_LAST_EJ_RECEIPTS.pre" />
    <Op class="dtv.pos.hardware.op.ReprintEjRcptsOp" />
    <OpChainRoute chainKey="REPRINT_LAST_EJ_RECEIPTS.post" />
  </OpChain>
  <OpChain name="REPRINT_LAST_EJ_RECEIPTS.pre" />
  <OpChain name="REPRINT_LAST_EJ_RECEIPTS.post" />
  <OpChain name="VOUCHER_BALANCE_INQUIRY">
    <Op class="dtv.tenderauth.storedvalue.GatherVoucherInfoOp">
      <Parameter name="VoucherActivityCodeType" value="INQUIRE_BALANCE" />
    </Op>
    <PromptOp class="dtv.tenderauth.storedvalue.PromptVoucherForBalanceOp" validationsBean="voucherNumberRules" />
    <Op class="dtv.tenderauth.storedvalue.LookupVoucherBalanceOp" longRunning="true" />
    <Op class="dtv.tenderauth.storedvalue.ProcessBalanceInquiryTransactionOp" />
    <Op class="dtv.tenderauth.storedvalue.DisplayVoucherBalanceOp" />
    <Op class="dtv.pos.hardware.op.BuildRcptsOp" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
  </OpChain>
  <!-- Chains for PRIVATE CREDIT CARDS -->
  <OpChain name="NEW_CREDIT_APPLICATION" signal="TransactionModified" contextKey="SALE_TENDER_EMPTY_MENU_OPTION">
    <Op class="dtv.pos.common.op.CreateTransactionAsNeededOp">
      <Parameter name="TransactionType" value="RETAIL_SALE" />
    </Op>
    <OpChainRoute chainKey="FILL_CREDIT_APPLICATION" />
    <Op class="dtv.tenderauth.impl.ajb.SendCreditAppOp">
      <Parameter name="suspendChain" value="SUSPEND_TRANSACTION" />
    </Op>
    <Op class="dtv.pos.customer.credit.op.VoidLineItemOp" />
  </OpChain>
  <OpChain name="FILL_CREDIT_APPLICATION">
    <Op class="dtv.pos.tender.CreateTenderLineItemOp">
      <Parameter name="TenderStatus" value="Tender" />
      <Parameter name="TenderId" value="PRIVATE_LABEL" />
    </Op>
    <Op class="dtv.pos.tender.AddTenderToSaleTranOp" />
    <Op class="dtv.pos.tender.rounding.UpdateTransactionRoundedAmountOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
    <Op class="dtv.pos.customer.credit.op.PrivateCreditApplicationOp" breakpoint="true">
      <Parameter name="FirstField" value="lastName" />
      <Parameter name="AdultHood" value="18" />
    </Op>
    <Op class="dtv.pos.customer.credit.op.DisplayInsuranceSignatureOp" />
    <Op class="dtv.pos.customer.credit.op.DisplayOutOfStateShopperMessageOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>
  <OpChain name="BACK_OFFICE_PENDING_CREDIT_APPLICATIONS">
    <Op class="dtv.tenderauth.impl.ajb.status.MonitorCreditAppStatusOp">
      <Parameter name="switchAppChain" value="PRE_CHANGE_APPLICATION" />
      <Parameter name="initialDelayMillis" value="20000" />
      <Parameter name="cycleDelayMillis" value="60000" />
      <Parameter name="maximumCycleCount" value="-1" />
    </Op>
    <Op class="dtv.pos.register.suspendresume.CreateResumeTransOp" />
    <Op class="dtv.tenderauth.impl.ajb.ResumePendingAuthOp">
      <Parameter name="applicationResumeChain" value="RESUME_CREDIT_APP_AUTHORIZATION" />
        <!-- the following SHOULD never get called from the back office, but wee should have
        something ahead of the transaction actually getting resumed that prevents it -->
      <Parameter name="tenderResumeChain" value="RESUME_TENDER_AUTHORIZATION" />
    </Op>
    <WorkerOp workersBean="calculateTlogSequenceWorkers" />
    <Op class="dtv.tenderauth.impl.ajb.CompleteBackOfficeApplicationTransOp">
      <Parameter name="chainKey" value="TRANSACTION_COMPLETE" />
    </Op>
  </OpChain>
  <OpChain name="BACK_OFFICE_NEW_CREDIT_APPLICATION">
    <Op class="dtv.pos.common.op.CreateTransactionAsNeededOp">
      <Parameter name="TransactionType" value="CREDIT_APPLICATION" />
      <Parameter name="persistOnReverse" value="true" />
    </Op>
    <OpChainRoute chainKey="FILL_CREDIT_APPLICATION" />
    <Op class="dtv.tenderauth.impl.ajb.SendCreditAppOp">
      <Parameter name="suspendChain" value="SUSPEND_TRANSACTION_BACKOFFICE" />
    </Op>
    <Op class="dtv.pos.customer.credit.op.VoidLineItemOp" />
    <WorkerOp workersBean="calculateTlogSequenceWorkers" />
    <Op class="dtv.tenderauth.impl.ajb.CompleteBackOfficeApplicationTransOp">
      <Parameter name="chainKey" value="TRANSACTION_COMPLETE" />
    </Op>
  </OpChain>
  <OpChain name="BACK_OFFICE_CREDIT_ACCT_LOOKUP">
    <Op class="dtv.pos.common.op.CreateTransactionAsNeededOp">
      <Parameter name="TransactionType" value="ACCOUNT_LOOKUP" />
      <Parameter name="persistOnReverse" value="true" />
    </Op>
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
    <OpChainRoute chainKey="CREDIT_ACCT_LOOKUP_START" />
    <OpChainRoute chainKey="COMPLETE_BACK_OFFICE_CREDIT_ACCT_LOOKUP" />
  </OpChain>
  <OpChain name="COMPLETE_BACK_OFFICE_CREDIT_ACCT_LOOKUP" signal="TransactionComplete">
    <WorkerOp workersBean="completeTransactionWorkers" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
  </OpChain>
  <OpChain name="CREDIT_ACCT_LOOKUP">
    <OpChainRoute chainKey="CREDIT_ACCT_LOOKUP_START" />
  </OpChain>
  <OpChain name="CREDIT_ACCT_LOOKUP_START">
    <Op class="dtv.pos.customer.credit.op.PromptAcctSearchCriteriaOp">
      <Parameter name="tenderId" value="PRIVATE_LABEL" />
    </Op>
    <Op class="dtv.tenderauth.impl.ajb.LookupPrivateCreditAccountOp">
      <Parameter name="tenderId" value="PRIVATE_LABEL" />
    </Op>
    <OpChainRoute chainKey="CUSTOMER_CREDIT_DISPLAY_ACCOUNT_INFORMATION" />
  </OpChain>
  <OpChain name="CUSTOMER_CREDIT_DISPLAY_ACCOUNT_INFORMATION">
    <Op class="dtv.pos.customer.credit.op.DisplayAccountInformationOp" />
  </OpChain>
  <!-- START: Print PDF Documents -->
  <OpChain name="PRINT_DOCUMENTS">
    <OpChainRoute chainKey="PRINT_DOCUMENTS_START.local" />
    <Op class="dtv.pos.document.op.PrintPdfDocumentsOp" />
    <OpChainRoute chainKey="PRINT_DOCUMENTS_FINISH.local" />
  </OpChain>
  <OpChain name="PRINT_DOCUMENTS_START.local">
    <OpChainRoute chainKey="PRINT_DOCUMENTS_START.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="PRINT_DOCUMENTS_START.post" />
  </OpChain>
  <OpChain name="PRINT_DOCUMENTS_FINISH.local">
    <OpChainRoute chainKey="PRINT_DOCUMENTS_FINISH.pre" />
    <!-- Fiscal logic goes here -->
    <OpChainRoute chainKey="PRINT_DOCUMENTS_FINISH.post" />
  </OpChain>
  <OpChain name="PRINT_DOCUMENTS_START.pre" />
  <OpChain name="PRINT_DOCUMENTS_START.post" />
  <OpChain name="PRINT_DOCUMENTS_FINISH.pre" />
  <OpChain name="PRINT_DOCUMENTS_FINISH.post" />
  <!-- START: Warranty -->
  <OpChain name="SELECT_WARRANTY_PLANS_SETUP">
    <Op class="dtv.pos.warranty.common.SetupWarrantyParamsOp">
      <Parameter name="WARRANTY_TYPE_CODE" value="WARRANTY" />
    </Op>
    <Op class="dtv.pos.warranty.common.SetupWarrantyItemDataOp">
      <Parameter name="CLEAR_ITEM" value="false" />
    </Op>
    <OpChainRoute chainKey="SELECT_WARRANTY_PLANS" />
  </OpChain>
  <OpChain name="SELECT_WARRANTY_PLANS">
    <Op class="dtv.pos.warranty.common.ForceCoveredItemLineDisplayOp" />
    <PromptOp class="dtv.pos.warranty.info.PromptWarrantyPlanOp" breakpoint="true" />
    <OpChainRoute chainKey="ENTER_NEW_WARRANTY_INFO" />
  </OpChain>
  <OpChain name="ENTER_NEW_WARRANTY_INFO">
    <Op class="dtv.pos.warranty.info.EnsureWarrantyCustomerAssignedOp" />
    <PromptOp class="dtv.pos.warranty.info.PromptNewWarrantyNumberOp" validationsBean="newWarrantyIdRules" />
    <PromptOp class="dtv.pos.warranty.info.PromptAcceptWarrantyCustomerOp" />
    <Op class="dtv.pos.framework.op.DoNothingOp">
      <Parameter name="RESPONSE" value="COMPLETE" />
    </Op>
  </OpChain>
  <!-- Warranty: Sale -->
  <OpChain name="SALE_WARRANTY_SETUP">
    <Op class="dtv.pos.warranty.common.SetupWarrantyParamsOp">
      <Parameter name="WARRANTY_STATUS_CODE" value="OPEN" />
      <Parameter name="WARRANTY_BEING_ISSUED" value="true" />
    </Op>
  </OpChain>
  <OpChain name="SALE_ATTACHED_WARRANTY">
    <OpChainRoute chainKey="SELECT_WARRANTY_PLANS_SETUP" />
    <Op class="dtv.pos.warranty.common.RunCoveredLineItemChainOp">
      <Parameter name="ChainKey" value="SALE_WARRANTY_FINISH" />
    </Op>
  </OpChain>
  <OpChain name="PRE_SALE_WARRANTY">
    <OpChainRoute chainKey="SALE_WARRANTY" />
  </OpChain>
  <OpChain name="SALE_WARRANTY">
    <OpChainRoute chainKey="NEW_WARRANTY_SETUP" />
    <PromptOp class="dtv.pos.warranty.info.PromptLineToCoverTransTypeOp">
      <Parameter name="OPTIONS_KEY" value="SellWarrantyChains" />
    </PromptOp>
    <OpChainRoute chainKey="SALE_WARRANTY_FINISH" />
  </OpChain>
  <OpChain name="SALE_WARRANTY_GIFT">
    <OpChainRoute chainKey="NEW_WARRANTY_GIFT_SETUP" />
    <Op class="dtv.pos.warranty.info.PromptLineToCoverTransTypeOp">
      <Parameter name="OPTIONS_KEY" value="SellWarrantyGiftChains" />
    </Op>
    <OpChainRoute chainKey="SALE_WARRANTY_FINISH" />
  </OpChain>
  <OpChain name="SALE_WARRANTY_RENEW">
    <OpChainRoute chainKey="NEW_WARRANTY_RENEW_SETUP" />
    <Op class="dtv.pos.warranty.info.PromptLineToCoverTransTypeOp">
      <Parameter name="OPTIONS_KEY" value="SellWarrantyRenewChains" />
    </Op>
    <OpChainRoute chainKey="SALE_WARRANTY_FINISH" />
  </OpChain>
  <OpChain name="SALE_WARRANTY_FINISH" signal="TransactionModified">
    <Op class="dtv.pos.warranty.common.WarrantyItemIteratingOp">
      <Parameter name="ChainKey" value="SALE_WARRANTY_FINISH_ITERABLE" />
    </Op>
  </OpChain>
  <OpChain name="SALE_WARRANTY_FINISH_ITERABLE" signal="TransactionModified">
    <OpChainRoute chainKey="SALE_WARRANTY_SETUP" />
    <Op class="dtv.pos.warranty.common.CreateWarrantyLineOp">
      <Parameter name="SALE_ITEM_TYPE" value="SALE" />
      <Parameter name="RETURN_MODE" value="false" />
      <Parameter name="FORCE_ZERO_EXT_PRICE" value="false" />
    </Op>
    <Op class="dtv.pos.warranty.common.SetupWarrantyLineAsCurrentOp" />
    <Op class="dtv.pos.warranty.common.RunWarrantyItemChainOp">
      <Parameter name="ChainKey" value="SALE_WARRANTY_FINISH_IMPL" />
    </Op>
  </OpChain>
  <OpChain name="SALE_WARRANTY_FINISH_IMPL">
    <OpChainRoute chainKey="SALE_ITEM_ADD" />
    <OpChainRoute chainKey="CREATE_WARRANTY" />
  </OpChain>
  <!-- Warranty: Return -->
  <OpChain name="RETURN_WARRANTY_SETUP">
    <Op class="dtv.pos.warranty.common.SetupWarrantyParamsOp">
      <Parameter name="WARRANTY_STATUS_CODE" value="CLOSED" />
      <Parameter name="WARRANTY_BEING_ISSUED" value="false" />
    </Op>
    <Op class="dtv.pos.warranty.returns.SetupWarrantyLineDataOp" />
  </OpChain>
  <OpChain name="RETURN_ATTACHED_WARRANTY" signal="TransactionModified">
    <OpChainRoute chainKey="RETURN_SELECT_WARRANTY_PLANS_SETUP" />
    <Op class="dtv.pos.warranty.common.RunCoveredLineItemChainOp">
      <Parameter name="ChainKey" value="RETURN_WARRANTY_UNVERIFIED_ITEM_FINISH" />
    </Op>
  </OpChain>
  <OpChain name="RETURN_SELECT_WARRANTY_PLANS_SETUP">
    <Op class="dtv.pos.warranty.common.SetupWarrantyParamsOp">
      <Parameter name="WARRANTY_TYPE_CODE" value="WARRANTY" />
      <Parameter name="WARRANTY_STATUS_CODE" value="CLOSED" />
      <Parameter name="WARRANTY_BEING_ISSUED" value="false" />
    </Op>
    <Op class="dtv.pos.warranty.common.SetupWarrantyItemDataOp">
      <Parameter name="CLEAR_ITEM" value="false" />
    </Op>
    <OpChainRoute chainKey="RETURN_SELECT_WARRANTY_PLANS" />
  </OpChain>
  <OpChain name="RETURN_SELECT_WARRANTY_PLANS">
    <PromptOp class="dtv.pos.warranty.common.ConfirmWarrantyApplyOp" breakpoint="true" />
    <Op class="dtv.pos.warranty.common.ForceCoveredItemLineDisplayOp" />
    <PromptOp class="dtv.pos.warranty.info.PromptWarrantyPlanOp" />
  </OpChain>
  <OpChain name="RETURN_WARRANTY_BLIND">
    <OpChainRoute chainKey="RETURN_WARRANTY_UNVERIFIED" />
  </OpChain>
  <OpChain name="RETURN_WARRANTY_UNVERIFIED">
    <OpChainRoute chainKey="NEW_WARRANTY_SETUP" />
    <PromptOp class="dtv.pos.warranty.info.PromptWarrantyNumberOp" validationsBean="nonNullWarrantyNumberRules" breakpoint="true" />
    <OpChainRoute chainKey="RETURN_WARRANTY_VALIDATE" />
    <Op class="dtv.pos.register.returns.PromptReturnCommAssocOp" />
    <Op class="dtv.pos.register.returns.verification.CompleteUnverifiedBlindReturnOp" />
    <OpChainRoute chainKey="RETURN_WARRANTY_FINISH" />
  </OpChain>
  <OpChain name="RETURN_WARRANTY_VERIFIED">
    <OpChainRoute chainKey="NEW_WARRANTY_SETUP" />
    <OpChainRoute chainKey="RETURN_WARRANTY_FINISH" />
  </OpChain>
  <OpChain name="RETURN_WARRANTY_VALIDATE">
    <ValidationOp class="dtv.pos.warranty.returns.LookupWarrantyForReturnOp" validationsBean="allowReturnWarrantyNOFRules" />
    <PromptOp class="dtv.pos.warranty.info.PromptAcceptWarrantyNotOnFileOp" />
    <Op class="dtv.pos.warranty.common.CreateWarrantyOp" />
    <ValidationOp validationsBean="returnWarrantyRules" />
  </OpChain>
  <OpChain name="RETURN_WARRANTY_FINISH" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.returns.PromptReturnReasonCodeOp" />
    <OpChainRoute chainKey="ADD_RETURN_ITEM_TO_TRAN" />
    <OpChainRoute chainKey="RETURN_WARRANTY_SETUP" />
    <OpChainRoute chainKey="ADD_WARRANTIES" />
    <OpChainRoute chainKey="UPDATE_WARRANTIES" />
  </OpChain>
  <OpChain name="RETURN_WARRANTY_UNVERIFIED_ITEM_FINISH">
    <OpChainRoute chainKey="NEW_WARRANTY_SETUP" />
    <Op class="dtv.pos.warranty.common.CreateWarrantyLineOp">
      <Parameter name="SALE_ITEM_TYPE" value="SALE" />
      <Parameter name="RETURN_MODE" value="true" />
      <Parameter name="FORCE_ZERO_EXT_PRICE" value="false" />
    </Op>
    <Op class="dtv.pos.warranty.common.SetupWarrantyLineAsCurrentOp" />
    <PromptOp class="dtv.pos.warranty.info.PromptWarrantyNumberOp" validationsBean="nonNullWarrantyNumberRules" breakpoint="true" />
    <OpChainRoute chainKey="RETURN_WARRANTY_VALIDATE" />
    <Op class="dtv.pos.register.returns.PromptReturnCommAssocOp" />
    <Op class="dtv.pos.register.returns.verification.CompleteUnverifiedBlindReturnOp" />
    <OpChainRoute chainKey="RETURN_WARRANTY_FINISH" />
  </OpChain>
  <!-- Warranty: Ship Sale -->
  <OpChain name="SEND_SALE_WARRANTY_SETUP">
    <Op class="dtv.pos.warranty.common.SetupWarrantyParamsOp">
      <Parameter name="WARRANTY_STATUS_CODE" value="PENDING" />
      <Parameter name="WARRANTY_BEING_ISSUED" value="false" />
    </Op>
  </OpChain>
  <OpChain name="PRE_SEND_SALE_WARRANTY">
    <OpChainRoute chainKey="SEND_SALE_WARRANTY" />
  </OpChain>
  <OpChain name="SEND_SALE_WARRANTY">
    <OpChainRoute chainKey="NEW_WARRANTY_SETUP" />
    <Op class="dtv.pos.warranty.info.PromptLineToCoverTransTypeOp">
      <Parameter name="OPTIONS_KEY" value="SellWarrantyChains" />
    </Op>
    <OpChainRoute chainKey="SEND_SALE_WARRANTY_FINISH" />
  </OpChain>
  <OpChain name="SEND_SALE_WARRANTY_GIFT">
    <OpChainRoute chainKey="NEW_WARRANTY_GIFT_SETUP" />
    <Op class="dtv.pos.warranty.info.PromptLineToCoverTransTypeOp">
      <Parameter name="OPTIONS_KEY" value="SellWarrantyGiftChains" />
    </Op>
    <OpChainRoute chainKey="SEND_SALE_WARRANTY_FINISH" />
  </OpChain>
  <OpChain name="SEND_SALE_WARRANTY_RENEW">
    <OpChainRoute chainKey="NEW_WARRANTY_RENEW_SETUP" />
    <Op class="dtv.pos.warranty.info.PromptLineToCoverTransTypeOp">
      <Parameter name="OPTIONS_KEY" value="SellWarrantyRenewChains" />
    </Op>
    <OpChainRoute chainKey="SEND_SALE_WARRANTY_FINISH" />
  </OpChain>
  <OpChain name="SEND_SALE_WARRANTY_FINISH" signal="TransactionModified">
    <Op class="dtv.pos.warranty.common.WarrantyItemIteratingOp">
      <Parameter name="ChainKey" value="SEND_SALE_WARRANTY_FINISH_ITERABLE" />
    </Op>
  </OpChain>
  <OpChain name="SEND_SALE_WARRANTY_FINISH_ITERABLE">
    <OpChainRoute chainKey="SEND_SALE_WARRANTY_SETUP" />
    <Op class="dtv.pos.warranty.common.CreateWarrantyLineOp">
      <Parameter name="SALE_ITEM_TYPE" value="SEND_SALE" />
      <Parameter name="RETURN_MODE" value="false" />
      <Parameter name="FORCE_ZERO_EXT_PRICE" value="false" />
    </Op>
    <Op class="dtv.pos.warranty.common.SetupWarrantyLineAsCurrentOp" />
    <Op class="dtv.pos.warranty.common.RunWarrantyItemChainOp">
      <Parameter name="ChainKey" value="SEND_SALE_WARRANTY_FINISH_IMPL" />
    </Op>
  </OpChain>
  <OpChain name="SEND_SALE_WARRANTY_FINISH_IMPL">
    <OpChainRoute chainKey="ADD_SEND_SALE_ITEM_START" />
    <OpChainRoute chainKey="CREATE_WARRANTY" />
    <Op class="dtv.pos.customer.account.op.RefreshCustomerAcctDetailOp" />
  </OpChain>
  <OpChain name="UPDATE_WARRANTY_SEND_SALE_QUANTITY">
    <Op class="dtv.pos.warranty.common.SetupWarrantyItemDataOp">
      <Parameter name="CLEAR_ITEM" value="false" />
    </Op>
    <PromptOp class="dtv.pos.warranty.change.PromptWarrantyQtyChangeOp" validationsBean="saleItemQuantityRules" />
    <Op class="dtv.pos.warranty.common.WarrantyLineIteratingOp">
      <Parameter name="ChainKey" value="CHANGE_SEND_SALE_ITEM_QUANTITY_FINISH" />
    </Op>
  </OpChain>
  <OpChain name="UPDATE_WARRANTY_SEND_SALE_PRICE">
    <Op class="dtv.pos.warranty.common.SetupWarrantyItemDataOp">
      <Parameter name="CLEAR_ITEM" value="false" />
    </Op>
    <Op class="dtv.pos.warranty.common.WarrantyLineIteratingOp">
      <Parameter name="ChainKey" value="UPDATE_WARRANTY_SEND_SALE_PRICE_IMPL" />
    </Op>
  </OpChain>
  <OpChain name="UPDATE_WARRANTY_SEND_SALE_PRICE_IMPL">
    <Op class="dtv.pos.warranty.common.SetupWarrantyPriceAsCurrentOp" />
    <OpChainRoute chainKey="CHANGE_SEND_SALE_ITEM_PRICE_FINISH" />
  </OpChain>
  <!-- Warranty: Layaway -->
  <OpChain name="LAYAWAY_WARRANTY_SETUP">
    <Op class="dtv.pos.warranty.common.SetupWarrantyParamsOp">
      <Parameter name="WARRANTY_STATUS_CODE" value="PENDING" />
      <Parameter name="WARRANTY_BEING_ISSUED" value="false" />
    </Op>
  </OpChain>
  <OpChain name="PRE_LAYAWAY_WARRANTY">
    <OpChainRoute chainKey="LAYAWAY_WARRANTY" />
  </OpChain>
  <OpChain name="LAYAWAY_WARRANTY">
    <OpChainRoute chainKey="NEW_WARRANTY_SETUP" />
    <Op class="dtv.pos.warranty.info.PromptLineToCoverTransTypeOp">
      <Parameter name="OPTIONS_KEY" value="SellWarrantyChains" />
    </Op>
    <OpChainRoute chainKey="LAYAWAY_WARRANTY_FINISH" />
  </OpChain>
  <OpChain name="LAYAWAY_WARRANTY_GIFT">
    <OpChainRoute chainKey="NEW_WARRANTY_GIFT_SETUP" />
    <Op class="dtv.pos.warranty.info.PromptLineToCoverTransTypeOp">
      <Parameter name="OPTIONS_KEY" value="SellWarrantyGiftChains" />
    </Op>
    <OpChainRoute chainKey="LAYAWAY_WARRANTY_FINISH" />
  </OpChain>
  <OpChain name="LAYAWAY_WARRANTY_RENEW">
    <OpChainRoute chainKey="NEW_WARRANTY_RENEW_SETUP" />
    <Op class="dtv.pos.warranty.info.PromptLineToCoverTransTypeOp">
      <Parameter name="OPTIONS_KEY" value="SellWarrantyRenewChains" />
    </Op>
    <OpChainRoute chainKey="LAYAWAY_WARRANTY_FINISH" />
  </OpChain>
  <OpChain name="LAYAWAY_WARRANTY_FINISH" signal="TransactionModified">
    <Op class="dtv.pos.warranty.common.WarrantyItemIteratingOp">
      <Parameter name="ChainKey" value="LAYAWAY_WARRANTY_FINISH_ITERABLE" />
    </Op>
  </OpChain>
  <OpChain name="LAYAWAY_WARRANTY_FINISH_ITERABLE">
    <OpChainRoute chainKey="LAYAWAY_WARRANTY_SETUP" />
    <Op class="dtv.pos.warranty.common.CreateWarrantyLineOp">
      <Parameter name="SALE_ITEM_TYPE" value="LAYAWAY" />
      <Parameter name="RETURN_MODE" value="false" />
      <Parameter name="FORCE_ZERO_EXT_PRICE" value="true" />
    </Op>
    <Op class="dtv.pos.warranty.common.SetupWarrantyLineAsCurrentOp" />
    <Op class="dtv.pos.warranty.common.RunWarrantyItemChainOp">
      <Parameter name="ChainKey" value="LAYAWAY_WARRANTY_FINISH_IMPL" />
    </Op>
  </OpChain>
  <OpChain name="LAYAWAY_WARRANTY_FINISH_IMPL">
    <OpChainRoute chainKey="ADD_LAYAWAY_ITEM" />
    <OpChainRoute chainKey="CREATE_WARRANTY" />
    <Op class="dtv.pos.customer.account.op.RefreshCustomerAcctDetailOp" />
  </OpChain>
  <OpChain name="UPDATE_WARRANTY_LAYAWAY_QUANTITY">
    <Op class="dtv.pos.warranty.common.SetupWarrantyItemDataOp">
      <Parameter name="CLEAR_ITEM" value="false" />
    </Op>
    <PromptOp class="dtv.pos.warranty.change.PromptWarrantyQtyChangeOp" validationsBean="saleItemQuantityRules" />
    <Op class="dtv.pos.warranty.common.WarrantyLineIteratingOp">
      <Parameter name="ChainKey" value="CHANGE_LAYAWAY_ITEM_QUANTITY_FINISH" />
    </Op>
  </OpChain>
  <OpChain name="UPDATE_WARRANTY_LAYAWAY_PRICE">
    <Op class="dtv.pos.warranty.common.SetupWarrantyItemDataOp">
      <Parameter name="CLEAR_ITEM" value="false" />
    </Op>
    <Op class="dtv.pos.warranty.common.WarrantyLineIteratingOp">
      <Parameter name="ChainKey" value="UPDATE_WARRANTY_LAYAWAY_PRICE_IMPL" />
    </Op>
  </OpChain>
  <OpChain name="UPDATE_WARRANTY_LAYAWAY_PRICE_IMPL">
    <Op class="dtv.pos.warranty.common.SetupWarrantyPriceAsCurrentOp" />
    <OpChainRoute chainKey="CHANGE_LAYAWAY_ITEM_PRICE_FINISH" />
  </OpChain>
  <!-- Warranty: Special Order -->
  <OpChain name="SPECIAL_ORDER_WARRANTY_SETUP">
    <Op class="dtv.pos.warranty.common.SetupWarrantyParamsOp">
      <Parameter name="WARRANTY_STATUS_CODE" value="PENDING" />
      <Parameter name="WARRANTY_BEING_ISSUED" value="false" />
    </Op>
  </OpChain>
  <OpChain name="PRE_SPECIAL_ORDER_WARRANTY">
    <OpChainRoute chainKey="SPECIAL_ORDER_WARRANTY" />
  </OpChain>
  <OpChain name="SPECIAL_ORDER_WARRANTY">
    <OpChainRoute chainKey="NEW_WARRANTY_SETUP" />
    <Op class="dtv.pos.warranty.info.PromptLineToCoverTransTypeOp">
      <Parameter name="OPTIONS_KEY" value="SellWarrantyChains" />
    </Op>
    <OpChainRoute chainKey="SPECIAL_ORDER_WARRANTY_FINISH" />
  </OpChain>
  <OpChain name="SPECIAL_ORDER_WARRANTY_GIFT">
    <OpChainRoute chainKey="NEW_WARRANTY_GIFT_SETUP" />
    <Op class="dtv.pos.warranty.info.PromptLineToCoverTransTypeOp">
      <Parameter name="OPTIONS_KEY" value="SellWarrantyGiftChains" />
    </Op>
    <OpChainRoute chainKey="SPECIAL_ORDER_WARRANTY_FINISH" />
  </OpChain>
  <OpChain name="SPECIAL_ORDER_WARRANTY_RENEW">
    <OpChainRoute chainKey="NEW_WARRANTY_RENEW_SETUP" />
    <Op class="dtv.pos.warranty.info.PromptLineToCoverTransTypeOp">
      <Parameter name="OPTIONS_KEY" value="SellWarrantyRenewChains" />
    </Op>
    <OpChainRoute chainKey="SPECIAL_ORDER_WARRANTY_FINISH" />
  </OpChain>
  <OpChain name="SPECIAL_ORDER_WARRANTY_FINISH" signal="TransactionModified">
    <Op class="dtv.pos.warranty.common.WarrantyItemIteratingOp">
      <Parameter name="ChainKey" value="SPECIAL_ORDER_WARRANTY_FINISH_ITERABLE" />
    </Op>
  </OpChain>
  <OpChain name="SPECIAL_ORDER_WARRANTY_FINISH_ITERABLE">
    <OpChainRoute chainKey="SPECIAL_ORDER_WARRANTY_SETUP" />
    <Op class="dtv.pos.warranty.common.CreateWarrantyLineOp">
      <Parameter name="SALE_ITEM_TYPE" value="SPECIAL_ORDER" />
      <Parameter name="RETURN_MODE" value="false" />
      <Parameter name="FORCE_ZERO_EXT_PRICE" value="true" />
    </Op>
    <Op class="dtv.pos.warranty.common.SetupWarrantyLineAsCurrentOp" />
    <Op class="dtv.pos.warranty.common.RunWarrantyItemChainOp">
      <Parameter name="ChainKey" value="SPECIAL_ORDER_WARRANTY_FINISH_IMPL" />
    </Op>
  </OpChain>
  <OpChain name="SPECIAL_ORDER_WARRANTY_FINISH_IMPL">
    <OpChainRoute chainKey="ADD_SPECIAL_ORDER_ITEM_FINISH" />
    <OpChainRoute chainKey="CREATE_WARRANTY" />
    <Op class="dtv.pos.customer.account.op.RefreshCustomerAcctDetailOp" />
  </OpChain>
  <OpChain name="UPDATE_WARRANTY_CUSTOMER_ACCOUNT_QUANTITY">
    <Op class="dtv.pos.warranty.common.SetupWarrantyItemDataOp">
      <Parameter name="CLEAR_ITEM" value="false" />
    </Op>
    <PromptOp class="dtv.pos.warranty.change.PromptWarrantyQtyChangeOp" validationsBean="saleItemQuantityRules" />
    <Op class="dtv.pos.warranty.common.WarrantyLineIteratingOp">
      <Parameter name="ChainKey" value="CHANGE_CUSTOMER_ACCOUNT_ITEM_QUANTITY_FINISH" />
    </Op>
  </OpChain>
  <OpChain name="UPDATE_WARRANTY_SPECIAL_ORDER_PRICE">
    <Op class="dtv.pos.warranty.common.SetupWarrantyItemDataOp">
      <Parameter name="CLEAR_ITEM" value="false" />
    </Op>
    <Op class="dtv.pos.warranty.common.WarrantyLineIteratingOp">
      <Parameter name="ChainKey" value="UPDATE_WARRANTY_SPECIAL_ORDER_PRICE_IMPL" />
    </Op>
  </OpChain>
  <OpChain name="UPDATE_WARRANTY_SPECIAL_ORDER_PRICE_IMPL">
    <Op class="dtv.pos.warranty.common.SetupWarrantyPriceAsCurrentOp" />
    <OpChainRoute chainKey="CHANGE_SP_ORDER_ITEM_PRICE_FINISH" />
  </OpChain>
  <!-- Warranty: Work Order -->
  <OpChain name="WORK_ORDER_WARRANTY">
    <Op class="dtv.pos.warranty.common.SetupWarrantyParamsOp">
      <Parameter name="WARRANTY_TYPE_CODE" value="WARRANTY" />
    </Op>
    <PromptOp class="dtv.pos.workorder.account.PromptWarrantyNumberOp" validationsBean="newWarrantyIdRulesBase" breakpoint="true" />
    <Op class="dtv.pos.warranty.common.RunWarrantyNumberChainOp">
      <Parameter name="ChainKey" value="WORK_ORDER_WARRANTY_VALIDATE" />
    </Op>
  </OpChain>
  <OpChain name="WORK_ORDER_WARRANTY_VALIDATE">
    <ValidationOp class="dtv.pos.warranty.common.LookupWarrantyOp" validationsBean="allowWorkOrderWarrantyNOFRules" />
    <Op class="dtv.pos.warranty.info.PromptAcceptWarrantyNotOnFileOp" />
    <ValidationOp class="dtv.pos.warranty.info.ValidateExistingWarrantiesOp" validationsBean="workOrderWarrantyRules" />
  </OpChain>
  <!-- Warranty: Selection/Identification -->
  <OpChain name="ADD_WARRANTIES_TO_CURRENT_TRANS_ITEM">
    <PromptOp class="dtv.pos.warranty.info.PromptLineToCoverFromCurrentTransOp" />
    <OpChainRoute chainKey="SELECT_WARRANTY_PLANS" />
  </OpChain>
  <OpChain name="ADD_WARRANTIES_TO_HISTORY_TRANS_ITEM">
    <Op class="dtv.pos.customer.EnsureCustomerAssignedOp" />
    <Op class="dtv.pos.warranty.info.PromptLineToCoverFromHistoryTransOp" />
    <OpChainRoute chainKey="SELECT_WARRANTY_PLANS" />
  </OpChain>
  <OpChain name="ADD_WARRANTIES_TO_RECEIPT_TRANS_ITEM">
    <Op class="dtv.pos.warranty.info.PromptOrigReceiptInfoOp" />
    <!-- For these 4 next operation, ONLY ONE of them will be run, depending on the fields entered through the search form. -->
    <Op class="dtv.pos.warranty.info.PromptLineToCoverFromCreditCardOp" />
    <Op class="dtv.pos.warranty.info.PromptLineToCoverFromSerializedItemsOp" />
    <Op class="dtv.pos.warranty.info.PromptLineToCoverFromFiscalNumberOp" />
    <Op class="dtv.pos.warranty.info.PromptLineToCoverFromReceiptTransOp" />
    <OpChainRoute chainKey="SELECT_WARRANTY_PLANS" />
  </OpChain>
  <OpChain name="ADD_WARRANTIES_TO_MANUAL_ITEM">
    <PromptOp class="dtv.pos.warranty.info.PromptItemToCoverIdOp" validationsBean="itemIdRules" />
    <ValidationOp class="dtv.pos.warranty.info.ValidateItemToCoverOp" validationsBean="validWarrantyItemRules" />
    <PromptOp class="dtv.pos.warranty.info.PromptItemToCoverPriceOp" validationsBean="itemPriceRules" />
    <Op class="dtv.pos.warranty.info.UpdateWarrantyPlanPriceOp" />
    <OpChainRoute chainKey="SELECT_WARRANTY_PLANS" />
  </OpChain>
  <!-- Warranty: Change -->
  <OpChain name="PRE_CHANGE_WARRANTY_CUSTOMER">
    <Op class="dtv.pos.warranty.info.PromptWarrantyLineOp" />
    <OpChainRoute chainKey="CHANGE_WARRANTY_CUSTOMER" />
  </OpChain>
  <OpChain name="CHANGE_WARRANTY_CUSTOMER">
    <Op class="dtv.pos.warranty.common.WarrantyCustomerSearchOp">
      <Parameter name="RESULTS_PROMPT" value="CUSTOMER_LIST_REGISTER" />
      <Parameter name="IGNORE_CURRENT_PARTY" value="true" />
      <Parameter name="PrimaryOnly" value="true" />
      <Parameter name="AddCustomerChain" value="ADD_NEW_CUST_ASSOC" />
      <Parameter name="EditCustomerChain" value="CUST_ASSOCIATION_EDIT" />
    </Op>
    <ValidationOp validationsBean="attachCustomerToSaleRules" />
    <Op class="dtv.pos.warranty.change.UpdateWarrantyCustomerOp" />
  </OpChain>
  <!-- Warranty: Output -->
  <OpChain name="PRINT_WARRANTIES" />
  <!-- Warranty: Miscellaneous -->
  <OpChain name="CREATE_WARRANTY">
    <Op class="dtv.pos.warranty.common.AddCoverageAssociationOp" />
    <Op class="dtv.pos.warranty.common.CreateWarrantyOp" />
    <OpChainRoute chainKey="ADD_WARRANTIES" />
    <OpChainRoute chainKey="UPDATE_WARRANTIES" />
  </OpChain>
  <OpChain name="ADD_WARRANTIES">
    <Op class="dtv.pos.warranty.common.AddWarrantyModifierOp" />
    <Op class="dtv.pos.warranty.common.AddWarrantyLineListenerOp" />
    <Op class="dtv.pos.warranty.common.AddWarrantiesToManagerOp" />
  </OpChain>
  <OpChain name="UPDATE_WARRANTIES">
    <Op class="dtv.pos.warranty.change.UpdateWarrantyLineOp" />
    <Op class="dtv.pos.warranty.change.UpdateWarrantiesOp" />
    <Op class="dtv.pos.warranty.change.UpdateWarrantyLineQtyOp" />
  </OpChain>
  <OpChain name="UPDATE_WARRANTY_ASSOCIATIONS">
    <Op class="dtv.pos.warranty.change.UpdateCoverageOp" />
    <Op class="dtv.pos.warranty.common.AddWarrantyLineListenerOp" />
    <Op class="dtv.pos.warranty.common.AddWarrantiesToManagerOp" />
    <Op class="dtv.pos.warranty.change.UpdateWarrantiesOp" />
  </OpChain>
  <OpChain name="ISSUE_WARRANTIES">
    <Op class="dtv.pos.warranty.common.SetupWarrantyParamsOp">
      <Parameter name="WARRANTY_STATUS_CODE" value="OPEN" />
      <Parameter name="WARRANTY_BEING_ISSUED" value="true" />
    </Op>
    <Op class="dtv.pos.warranty.common.SetupWarrantyItemDataOp">
      <Parameter name="CLEAR_ITEM" value="false" />
    </Op>
    <OpChainRoute chainKey="UPDATE_WARRANTY_ASSOCIATIONS" />
  </OpChain>
  <OpChain name="SUSPEND_WARRANTIES">
    <Op class="dtv.pos.warranty.common.SetupWarrantyParamsOp">
      <Parameter name="WARRANTY_STATUS_CODE" value="PENDING" />
    </Op>
    <Op class="dtv.pos.warranty.change.UpdateWarrantiesOp" />
    <Op class="dtv.pos.warranty.common.AddWarrantiesToPersistablesOp" />
  </OpChain>
  <OpChain name="RESUME_WARRANTIES">
    <Op class="dtv.pos.warranty.common.SetupWarrantyParamsOp">
      <Parameter name="WARRANTY_STATUS_CODE" value="OPEN" />
    </Op>
    <Op class="dtv.pos.warranty.common.CopyWarrantiesOp" />
    <OpChainRoute chainKey="UPDATE_WARRANTY_ASSOCIATIONS" />
  </OpChain>
  <OpChain name="POST_VOID_WARRANTY_ACTIVITY">
    <Op class="dtv.pos.warranty.common.PostVoidWarrantyActivityOp" />
  </OpChain>
  <OpChain name="CREATE_WARRANTY_ACTIVITY">
    <Op class="dtv.pos.warranty.common.AddWarrantiesToPersistablesOp" />
    <Op class="dtv.pos.warranty.common.AddWarrantyJournalsToPersistablesOp" />
  </OpChain>
  <OpChain name="NEW_WARRANTY_SETUP">
    <Op class="dtv.pos.warranty.common.SetupWarrantyParamsOp">
      <Parameter name="WARRANTY_TYPE_CODE" value="WARRANTY" />
      <Parameter name="WARRANTY_MANUALLY_ADDED" value="true" />
    </Op>
    <Op class="dtv.pos.warranty.common.SetupWarrantyItemDataOp">
      <Parameter name="CLEAR_ITEM" value="false" />
    </Op>
    <Op class="dtv.pos.warranty.info.EnsureWarrantyCustomerAssignedOp" />
  </OpChain>
  <OpChain name="NEW_WARRANTY_GIFT_SETUP">
    <Op class="dtv.pos.warranty.common.SetupWarrantyParamsOp">
      <Parameter name="WARRANTY_TYPE_CODE" value="WARRANTY_GIFT" />
    </Op>
    <Op class="dtv.pos.warranty.common.SetupWarrantyItemDataOp">
      <Parameter name="CLEAR_ITEM" value="true" />
    </Op>
    <Op class="dtv.pos.warranty.info.EnsureWarrantyCustomerAssignedOp" />
  </OpChain>
  <OpChain name="NEW_WARRANTY_RENEW_SETUP">
    <Op class="dtv.pos.warranty.common.SetupWarrantyParamsOp">
      <Parameter name="WARRANTY_TYPE_CODE" value="WARRANTY_RENEWAL" />
    </Op>
    <Op class="dtv.pos.warranty.common.SetupWarrantyItemDataOp">
      <Parameter name="CLEAR_ITEM" value="true" />
    </Op>
    <Op class="dtv.pos.warranty.info.EnsureWarrantyCustomerAssignedOp" />
  </OpChain>
  <!-- END: Warranty -->

  <OpChain name="CREDIT_PAYMENT" signal="TransactionModified">
    <PromptOp class="dtv.pos.houseaccount.op.PromptCreditPaymentNumberOp">
      <Parameter name="tenderId" value="PRIVATE_LABEL" />
    </PromptOp>
    <PromptOp class="dtv.pos.houseaccount.op.PromptCreditPaymentAmountOp" validationsBean="itemPriceRules" />
    <Op class="dtv.pos.houseaccount.op.CreateCreditPaymentLineItemOp" />
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <Op class="dtv.pos.register.itemmessages.DisplayInstructionsOp">
      <Parameter name="FILENAME" value="_instructionalMsg" />
    </Op>
    <Op class="dtv.pos.register.itemmessages.DisplayItemMessagesOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
    <Op class="dtv.pos.register.UpdateCurrentTransListOp" />
  </OpChain>
  <OpChain name="NO_SALE_ITEMS_ALLOWED" contextKey="SALE" rollbackChainKey="ROLLBACK_TRANS_PROMPT" rollbackLevel="10">
    <Op class="dtv.pos.register.UpdateCurrentTransListOp" />
    <Op class="dtv.pos.framework.op.ForceMenuSelectionOp" />
  </OpChain>
  <OpChain name="INVENTORY_ADJUSTMENT_SETUP" rollbackLevel="20">
    <Op class="dtv.pos.inventory.adjustment.SetupAdjustmentOp" />
    <Op class="dtv.pos.inventory.adjustment.PromptAdjustmentReasonOp" />
    <Op class="dtv.pos.inventory.adjustment.PromptInventoryLocationBucketOp" />
    <OpChainRoute chainKey="INVENTORY_ADJUSTMENT_MAIN" chainType="START" />
  </OpChain>
  <OpChain name="INVENTORY_ADJUSTMENT_MAIN" contextKey="INVENTORY_ADJUSTMENT" rollbackChainKey="PROMPT_CANCEL_INVENTORY" rollbackLevel="30">
    <PromptOp class="dtv.pos.inventory.adjustment.PromptAdjustmentItemScanOp" contextKey="INVENTORY_ADJUSTMENT" validationsBean="invAdjustItemRules" breakpoint="true" />
    <ValidationOp class="dtv.pos.inventory.adjustment.CheckItemNotOnFileOp" validationsBean="itemNotOnFileRules" />
    <Op class="dtv.pos.common.PromptStyleLookupOp" />
    <Op class="dtv.pos.inventory.adjustment.MatchInventoryLineItemOp" />
    <PromptOp class="dtv.pos.inventory.adjustment.PromptInvAdjustSerialNumberOp" validationsBean="serialNumbeInvAdjRules" />
    <PromptOp class="dtv.pos.inventory.op.PromptInventoryItemQuantityOp" validationsBean="itemQuantityRules" />
    <Op class="dtv.pos.inventory.adjustment.ProcessAdjustmentDocLineOp" />
  </OpChain>
  <OpChain name="SAVE_EXIT_INVENTORY_ADJUSTMENT" signal="InventoryOperationsComplete">
    <WorkerOp workersBean="saveInvAdjustWorkers" />
    <OpChainRoute chainKey="INVENTORY_ADJUSTMENT_REPORT" />
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>
  <OpChain name="INVENTORY_ADJUSTMENT_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="INVENTORY_ADJUSTMENT_REPORT" />
    </Op>
    <Op class="dtv.pos.inventory.adjustment.SetInvAdjRepOp" />
    <Op class="dtv.pos.reporting.fill.FillReportOp">
      <Parameter name="continueOnError" value="true" />
    </Op>
    <Op class="dtv.pos.reporting.print.PrintReportOp">
      <Parameter name="continueOnError" value="true" />
    </Op>
  </OpChain>
  <OpChain name="INVENTORY_ADJUSTMENT_ITEM_CHANGE_QTY">
    <PromptOp class="dtv.pos.inventory.op.GetSelectedInventoryItemOp" validationsBean="changableQtyInventoryItemRules" />
    <PromptOp class="dtv.pos.inventory.op.PromptInventoryAdjustmentQuantityOp" validationsBean="itemQuantityRules" />
  </OpChain>
  <OpChain name="INVENTORY_ADJUSTMENT_ITEM_VOID">
    <PromptOp class="dtv.pos.inventory.op.GetSelectedInventoryItemOp" validationsBean="selectedInventoryItemRules" />
    <Op class="dtv.pos.inventory.op.PromptForVoidItemOp" />
    <Op class="dtv.pos.inventory.adjustment.RefreshTransactionListOp" />
  </OpChain>
  <OpChain name="ISSUE_DOCUMENT">
    <Op class="dtv.pos.document.op.CreateDocumentLineItemOp" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>
  <OpChain name="ISSUE_DOCUMENT_VOUCHER_START" signal="TransactionModified">
    <Op class="dtv.pos.register.nonphysical.GatherVoucherSaleItemInfoOp">
      <Parameter name="SaleItemType" value="SALE" />
      <Parameter name="VoucherActivityCodeType" value="ISSUED" />
    </Op>
    <PromptOp class="dtv.pos.tender.voucher.PromptVoucherNumberOp">
      <Parameter name="LineItemType" value="ITEM" />
      <Parameter name="Cancelable" value="FALSE" />
    </PromptOp>
    <Op class="dtv.pos.document.op.CreateDocumentVoucherSaleLineItemOp" />
    <OpChainRoute chainKey="SALE_VOUCHER_VALIDATE" />
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <OpChainRoute chainKey="SALE_VOUCHER_AUTHORIZE" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>
  <OpChain name="REDEEM_TRANSACTION_BOUNCE_BACK_COUPON" signal="TransactionModified">
    <PromptOp class="dtv.pos.document.bounceback.op.PromptBounceBackCouponNbrOp" validationsBean="nonNullSerialNumberRules" />
    <ValidationOp class="dtv.pos.document.bounceback.op.ValidateBounceBackCouponOp" validationsBean="bounceBackCouponRules" />
    <ValidationOp validationsBean="transactionDiscountRules" />
    <PromptOp class="dtv.pos.pricing.discount.PromptForAmountPercentOp" />
    <Op class="dtv.pos.pricing.discount.ValidateDiscountCompatibilityOp" />
    <Op class="dtv.pos.document.bounceback.op.ApplyBounceBackCouponOp" />
    <Op class="dtv.pos.pricing.discount.AddDiscountLineItemToTransactionOp" />
    <Op class="dtv.pos.pricing.discount.AddTransDiscountPriceModifiersOp" />
    <Op class="dtv.pos.pricing.discount.PlayDiscountSoundOp" />
    <Op class="dtv.pos.pricing.discount.DisplayDiscountPromptOp" />
    <Op class="dtv.pos.sendsale.op.UpdateTransDiscSendSaleItemsOp" />
    <!--Operation class="dtv.pos.common.PersistTranInProcessOp" /-->
  </OpChain>
  <OpChain name="REDEEM_LINE_ITEM_BOUNCE_BACK_COUPON" signal="TransactionModified">
    <PromptOp class="dtv.pos.document.bounceback.op.PromptBounceBackCouponNbrOp" validationsBean="nonNullSerialNumberRules" />
    <ValidationOp class="dtv.pos.document.bounceback.op.ValidateBounceBackCouponOp" validationsBean="bounceBackCouponRules" />
    <PromptOp class="dtv.pos.register.GetSelectedSaleLineOp" validationsBean="saleItemModifyRules" />
    <ValidationOp validationsBean="redeemBounceBackDiscountRules" />
    <PromptOp class="dtv.pos.pricing.discount.PromptForAmountPercentOp" validationsBean="lineItemDiscountRules" />
    <Op class="dtv.pos.pricing.discount.ValidateDiscountCompatibilityOp" />
    <Op class="dtv.pos.document.bounceback.op.ApplyBounceBackCouponOp" />
    <Op class="dtv.pos.pricing.discount.AddPriceModifierToTransactionOp" />
    <Op class="dtv.pos.pricing.discount.PlayDiscountSoundOp" />
    <Op class="dtv.pos.pricing.discount.DisplayDiscountPromptOp" />
    <Op class="dtv.pos.sendsale.op.RouteSendSaleLineItemDiscOp" />
    <!--Operation class="dtv.pos.common.PersistTranInProcessOp"/ -->
  </OpChain>
  <OpChain name="REDEEM_BOUNCE_BACK_COUPON_FROM_EVENT">
    <Op class="dtv.pos.document.bounceback.op.RouteBounceBackCouponEventOp" />
  </OpChain>
  <OpChain name="POST_VOID_BOUNCE_BACK_COUPON">
    <Op class="dtv.pos.ejournal.postvoid.PostVoidBounceBackCouponOp" />
  </OpChain>
  <OpChain name="START_RETURN_FROM_RECEIPT_SCAN" contextKey="RETURN" rollbackChainKey="BACKTO_SALE_ITEM">
    <Op class="dtv.pos.register.returns.HandleReceiptScanDuringSaleOp">
      <Parameter name="Privilege" value="RETURN_ITEM" />
    </Op>
  </OpChain>

  <!-- POST_VOID Report -->
  <OpChain name="POST_VOID_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="POST_VOID_TRANSACTION_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>

  <!-- TRANSACTION_VOID Report -->
  <OpChain name="CANCELLED_TRANSACTION_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="CANCELLED_TRANSACTION_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>

  <OpChain name="ITEM_LIST_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="ITEM_LIST_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="INVENTORY_MOVEMENT_PENDING">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="INVENTORY_MOVEMENT_PENDING" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="INVENTORY_MOVEMENT_HISTORY">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="INVENTORY_MOVEMENT_HISTORY" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Line_VOID Report -->
  <OpChain name="LINE_VOID_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="LINE_VOID_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Sales Goals Report -->
  <OpChain name="SALES_GOALS_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="SALES_GOALS_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Suspended Transaction Report -->
  <OpChain name="SUSPENDED_TRANSACTION_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="SUSPENDED_TRANSACTION_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- Airside Sales Tax Report -->
  <OpChain name="AIRSIDE_SALES_TAX_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="AIRSIDE_SALES_TAX_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!--add line item comments-->
  <OpChain name="ADD_LINE_ITEM_COMMENT" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.GetSelectedSaleLineOp" validationsBean="saleItemModifyRules" />
    <PromptOp class="dtv.pos.nosale.PromptLineItemCommentOp" validationsBean="commentRules" />
  </OpChain>
  <OpChain name="CUST_ACCOUNT_ADD_LINE_ITEM_COMMENT" signal="TransactionModified">
    <Op class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" />
    <Op class="dtv.pos.nosale.PromptLineItemCommentOp" />
  </OpChain>
  <OpChain name="PRINT_REBATE_RECEIPT">
    <PromptOp class="dtv.pos.ejournal.PromptTransactionIdOp" validationsBean="transactionExistsRule" />
    <ValidationOp validationsBean="transactionReceiptRebateRules" />
    <Op class="dtv.pos.register.rebate.SetRebateReceiptSourceOp" />
    <Op class="dtv.pos.hardware.op.BuildRcptsOp" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
  </OpChain>
  <OpChain name="ISSUE_REBATE_RECEIPT">
    <!-- used by back office -->
    <ValidationOp validationsBean="transactionReceiptRebateRules" />
    <Op class="dtv.pos.register.rebate.SetRebateReceiptSourceOp" />
    <Op class="dtv.pos.hardware.op.BuildRcptsOp" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
  </OpChain>
  <OpChain name="INVENTORY_LOCATION_SEARCH" rollbackLevel="70">
    <Op class="dtv.pos.inventory.locationmaint.InventoryLocationSearchOp" breakpoint="true">
      <Parameter name="AddInvLocationChain" value="ADD_INVENTORY_LOCATION" />
    </Op>
    <OpChainRoute chainKey="EDIT_INVENTORY_LOCATION" chainType="START" />
  </OpChain>
  <OpChain name="ADD_INVENTORY_LOCATION">
    <Op class="dtv.pos.inventory.locationmaint.AddInventoryLocationOp" />
    <OpChainRoute chainKey="EDIT_INVENTORY_LOCATION" chainType="START" />
  </OpChain>
  <OpChain name="EDIT_INVENTORY_LOCATION" rollbackLevel="80">
    <Op class="dtv.pos.inventory.locationmaint.EditInventoryLocationOp" />
  </OpChain>
  <OpChain name="DELETE_INVENTORY_LOCATION">
    <ValidationOp validationsBean="deleteInventoryLocationRules" />
    <PromptOp class="dtv.pos.inventory.locationmaint.PromptDeleteInventoryLocationOp" />
    <OpChainRoute chainKey="INVENTORY_LOCATION_SEARCH" chainType="START" />
  </OpChain>
  <OpChain name="PRINT_ITEM_LIST_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="ITEM_LIST_REPORT" />
    </Op>
    <Op class="dtv.pos.inventory.op.SetItemListReportParamsOp" />
    <Op class="dtv.pos.reporting.fill.FillReportOp" />
    <Op class="dtv.pos.reporting.print.PrintReportOp">
      <Parameter name="continueOnError" value="true" />
    </Op>
  </OpChain>
  <OpChain name="INVENTORY_LOCATION_SUMMARY_COUNT" rollbackLevel="50">
    <Op class="dtv.pos.inventory.count.summary.LocationSummaryCountOp" />
  </OpChain>
  <OpChain name="COMPLETE_INVENTORY_LOCATION_SUMMARY_COUNT">
    <WorkerOp workersBean="processSummaryCountWorkers" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>
  <OpChain name="SETUP_INVENTORY_ITEM_TRANSFER">
    <Op class="dtv.pos.inventory.movement.PromptItemTransferSourceOp">
      <Parameter name="formMessage" value="_itemTransferFromLocationMessage" />
      <Parameter name="availabilityCode" value="TRANSFER_FROM" />
    </Op>
    <Op class="dtv.pos.inventory.lookup.PromptInventoryLocationBucketOp" breakpoint="true">
      <Parameter name="formMessage" value="_itemTransferToLocationMessage" />
      <Parameter name="availabilityCode" value="TRANSFER_TO" />
    </Op>
    <ValidationOp validationsBean="itemTransferDestinationRules" />
    <PromptOp class="dtv.pos.inventory.movement.PromptItemTransferReasonOp" />
    <Op class="dtv.pos.inventory.movement.SetupItemTransferOp" />
    <OpChainRoute chainKey="INVENTORY_ITEM_TRANSFER" chainType="START" />
  </OpChain>
  <OpChain name="INVENTORY_ITEM_TRANSFER" rollbackChainKey="PROMPT_ROLLBACK_ITEM_TRANSFER" rollbackLevel="60" contextKey="ITEM_TRANSFER">
    <PromptOp class="dtv.pos.inventory.movement.PromptTransferItemScanOp" contextKey="ITEM_TRANSFER" validationsBean="itemTransferItemRules" breakpoint="true" />
    <PromptOp class="dtv.pos.inventory.movement.PromptTransferItemSerialNumberOp" validationsBean="serialNumberInvDocRules" />
    <Op class="dtv.pos.inventory.movement.MatchItemAgainstSourceLocationOp" />
    <PromptOp class="dtv.pos.inventory.movement.PromptTransferItemQtyOp" validationsBean="itemTransferQtyRules" />
    <ValidationOp class="dtv.pos.inventory.movement.ValidateTransferItemQtyOp" validationsBean="itemTransferQtyRules" />
  </OpChain>
  <OpChain name="PROMPT_ROLLBACK_ITEM_TRANSFER">
    <PromptOp class="dtv.pos.common.op.PromptConfiguredRollbackOp" key="CANCEL_ITEM_TRANSFER">
      <Parameter name="rollbackChain" value="CANCEL_INVENTORY" />
    </PromptOp>
  </OpChain>
  <OpChain name="ITEM_TRANSFER_ALL_ITEMS">
    <PromptOp class="dtv.pos.inventory.movement.PromptTransferAllItemsOp" />
  </OpChain>
  <OpChain name="ITEM_TRANSFER_SEARCH_ITEM">
    <PromptOp class="dtv.pos.inventory.op.PromptSimpleItemScanOp" key="ITEM_TRANSFER_ITEM_SCAN_SEARCH" validationsBean="itemTransferItemRules"/>
    <Op class="dtv.pos.inventory.movement.SearchTransferItemOp" />
    <Op class="dtv.pos.inventory.movement.SelectTransferItemOp" />
  </OpChain>
  <OpChain name="ITEM_TRANSFER_CHANGE_QUANTITY">
    <Op class="dtv.pos.inventory.movement.GetSelectedTransferItemOp" />
    <PromptOp class="dtv.pos.inventory.movement.PromptTransferItemChangeQtyOp" validationsBean="itemTransferChangeQtyRules" />
  </OpChain>
  <OpChain name="ITEM_TRANSFER_VOID_ITEM">
    <Op class="dtv.pos.inventory.movement.GetSelectedTransferItemOp" />
    <Op class="dtv.pos.inventory.movement.VoidTransferItemOp" />
  </OpChain>
  <OpChain name="ITEM_TRANSFER_PRINT_LIST">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="ITEM_LIST_REPORT" />
    </Op>
    <Op class="dtv.pos.inventory.movement.SetTransferItemListReportParamsOp" />
    <Op class="dtv.pos.reporting.fill.FillReportOp" />
    <Op class="dtv.pos.reporting.print.PrintReportOp">
      <Parameter name="continueOnError" value="true" />
    </Op>
  </OpChain>
  <OpChain name="ITEM_TRANSFER_SAVE" signal="InventoryOperationsComplete,TransactionComplete">
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="ITEM_TRANSFER_SAVE" />
    <Op class="dtv.pos.inventory.movement.CreateItemTransferDocumentOp" />
    <WorkerOp workersBean="saveItemTransferWorkers" />
    <Op class="dtv.pos.inventory.movement.PrintItemTransferReportOp" />
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>
  <OpChain name="PRINT_ITEM_MOVEMENT_REPORT">
    <!-- JASPER REMOVE -->
    <!--<Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="INVENTORY_MOVEMENT_REPORT" />
    </Op>
    <Op class="dtv.pos.inventory.movement.SetItemTransferReportParamsOp" />
    <Op class="dtv.pos.reporting.fill.FillReportOp" />
    <Op class="dtv.pos.reporting.print.PrintReportOp">
      <Parameter name="continueOnError" value="true" />
    </Op>-->
  </OpChain>
  <OpChain name="SETUP_MOVEMENT_PENDING_RECONCILIATION">
    <Op class="dtv.pos.inventory.movement.SetupMovementPendingReconciliationOp" longRunning="true" />
    <OpChainRoute chainKey="MOVEMENT_PENDING_RECONCILIATION" chainType="START" />
  </OpChain>
  <OpChain name="MOVEMENT_PENDING_RECONCILIATION" rollbackChainKey="PROMPT_ROLLBACK_MOVEMENT_PENDING_RECONCILIATION" rollbackLevel="60">
    <PromptOp class="dtv.pos.inventory.movement.DisplayMovementPendingReconciliationOp" />
  </OpChain>
  <OpChain name="PROMPT_ROLLBACK_MOVEMENT_PENDING_RECONCILIATION">
    <PromptOp class="dtv.pos.common.op.PromptConfiguredRollbackOp" key="CANCEL_MOVEMENT_PENDING_RECONCILIATION">
      <Parameter name="rollbackChain" value="CANCEL_INVENTORY" />
    </PromptOp>
  </OpChain>
  <OpChain name="MOVEMENT_PENDING_VIEW_DETAIL">
    <Op class="dtv.pos.inventory.movement.ViewMovementPendingDetailOp" />
  </OpChain>
  <OpChain name="MOVEMENT_PENDING_RECONCILE_ITEM">
    <Op class="dtv.pos.inventory.movement.SetItemToReconcileOp" />
    <ValidationOp validationsBean="movementPendingLocExistsRules" />
    <Op class="dtv.pos.inventory.movement.DetermineReconcileInventoryLocationOp">
      <Parameter name="selectionRequired" value="true" />
    </Op>
    <ValidationOp class="dtv.pos.inventory.movement.ValidateReconcileSerialNumberOp" validationsBean="pedingSerialItemRules" />
    <PromptOp class="dtv.pos.inventory.movement.PromptReconcileQuantityOp" validationsBean="pendingLocationQtyRules" />
  </OpChain>
  <OpChain name="MOVEMENT_PENDING_SEARCH_ITEM">
    <PromptOp class="dtv.pos.inventory.op.PromptSimpleItemScanOp" key="ITEM_TRANSFER_ITEM_SCAN_SEARCH" breakpoint="true" />
    <Op class="dtv.pos.inventory.movement.SearchMovementPendingItemOp" />
    <Op class="dtv.pos.inventory.movement.SelectMovementPendingItemOp" />
  </OpChain>
  <OpChain name="MOVEMENT_PENDING_PRE_CHANGE_QUANTITY">
    <Op class="dtv.pos.inventory.movement.GetSelectedMovementItemOp" />
    <ValidationOp validationsBean="movementPendingLocExistsRules" />
    <PromptOp class="dtv.pos.inventory.movement.PromptReconcileChangeQuantityOp" validationsBean="pendingLocationChangeQtyRules" />
    <Op class="dtv.pos.inventory.movement.InventoryLocationMovementChangeWhileOp">
      <Parameter name="ChainKey" value="MOVEMENT_PENDING_CHANGE_QUANTITY" />
    </Op>
  </OpChain>
  <OpChain name="MOVEMENT_PENDING_CHANGE_QUANTITY">
    <Op class="dtv.pos.inventory.movement.DetermineReconcileInventoryLocationOp">
      <Parameter name="selectionRequired" value="true" />
    </Op>
    <PromptOp class="dtv.pos.inventory.movement.PromptReconcileQuantityOp" validationsBean="pendingLocationQtyAllocateRules">
      <Parameter name="ChangeQuantity" value="true" />
    </PromptOp>
  </OpChain>
  <OpChain name="MOVEMENT_PENDING_VOID_ITEM">
    <Op class="dtv.pos.inventory.movement.GetSelectedMovementItemOp" />
    <Op class="dtv.pos.inventory.movement.VoidMovementPendingItemOp" />
  </OpChain>
  <OpChain name="MOVEMENT_PENDING_SAVE" signal="InventoryOperationsComplete,TransactionComplete">
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="MOVEMENT_PENDING_SAVE" />
    <Op class="dtv.pos.inventory.movement.UpdateReconciledStatusesOp" />
    <Op class="dtv.pos.inventory.movement.CreateMovementPendingTransactionOp" />
    <Op class="dtv.pos.inventory.NewProcessInventoryOp" /> <!-- TODO:REPLACE OP WITH WORKER FROM XFG-CLIENT PROJECT-->
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <Op class="dtv.pos.inventory.movement.PrintMovementPendingReconciliationReportOp" />
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>
  <OpChain name="PRINT_MOVEMENT_PENDING_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="INVENTORY_MOVEMENT_PENDING" />
    </Op>
    <Op class="dtv.pos.reporting.fill.FillReportOp" />
    <Op class="dtv.pos.reporting.print.PrintReportOp">
      <Parameter name="continueOnError" value="true" />
    </Op>
  </OpChain>
  <OpChain name="OPCHAIN_ROLLBACK">
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>

  <!-- Start 183583 -->
  <!-- Remote Workstation Count and Close -->

  <!--START_REMOTE_WORKSTATION_CLOSE-->
  <OpChain name="START_REMOTE_WORKSTATION_CLOSE" contextKey="WORKSTATION_CLOSE">
    <ValidationOp validationsBean="closeWorkstationRules" />
    <PromptOp class="dtv.pos.systemcycle.close.PromptToCloseOp" key="START_CLOSE_REMOTE_WORKSTATION" />
    <OpChainRoute chainKey="TR_WORKSTATION_CLOSE_CHECK" />
    <!-- link to chain to open drawer and start till audit -->
    <OpChainRoute chainKey="START_TILL_AUDIT" />
    <Op class="dtv.pos.systemcycle.questions.PromptCycleQuestionsOp">
      <Parameter name="QuestionType" value="START_REMOTE_WORKSTATION_CLOSE" />
    </Op>
    <Op class="dtv.pos.systemcycle.workstation.CreateStartRemoteCloseTransactionOp" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
    <PromptOp class="dtv.pos.hardware.op.WaitForCashDrawerCloseOp" validationsBean="cashDrawerCloseRules" />
    <OpChainRoute chainKey="RETURN_TO_LOGIN" />
  </OpChain>

  <!--START_TILL_AUDIT-->
  <OpChain name="START_TILL_AUDIT" contextKey="WORKSTATION_CLOSE">
    <Op class="dtv.pos.till.CheckCurrentSessionStatusOp">
      <Parameter name="AcceptedStatus" value="BEGINCOUNT" />
    </Op>
    <Op class="dtv.pos.hardware.op.AlwaysOpenCashDrawerOp" />
    <!-- link to chain to print till summary receipt -->
    <OpChainRoute chainKey="PRINT_TILL_SUMMARY" />
  </OpChain>

  <!-- PRINT_TILL_SUMMARY -->
  <OpChain name="PRINT_TILL_SUMMARY_FROM_MENU">
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="PRINT_TILL_SUMMARY_CONFIRM" />
    <OpChainRoute chainKey="PRINT_TILL_SUMMARY" />
  </OpChain>
  <OpChain name="PRINT_TILL_SUMMARY">
    <OpChainRoute chainKey="PRE_TRANS_TILL_VALIDATION" />
    <Op class="dtv.pos.till.BuildTillSummaryBeanOp" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
  </OpChain>

  <!--COMPLETE_REMOTE_WORKSTATION_CLOSE-->
  <OpChain name="COMPLETE_REMOTE_WORKSTATION_CLOSE">
    <Op class="dtv.pos.systemcycle.common.PromptRemoteCloseWorkstationOp" breakpoint="true" />
    <PromptOp class="dtv.pos.systemcycle.workstation.PromptToRemoteCloseOp" key="COMPLETE_CLOSE_REMOTE_WORKSTATION" />
    <Op class="dtv.pos.systemcycle.common.HandleRemoteCloseWorkstationOp" />
    <Op class="dtv.pos.systemcycle.workstation.CreateCompleteRemoteCloseTransactionOp" />
    <Op class="dtv.pos.systemcycle.close.RestoreCurrentWorkstationSessionOp" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
  </OpChain>

  <!-- closing count-->
  <OpChain name="REMOTE_CLOSING_COUNT_LOGIC" signal="TransactionComplete">
    <Op class="dtv.pos.till.count.PromptTillCountOp" breakpoint="true" />
    <Op class="dtv.pos.till.count.PromptClosingDepositAmountsOp">
      <Parameter name="ChainKey" value="PROMPT_CLOSING_DEPOSIT" />
    </Op>
    <Op class="dtv.pos.till.count.CreateTillEndCountObjectsOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <Op class="dtv.pos.till.UpdateRemoveDrawerFromCurrentWkstnOp" />
    <OpChainRoute chainKey="PRINT_RECEIPTS" />
  </OpChain>
  <!-- End 183583 -->

  <!-- Start 183581 -->
  <OpChain name="SPECIAL_ORDER_ACCT_MAINT" rollbackLevel="20" contextKey="BACK_OFFICE_MAIN_MENU">
    <Op class="dtv.pos.customer.account.op.InitCustAcctTypeOp">
      <Parameter name="TYPE" value="SPECIAL_ORDER" />
    </Op>
    <Op class="dtv.pos.register.specorder.account.SpecialOrderMaintSearchOp" />
    <OpChainRoute chainKey="SPECIAL_ORDER_MAINT_DETAIL" chainType="START" />
  </OpChain>

  <OpChain name="SPECIAL_ORDER_MAINT_DETAIL" rollbackLevel="30" contextKey="SPECIAL_ORDER">
    <Op class="dtv.pos.customer.account.op.ViewCustAccountOp" breakpoint="true">
      <Parameter name="ChainKey" value="SPECIAL_ORDER_ACCT_MAINT" />
      <Parameter name="FormKey" value="SPECIAL_ORDER_MAINTENANCE" />
    </Op>
  </OpChain>

  <OpChain name="SPECIAL_ORDER_MAINT_CANCEL_ORDER">
    <PromptOp class="dtv.pos.customer.account.op.PromptCustomerPresentForCancelOp">
      <Parameter name="location" value="back_office" />
    </PromptOp>
    <ValidationOp validationsBean="specialOrderAllowEscrowRules" />
    <Op class="dtv.pos.register.specorder.account.PromptCancelSpecOrderAccountOp" />
    <Op class="dtv.pos.customer.account.op.CreateEscrowTransactionOp" />
    <Op class="dtv.pos.customer.account.op.EscrowCustAcctOp" />
    <Op class="dtv.pos.customer.account.op.CompleteEscrowTransactionOp" />
    <Op class="dtv.pos.common.PersistObjectsOp" />
    <Op class="dtv.pos.giftregistry.op.ReturnSpecOrderAccountDetailsOp" />
    <Op class="dtv.pos.customer.account.op.ConfirmEscrowAccountOp" />
    <OpChainRoute chainKey="PRE_SPECIAL_ORDER_MAINT_DETAIL" chainType="START" />
  </OpChain>

  <OpChain name="SPECIAL_ORDER_MAINTENANCE_ADD_COMMENT">
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountCommentOp" validationsBean="commentRules" />
    <Op class="dtv.pos.customer.account.op.RefreshCustAccountCommentOp" />
    <Op class="dtv.pos.common.LogPersistablesOp" longRunning="true" />
    <Op class="dtv.pos.common.PersistObjectsOp" />
  </OpChain>
  <!-- End 183581 -->

  <!-- Start GDC 204556-->
  <OpChain name="OPEN_SUPPORT_TICKET">
    <Op class="dtv.pos.errorscreen.PromptErrorInfoOp" />
    <WorkerOp workersBean="reportErrorWorkers" />
  </OpChain>

  <OpChain name="OPEN_SUPPORT_TICKET_AUTOMATIC">
    <WorkerOp workersBean="automaticReportErrorWorkers" />
  </OpChain>
  <!-- End GDC 204556 -->

  <OpChain name="STORE_LAYOUT_MAINTENANCE_SETUP">
    <PromptOp class="dtv.pos.inventory.storelayout.StoreLayoutMaintenanceSetupOp" />
    <OpChainRoute chainKey="STORE_LAYOUT_MAINTENANCE" chainType="START" />
  </OpChain>
  <OpChain name="STORE_LAYOUT_MAINTENANCE" rollbackLevel="40" rollbackChainKey="PROMPT_CANCEL_STORE_LAYOUT_CHANGES">
    <PromptOp class="dtv.pos.inventory.storelayout.DisplayStoreLayoutMaintenanceOp" />
  </OpChain>
  <OpChain name="STORE_LAYOUT_ADD_SECTION">
    <PromptOp class="dtv.pos.inventory.storelayout.PromptAddSectionOp" validationsBean="storeLayoutAddSectionRules" />
  </OpChain>
  <OpChain name="STORE_LAYOUT_REMOVE_SECTION">
    <PromptOp class="dtv.pos.inventory.storelayout.GetSelectedSectionOp" key="STORE_LAYOUT_MAINT_REMOVE_SECTION" validationsBean="storeLayoutSelectSectionRules" />
    <Op class="dtv.pos.inventory.storelayout.RemoveSectionOp" />
  </OpChain>
  <OpChain name="STORE_LAYOUT_ADD_MERCH_LEVEL">
    <PromptOp class="dtv.pos.inventory.storelayout.GetSelectedSectionOp" key="STORE_LAYOUT_SELECT_SECTION_ADD_LEVEL" validationsBean="storeLayoutSelectSectionRules" />
    <Op class="dtv.pos.inventory.storelayout.SelectMerchLevelOp">
      <Parameter name="MessageKey" value="_storeLayoutMaintMerchLevelMessage" />
    </Op>
    <ValidationOp validationsBean="duplicateSectionDetailRules" />
    <WorkerOp workersBean="storeLayoutAddDetailWorkers" />
  </OpChain>
  <OpChain name="STORE_LAYOUT_ADD_ITEM">
    <PromptOp class="dtv.pos.inventory.storelayout.GetSelectedSectionOp" key="STORE_LAYOUT_SELECT_SECTION_ADD_ITEM" validationsBean="storeLayoutSelectSectionRules" />
    <PromptOp class="dtv.pos.inventory.storelayout.PromptStoreLayoutItemScanOp" validationsBean="inventoryCountAddItemRules" />
    <ValidationOp validationsBean="duplicateSectionDetailRules" />
    <WorkerOp workersBean="storeLayoutAddDetailWorkers" />
  </OpChain>
  <OpChain name="STORE_LAYOUT_REMOVE_SECTION_DETAIL">
    <PromptOp class="dtv.pos.inventory.storelayout.RemoveSectionDetailOp" validationsBean="storeLayoutSelectSectionDetailRules" />
  </OpChain>
  <OpChain name="STORE_LAYOUT_MOVE_SECTION_UP">
    <Op class="dtv.pos.inventory.storelayout.MoveSectionOp">
      <Parameter name="Direction" value="UP" />
    </Op>
  </OpChain>
  <OpChain name="STORE_LAYOUT_MOVE_SECTION_DOWN">
    <Op class="dtv.pos.inventory.storelayout.MoveSectionOp">
      <Parameter name="Direction" value="DOWN" />
    </Op>
  </OpChain>
  <OpChain name="STORE_LAYOUT_SAVE_CHANGES">
    <PromptOp class="dtv.pos.inventory.storelayout.PromptSaveStoreLayoutOp" />
    <Op class="dtv.pos.inventory.storelayout.SaveChangesOp" />
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>
  <OpChain name="STORE_LAYOUT_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="STORE_LAYOUT" />
    </Op>
    <Op class="dtv.pos.inventory.storelayout.SetStoreLayoutReportDataSourceOp" />
    <Op class="dtv.pos.reporting.fill.FillReportOp" />
    <Op class="dtv.pos.reporting.DisplayReportOp" />
  </OpChain>
  <OpChain name="PROMPT_CANCEL_STORE_LAYOUT_CHANGES">
    <PromptOp class="dtv.pos.inventory.storelayout.PromptCancelLayoutChangesOp" />
    <OpChainRoute chainKey="CANCEL_INVENTORY" chainType="START" />
  </OpChain>

  <OpChain name="INVENTORY_COUNT_SEARCH" rollbackLevel="30">
    <Op class="dtv.pos.inventory.count.InventoryCountSearchOp" />
    <OpChainRoute chainKey="INVENTORY_COUNT_SETUP" chainType="START" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_CREATE">
    <ValidationOp validationsBean="inventoryCountCreateRules" />
    <Op class="dtv.pos.inventory.count.CreateInventoryCountOp" />
    <!-- These chains for creating specific count types are not to be used independently of the
      general INVENTORY_COUNT_CREATE chain.   The specific chains merely contain additional steps
      that need to be taken that are specific to the count type being created.  One of these
      chains will run as part of the count creation process depending on the count type.
      Working around the nuances of chain navigation is why so many small count creation chains
      exist and run for certain count types before you actually get to the main count screen. -->
    <OpChainRoute>
      <Choice chainKey="PHYSICAL_COUNT_CREATE">
        <Condition class="dtv.pos.inventory.count.IsCountType">
          <Parameter name="CountType" value="PHYSICAL_COUNT" />
        </Condition>
      </Choice>
      <Choice chainKey="CYCLE_COUNT_CREATE">
        <Condition class="dtv.pos.inventory.count.IsCountType">
          <Parameter name="CountType" value="CYCLE_COUNT" />
        </Condition>
      </Choice>
      <Choice chainKey="SUPPLY_COUNT_CREATE">
        <Condition class="dtv.pos.inventory.count.IsCountType">
          <Parameter name="CountType" value="SUPPLY_COUNT" />
        </Condition>
      </Choice>
    </OpChainRoute>
  </OpChain>
  <OpChain name="PHYSICAL_COUNT_CREATE">
    <OpChainRoute chainKey="INVENTORY_COUNT_SETUP" chainType="START" />
  </OpChain>
  <OpChain name="CYCLE_COUNT_CREATE">
    <Op class="dtv.pos.inventory.count.CycleCountItemsSetupOp" />
    <OpChainRoute chainKey="CYCLE_COUNT_ITEMS" chainType="START" />
  </OpChain>
  <!--  The chain CYCLE_COUNT_ITEMS below is purposefully set with the same rollback level as
        INVENTORY_COUNT_MAIN.  Once you proceed from the process of building the item list for
        a cycle count, you should not be able to get back to it. -->
  <OpChain name="CYCLE_COUNT_ITEMS" rollbackLevel="40" rollbackChainKey="CYCLE_COUNT_ITEMS_CANCEL" contextKey="INVENTORY_CYCLE_COUNT">
    <PromptOp class="dtv.pos.inventory.count.PromptCycleCountItemScanOp" validationsBean="inventoryCountAddItemRules" breakpoint="true" />
    <ValidationOp class="dtv.pos.inventory.count.ValidateDetailNotOnCycleCountOp" validationsBean="cycleCountAddDetailRules" />
  </OpChain>
  <OpChain name="CYCLE_COUNT_HIERARCHY_LEVEL">
    <Op class="dtv.pos.inventory.storelayout.SelectMerchLevelOp">
      <Parameter name="MessageKey" value="_invCycleCountAddHierarchyMessage" />
    </Op>
    <ValidationOp class="dtv.pos.inventory.count.ValidateDetailNotOnCycleCountOp" validationsBean="cycleCountAddDetailRules" />
  </OpChain>
  <OpChain name="CYCLE_COUNT_ITEMS_REMOVE_ITEM">
    <PromptOp class="dtv.pos.inventory.count.GetAndRemoveSelectedCycleCountItemOp" />
  </OpChain>
  <OpChain name="CYCLE_COUNT_ITEMS_SAVE">
    <ValidationOp validationsBean="cycleCountSizeRules" />
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="CYCLE_COUNT_ITEMS_SAVE" />
    <Op class="dtv.pos.inventory.count.GenerateCycleCountDetailsOp" />
    <OpChainRoute chainKey="INVENTORY_COUNT_SETUP" chainType="START" />
  </OpChain>
  <OpChain name="CYCLE_COUNT_ITEMS_CANCEL">
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="CYCLE_COUNT_ITEMS_CANCEL" />
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>
  <OpChain name="SUPPLY_COUNT_CREATE">
    <Op class="dtv.pos.inventory.count.GenerateSupplyCountDetailsOp" />
    <OpChainRoute chainKey="INVENTORY_COUNT_SETUP" chainType="START" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_SETUP">
    <Op class="dtv.pos.inventory.count.InventoryCountSetupOp" />
    <OpChainRoute chainKey="INVENTORY_COUNT_MAIN" chainType="START" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_ROLLBACK_TO_MAIN_SCREEN">
    <OpChainRoute chainKey="INVENTORY_COUNT_MAIN" chainType="START" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_MAIN" rollbackLevel="40" rollbackChainKey="INVENTORY_COUNT_CANCEL_CHANGES" contextKey="INVENTORY_COUNT">
    <Op class="dtv.pos.inventory.count.DisplayInventoryCountMainOp" />
    <PromptOp class="dtv.pos.inventory.count.GetSelectedCountSheetOp" validationsBean="inventoryCountSelectSingleSheetRules" breakpoint="true" />
    <OpChainRoute chainType="START">
      <Choice chainKey="INVENTORY_COUNT_MAINTAIN_SHEET" condition="dtv.pos.inventory.count.CountSheetModeIsEnabled" />
      <Choice chainKey="INVENTORY_COUNT_MAINTAIN_MOBILE" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="INVENTORY_COUNT_GENERATE_COUNT_SHEETS">
    <Op class="dtv.pos.inventory.count.BuildCountSheetGenerationDataOp" />
    <ValidationOp validationsBean="inventoryCountGenerateSheetsRules" />
    <Op class="dtv.pos.inventory.count.ValidatePhysicalCountSizeOp" longRunning="true">
      <Parameter name="LongRunningMessage" value="_invCountBusyDeterminingSize" />
    </Op>
    <WorkerOp class="dtv.pos.inventory.count.GenerateCountWorkOp" workersBean="inventoryCountGenerateWorkers" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_INITIATE">
    <ValidationOp validationsBean="inventoryCountInitiateRules" />
    <WorkerOp workersBean="inventoryCountInitiateWorkers" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_PRINT_SINGLE_SHEET">
    <Op class="dtv.pos.inventory.count.GetCountSheetToActionOp" />
    <OpChainRoute chainKey="INVENTORY_COUNT_PRINT_SHEET" />
    <WorkerOp workersBean="inventoryCountPostPrintWorkers" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_PRINT_MULTIPLE_SHEETS">
    <PromptOp class="dtv.pos.inventory.count.PromptCountSheetListOp" validationsBean="inventoryCountSelectMultipleSheetsRules">
      <Parameter name="AcceptedStatus" value="PRELIMINARY" />
      <Parameter name="AcceptedStatus" value="PRINTED" />
      <Parameter name="AcceptedStatus" value="SAVED" />
      <Parameter name="AcceptedStatus" value="SUBMITTED" />
    </PromptOp>
    <PromptOp class="dtv.pos.inventory.count.PromptConfirmMultipleSheetsOp" key="INVENTORY_COUNT_PRINT_MULTIPLE_SHEETS" />
    <Op class="dtv.pos.inventory.count.ActOnCountSheetsWhileOp" longRunning="true">
      <Parameter name="ChainKey" value="INVENTORY_COUNT_PRINT_SHEET" />
    </Op>
    <WorkerOp workersBean="inventoryCountPostPrintWorkers" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_PRINT_SHEET">
    <Op class="dtv.pos.inventory.count.UpdateCountSheetStatusOp">
      <Parameter name="NewStatus" value="PRINTED" />
      <Parameter name="IgnoreWhen" value="SAVED" />
      <Parameter name="IgnoreWhen" value="SUBMITTED" />
    </Op>
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="INVENTORY_COUNT_SHEET" />
    </Op>
    <Op class="dtv.pos.inventory.count.SetCountSheetReportDataSourceOp" />
    <Op class="dtv.pos.reporting.fill.FillReportNoUiOp" />
    <Op class="dtv.pos.reporting.print.PrintReportOp">
      <Parameter name="continueOnError" value="false" />
    </Op>
  </OpChain>
  <OpChain name="INVENTORY_COUNT_SUBMIT_SINGLE_SHEET">
    <Op class="dtv.pos.inventory.count.GetCountSheetToActionOp" />
    <ValidationOp class="dtv.pos.inventory.count.ValidateCountSheetSubmissionOp" validationsBean="inventoryCountSubmitSheetRules" />
    <PromptOp class="dtv.pos.inventory.count.PromptSubmitUncountedSheetsOp" key="INVENTORY_COUNT_SUBMIT_UNCOUNTED_SHEETS" />
    <WorkerOp workersBean="submitCountSheetsAutoProcessingWorkers" class="dtv.pos.inventory.count.SubmitSheetsForAutoVariancesOp" />
    <Op class="dtv.pos.inventory.count.SubmitSheetsForManualRecountOp">
      <Parameter name="ChainKey" value="INVENTORY_COUNT_MANUAL_SUBMIT_SHEET" />
    </Op>
    <WorkerOp workersBean="saveInventoryCountWorkers" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_SUBMIT_MULTIPLE_SHEETS">
    <PromptOp class="dtv.pos.inventory.count.PromptCountSheetListOp" key="INVENTORY_COUNT_SELECT_SUBMIT_SHEETS" validationsBean="inventoryCountSelectMultipleSheetsRules">
      <Parameter name="AcceptedStatus" value="PRELIMINARY" />
      <Parameter name="AcceptedStatus" value="PRINTED" />
      <Parameter name="AcceptedStatus" value="SAVED" />
    </PromptOp>
    <PromptOp class="dtv.pos.inventory.count.PromptConfirmMultipleSheetsOp" key="INVENTORY_COUNT_SUBMIT_MULTIPLE_SHEETS" />
    <PromptOp class="dtv.pos.inventory.count.PromptSubmitUncountedSheetsOp" key="INVENTORY_COUNT_SUBMIT_UNCOUNTED_SHEETS" />
    <WorkerOp workersBean="submitCountSheetsAutoProcessingWorkers" class="dtv.pos.inventory.count.SubmitSheetsForAutoVariancesOp" />
    <Op class="dtv.pos.inventory.count.SubmitSheetsForManualRecountOp">
      <Parameter name="ChainKey" value="INVENTORY_COUNT_MANUAL_SUBMIT_SHEET" />
    </Op>
    <WorkerOp workersBean="saveInventoryCountWorkers" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_MANUAL_SUBMIT_SHEET">
    <Op class="dtv.pos.inventory.count.UpdateCountSheetStatusOp">
      <Parameter name="NewStatus" value="SUBMITTED" />
    </Op>
    <PromptOp class="dtv.pos.inventory.count.PromptCountSheetsToRecountOp" validationsBean="manualRecountSheetsRules" />
    <WorkerOp workersBean="inventoryCountManualRecountWorkers" class="dtv.pos.inventory.count.GenerateManualRecountSheetsOp" longRunning="true"/>
    <PromptOp class="dtv.pos.inventory.count.NotifyCountCompleteOp" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_VIEW_VARIANCE_REPORTS">
    <PromptOp class="dtv.pos.inventory.count.PromptVarianceReportListOp" />
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="ReportName" value="INVENTORY_COUNT_VARIANCE" />
    </Op>
    <Op class="dtv.pos.inventory.count.SetVarianceReportDataSourceOp" longRunning="true" />
    <Op class="dtv.pos.reporting.fill.FillReportOp" />
    <Op class="dtv.pos.reporting.DisplayReportOp">
      <Parameter name="NoDataMessage" value="_invCountVarianceReportNoData" />
    </Op>
  </OpChain>
  <OpChain name="INVENTORY_COUNT_COMPLETE_COUNT" signal="TransactionComplete">
    <Op class="dtv.pos.inventory.count.BuildFinalizedCountDataOp" longRunning="true">
      <Parameter name="LongRunningMessage" value="_invCountBusyBuildingFinalData" />
    </Op>
    <WorkerOp workersBean="inventoryCountCompleteWorkers" />
    <PromptOp class="dtv.pos.inventory.count.NotifyFinalVariancesNotProcessedOp" />
    <PromptOp key="INVENTORY_COUNT_FINAL_PROCESSING_COMPLETE" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_CANCEL_COUNT">
    <PromptOp class="dtv.pos.inventory.count.PromptCancelCountOp" />
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_MAINTAIN_SHEET" rollbackLevel="50" rollbackChainKey="INVENTORY_COUNT_SHEET_CANCEL_CHANGES" contextKey="INVENTORY_COUNT_SHEET">
    <Op class="dtv.pos.inventory.count.DisplayInventoryCountSheetOp" />
    <PromptOp class="dtv.pos.inventory.count.PromptCountSheetItemQuantityOp" validationsBean="inventoryCountSheetItemRules" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_MAINTAIN_MOBILE" rollbackLevel="50" rollbackChainKey="INVENTORY_COUNT_SHEET_CANCEL_CHANGES" contextKey="INVENTORY_COUNT_SHEET">
    <Op class="dtv.pos.inventory.count.DisplayInventoryCountSheetOp" />
    <PromptOp class="dtv.pos.inventory.count.PromptCountItemScanOp" key="INVENTORY_COUNT_MOBILE_ITEM_SCAN" validationsBean="inventoryCountScanItemRules" breakpoint="true" />
    <Op class="dtv.pos.inventory.count.MatchItemAgainstCountSheetOp" />
    <ValidationOp validationsBean="inventoryCountSheetItemRules" />
    <PromptOp class="dtv.pos.inventory.count.PromptInventoryCountItemQuantityOp" validationsBean="inventoryCountItemQuantityRules" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_SHEET_PAGE_UP">
    <Op class="dtv.pos.inventory.count.MoveCountSheetPageOp">
      <Parameter name="MoveAction" value="-1" />
    </Op>
  </OpChain>
  <OpChain name="INVENTORY_COUNT_SHEET_PAGE_DOWN">
    <Op class="dtv.pos.inventory.count.MoveCountSheetPageOp">
      <Parameter name="MoveAction" value="+1" />
    </Op>
  </OpChain>
  <OpChain name="INVENTORY_COUNT_SHEET_FIRST_PAGE">
    <Op class="dtv.pos.inventory.count.MoveCountSheetPageOp">
      <Parameter name="MoveAction" value="-1000000" />
    </Op>
  </OpChain>
  <OpChain name="INVENTORY_COUNT_SHEET_LAST_PAGE">
    <Op class="dtv.pos.inventory.count.MoveCountSheetPageOp">
      <Parameter name="MoveAction" value="+1000000" />
    </Op>
  </OpChain>
  <OpChain name="INVENTORY_COUNT_SHEET_ADD_ITEM">
    <PromptOp class="dtv.pos.inventory.op.PromptSimpleItemScanOp" validationsBean="inventoryCountAddItemRules" breakpoint="true" />
    <Op class="dtv.pos.inventory.count.MatchItemAgainstCountSheetForAddOp" />
    <PromptOp class="dtv.pos.inventory.count.PromptNewCountSheetItemQuantityOp" validationsBean="itemQuantityRules" />
    <Op class="dtv.pos.inventory.count.AddCountSheetItemOp" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_SHEET_ITEM_CHANGE_QTY">
    <PromptOp class="dtv.pos.inventory.op.GetSelectedInventoryCountItemOp" />
    <PromptOp class="dtv.pos.inventory.count.PromptInventoryCountChangeItemQuantityOp" validationsBean="inventoryCountChangeItemQuantityRules" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_SHEET_SAVE_CHANGES">
    <PromptOp class="dtv.pos.inventory.count.PromptExitCountSheetOp" key="INVENTORY_COUNT_SAVE_CHANGES_QUESTION" />
    <Op class="dtv.pos.inventory.count.SaveCountSheetChangesOp" />
    <WorkerOp workersBean="saveInventoryCountWorkers" />
    <OpChainRoute chainKey="INVENTORY_COUNT_ROLLBACK_TO_MAIN_SCREEN" chainType="START" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_SHEET_CANCEL_CHANGES">
    <PromptOp class="dtv.pos.inventory.count.PromptExitCountSheetOp" key="CANCEL_INVENTORY" />
    <OpChainRoute chainKey="INVENTORY_COUNT_ROLLBACK_TO_MAIN_SCREEN" chainType="START" />
  </OpChain>
  <OpChain name="INVENTORY_COUNT_CANCEL_CHANGES" signal="InventoryOperationsCancelled">
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>

  <OpChain name="SHOW_DASHBOARD" contextKey="DASHBOARD" rollbackLevel="30">
    <Op class="dtv.pos.reporting.dashboard.DisplayDashboardOp" />
  </OpChain>

  <OpChain name="EMPLOYEE_MESSAGE_SEARCH" rollbackLevel="30">
    <Op class="dtv.pos.employee.message.MessageSearchOp" />
    <OpChainRoute chainKey="EMPLOYEE_MESSAGE_MAINTENANCE" chainType="START" />
  </OpChain>
  <OpChain name="EMPLOYEE_MESSAGE_MAINTENANCE">
    <Op class="dtv.pos.employee.message.MaintainMessageOp" />
  </OpChain>
  <OpChain name="DELETE_EMPLOYEE_MESSAGE">
    <PromptOp class="dtv.pos.employee.message.PromptDeleteSelectedMessageOp" />
  </OpChain>
  <OpChain name="REGISTER_TILL_OPTIONS_MENU">
    <Op class="dtv.pos.framework.op.ForceMenuSelectionOp" contextKey="REGISTER_TILL_OPTIONS_MENU" />
  </OpChain>
  <OpChain name="INITIALIZE_BACKGROUND_PROCESSES"/>
  <OpChain name="INITIALIZE_REFRESH_PROMOTIONS_PROCESSES">
    <Op class="dtv.pos.register.refreshpromotions.RefreshPromotionsStartupOp" />
  </OpChain>
  <OpChain name="GUEST_LOOKUP" />
  <OpChain name="POSTVOID_GUEST_LOOKUP" />
  <OpChain name="VOID_ROOM_CHARGE" />

  <OpChain name="FINGERPRINT_FINGER_SELECTION">
    <Op class="dtv.pos.hardware.biometric.fingerprint.op.SelectEnrollIndexOp" />
  </OpChain>

  <OpChain name="PRINT_EMAIL_RECEIPTS">
    <Op class="dtv.pos.email.receipt.SetCurrentCustomerEmailForRcptsOp" />
    <OpChainRoute chainKey="SALE_COMPLETE" />
  </OpChain>

  <OpChain name="EMAIL_RECEIPTS">
    <Op class="dtv.pos.email.receipt.EmailAddressPromptOp" />
    <Op class="dtv.pos.email.receipt.UpdateCustomerEmailAddressOp" />
    <OpChainRoute chainKey="SALE_COMPLETE" />
  </OpChain>

  <!-- 344027: Inventory Replenishment -->
  <OpChain name="PERSIST_LINKED_REPLENISHMENT_ORDER_IMPL" signal="TransactionComplete">
    <Op class="dtv.pos.inventory.replenishment.op.CreateLinkedReplenishmentOrderTransactionOp" />
    <Op class="dtv.pos.common.PersistCurrentTransactionOp" />
  </OpChain>
  <OpChain name="INVENTORY_REPLENISHMENT_SEARCH" rollbackLevel="30">
    <Op class="dtv.pos.inventory.replenishment.op.ReplenishmentSearchOp" />
    <Op class="dtv.pos.inventory.replenishment.op.SetDefaultSourceIdOp" />
    <OpChainRoute chainKey="INVENTORY_REPLENISHMENT_SETUP" chainType="START" />
  </OpChain>
  <OpChain name="REPLENISHMENT_NEW_ORDER">
    <Op class="dtv.pos.inventory.replenishment.op.CreateNewReplenishmentOp" />
    <OpChainRoute chainKey="INVENTORY_REPLENISHMENT_SETUP" chainType="START" />
  </OpChain>
  <OpChain name="INVENTORY_REPLENISHMENT_SETUP">
    <Op class="dtv.pos.inventory.replenishment.op.ReplenishmentSetupOp" />
    <OpChainRoute chainKey="REPLENISHMENT_ITEM_ENTRY" chainType="START" />
  </OpChain>
  <OpChain name="REPLENISHMENT_ITEM_ENTRY" rollbackLevel="40" rollbackChainKey="PROMPT_CANCEL_REPLENISHMENT_CHANGES">
    <Op class="dtv.pos.inventory.replenishment.op.RefreshInventoryMainOp" />
    <PromptOp class="dtv.pos.inventory.replenishment.op.PromptReplenishmentItemScanOp" breakpoint="true" validationsBean="itemIdRules" />
    <OpChainRoute chainKey="REPLENISHMENT_ITEM_ENTRY_POST" />
  </OpChain>
  <OpChain name="REPLENISHMENT_ITEM_ENTRY_AFTER_LOOKUP">
    <Op class="dtv.pos.inventory.replenishment.op.RefreshInventoryMainOp" />
    <OpChainRoute chainKey="REPLENISHMENT_ITEM_ENTRY_POST" />
  </OpChain>
  <OpChain name="REPLENISHMENT_ITEM_ENTRY_POST">
    <ValidationOp validationsBean="inventoryReplenishmentItemValidationRules" />
    <PromptOp class="dtv.pos.inventory.replenishment.op.PromptForQuantityOp" validationsBean="replenishmentQuantityRules" breakpoint="true" />
    <OpChainRoute chainKey="REPLENISHMENT_ITEM_VALIDATE" />
    <Op class="dtv.pos.inventory.replenishment.op.AddReplenishmentLineItemOp" />
  </OpChain>
  <OpChain name="REPLENISHMENT_ITEM_VALIDATE">
    <Op class="dtv.pos.inventory.replenishment.op.ReplenishmentDisplayItemInfoOp" />
    <PromptOp class="dtv.pos.inventory.replenishment.op.ConfirmLargeQuantityOp" />
    <PromptOp class="dtv.pos.inventory.replenishment.op.PromptQuantityDifferentThanMultipleOfPacksOp" />
  </OpChain>
  <OpChain name="PROMPT_CANCEL_REPLENISHMENT_CHANGES">
    <PromptOp class="dtv.pos.inventory.op.PromptRollbackInventoryOp" key="CANCEL_REPLENISHMENT_CHANGES">
      <Parameter name="RollbackChain" value="CANCEL_INVENTORY" />
    </PromptOp>
  </OpChain>
  <OpChain name="INVENTORY_REPLENISHMENT_SAVE_CHANGES" signal="TransactionComplete">
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="REPLENISHMENT_SAVE_CHANGES" />
    <Op class="dtv.pos.inventory.replenishment.op.SaveChangesOp" />
    <OpChainRoute chainKey="SIMPLE_COMPLETE_TRANSACTION" />
    <Op class="dtv.pos.common.PersistCurrentTransactionOp" />
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />

  </OpChain>
  <OpChain name="REPLENISHMENT_CHANGE_QUANTITY">
    <PromptOp class="dtv.pos.inventory.replenishment.op.GetSelectedInventoryLineItemOp" validationsBean="modifyLineItemRules" />
    <PromptOp class="dtv.pos.inventory.replenishment.op.PromptForQuantityOp" validationsBean="replenishmentQuantityRules" breakpoint="true" />
    <OpChainRoute chainKey="REPLENISHMENT_ITEM_VALIDATE" />
    <Op class="dtv.pos.inventory.replenishment.op.SetNewQuantityOp" />
  </OpChain>
  <OpChain name="REPLENISHMENT_DELETE_ITEM">
    <PromptOp class="dtv.pos.inventory.replenishment.op.GetSelectedInventoryLineItemOp" validationsBean="modifyLineItemRules" />
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="REPLENISHMENT_DELETE_ITEM" />
    <Op class="dtv.pos.inventory.replenishment.op.DeleteItemOp" />
  </OpChain>
  <OpChain name="REPLENISHMENT_EDIT_REASON_CODE">
    <PromptOp class="dtv.pos.inventory.replenishment.op.GetSelectedInventoryLineItemOp" validationsBean="modifyLineItemRules" />
    <PromptOp class="dtv.pos.inventory.replenishment.op.PromptReplenishmentItemReasonOp" validationsBean="commentRules" />
    <Op class="dtv.pos.inventory.replenishment.op.SaveReplenishmentItemReasonOp" />
  </OpChain>
  <OpChain name="REPLENISHMENT_DELETE_REASON_CODE">
    <PromptOp class="dtv.pos.inventory.replenishment.op.GetSelectedInventoryLineItemOp" validationsBean="modifyLineItemRules"/>
    <PromptOp class="dtv.pos.inventory.replenishment.op.DeleteLineCommentOp" />
  </OpChain>
  <OpChain name="REPLENISHMENT_EDIT_SOURCE">
    <PromptOp class="dtv.pos.inventory.replenishment.op.GetSelectedInventoryLineItemOp" validationsBean="modifyLineItemRules"/>
    <PromptOp class="dtv.pos.inventory.replenishment.op.ListItemSourcesOp" />
  </OpChain>
  <OpChain name="REPLENISHMENT_HEADER_COMMENTS">
    <PromptOp class="dtv.pos.inventory.replenishment.op.PromptReplenishmentHeaderReasonOp" />
    <PromptOp class="dtv.pos.inventory.replenishment.op.PromptAskAddHeaderReasonCommentOp" />
    <PromptOp class="dtv.pos.inventory.replenishment.op.PromptHeaderReasonCommentsOp" />
    <Op class="dtv.pos.inventory.replenishment.op.SaveReplenishmentHeaderCommentsOp" />
  </OpChain>
  <OpChain name="REPLENISHMENT_DELETE_HEADER_COMMENT">
    <PromptOp class="dtv.pos.inventory.replenishment.op.DeleteHeaderCommentOp" />
  </OpChain>
  <OpChain name="REPLENISHMENT_NON_MERCHANDISE">
    <PromptOp class="dtv.pos.inventory.replenishment.op.DisplayNonMerchandiseOptionsListOp" />
    <PromptOp class="dtv.pos.inventory.replenishment.op.DisplayNonMerchandiseItemsOp" />
    <PromptOp class="dtv.pos.inventory.replenishment.op.PromptForQuantityOp" validationsBean="replenishmentQuantityRules" breakpoint="true" />
    <OpChainRoute chainKey="REPLENISHMENT_ITEM_VALIDATE" />
    <Op class="dtv.pos.inventory.replenishment.op.AddReplenishmentLineItemOp" />
  </OpChain>
  <OpChain name="REPLENISHMENT_CANCEL_ORDER" signal="TransactionCancelled">
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="CONFIRM_CANCEL_ORDER" />
    <Op class="dtv.pos.inventory.replenishment.op.CancelReplenishmentOrderOp" />
    <Op class="dtv.pos.common.PersistCurrentTransactionOp" />
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>
  <OpChain name="REPLENISHMENT_FORCE_CLOSE_ORDER">
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="CONFIRM_FORCE_CLOSE_ORDER" />
    <Op class="dtv.pos.inventory.replenishment.op.ForceCloseReplenishmentOrderOp" />
    <Op class="dtv.pos.inventory.replenishment.op.LinkedReplenishmentOrdersTransactionIteratingOp">
      <Parameter name="ChainKey" value="PERSIST_LINKED_REPLENISHMENT_ORDER_IMPL" />
    </Op>
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>
  <OpChain name="REPLENISHMENT_REQUEST_DETAIL_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="REPLENISHMENT_PRODUCT_DETAIL_REPORT" />
    </Op>
    <Op class="dtv.pos.inventory.replenishment.op.FillReplenishmentDetailReportParametersOp" />
    <Op class="dtv.pos.reporting.fill.FillReportOp" />
    <Op class="dtv.pos.reporting.print.PrintReportOp">
      <Parameter name="continueOnError" value="false" />
    </Op>
  </OpChain>
  <OpChain name="REPLENISHMENT_ORDER_WORKSHEET_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="REPLENISHMENT_ORDER_WORKSHEET_REPORT" />
    </Op>
    <Op class="dtv.pos.inventory.replenishment.op.SetReplenishmentWorksheetReportDatasourceOp" />
    <Op class="dtv.pos.reporting.fill.FillReportOp" />
    <Op class="dtv.pos.reporting.print.PrintReportOp">
      <Parameter name="continueOnError" value="false" />
    </Op>
  </OpChain>
  <OpChain name="REPLENISHMENT_SUBMIT_ORDER" signal="TransactionComplete">
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="REPLENISHMENT_CONFIRM_ORDER_SUBMIT" />
    <Op class="dtv.pos.inventory.replenishment.op.SubmitReplenishmentOrderOp" />
    <Op class="dtv.pos.inventory.replenishment.op.CreateMockShippingReceivingDocsOp" />
    <OpChainRoute chainKey="SIMPLE_COMPLETE_TRANSACTION" />
    <OpChainRoute chainKey="REPLENISHMENT_SUBMIT_ASK_PRINT_REQUEST" />
    <Op class="dtv.pos.framework.op.OpChainRollbackOp" />
  </OpChain>
  <OpChain name="REPLENISHMENT_SUBMIT_ASK_PRINT_REQUEST">
    <PromptOp class="dtv.pos.inventory.replenishment.op.AskPrintRequestDetailsOp" />
  </OpChain>
  <OpChain name="REPLENISHMENT_PRODUCT_REQUEST_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="REPLENISHMENT_PRODUCT_DETAIL_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true">
      <Parameter name="DisplayChain" value="REPLENISHMENT_PRODUCT_REQUEST_REPORT_DISPLAY" />
      <Parameter name="PrintChain" value="REPLENISHMENT_PRODUCT_REQUEST_REPORT_PRINT" />
      <Parameter name="SaveChain" value="REPLENISHMENT_PRODUCT_REQUEST_REPORT_SAVE" />
    </Op>
  </OpChain>
  <OpChain name="REPLENISHMENT_PRODUCT_REQUEST_REPORT_DISPLAY">
    <Op class="dtv.pos.inventory.replenishment.op.FillReplenishmentDetailReportParametersOp" />
    <OpChainRoute chainKey="REPORT_FILL_AND_DISPLAY"/>
  </OpChain>
  <OpChain name="REPLENISHMENT_PRODUCT_REQUEST_REPORT_PRINT">
    <Op class="dtv.pos.inventory.replenishment.op.FillReplenishmentDetailReportParametersOp" />
    <OpChainRoute chainKey="REPORT_FILL_AND_PRINT"/>
  </OpChain>
  <OpChain name="REPLENISHMENT_PRODUCT_REQUEST_REPORT_SAVE">
    <Op class="dtv.pos.inventory.replenishment.op.FillReplenishmentDetailReportParametersOp" />
    <OpChainRoute chainKey="REPORT_SAVE"/>
  </OpChain>
  <OpChain name="REPLENISHMENT_OPEN_PRODUCT_REQUESTS_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="REPLENISHMENT_OPEN_PRODUCT_REQUESTS_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.fill.FillReportOp" />
    <Op class="dtv.pos.reporting.DisplayReportOp" breakpoint="true" />
  </OpChain>

  <!-- /344027: Inventory Replenishment -->

  <!-- 345640: Stock Valuation - change to be the menu option chain for change/edit item cost -->
  <OpChain name="RECEIVE_CHANGE_COST">
    <PromptOp class="dtv.pos.inventory.op.GetSelectedInventoryItemOp" validationsBean="selectedInventoryItemRules" />
    <PromptOp class="dtv.pos.inventory.op.PromptInventoryItemCostOp" validationsBean="receivingItemChangeCostRules" />
  </OpChain>

  <!-- Reports for Stock Valuation -->
  <OpChain name="FIFO_STOCK_VALUATION_REPORT">
    <Op class="dtv.pos.reporting.stockvaluation.PopulateFIFOTablesOp" />
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="FIFO_STOCK_VALUATION_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="WAC_STOCK_VALUATION_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="WAC_STOCK_VALUATION_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <OpChain name="PWAC_STOCK_VALUATION_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="PWAC_STOCK_VALUATION_REPORT" />
    </Op>
    <Op class="dtv.pos.reporting.PromptReportParametersOp" breakpoint="true" />
  </OpChain>
  <!-- / 345640: Stock Valuation -->

  <OpChain name="PRE_PRESALE_CHAIN" signal="TransactionModified" rollbackChainKey="BACKTO_SALE_ITEM" rollbackLevel="30">
    <Op class="dtv.pos.customer.account.op.InitCustAcctTypeOp">
      <Parameter name="TYPE" value="PRESALE" />
    </Op>
    <OpChainRoute chainKey="PRE_CUSTOMER_ACCOUNT_CHAIN" />
  </OpChain>

  <OpChain name="PRE_ONHOLD_CHAIN" signal="TransactionModified" rollbackChainKey="BACKTO_SALE_ITEM" rollbackLevel="30">
    <Op class="dtv.pos.customer.account.op.InitCustAcctTypeOp">
      <Parameter name="TYPE" value="ONHOLD" />
    </Op>
    <OpChainRoute chainKey="PRE_CUSTOMER_ACCOUNT_CHAIN" />
  </OpChain>

  <OpChain name="PRE_CUSTOMER_ACCOUNT_CHAIN">
    <Op class="dtv.pos.register.cca.op.InjectConfigurableCustomerAccountInfoOp" />
    <Op class="dtv.pos.register.cca.op.CustomerAccountRegisterSearchOp">
      <Parameter name="STATUS" value="OPEN" />
      <Parameter name="STATUS" value="READY_TO_PICKUP" />
    </Op>
    <Op class="dtv.pos.customer.AddCustToTransactionOp" />
    <OpChainRoute chainKey="CUSTOMER_ACCOUNT_CHAIN" chainType="START" />
  </OpChain>

  <OpChain name="CUSTOMER_ACCOUNT_CHAIN" rollbackChainKey="CUSTOMER_ACCOUNT_FINISH" rollbackLevel="40">
    <Op class="dtv.pos.register.cca.op.InjectConfigurableCustomerAccountInfoOp" />
    <OpChainRoute chainKey="DISPLAY_CUSTOMER_ACCOUNT_SCREEN" />
    <Op class="dtv.pos.register.cca.op.PromptCustomerAccountOptionsOp" />
  </OpChain>

  <OpChain name="CUSTOMER_ACCOUNT_FINISH" signal="TransactionModified">
    <Op class="dtv.pos.customer.account.op.ValidateNewCustAcctOp" />
    <OpChainRoute chainKey="CUSTOMER_ACCOUNT_DEPOSIT" />
    <Op class="dtv.pos.customer.account.op.CompleteCustomerAccountOp" />
    <OpChainRoute chainKey="BACKTO_SALE_ITEM" chainType="START" />
  </OpChain>

  <OpChain name="ADD_NEW_CUSTOMER_ACCOUNT">
    <Op class="dtv.pos.customer.EnsureCustomerAssignedOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustomerAccountOp" />
  </OpChain>

  <OpChain name="ADD_NEW_CUSTOMER_ACCOUNT_ITEM">
    <OpChainRoute chainKey="DISPLAY_CUSTOMER_ACCOUNT_SCREEN" />
    <PromptOp class="dtv.pos.register.cca.op.PromptCCAItemScanOp" />
    <Op class="dtv.pos.register.cca.op.item.CCACheckItemNotOnFileOp" />
    <ValidationOp validationsBean="ccaItemRules" />
    <OpChainRoute chainKey="CUSTOMER_ACCOUNT_ITEM_AFTER_LOOKUP" />
  </OpChain>
  <OpChain name="CUSTOMER_ACCOUNT_ITEM_AFTER_LOOKUP">
    <OpChainRoute chainKey="CUSTOMER_ACCOUNT_ITEM_ID_VALIDATE" />
    <Op class="dtv.pos.register.cca.op.item.RouteCCAItemOp" />
    <OpChainRoute chainKey="SELECT_WARRANTY_PLANS_SETUP" />
    <Op class="dtv.pos.warranty.common.RunCoveredLineItemChainOp">
      <Parameter name="ChainKey" value="CUSTOMER_ACCOUNT_WARRANTY_FINISH" />
    </Op>
    <!-- <OpChainRoute chainKey="CUSTOMER_ACCOUNT_CHAIN" chainType="START" /> -->
  </OpChain>

  <OpChain name="CUSTOMER_ACCOUNT_WARRANTY_FINISH" signal="TransactionModified">
    <Op class="dtv.pos.warranty.common.WarrantyItemIteratingOp">
      <Parameter name="ChainKey" value="CUSTOMER_ACCOUNT_WARRANTY_FINISH_ITERABLE" />
    </Op>
  </OpChain>
  <OpChain name="CUSTOMER_ACCOUNT_WARRANTY_FINISH_ITERABLE">
    <OpChainRoute chainKey="CUSTOMER_ACCOUNT_WARRANTY_SETUP" />
    <Op class="dtv.pos.warranty.common.CCACreateWarrantyLineOp">
      <Parameter name="RETURN_MODE" value="false" />
      <Parameter name="FORCE_ZERO_EXT_PRICE" value="true" />
    </Op>
    <Op class="dtv.pos.warranty.common.SetupWarrantyLineAsCurrentOp" />
    <Op class="dtv.pos.warranty.common.RunWarrantyItemChainOp">
      <Parameter name="ChainKey" value="CUSTOMER_ACCOUNT_WARRANTY_FINISH_IMPL" />
    </Op>
  </OpChain>
  <OpChain name="CUSTOMER_ACCOUNT_WARRANTY_FINISH_IMPL">
    <OpChainRoute chainKey="ADD_CUSTOMER_ACCOUNT_ITEM_FINISH" />
    <OpChainRoute chainKey="CREATE_WARRANTY" />
    <Op class="dtv.pos.customer.account.op.RefreshCustomerAcctDetailOp" />
  </OpChain>
  <OpChain name="CUSTOMER_ACCOUNT_WARRANTY_SETUP">
    <Op class="dtv.pos.warranty.common.SetupWarrantyParamsOp">
      <Parameter name="WARRANTY_STATUS_CODE" value="PENDING" />
      <Parameter name="WARRANTY_BEING_ISSUED" value="false" />
    </Op>
  </OpChain>

  <OpChain name="ADD_CUSTOMER_ACCOUNT_ITEM_FINISH" signal="TransactionModified">
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.shippingfee.EnsureSingleShippingFeeLineItemOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <Op class="dtv.pos.customer.account.op.AddCustomerAccountModifierOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <WorkerOp workersBean="addTransDiscountsToNewItemWorkers" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.register.cca.op.item.CreateCustomerItemAccountDetailOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctActivityOp" />
  </OpChain>

  <OpChain name="CUSTOMER_ACCOUNT_PRE_TENDERING">
    <Op class="dtv.pos.customer.account.op.ValidateNewCustAcctPreTenderOp" />
    <OpChainRoute chainKey="CUSTOMER_ACCOUNT_DEPOSIT" />
    <Op class="dtv.pos.customer.account.op.CompleteCustomerAccountOp" />
    <Op class="dtv.pos.register.UpdateCurrentTransListOp" />
    <OpChainRoute chainKey="PRE_TENDERING" chainType="START" />
  </OpChain>

  <OpChain name="DISPLAY_CUSTOMER_ACCOUNT_SCREEN">
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
  </OpChain>

  <OpChain name="CUSTOMER_ACCOUNT_ITEM_ID_VALIDATE">
    <ValidationOp validationsBean="ccaItemRules" />
    <Op class="dtv.pos.register.cca.op.item.CreateCCALineItemOp" />
    <Op class="dtv.pos.register.cca.op.item.CCACheckCustAcctStyleLookupOp" />
    <PromptOp class="dtv.pos.register.sale.PromptForItemWeightOp" validationsBean="itemWeightRules" />
    <Op class="dtv.pos.register.PromptBirthDateScanOp" />
    <Op class="dtv.pos.register.MinimumAgeValidationOp" />
    <PromptOp class="dtv.pos.register.PromptItemDescriptionOp" validationsBean="itemDescriptionRules" />
    <PromptOp class="dtv.pos.register.PromptItemQuantityOp" validationsBean="saleItemQuantityRules" />
    <ValidationOp class="dtv.pos.register.ValidateItemQtyWithoutPromptQtyOp" validationsBean="saleItemQtyNoPromptRules" />
    <ValidationOp validationsBean="allowedItemQtyRules" />
    <Op class="dtv.pos.kits.CreateKitOp" />
    <Op class="dtv.pos.register.cca.op.InventoryLocationWhileOp">
      <Parameter name="ChainKey" value="CUSTOMER_ACCOUNT_ALLOCATE_QUANTITY" />
    </Op>
    <Op class="dtv.pos.register.modifyitem.UpdateChangedQuantityOp" />
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountItemSerialNumberOp" validationsBean="serialNumberSaleRules" />
    <Op class="dtv.pos.register.ItemPropertyPromptOp" />
    <Op class="dtv.pos.register.PromptItemPriceOp" />
  </OpChain>

  <!-- Void CCA Item -->
  <OpChain name="VOID_CUSTOMER_ACCOUNT_ITEM" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" validationsBean="custAccountItemVoidRules" />
    <Op class="dtv.pos.pricing.discount.ConfirmGroupDiscountItemVoidOp" />
    <Op class="dtv.pos.register.PromptVoidLineItemReasonCodeOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="CANCEL" />
    </Op>
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.customer.account.op.UpdateVoidCustAcctItemOp" />
    <Op class="dtv.pos.pricing.discount.VoidGroupDiscountOp">
      <Parameter name="ChainKey" value="VOID_CUSTOMER_ACCOUNT_DISCOUNT_MAIN" />
    </Op>
    <OpChainRoute chainKey="DISPLAY_CUSTOMER_ACCOUNT_SCREEN" />
  </OpChain>

  <OpChain name="VOID_CUSTOMER_ACCOUNT_LINE_ITEM_TOUCH" signal="TransactionModified">
    <ValidationOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemFromTouchOp" validationsBean="custAccountItemVoidRules" />
    <Op class="dtv.pos.pricing.discount.ConfirmGroupDiscountItemVoidOp" />
    <Op class="dtv.pos.register.PromptVoidLineItemReasonCodeOp" />
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="CANCEL" />
    </Op>
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.customer.account.op.UpdateVoidCustAcctItemOp" />
    <Op class="dtv.pos.pricing.discount.VoidGroupDiscountOp">
      <Parameter name="ChainKey" value="VOID_CUSTOMER_ACCOUNT_DISCOUNT_MAIN" />
    </Op>
    <OpChainRoute chainKey="DISPLAY_CUSTOMER_ACCOUNT_SCREEN" />
  </OpChain>

  <OpChain name="VOID_CUSTOMER_ACCOUNT_DISCOUNT_MAIN">
    <Op class="dtv.pos.customer.account.op.VoidCustomerAccountDiscountOp" />
    <Op class="dtv.pos.customer.account.op.RouteChangeDiscountOp">
      <Parameter name="ItemLevelChainKey" value="VOID_CUSTOMER_ACCOUNT_LINE_ITEM_DISCOUNT" />
      <Parameter name="GroupLevelChainKey" value="VOID_CUSTOMER_ACCOUNT_GROUP_DISCOUNT" />
    </Op>
  </OpChain>

  <OpChain name="VOID_CUSTOMER_ACCOUNT_LINE_ITEM_DISCOUNT">
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
  </OpChain>

  <OpChain name="VOID_CUSTOMER_ACCOUNT_GROUP_DISCOUNT">
    <Op class="dtv.pos.pricing.discount.ModifyGroupDiscountCustAcctItemsOp">
      <Parameter name="ChainKey" value="CREATE_CUSTOMER_ACCOUNT_GROUP_DISCOUNT_MODIFICATION" />
      <Parameter name="VoidGroupDiscount" value="true" />
    </Op>
  </OpChain>

  <OpChain name="CREATE_CUSTOMER_ACCOUNT_GROUP_DISCOUNT_MODIFICATION">
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp">
      <Parameter name="CreateActivity" value="false" />
    </Op>
  </OpChain>

  <OpChain name="VOID_CUSTOMER_ACCOUNT_DISCOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.GetCurrentCustAcctDiscountOp" validationsBean="changeDiscountRules" />
    <OpChainRoute chainKey="VOID_CUSTOMER_ACCOUNT_DISCOUNT_MAIN" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
  </OpChain>

  <OpChain name="CUSTOMER_ACCOUNT_ALLOCATE_QUANTITY">
    <Op class="dtv.pos.register.cca.op.CCADetermineInventoryLocationOp">
      <Parameter name="SetupMode" value="true" />
    </Op>
    <PromptOp class="dtv.pos.register.cca.op.PromptCCALocationQuantityOp" validationsBean="itemLocationQuantityRules">
      <Parameter name="SetupMode" value="true" />
    </PromptOp>
  </OpChain>

  <OpChain name="ADD_CUSTOMER_ACCOUNT_ITEM">
    <OpChainRoute chainKey="ADD_CUSTOMER_ACCOUNT_ITEM_FINISH" />
  </OpChain>
  <OpChain name="CUSTOMER_ACCOUNT_DEPOSIT">
    <PromptOp class="dtv.pos.register.cca.op.PromptDepositAmountOp" validationsBean="depositAmountRules" />
    <Op class="dtv.pos.register.cca.op.CheckMaxCustomerAccountDepositOp" />
    <ValidationOp class="dtv.pos.register.cca.op.ValidateCCADepositAmountOp" validationsBean="maxDepositAmountRules" />
  </OpChain>

  <OpChain name="CUSTOMER_ACCOUNT_PICKUP_ITEM" signal="TransactionModified">
    <PromptOp class="dtv.pos.register.cca.op.pickup.ListPickableItemsOp" />
    <Op class="dtv.pos.register.cca.op.pickup.ForcePickupAllOp" />
    <Op class="dtv.pos.register.cca.op.pickup.ForcePickupAllAssociatedOp" />
    <Op class="dtv.pos.register.cca.op.pickup.ProcessPickedItemsOp" />
    <Op class="dtv.pos.customer.account.op.PickedItemsInventoryLocationWhileOp">
      <Parameter name="ChainKey" value="PROCESS_PICKED_CCA_ITEMS_INVENTORY" />
    </Op>
    <Op class="dtv.pos.register.SaleReturnLineIteratingOp">
      <Parameter name="ChainKey" value="CUSTOMER_ACCOUNT_PICKUP_ITEM_VALIDATE" />
    </Op>
    <Op class="dtv.pos.customer.account.op.UpdateItemStatusPickedOp" />
    <Op class="dtv.pos.warranty.common.WarrantyTransIteratingOp">
      <Parameter name="ChainKey" value="ISSUE_WARRANTIES" />
    </Op>    
    <OpChainRoute chainKey="SALE_TAXING" condition="dtv.pos.customer.account.condition.CustomerAccountCreditAsReturnRunCondition"/>  
    <Op class="dtv.pos.register.cca.op.pickup.AddPickupTenderOp" />    
  </OpChain>

  <OpChain name="PROCESS_PICKED_CCA_ITEMS_INVENTORY">
    <Op class="dtv.pos.inventory.op.InventoryLocationWhileOp">
      <Parameter name="ChainKey" value="CCA_PICKUP_ALLOCATE_QUANTITY" />
    </Op>
  </OpChain>

  <OpChain name="CUSTOMER_ACCOUNT_PICKUP_ITEM_VALIDATE">
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountItemSerialNumberOp" validationsBean="serialNumberSaleRules">
      <Parameter name="CANCELLABLE" value="false" />
    </PromptOp>
  </OpChain>

  <OpChain name="ADD_CUSTOMER_ACCOUNT_PICKUP_TENDER">
    <Op class="dtv.pos.register.cca.op.item.CreateCustomerItemAccountDetailOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctActivityOp" />
    <OpChainRoute chainKey="CUSTOMER_ACCOUNT_CHAIN" chainType="START" />
  </OpChain>

  <OpChain name="CCA_PICKUP_ALLOCATE_QUANTITY">
    <Op class="dtv.pos.register.cca.op.CCADetermineInventoryLocationOp" />
    <PromptOp class="dtv.pos.register.cca.op.PromptCCALocationQuantityOp" validationsBean="itemLocationQuantityRules" />
  </OpChain>

  <OpChain name="ADD_CUST_ACCT_ITEM_FINISH" signal="TransactionModified">
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.common.PersistTranInProcessOp" />
  </OpChain>

  <OpChain name="DEACTIVATE_CUSTOMER">
    <PromptOp class="dtv.pos.customer.PromptConfirmDeactivateCustomerOp" />
  </OpChain>

  <OpChain name="CANCEL_CUSTOMER_ACCOUNT" signal="TransactionModified">
    <Op class="dtv.pos.register.cca.op.CancelCustomerAccountConfirmationOp" />
    <PromptOp class="dtv.pos.register.cca.op.PromptCCACustomerPresentOp">
      <Parameter name="location" value="register" />
    </PromptOp>
    <Op class="dtv.pos.common.op.DisablePromptActionsOp" />
    <Op class="dtv.pos.register.cca.op.CancelConfigurableCustomerAccountOp" />
    <OpChainRoute chainKey="ISSUE_CUSTOMER_ACCOUNT_REFUND" />
    <Op class="dtv.pos.customer.account.op.CompleteCustomerAccountOp" />
    <Op class="dtv.pos.customer.account.op.AddCancelledAccountToPersistablesBagOp" />
    <Op class="dtv.pos.register.UpdateCurrentTransListOp" />
    <OpChainRoute chainKey="SALE_ITEM_START" chainType="START" />
  </OpChain>
  <OpChain name="CANCEL_CUSTOMER_ACCOUNT_ITEM">
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.customer.account.op.UpdateVoidCustAcctItemOp">
      <Parameter name="detailStateCode" value="CANCEL" />
    </Op>
  </OpChain>
  <OpChain name="ISSUE_CUSTOMER_ACCOUNT_REFUND">
    <Op class="dtv.pos.register.cca.op.CreateCustomerAccountRefundItemOp" />
  </OpChain>

  <OpChain name="CHANGE_CUSTOMER_ACCOUNT_ITEM_PRICE_TOUCH">
    <ValidationOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemFromTouchOp" validationsBean="custAccountChangePriceRules" />
    <OpChainRoute chainKey="CHANGE_CUSTOMER_ACCOUNT_ITEM_PRICE_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_CUSTOMER_ACCOUNT_ITEM_PRICE">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" validationsBean="custAccountChangePriceRules" />
    <OpChainRoute chainKey="CHANGE_CUSTOMER_ACCOUNT_ITEM_PRICE_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_CUSTOMER_ACCOUNT_ITEM_PRICE_IMPL" signal="TransactionModified">
    <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_PRICE" />
    </Op>
    <Op class="dtv.pos.register.modifyitem.PromptItemPriceChangeOp" />
    <Op class="dtv.pos.register.modifyitem.PromptPriceChangeReasonCodeOp" />
    <Op class="dtv.pos.register.VoidAllDiscountsOp" />
    <OpChainRoute chainKey="CHANGE_CUSTOMER_ACCOUNT_ITEM_PRICE_FINISH" />
    <OpChainRoute chainKey="DISPLAY_CUSTOMER_ACCOUNT_SCREEN" />
    <OpChainRoute chainKey="POST_CHANGE_CUSTOMER_ACCOUNT_ITEM_PRICE" chainType="START" />
  </OpChain>

  <OpChain name="CHANGE_CUSTOMER_ACCOUNT_ITEM_PRICE_FINISH" signal="TransactionModified">
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
  </OpChain>
  <OpChain name="POST_CHANGE_CUSTOMER_ACCOUNT_ITEM_PRICE" signal="TransactionModified">
    <OpChainRoute chainKey="UPDATE_WARRANTY_CUSTOMER_ACCOUNT_PRICE" />
  </OpChain>
  <OpChain name="UPDATE_WARRANTY_CUSTOMER_ACCOUNT_PRICE">
    <Op class="dtv.pos.warranty.common.SetupWarrantyItemDataOp">
      <Parameter name="CLEAR_ITEM" value="false" />
    </Op>
    <Op class="dtv.pos.warranty.common.WarrantyLineIteratingOp">
      <Parameter name="ChainKey" value="UPDATE_WARRANTY_CUSTOMER_ACCOUNT_PRICE_IMPL" />
    </Op>
  </OpChain>
  <OpChain name="UPDATE_WARRANTY_CUSTOMER_ACCOUNT_PRICE_IMPL">
    <Op class="dtv.pos.warranty.common.SetupWarrantyPriceAsCurrentOp" />
    <OpChainRoute chainKey="CHANGE_CUSTOMER_ACCOUNT_ITEM_PRICE_FINISH" />
  </OpChain>

  <OpChain name="CHANGE_CUSTOMER_ACCOUNT_ITEM_QUANTITY_TOUCH">
    <ValidationOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemFromTouchOp" validationsBean="custAccountChangeQuantityRules" />
    <OpChainRoute chainKey="CHANGE_CUSTOMER_ACCOUNT_ITEM_QUANTITY_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_CUSTOMER_ACCOUNT_ITEM_QUANTITY">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" validationsBean="custAccountChangeQuantityRules" />
    <OpChainRoute chainKey="CHANGE_CUSTOMER_ACCOUNT_ITEM_QUANTITY_IMPL" />
  </OpChain>
  <OpChain name="CHANGE_CUSTOMER_ACCOUNT_ITEM_QUANTITY_IMPL" signal="TransactionModified">
     <Op class="dtv.pos.customer.account.op.UpdateCustAcctActivityCodeOp">
      <Parameter name="CODE" value="MODIFY_QUANTITY" />
    </Op>
    <PromptOp class="dtv.pos.register.modifyitem.PromptItemQuantityChangeOp" validationsBean="custAcctQuantityRules" />
    <Op class="dtv.pos.kits.UpdateKitComponentModifiersQtyOp" />
    <Op class="dtv.pos.inventory.op.InventoryLocationChangeWhileOp">
      <Parameter name="ChainKey" value="CUSTOMER_ACCOUNT_ALLOCATE_QUANTITY" />
    </Op>
    <OpChainRoute chainKey="CHANGE_CUSTOMER_ACCOUNT_ITEM_QUANTITY_FINISH"/>
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
    <OpChainRoute chainKey="POST_CHANGE_CUSTOMER_ACCOUNT_ITEM_QUANTITY" chainType="START"/>
  </OpChain>

  <OpChain name="ADD_CUSTOMER_ACCOUNT_COUPON" signal="TransactionModified">
    <PromptOp class="dtv.pos.coupon.PromptCouponOp" validationsBean="couponIdRules" />
    <ValidationOp class="dtv.pos.register.cca.op.discount.LookupCustomerAccountCouponOp" validationsBean="couponVerificationRules" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp" />
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
  </OpChain>
  <OpChain name="ROUTE_CUSTOMER_ACCOUNT_DISCOUNT">
    <Op class="dtv.pos.register.cca.op.discount.RouteCustomerAccountDiscountOp" />
  </OpChain>
  <OpChain name="CUSTOMER_ACCOUNT_LINE_ITEM_DISCOUNT">
    <ValidationOp validationsBean="discountRules" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountReasonOp" />
    <PromptOp class="dtv.pos.pricing.discount.PromptForAmountPercentOp" validationsBean="lineItemDiscountRules" />
    <Op class="dtv.pos.pricing.discount.ValidateDiscountCompatibilityOp" />
    <PromptOp class="dtv.pos.pricing.discount.PromptDiscountSerialNumberOp" validationsBean="nonNullSerialNumberRules" />
    <Op class="dtv.pos.pricing.discount.AddPriceModifierToTransactionOp" />
    <Op class="dtv.pos.pricing.discount.PlayDiscountSoundOp" />
    <Op class="dtv.pos.pricing.discount.DisplayDiscountPromptOp" />
  </OpChain>
  <OpChain name="ADD_CUSTOMER_ACCOUNT_DISCOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" />
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountDiscountOp">
      <Parameter name="ApplicationMethodCode" value="LINE_ITEM" />
    </PromptOp>
    <Op class="dtv.pos.register.cca.op.discount.RouteCustomerAccountDiscountOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp">
      <Parameter name="CreateActivity" value="false" />
    </Op>
    <Op class="dtv.pos.customer.account.op.DisplayCustAcctMsgFormOp" />
    <OpChainRoute chainKey="POST_ADD_CUSTOMER_ACCOUNT_DISCOUNT" />
  </OpChain>
  <OpChain name="ADD_WORK_ORDER_DISCOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.GetSelectedCustAcctItemOp" />
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountDiscountOp">
      <Parameter name="ApplicationMethodCode" value="LINE_ITEM" />
    </PromptOp>
    <Op class="dtv.pos.register.cca.op.discount.RouteCustomerAccountDiscountOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemUponModificationOp">
      <Parameter name="CreateActivity" value="false" />
    </Op>
    <Op class="dtv.pos.workorder.account.DisplayWorkOrderAcctFormOp" />
    <OpChainRoute chainKey="POST_ADD_CUSTOMER_ACCOUNT_DISCOUNT" />
  </OpChain>
  <OpChain name="ADD_CUSTOMER_ACCOUNT_GROUP_DISCOUNT" signal="TransactionModified">
    <PromptOp class="dtv.pos.customer.account.op.PromptCustAccountDiscountOp">
      <Parameter name="ApplicationMethodCode" value="GROUP" />
    </PromptOp>
    <ValidationOp validationsBean="custAcctDiscountRules" />
    <PromptOp class="dtv.pos.pricing.discount.layaway.PromptForCustAcctGroupDiscountItemsOp" validationsBean="groupItemSelectionDiscountRules"/>
    <Op class="dtv.pos.register.cca.op.discount.RouteCustomerAccountDiscountOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctItemsForGroupDiscountModificationOp">
      <Parameter name="CreateActivity" value="false" />
    </Op>
    <Op class="dtv.pos.pricing.discount.ModifyGroupDiscountCustAcctItemsOp">
      <Parameter name="ChainKey" value="CREATE_CUSTOMER_ACCOUNT_GROUP_DISCOUNT_MODIFICATION" />
    </Op>
    <Op class="dtv.pos.pricing.discount.ModifyGroupDiscountCustAcctItemsOp">
      <Parameter name="ChainKey" value="POST_ADD_CUSTOMER_ACCOUNT_DISCOUNT" />
    </Op>
  </OpChain>
  <OpChain name="UPDATE_CUSTOMER_ACCOUNT_GROUP_DISCOUNT_MODIFICATION">
    <Op class="dtv.pos.customer.account.op.UpdateCustAccountDiscountOp" />
  </OpChain>
  <OpChain name="POST_ADD_CUSTOMER_ACCOUNT_DISCOUNT" signal="TransactionModified">
    <OpChainRoute chainKey="UPDATE_WARRANTY_CUSTOMER_ACCOUNT_PRICE" />
  </OpChain>
  <OpChain name="CUSTOMER_ACCOUNT_NON_PHYSICAL_FINISH" signal="TransactionModified">
    <!-- <OpChainRoute chainKey="CUSTOMER_ACCOUNT_NON_PHYSICAL_VALIDATE" /> -->
    <Op class="dtv.pos.commission.RouteItemCommissionAssociationOp" />
    <Op class="dtv.pos.shippingfee.EnsureSingleShippingFeeLineItemOp" />
    <Op class="dtv.pos.shippingfee.FlagManualShippingFeeOp" />
    <Op class="dtv.pos.register.AddItemToSaleTranOp" />
    <Op class="dtv.pos.customer.account.op.AddCustomerAccountModifierOp" />
    <WorkerOp workersBean="addPriceChangeModifierToLineItemWorkers" />
    <OpChainRoute chainKey="SALE_TAXING" />
    <Op class="dtv.pos.register.cca.op.item.CreateCustomerItemAccountDetailOp" />
    <Op class="dtv.pos.customer.account.op.CreateCustAcctActivityOp" />
  </OpChain>
  <OpChain name="CUSTOMER_ACCOUNT_NON_PHYSICAL_VALIDATE">
    <PromptOp class="dtv.pos.register.PromptItemDescriptionOp" validationsBean="itemDescriptionRules" />
    <Op class="dtv.pos.register.PromptItemQuantityOp" />
    <Op class="dtv.pos.register.PromptItemPriceOp" />
  </OpChain>

   <!-- House Accounts Buyers -->
  <OpChain name="ADD_BUYER">
    <Op class="dtv.pos.houseaccount.op.PromptHouseAcctAddBuyerOp" />
  </OpChain>
  <OpChain name="EDIT_BUYER">
    <Op class="dtv.pos.houseaccount.op.PromptHouseAcctBuyerListOp" breakpoint="true">
      <Parameter name="PromptTitle" value="_custHouseAccountEditBuyerTitle" />
      <Parameter name="PromptMessage" value="_custHouseAccountEditBuyersListMsg" />
    </Op>
    <Op class="dtv.pos.houseaccount.op.PromptHouseAcctEditBuyerOp" />
  </OpChain>
  <OpChain name="SET_PRIMARY_BUYER">
    <Op class="dtv.pos.houseaccount.op.PromptHouseAcctBuyerListOp">
      <Parameter name="PromptTitle" value="_custHouseAccountSetPrimarBuyersListyTitle" />
      <Parameter name="PromptMessage" value="_custHouseAccountSetPrimaryBuyersListMsg" />
    </Op>
    <ValidationOp class="dtv.pos.houseaccount.op.ValidateHouseAcctSetPrimaryBuyerOp" validationsBean="setHouseAccountPrimaryBuyerRules" />
  </OpChain>
  <OpChain name="DEACTIVATE_BUYER">
    <Op class="dtv.pos.houseaccount.op.PromptHouseAcctBuyerListOp">
      <Parameter name="PromptTitle" value="_custHouseAccountDeactivateBuyersListTitle" />
      <Parameter name="PromptMessage" value="_custHouseAccountDeactivateBuyersListMsg" />
    </Op>
    <ValidationOp class="dtv.pos.houseaccount.op.ValidateHouseAcctDeactivateBuyerOp" validationsBean="deactivateHouseAccountPrimaryBuyerRules" />
  </OpChain>
  <OpChain name="HOUSE_ACCOUNT_CHANGE_CREDITLIMIT">
    <Op class="dtv.pos.houseaccount.op.PromptHouseAccountChangeCreditLimitOp" />
  </OpChain>
  <OpChain name="CUST_MAINT_HOUSE_ACCOUNT_NEW">
    <Op class="dtv.pos.houseaccount.op.CreateHouseAccountOp" />
  </OpChain>
  <OpChain name="EDIT_STATUS">
    <Op class="dtv.pos.customer.PromptHAStatusListOp" />
  </OpChain>
  <OpChain name="CHECK_FOR_UPDATES">
    <Op class="dtv.pos.appmanagement.op.SendIpcMessageOp">
      <Parameter name="SERVICE" value="xstore" />
      <Parameter name="METHOD" value="force-download-deployment-file" />
      <Parameter name="ErrorPromptKey" value="ERROR_SENDING_IPC_GO_BACK" />
    </Op>
    <PromptOp key="CHECK_FOR_UPDATES_WAS_RUN" />
  </OpChain>
  <OpChain name="REFRESH_PROMOTIONS_CONFIRMATION">
    <PromptOp class="dtv.pos.register.refreshpromotions.RefreshPromotionsConfirmation"/>
  </OpChain>
  <OpChain name="REFRESH_PROMOTIONS">
    <Op class="dtv.pos.register.refreshpromotions.RefreshPromotionsOp" longRunning="true"/>
    <PromptOp class="dtv.pos.register.refreshpromotions.RefreshPromotionsDone"/>
  </OpChain>
  <OpChain name="AUTHORIZATION_CLOSE_BATCH">
    <Op class="dtv.tenderauth.impl.xpay.CreateCloseBatchTransactionOp" />
    <Op class="dtv.tenderauth.impl.xpay.XpayCloseBatchOp" longRunning="true" />
  </OpChain>
  <OpChain name="RETAIL_LOCATION_OPEN_FROM_APP">
    <Op class="dtv.pos.hardware.op.PlaySoundOp" />
    <Op class="dtv.pos.common.op.PromptLoginIfNeededOp">
      <Parameter name="FailedPromptKey" value="STORE_OPEN_LOGIN_FAILED" />
      <Parameter name="PasswordPromptKey" value="STORE_OPEN_USER_PWD" />
      <Parameter name="UserIdPromptKey" value="STORE_OPEN_USER_ID" />
      <Parameter name="PrivilegeType" value="LOG_IN_TO_SYSTEM" />
    </Op>
    <Op class="dtv.pos.assistance.access.ValidateEmployeeRestrictedAccessOp" />
    <OpChainRoute chainKey="RETAIL_LOCATION_OPEN" chainType="START" />
  </OpChain>
  <OpChain name="WORKSTATION_OPEN_FROM_APP">
    <Op class="dtv.pos.hardware.op.PlaySoundOp" />
    <Op class="dtv.pos.common.op.PromptLoginIfNeededOp">
      <Parameter name="FailedPromptKey" value="WORKSTATION_OPEN_LOGIN_FAILED" />
      <Parameter name="PasswordPromptKey" value="WORKSTATION_OPEN_USER_PWD" />
      <Parameter name="UserIdPromptKey" value="WORKSTATION_OPEN_USER_ID" />
      <Parameter name="PrivilegeType" value="LOG_IN_TO_SYSTEM" />
    </Op>
    <Op class="dtv.pos.assistance.access.ValidateEmployeeRestrictedAccessOp" />
    <Op class="dtv.pos.systemcycle.access.SynchStateJournalOp" />
    <OpChainRoute chainKey="WORKSTATION_OPEN" chainType="START" />
  </OpChain>
  <OpChain name="SHOW_DASHBOARD_FROM_APP">
    <Op class="dtv.pos.common.op.PromptLoginIfNeededOp">
      <Parameter name="FailedPromptKey" value="SHOW_DASHBOARD_LOGIN_FAILED" />
      <Parameter name="PasswordPromptKey" value="SHOW_DASHBOARD_USER_PWD" />
      <Parameter name="UserIdPromptKey" value="SHOW_DASHBOARD_USER_ID" />
      <Parameter name="PrivilegeType" value="LOG_IN_TO_SYSTEM" />
    </Op>
    <Op class="dtv.pos.assistance.access.ValidateEmployeeRestrictedAccessOp" />
    <OpChainRoute chainKey="SHOW_DASHBOARD" chainType="START" />
  </OpChain>
  <OpChain name="DISPLAY_SELECTED_ITEM">
    <Op class="dtv.pos.inventory.lookup.SetSelectedItemOp" />
    <Op class="dtv.pos.inventory.lookup.DisplayFoundItemOp" />
  </OpChain>
  <OpChain name="SHOW_ENVIRONMENT">
    <Op class="dtv.pos.common.op.EnvironmentNotEnabledPromptOp" />
    <Op class="dtv.pos.appmanagement.op.SendIpcMessageOp">
      <Parameter name="SERVICE" value="xstore" />
      <Parameter name="METHOD" value="bring-ui-to-front" />
    </Op>
  </OpChain>
  <OpChain name="DRILL_DOWN_ITEMS">
    <Op class="dtv.pos.reporting.drilldown.op.PromptFormDrillDownParametersOp">
      <Parameter name="title" value="_rpt.item.drilldown.form.title" />
      <Parameter name="message" value="_rpt.item.drilldown.form.message" />
    </Op>
    <Op class="dtv.pos.reporting.drilldown.op.PromptSelectItemDrillDownOp" breakpoint="true" />
  </OpChain>

  <OpChain name="ITEM_DRILL_DOWN_GRAPH_GROSS_SALES">
    <Op class="dtv.pos.reporting.drilldown.op.PromptDrillDownGraphOp">
      <Parameter name="data" value="GROSS_SALES" />
    </Op>
  </OpChain>

  <OpChain name="ITEM_DRILL_DOWN_GRAPH_RETURNS">
    <Op class="dtv.pos.reporting.drilldown.op.PromptDrillDownGraphOp">
      <Parameter name="data" value="RETURNS" />
    </Op>
  </OpChain>

  <OpChain name="ITEM_DRILL_DOWN_GRAPH_DISCOUNTS">
    <Op class="dtv.pos.reporting.drilldown.op.PromptDrillDownGraphOp">
      <Parameter name="data" value="DISCOUNTS" />
    </Op>
  </OpChain>

  <OpChain name="ITEM_DRILL_DOWN_GRAPH_NET_SALES">
    <Op class="dtv.pos.reporting.drilldown.op.PromptDrillDownGraphOp">
      <Parameter name="data" value="NET_SALES" />
    </Op>
  </OpChain>

  <OpChain name="ITEM_DRILL_DOWN_GRAPH_GROSS_QUANTITY">
    <Op class="dtv.pos.reporting.drilldown.op.PromptDrillDownGraphOp">
      <Parameter name="data" value="GROSS_SALES" />
      <Parameter name="useQuantities" value="true" />
    </Op>
  </OpChain>

  <OpChain name="ITEM_DRILL_DOWN_GRAPH_RETURNS_QUANTITY">
    <Op class="dtv.pos.reporting.drilldown.op.PromptDrillDownGraphOp">
      <Parameter name="data" value="RETURNS" />
      <Parameter name="useQuantities" value="true" />
    </Op>
  </OpChain>

  <OpChain name="ITEM_DRILL_DOWN_GRAPH_DISCOUNTS_QUANTITY">
    <Op class="dtv.pos.reporting.drilldown.op.PromptDrillDownGraphOp">
      <Parameter name="data" value="DISCOUNTS" />
      <Parameter name="useQuantities" value="true" />
    </Op>
  </OpChain>

  <OpChain name="ITEM_DRILL_DOWN_GRAPH_NET_SALES_QUANTITY">
    <Op class="dtv.pos.reporting.drilldown.op.PromptDrillDownGraphOp">
      <Parameter name="data" value="NET_SALES" />
      <Parameter name="useQuantities" value="true" />
    </Op>
  </OpChain>

  <OpChain name="EMPLOYEE_MESSAGES_URL_BROWSER">
    <Op class="dtv.pos.messages.EmployeeMessagesOpenInBrowserOp" />
  </OpChain>

  <OpChain name="EMPLOYEE_MESSAGE_URL_NOT_ALLOWED">
    <Op class="dtv.pos.messages.NotifyInvalidMessageUrlShowAreaOp" />
  </OpChain>

  <OpChain name="DRILL_DOWN_GRAPH_LAUNCHER">
    <Op class="dtv.pos.reporting.drilldown.op.PromptDrillDownGraphOp" />
  </OpChain>

  <OpChain name="CHARITY" signal="TransactionModified">
    <PromptOp class="dtv.pos.charity.PromptDonationAmountOp" />
  </OpChain>

  <OpChain name="PRINT_RAIN_CHECK">
    <PromptOp class="dtv.pos.raincheck.PromptPrintRainCheckOp" />
    <Op class="dtv.pos.raincheck.CreateRainCheckTransactionOp" />
    <Op class="dtv.pos.hardware.op.BuildRcptsOp" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <Op class="dtv.pos.raincheck.SaveRainCheckRcptsOp" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
  </OpChain>

  <OpChain name="REDEEM_RAIN_CHECK">
    <PromptOp class="dtv.pos.raincheck.PromptRainCheckIdOp" validationsBean="rainCheckIdRules" />
    <PromptOp class="dtv.pos.raincheck.PromptRedeemRainCheckOp" />
    <OpChainRoute chainKey="SALE_ITEM_AFTER_LOOKUP" chainType="START" />
  </OpChain>

  <OpChain name="REDEEM_RAIN_CHECK_BY_SCAN">
    <PromptOp class="dtv.pos.raincheck.PromptRainCheckScanOp" validationsBean="rainCheckIdRules" />
    <PromptOp class="dtv.pos.raincheck.PromptRedeemRainCheckOp" />
    <OpChainRoute chainKey="SALE_ITEM_AFTER_LOOKUP" chainType="START" />
  </OpChain>

  <OpChain name="QUICK_ITEMS_ADD_ITEM">
    <Op class="dtv.pos.info.quickitems.AddItemFromQuickItemsOp">
      <Parameter name="SALE" value="SALE_ITEM_AFTER_LOOKUP" />
      <Parameter name="SEND_SALE" value="SEND_SALE_ITEM_AFTER_LOOKUP" />
      <Parameter name="LAYAWAY" value="LAYAWAY_ITEM_AFTER_LOOKUP" />
      <Parameter name="SPECIAL_ORDER" value="SPECIAL_ORDER_ITEM_AFTER_LOOKUP" />
      <Parameter name="ORDER" value="ORDER_ADD_ITEM_LOOKUP" />
      <Parameter name="RETURN" value="RETURN_BLIND_ITEM" />
      <Parameter name="PRESALE" value="CUSTOMER_ACCOUNT_ITEM_AFTER_LOOKUP" />
      <Parameter name="ONHOLD" value="CUSTOMER_ACCOUNT_ITEM_AFTER_LOOKUP" />
    </Op>
  </OpChain>

  <OpChain name="OVERRIDE_RETURN_PRICE">
    <Op class="dtv.pos.register.OverrideItemPriceOp" />
  </OpChain>

 <!-- Customer-related chains -->
  <OpChain name="CUSTOMER_MAINTENANCE" rollbackLevel="40">
    <Op class="dtv.pos.customer.CustomerSearchOp" required="true" breakpoint="true">
      <Parameter name="RESULTS_PROMPT" value="CUSTOMER_LIST" />
      <Parameter name="PrimaryOnly" value="true" />
      <Parameter name="AddCustomerChain" value="CREATE_CUSTOMER_FROM_SEARCH" />
      <Parameter name="EditCustomerChain" value="CUSTOMER_MAINTENANCE_EDIT" />
      <Parameter name="AlwaysViewCustomer" value="true" />
    </Op>
  </OpChain>
  <OpChain name="CUSTOMER_MAINTENANCE_EDIT">
    <Op class="dtv.pos.customer.EditCustomerOp" breakpoint="true" />
  </OpChain>
  <OpChain name="CUST_ASSOCIATION_EDIT">
    <Op class="dtv.pos.customer.EditCustomerOp" breakpoint="true">
      <Parameter name="AddCustomerToTran" value="true" />
    </Op>
  </OpChain>
  <OpChain name="VIEW_CUSTOMER_IN_TRANSACTION">
    <Op class="dtv.pos.customer.ViewTransactionCustomerOp" breakpoint="true" />
  </OpChain>
  <OpChain name="CREATE_CUSTOMER_FROM_SEARCH">
    <OpChainRoute chainKey="CUSTOMER.REVIEW_INFORMATION_CONSENT" />
    <Op class="dtv.pos.customer.CreateCustomerFromSearchOp" breakpoint="true" />
  </OpChain>
  <OpChain name="CREATE_CUSTOMER">
    <Op class="dtv.pos.customer.InitializeNewCustomerOp" />
    <OpChainRoute chainKey="CUSTOMER.REVIEW_INFORMATION_CONSENT" />
    <Op class="dtv.pos.customer.CreateCustomerOp" breakpoint="true">
      <Parameter name="IgnoreCurrentValues" value="true" />
    </Op>
  </OpChain>
  <OpChain name="PRINT_CUSTOMER">
    <Op class="dtv.pos.customer.PrintCustomerOp" />
  </OpChain>
  <OpChain name="DELETE_CUSTOMER">
    <Op class="dtv.pos.customer.DeleteCustomerOp" />
  </OpChain>
  <OpChain name="CUST_ASSOCIATION" signal="TransactionModified">
    <Op class="dtv.pos.customer.CustomerSearchOp" required="true" breakpoint="true">
      <!-- the CustomerSearchOp MUST be the first in the CUST_ASSOCIATION chain
        so that it can see card swipe events that trigger this chain -->
      <Parameter name="RESULTS_PROMPT" value="CUSTOMER_LIST_REGISTER" />
      <Parameter name="PrimaryOnly" value="true" />
      <Parameter name="AddCustomerChain" value="ADD_NEW_CUST_ASSOC" />
      <Parameter name="EditCustomerChain" value="CUST_ASSOCIATION_EDIT" />
    </Op>
    <OpChainRoute chainKey="CUSTOMER.REVIEW_INFORMATION_CONSENT" condition="dtv.pos.customer.NonNullSelectedCustomer" />
    <OpChainRoute chainKey="CUST_ASSOCIATION.pre" />
    <ValidationOp validationsBean="attachCustomerToSaleRules" />
    <Op class="dtv.pos.customer.AddCustToTransactionOp" />
    <OpChainRoute chainKey="CUST_ASSOCIATION.LOYALTY" />
    <Op class="dtv.pos.pricing.discount.ValidateDiscountsOnCustomerChangeOp" />
    <Op class="dtv.pos.register.layaway.account.DelinquentLayawaySearchOp" />
    <Op class="dtv.pos.register.specorder.account.ReceivedSpecOrderSearchOp" />
    <Op class="dtv.pos.workorder.account.WorkOrderRequiresAttentionOp" />
    <!-- This heavy-handed operation really does not belong here. Let's see if removing it causes any
         problems. If it does, those problems should be fixed at the source and not hidden by this operation.
    <Op class="dtv.pos.register.UpdateCurrentTransListOp" />
    -->
    <OpChainRoute chainKey="CUST_ASSOCIATION.post" />
  </OpChain>
  <OpChain name="CUSTOMER.REVIEW_INFORMATION_CONSENT" />
  <OpChain name="CUST_ASSOCIATION.pre" />
  <OpChain name="CUST_ASSOCIATION.LOYALTY" />
  <OpChain name="CUST_ASSOCIATION.post" />
  <OpChain name="ADD_NEW_CUST_ASSOC" signal="TransactionModified">
    <OpChainRoute chainKey="CUSTOMER.REVIEW_INFORMATION_CONSENT" />
    <Op class="dtv.pos.customer.CreateCustomerOp" breakpoint="true">
      <Parameter name="AddCustomerToTran" value="true" />
    </Op>
  </OpChain>
  <!-- Remove Customer Association from -->
  <OpChain name="REMOVE_CUST_ASSOC" signal="TransactionModified">
    <Op class="dtv.pos.register.specorder.PromptRemoveCustWithSpecOrderOp" />
    <Op class="dtv.pos.customer.award.VoidAwardsFromTransactionOp" />
    <Op class="dtv.pos.customer.RemoveCustFromTransactionOp" />
    <Op class="dtv.pos.pricing.discount.ValidateDiscountsOnCustomerChangeOp" />
    <Op class="dtv.pos.customer.wishlist.op.RemoveWishListItemsOfCustomerOp" />
  </OpChain>
  <OpChain name="CUST_MAINT_TAX_EXEMPTIONS">
    <OpChainRoute chainKey="EDIT_TAX_EXEMPTION" />
    <Op class="dtv.pos.customer.AddTaxExemptionToModelOp" />
  </OpChain>
  <OpChain name="ADD_CUSTOMER_ADDRESS">
    <Op class="dtv.pos.customer.PromptCustomerAddAddressOp" breakpoint="true"/>
  </OpChain>
  <OpChain name="EDIT_CUSTOMER_ADDRESS">
    <Op class="dtv.pos.customer.PromptCustomerEditAddressOp" breakpoint="true"/>
  </OpChain>
  <OpChain name="CHANGE_PRIMARY_ADDRESS">
    <Op class="dtv.pos.customer.PromptCustomerUpdatePrimaryAddressOp" />
  </OpChain>
  <OpChain name="DELETE_CUSTOMER_ADDRESS">
    <ValidationOp class="dtv.pos.customer.ValidateDeleteAddressOp" validationsBean="deletePrimaryAddressRules" />
    <Op class="dtv.pos.customer.PromptCustomerDeleteAddressOp" />
  </OpChain>

  <OpChain name="ITEM_SUMMARY_VIEW">
    <Op class="dtv.pos.item.ViewItemSummaryOp" />
  </OpChain>

  <!-- Customer Wish List -->
  <OpChain name="ADD_WISH_LIST_ITEM">
    <Op class="dtv.pos.customer.wishlist.op.WishListItemSearchOp" />
    <ValidationOp class="dtv.pos.customer.wishlist.op.WishListAddItemOp" validationsBean="wishListAddItemRules" />
  </OpChain>
  <OpChain name="ADD_WISH_LIST_ITEM_FROM_SCAN">
    <ValidationOp class="dtv.pos.customer.wishlist.op.WishListAddItemOp" validationsBean="wishListAddItemRules" />
  </OpChain>
  <OpChain name="DELETE_WISH_LIST_ITEM">
    <PromptOp class="dtv.pos.customer.wishlist.op.PromptDeleteWishListItemOp" validationsBean="custItemListSelectItemsRules" />
    <PromptOp class="dtv.pos.customer.wishlist.op.ConfirmDeleteWishListItemOp" />
  </OpChain>
  <OpChain name="PURCHASE_WISH_LIST_ITEM">
    <PromptOp class="dtv.pos.customer.wishlist.op.PromptPurchaseWishListOp" validationsBean="custItemListSelectItemsRules" />
    <PromptOp class="dtv.pos.customer.wishlist.op.NotifyRemoveWishListOp" />
    <OpChainRoute>
      <Choice chainKey="ORDER_ITEMS_FROM_CART" chainType="START" condition="dtv.pos.customer.custitem.OrderContextCondition" />
      <Choice chainKey="CUST_ITEM_PURCHASE_FROM_CART" chainType="START" />
    </OpChainRoute>
  </OpChain>
  <OpChain name="PRINT_WISH_LIST_ITEM">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="WISH_LIST_REPORT" />
    </Op>
    <Op class="dtv.pos.customer.wishlist.op.SetWishListReportDatasourceOp" />
    <Op class="dtv.pos.reporting.fill.FillReportOp" />
    <Op class="dtv.pos.reporting.DisplayReportOp" />
  </OpChain>

  <OpChain name="CUST_ITEM_PURCHASE_FROM_CART">
    <Op class="dtv.pos.customer.custitem.op.SplitItemQuantityOp" />
    <Op class="dtv.pos.customer.custitem.op.CustItemListLineIteratingOp">
      <Parameter name="SALE" value="SALE_ITEM_AFTER_LOOKUP" />
      <Parameter name="LAYAWAY" value="LAYAWAY_ITEM_AFTER_LOOKUP" />
      <Parameter name="SPECIAL_ORDER" value="SPECIAL_ORDER_ITEM_AFTER_LOOKUP" />
      <Parameter name="SEND_SALE" value="SEND_SALE_ITEM_AFTER_LOOKUP" />
      <Parameter name="PRESALE" value="CUSTOMER_ACCOUNT_ITEM_AFTER_LOOKUP" />
      <Parameter name="ONHOLD" value="CUSTOMER_ACCOUNT_ITEM_AFTER_LOOKUP" />
    </Op>
  </OpChain>

  <!-- Airline information handling opchains -->
  <OpChain name="AIRLINE_INFORMATION_LOOKUP">
    <Op class="dtv.pos.flight.op.FlightInformationLookupOp" />
  </OpChain>
  <OpChain name="ADD_NEW_FLIGHT_INFORMATION">
    <Op class="dtv.pos.flight.op.EditFlightInformationOp" />
  </OpChain>

  <OpChain name="ASSOCIATE_TASKS_LOGIN" contextKey="ASSOCIATE_TASKS_LOGIN">
    <Op class="dtv.pos.security.op.PosLoginOp">
      <Parameter name="IdPrompt" value="LOGIN_USER_ID_ESC" />
    </Op>
    <OpChainRoute chainKey="ASSOCIATE_TASKS" chainType="START" />
  </OpChain>
  <OpChain name="ASSOCIATE_TASKS" rollbackLevel="40">
    <Op class="dtv.pos.tasks.op.HandleTaskMaintActionsOp" breakpoint="true" />
  </OpChain>
  <OpChain name="NEW_ASSOCIATE_TASK">
    <Op class="dtv.pos.tasks.op.InitializeNewTaskOp" />
    <Op class="dtv.pos.tasks.op.CreateTaskOp" />
  </OpChain>
  <OpChain name="EDIT_ASSOCIATE_TASK">
    <Op class="dtv.pos.tasks.op.EditTaskOp" />
  </OpChain>
  <OpChain name="REOPEN_ASSOCIATE_TASK">
    <Op class="dtv.pos.tasks.op.ChangeTaskStatusOp">
      <Parameter name="taskStatus" value="OPEN" />
    </Op>
  </OpChain>
  <OpChain name="BEGIN_ASSOCIATE_TASK">
    <Op class="dtv.pos.tasks.op.ChangeTaskStatusOp">
      <Parameter name="taskStatus" value="IN_PROGRESS" />
    </Op>
  </OpChain>
  <OpChain name="COMPLETE_ASSOCIATE_TASK">
    <PromptOp class="dtv.pos.tasks.op.PromptForConfirmationOp" key="TASK_COMPLETE_SAVE_CHANGES" />
    <Op class="dtv.pos.tasks.op.ChangeTaskStatusOp">
      <Parameter name="taskStatus" value="CLOSED" />
    </Op>
  </OpChain>
  <OpChain name="CANCEL_ASSOCIATE_TASK">
    <PromptOp class="dtv.pos.tasks.op.PromptForConfirmationOp" key="TASK_CANCEL_SAVE_CHANGES" />
    <Op class="dtv.pos.tasks.op.ChangeTaskStatusOp">
      <Parameter name="taskStatus" value="CANCELLED" />
    </Op>
  </OpChain>
  <OpChain name="ASSOCIATE_TASK_CUSTOMER_SEARCH">
    <Op class="dtv.pos.customer.CustomerSearchOp" breakpoint="true">
      <Parameter name="RESULTS_PROMPT" value="CUSTOMER_LIST_REGISTER" />
      <Parameter name="AddCustomerChain" value="ADD_NEW_CUST_ASSOC" />
      <Parameter name="EditCustomerChain" value="CUST_ASSOCIATION_EDIT" />
    </Op>
  </OpChain>
  <OpChain name="ADD_ASSOCIATE_TASK_NOTE">
    <PromptOp class="dtv.pos.tasks.op.PromptAddTaskNoteOp" validationsBean="commentRules" />
  </OpChain>
  <OpChain name="ADD_ASSOCIATE_TASK_NOTE_CUST">
    <PromptOp class="dtv.pos.tasks.op.PromptAddTaskNoteOp" validationsBean="commentRules">
      <Parameter name="customerEvent" value="true" />
    </PromptOp>
  </OpChain>
  <OpChain name="VIEW_ASSOCIATE_TASK_NOTES">
    <PromptOp class="dtv.pos.tasks.op.ViewTaskNotesOp" breakpoint="true" />
  </OpChain>
  <OpChain name="NEW_ASSOCIATE_TASK_CUST">
    <Op class="dtv.pos.tasks.op.InitializeNewTaskOp">
      <Parameter name="assignCustomer" value="true" />
    </Op>
    <Op class="dtv.pos.tasks.op.CreateTaskOp">
      <Parameter name="formKey" value="ASSOCIATE_TASK_DETAIL_CUST" />
      <Parameter name="customerEvent" value="true" />
    </Op>
  </OpChain>
  <OpChain name="EDIT_ASSOCIATE_TASK_CUST">
    <Op class="dtv.pos.tasks.op.EditTaskOp">
      <Parameter name="formKey" value="ASSOCIATE_TASK_DETAIL_CUST" />
      <Parameter name="customerEvent" value="true" />
    </Op>
  </OpChain>
  <OpChain name="TASK_ACTIVITY_LIST">
    <PromptOp class="dtv.pos.tasks.op.PromptTaskActivityListOp" />
  </OpChain>
  <OpChain name="TASK_STATUS_LIST">
    <PromptOp class="dtv.pos.tasks.op.PromptTaskStatusListOp" />
  </OpChain>
  <OpChain name="TASK_ASSOC_LIST">
    <PromptOp class="dtv.pos.tasks.op.PromptTaskAssociateListOp" />
  </OpChain>

  <OpChain name="XCOMMERCE" contextKey="SALE">
    <Op class="dtv.pos.customer.xcommerce.SimulateXcommerceOp" />
    <OpChainRoute chainKey="XCOMMERCE_LIST_PROMPT" chainType="STACK" />
  </OpChain>

  <OpChain name="XCOMMERCE_LIST_PROMPT" >
    <PromptOp class="dtv.pos.customer.xcommerce.PromptXcommerceItemsNotOnFileOp" />
    <PromptOp class="dtv.pos.customer.xcommerce.PromptNonOrderableXcommerceItemsOp" />
    <PromptOp class="dtv.pos.customer.xcommerce.PromptXcommerceItemTypesInvalidOp" />
    <PromptOp class="dtv.pos.customer.xcommerce.PromptXcommerceItemsOp" breakpoint="true" />
    <PromptOp class="dtv.pos.customer.xcommerce.ConfirmUnmarkedXcommerceItemsPromptOp"/>
    <OpChainRoute chainKey="XCOMMERCE_PROCESS_SELECTED_ITEMS" condition="dtv.pos.customer.xcommerce.XcommerceHasMarkedItemsForPurchase" />
  </OpChain>

  <OpChain name="XCOMMERCE_PROCESS_SELECTED_ITEMS">
    <PromptOp key="PROMPT_COMPLETE_XCOMMERCE" />
    <OpChainRoute>
      <Choice chainKey="XCOMMERCE_SALE_ITEMS">
        <Condition class="dtv.pos.customer.xcommerce.XcommerceHasMarkedItemsForPurchase">
          <Parameter name="SaleItemType" value="SALE" />
        </Condition>
      </Choice>
    </OpChainRoute>
    <OpChainRoute>
      <Choice chainKey="XCOMMERCE_ORDER_ITEMS">
        <Condition class="dtv.pos.customer.xcommerce.XcommerceHasMarkedItemsForPurchase">
          <Parameter name="SaleItemType" value="ORDER" />
        </Condition>
      </Choice>
    </OpChainRoute>
  </OpChain>

  <OpChain name="XCOMMERCE_SALE_ITEMS" >
    <Op class="dtv.pos.customer.xcommerce.SetupXcommerceItemsForTypeOp" >
      <Parameter name="SaleItemType" value="SALE" />
    </Op>
    <OpChainRoute chainKey="CUST_ITEM_PURCHASE_FROM_CART" chainType="STACK" />
  </OpChain>

  <OpChain name="XCOMMERCE_ORDER_ITEMS" >
    <Op class="dtv.pos.customer.xcommerce.SetupXcommerceItemsForTypeOp" >
      <Parameter name="SaleItemType" value="ORDER" />
    </Op>
    <OpChainRoute chainKey="REQUIRED_CUSTOMER_ASSOCIATION" />
    <Op class="dtv.pos.customer.custitem.op.CustItemsOrderIteratingOp">
      <Parameter name="chainKey" value="ORDER_ITEMS_FROM_CART" />
    </Op>
  </OpChain>

  <!-- COUNTRYPACK COMMONS -->
  <OpChain name="CHECK_TENDERED_CASH.local">
    <Op class="oracle.retail.xstore.countrypack.common.op.ValidateMaxTenderedCashAmountOp" />
  </OpChain>

  <OpChain name="COUNTRYPACK.ASSIGN_MANUAL_RECEIPT" rollbackChainKey="COUNTRYPACK.REMOVE_MANUAL_RECEIPT">
    <PromptOp class="oracle.retail.xstore.countrypack.common.register.op.PromptManualReceiptNumberOp" key="COUNTRYPACK.PROMPT_MANUAL_RECEIPT_NUMBER" validationsBean="countrypack.manualReceiptNumberValidation" />
    <PromptOp class="oracle.retail.xstore.countrypack.common.register.op.PromptManualReceiptDateOp" key="COUNTRYPACK.PROMPT_MANUAL_RECEIPT_DATE" validationsBean="countrypack.manualReceiptDateValidation" />
    <Op class="oracle.retail.xstore.countrypack.common.register.op.CreateManualReceiptOp" />
    <OpChainRoute chainKey="SALE_ITEM_START" chainType="START" />
  </OpChain>

  <OpChain name="COUNTRYPACK.REMOVE_MANUAL_RECEIPT">
    <Op class="oracle.retail.xstore.countrypack.common.register.op.RemoveManualReceiptOp" />
    <OpChainRoute chainKey="SALE_ITEM_START" chainType="START" />
  </OpChain>
  <OpChain name="COUNTRYPACK.WORKSTATION_END_DAY">
    <OpChainRoute chainKey="COUNTRYPACK.WORKSTATION_END_DAY.local.pre" />
    <Op class="dtv.pos.common.op.CreateTransactionAsNeededOp">
      <Parameter name="TransactionType" value="WORKSTATION_END_DAY" />
    </Op>
    <!-- Execute the z-report on fiscal printer -->
    <Op class="dtv.pos.hardware.op.CompleteFiscalTransactionOp" longRunning="true" />
    <OpChainRoute chainKey="COUNTRYPACK.WORKSTATION_END_DAY.local.post" />
    <OpChainRoute chainKey="SIMPLE_COMPLETE_TRANSACTION" />
  </OpChain>
  <OpChain name="COUNTRYPACK.WORKSTATION_END_DAY.local.pre" />
  <OpChain name="COUNTRYPACK.WORKSTATION_END_DAY.local.post" />
  <OpChain name="COUNTRYPACK.WORKSTATION_BEGIN_DAY">
    <OpChainRoute chainKey="COUNTRYPACK.WORKSTATION_BEGIN_DAY.local.pre" />
    <ValidationOp validationsBean="countryPack.fiscalPrinter.beginDay" longRunning="true" />
    <Op class="oracle.retail.xstore.countrypack.common.hardware.fiscal.op.PromptFiscalPrinterEndOfDayRequiredOp" longRunning="true" />
    <Op class="dtv.pos.common.op.CreateTransactionAsNeededOp">
      <Parameter name="TransactionType" value="WORKSTATION_BEGIN_DAY" />
    </Op>
    <!-- Notifies the fp about the day opening, mostly used to setup the posID and cashierId  -->
    <Op class="dtv.pos.hardware.op.CompleteFiscalTransactionOp" longRunning="true" />
    <OpChainRoute chainKey="COUNTRYPACK.WORKSTATION_BEGIN_DAY.local.post" />
    <OpChainRoute chainKey="SIMPLE_COMPLETE_TRANSACTION" />
  </OpChain>
  <OpChain name="COUNTRYPACK.WORKSTATION_BEGIN_DAY.local.pre" />
  <OpChain name="COUNTRYPACK.WORKSTATION_BEGIN_DAY.local.post" />
  <OpChain name="COUNTRYPACK.RESET_FISCAL_PRINTER">
    <ValidationOp validationsBean="countrypack.fiscalPrinter.backofficeOnlineRules" />
    <Op class="oracle.retail.xstore.countrypack.common.hardware.fiscal.op.ResetFiscalPrinterOp" longRunning="true"/>
    <PromptOp key="COUNTRYPACK.FP_OPERATION_COMPLETED" />
  </OpChain>
  <OpChain name="COUNTRYPACK.SET_FISCAL_PRINTER_LOGO">
    <ValidationOp validationsBean="countrypack.fiscalPrinter.backofficeOnlineRules" />
    <Op class="oracle.retail.xstore.countrypack.common.hardware.fiscal.op.SetFiscalPrinterLogoHeaderOp" longRunning="true"/>
    <PromptOp key="COUNTRYPACK.FP_OPERATION_COMPLETED" />
  </OpChain>
  <OpChain name="COUNTRYPACK.SET_FISCAL_PRINTER_VAT">
    <ValidationOp validationsBean="countrypack.fiscalPrinter.backofficeDayOpenedRules" />
    <Op class="oracle.retail.xstore.countrypack.common.hardware.fiscal.op.SetFiscalPrinterVatTableOp" longRunning="true"/>
    <PromptOp key="COUNTRYPACK.FP_OPERATION_COMPLETED" />
  </OpChain>
  <OpChain name="COUNTRYPACK.SET_FISCAL_PRINTER_DATE">
    <ValidationOp validationsBean="countrypack.fiscalPrinter.backofficeSetDateRules" />
    <Op class="oracle.retail.xstore.countrypack.common.hardware.fiscal.op.SetFiscalPrinterDateTimeOp" longRunning="true"/>
    <PromptOp key="COUNTRYPACK.FP_OPERATION_COMPLETED" />
  </OpChain>
  <OpChain name="COUNTRYPACK.SET_FISCAL_PRINTER_HEADER">
    <ValidationOp validationsBean="countrypack.fiscalPrinter.backofficeDayOpenedRules" />
    <Op class="oracle.retail.xstore.countrypack.common.hardware.fiscal.op.SetFiscalPrinterHeaderOp" longRunning="true"/>
    <PromptOp key="COUNTRYPACK.FP_OPERATION_COMPLETED" />
  </OpChain>
  <OpChain name="COUNTRYPACK.PRINT_X_REPORT">
    <ValidationOp validationsBean="countrypack.fiscalPrinter.backofficeOnlineRules" />
    <Op class="oracle.retail.xstore.countrypack.common.hardware.fiscal.op.PrintXReportOp" longRunning="true"/>
    <PromptOp key="COUNTRYPACK.FP_OPERATION_COMPLETED" />
  </OpChain>
  <OpChain name="COUNTRYPACK.PRINT_M_REPORT">
    <ValidationOp validationsBean="countrypack.fiscalPrinter.backofficeOnlineRules" />
    <Op class="oracle.retail.xstore.countrypack.common.hardware.fiscal.op.PrintMReportOp" longRunning="true"/>
    <PromptOp key="COUNTRYPACK.FP_OPERATION_COMPLETED" />
  </OpChain>
  <OpChain name="COUNTRYPACK.PRINT_Z_REPORT" rollbackChainKey="ROLLBACK_WORKSTATION_END_DAY_TRANS">
    <ValidationOp validationsBean="countrypack.fiscalPrinter.backofficeOnlineRules" />
    <OpChainRoute chainKey="COUNTRYPACK.WORKSTATION_END_DAY" />
    <PromptOp key="COUNTRYPACK.FP_OPERATION_COMPLETED" />
  </OpChain>
  <OpChain name="ROLLBACK_WORKSTATION_END_DAY_TRANS">
    <OpChainRoute>
      <Choice chainKey="CANCEL_TRANSACTION" chainType="START" condition="dtv.pos.register.condition.NoTransRunCondition" />
      <Choice chainKey="CANCEL_NO_TRANSACTION" chainType="START" />
    </OpChainRoute>
  </OpChain>

  <!-- COUNTRYPACK DAILYREPORT START -->
  <OpChain name="COUNTRYPACK.DAILY_REPORT.PRINT">
    <Op class="dtv.pos.reporting.LoadReportOp" longRunning="true">
      <Parameter name="reportName" value="DAILY_REPORT" />
    </Op>
    <Op class="oracle.retail.xstore.countrypack.common.dailyreport.op.SetDailyReportParametersOp" longRunning="true" />
    <Op class="dtv.pos.reporting.fill.FillReportNoUiOp" longRunning="true" />
    <Op class="dtv.pos.reporting.print.PrintReportOp">
      <Parameter name="continueOnError" value="false" />
    </Op>
    <Op class="oracle.retail.xstore.countrypack.common.dailyreport.op.SaveDailyReportOp" longRunning="true" />
  </OpChain>

  <OpChain name="COUNTRYPACK.DAILY_REPORT.GENERATE_LAST" signal="TransactionComplete">
    <Op class="oracle.retail.xstore.countrypack.common.dailyreport.op.SelectTransactionOp" />
    <OpChainRoute chainKey="RETAIL_LOCATION_CLOSE.local" condition="oracle.retail.xstore.countrypack.common.dailyreport.AnyTransaction"/>
  </OpChain>
  <!-- COUNTRYPACK DAILYREPORT END -->

  <!-- COUNTRYPACK INVOICE START -->
  <OpChain name="COUNTRYPACK.INVOICE_REQUEST" >
    <OpChainRoute chainKey="COUNTRYPACK.INVOICE_REQUEST_IMPL" />
    <OpChainRoute chainKey="PRE_TENDERING" chainType="START" />
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_REQUEST_IMPL" >
    <ValidationOp validationsBean="countryPack.validateInvoiceItems" />
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.ClearInvoiceCustomerOp" />
    <PromptOp class="oracle.retail.xstore.countrypack.common.invoice.op.InvoiceCheckMixedSaleReturnItemsTransOp" />
    <ValidationOp validationsBean="countryPack.validateReturnsOnInvoiceRequest" />
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.InvoiceSetCreditNoteCustomerOp" />
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.InvoiceEnsureCustomerAssignedOp">
      <Parameter name="CHAIN_KEY" value="COUNTRYPACK.INVOICE_CUST_ASSOCIATION" />
    </Op>
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.InvoiceCustomerSummaryOp" breakpoint="true" >
      <Parameter name="CHAIN_KEY" value="COUNTRYPACK.INVOICE_CUST_ASSOCIATION" />
      <Parameter name="FORM_KEY" value="INVOICE_CUSTOMER_SUMMARY" />
    </Op>
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.InvoiceIssueSetValueOp" >
      <Parameter name="Value" value="true" />
    </Op>
    <OpChainRoute chainKey="COUNTRYPACK.INVOICE_REQUEST_IMPL.POST" />
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_REQUEST_IMPL.POST" />

  <OpChain name="COUNTRYPACK.CUSTOMER_MAINTENANCE_EDIT">
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.InvoiceEditCustomerOp" longRunning="true" />
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_CUST_ASSOCIATION">
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.InvoiceCustomerSearchOp" required="true" breakpoint="true">
      <!-- the CustomerSearchOp MUST be the first in the CUST_ASSOCIATION chain
        so that it can see card swipe events that trigger this chain -->
      <Parameter name="RESULTS_PROMPT" value="CUSTOMER_LIST_REGISTER" />
      <Parameter name="PrimaryOnly" value="true" />
      <Parameter name="AddCustomerChain" value="ADD_NEW_CUST_ASSOC" />
      <Parameter name="EditCustomerChain" value="CUST_ASSOCIATION_EDIT" />
    </Op>
    <OpChainRoute chainKey="COUNTRYPACK.INVOICE_CUST_ASSOCIATION.pre" />

    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.InvoiceCheckTransTaxExemptionPromptOp" />
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.InvoiceSetCustomerOp" />

    <OpChainRoute chainKey="COUNTRYPACK.INVOICE_CUST_ASSOCIATION.post" />
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_CUST_ASSOCIATION.pre" />

  <OpChain name="COUNTRYPACK.INVOICE_CUST_ASSOCIATION.post" />

  <OpChain name="COUNTRYPACK.CREATE_INVOICE">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="COUNTRYPACK.INVOICE" />
    </Op>
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.SetInvoiceBeanAsReportDataScourceOp" />
    <Op class="dtv.pos.reporting.fill.FillReportNoUiOp" />
    <Op class="dtv.pos.reporting.print.PrintReportOp" longRunning="true">
      <Parameter name="continueOnError" value="true" />
    </Op>
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.CreateInvoiceOp" />
    <OpChainRoute chainKey="COUNTRYPACK.CREATE_INVOICE.local.post" />
  </OpChain>
  <OpChain name="COUNTRYPACK.CREATE_INVOICE.local.post" />

  <!-- Reprint last invoice -->
  <OpChain name="COUNTRYPACK.INVOICE_REPRINT_LAST_INVOICE" signal="TransactionComplete">
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.SelectLastInvoiceTransactionOp" />
    <ValidationOp class="oracle.retail.xstore.countrypack.common.invoice.op.LoadInvoicesOp" validationsBean="countryPack.reprintLastInvoice" />
    <PromptOp class="oracle.retail.xstore.countrypack.common.invoice.op.LastInvoiceReprintConfirmPrompt" />
    <OpChainRoute>
      <Choice chainKey="COUNTRYPACK.INVOICE_REPRINT_LAST_INVOICES" condition="oracle.retail.xstore.countrypack.common.invoice.condition.TransactionHasSalesInvoice" />
      <Choice chainKey="COUNTRYPACK.TAXFREE_REPRINT_LAST_INVOICE" condition="oracle.retail.xstore.countrypack.common.taxfree.condition.TransactionHasTaxFreeInvoice" />
    </OpChainRoute>
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_REPRINT_LAST_INVOICES">
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.ReprintInvoiceIteratingOp">
      <Parameter name="chainKey" value="COUNTRYPACK.INVOICE_REPRINT_LAST_INVOICE_INNER" />
    </Op>
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_REPRINT_LAST_INVOICE_INNER">
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.ReprintLastInvoiceOp" longRunning="true" />
  </OpChain>

  <OpChain name="COUNTRYPACK.TAXFREE_REPRINT_LAST_INVOICE" >
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeReprintPrepare" />
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_PRINT_CONFIRM" />
  </OpChain>

  <!-- Reprint an invoice / reissue a Tax Free invoice from Electronic Journal -->
  <OpChain name="COUNTRYPACK.INVOICE_REPRINT_INVOICE_FROM_EJ">
    <ValidationOp class="oracle.retail.xstore.countrypack.common.invoice.op.LoadInvoicesOp" validationsBean="countryPack.validateReprintInvoiceFromEj" />
    <OpChainRoute>
    <Choice chainKey="COUNTRYPACK.INVOICE_REPRINT_INVOICE_FROM_EJ_IMPL" condition="oracle.retail.xstore.countrypack.common.invoice.condition.TransactionHasSalesInvoice" />
    <Choice chainKey="COUNTRYPACK.TAXFREE_REISSUE_INVOICE_FROM_EJ_IMPL" condition="oracle.retail.xstore.countrypack.common.taxfree.condition.TransactionHasTaxFreeInvoice" />
    </OpChainRoute>
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_REPRINT_INVOICE_FROM_EJ_IMPL">
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="COUNTRYPACK.INVOICE_REPRINT_INVOICE_FROM_EJ" />
    <OpChainRoute chainKey="COUNTRYPACK.INVOICE_REPRINT_INVOICES_FROM_EJ" />
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_REPRINT_INVOICES_FROM_EJ">
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.ReprintInvoiceIteratingOp">
      <Parameter name="chainKey" value="COUNTRYPACK.INVOICE_REPRINT_INVOICES_FROM_EJ_INNER" />
    </Op>
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_REPRINT_INVOICES_FROM_EJ_INNER">
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.ReprintInvoiceOp" longRunning="true">
      <Parameter name="WATERMARK_STYLE" value="WATERMARK_REPRINT" />
      <Parameter name="MESSAGE" value="_countrypack.invoice.InvoiceDuplicate" />
    </Op>
  </OpChain>

  <!-- Issue invoice from Electronic Journal -->
  <OpChain name="COUNTRYPACK.INVOICE_ISSUE_INVOICE_FROM_EJ">
    <ValidationOp class="oracle.retail.xstore.countrypack.common.invoice.op.LoadInvoicesOp" validationsBean="countryPack.validateIssueInvoiceFromEj" />
    <PromptOp class="oracle.retail.xstore.countrypack.common.taxfree.ejournal.op.PromptEJournalInvoiceTypeOp" />
    <OpChainRoute>
      <Choice chainKey="COUNTRYPACK.INVOICE_ISSUE_INVOICE_FROM_EJ_IMPL" condition="oracle.retail.xstore.countrypack.common.invoice.condition.IsPrintInvoice" />
      <Choice chainKey="COUNTRYPACK.TAXFREE_ISSUE_INVOICE_FROM_EJ_IMPL" >
        <Condition class="oracle.retail.xstore.countrypack.common.taxfree.condition.IsTaxFreeIssueSelected">
          <Parameter name="RequiredStatus" value="TF_REQUESTED" />
        </Condition>
      </Choice>
    </OpChainRoute>
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.ClearInvoiceDataOp" />
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_ISSUE_INVOICE_FROM_EJ_IMPL" signal="TransactionComplete">
    <PromptOp class="oracle.retail.xstore.countrypack.common.invoice.ejournal.op.PromptInvoiceConfirmationOp" key="COUNTRYPACK.INVOICE_ISSUE_FROM_EJ" />
    <ValidationOp validationsBean="countryPack.invoice.validateIssueInvoiceFromEj" />
    <OpChainRoute chainKey="COUNTRYPACK.INVOICE_REQUEST_IMPL" />
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.CreateDeferredInvoiceTransactionOp" >
      <Parameter name="LinkTypeCode" value="DEFERRED_INVOICE_TRANSACTION" />
    </Op>
    <OpChainRoute chainKey="COUNTRYPACK.CREATE_INVOICE" condition="oracle.retail.xstore.countrypack.common.invoice.condition.IsPrintInvoice" />
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.CloseDeferredInvoiceTransactionOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_RETRY_FROM_EJ">
    <ValidationOp class="oracle.retail.xstore.countrypack.common.invoice.op.LoadInvoicesOp" validationsBean="countryPack.validateRetryInvoiceFromEj" />

    <OpChainRoute chainKey="COUNTRYPACK.INVOICE_RETRY_FROM_EJ_IMPL" />

    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.ClearInvoiceDataOp" />
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_RETRY_FROM_EJ_IMPL" signal="TransactionComplete">

  </OpChain>

  <!-- Void an invoice from Electronic Journal -->
  <OpChain name="COUNTRYPACK.INVOICE_VOID_FROM_EJ" signal="TransactionComplete">
    <ValidationOp class="oracle.retail.xstore.countrypack.common.invoice.op.LoadInvoicesOp" validationsBean="countryPack.validateVoidInvoiceFromEj" />
    <OpChainRoute>
      <Choice chainKey="COUNTRYPACK.INVOICE_VOID_FROM_EJ_IMPL" condition="oracle.retail.xstore.countrypack.common.invoice.condition.TransactionHasSalesInvoice" />
      <Choice chainKey="COUNTRYPACK.TAXFREE_VOID_FROM_EJ_IMPL" condition="oracle.retail.xstore.countrypack.common.taxfree.condition.TransactionHasTaxFreeInvoice" />
    </OpChainRoute>
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.ClearInvoiceDataOp" />
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_VOID_FROM_EJ_IMPL">
    <PromptOp class="dtv.pos.framework.op.PromptYesNoOp" key="COUNTRYPACK.INVOICE_VOID_FROM_EJ" />
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.CreateDeferredInvoiceTransactionOp" >
      <Parameter name="LinkTypeCode" value="VOID_INVOICE_TRANSACTION" />
    </Op>
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.VoidInvoicesOp" />
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.CloseDeferredInvoiceTransactionOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <OpChainRoute chainKey="COUNTRYPACK.INVOICE_POST_VOID_PRINT_FROM_EJ" condition="oracle.retail.xstore.countrypack.common.invoice.condition.InvoicePrintOnPostVoid" />
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_POST_VOID_PRINT_FROM_EJ">
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.ReprintInvoiceIteratingOp">
      <Parameter name="chainKey" value="COUNTRYPACK.INVOICE_POST_VOID_PRINT_FROM_EJ_INNER" />
    </Op>
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_POST_VOID_PRINT_FROM_EJ_INNER">
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.ReprintPostVoidInvoiceOp" longRunning="true">
      <Parameter name="WATERMARK_STYLE" value="WATERMARK" />
      <Parameter name="MESSAGE" value="_countrypack.invoice.watermarkVoided" />
    </Op>
  </OpChain>

  <!-- Post void an invoice from Electronic Journal -->
  <OpChain name="COUNTRYPACK.INVOICE_POST_VOID_MAIN.1.pre">
    <PromptOp class="oracle.retail.xstore.countrypack.common.invoice.op.PostVoidInvoiceQuestionOp" key="COUNTRYPACK.INVOICE_POST_VOID" />
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_POST_VOID">
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.VoidInvoicesOp" />
    <OpChainRoute chainKey="COUNTRYPACK.INVOICE_POST_VOID_PRINT_FROM_EJ" condition="oracle.retail.xstore.countrypack.common.invoice.condition.InvoicePrintOnPostVoid" />
  </OpChain>

  <OpChain name="COUNTRYPACK.INVOICE_SEARCH" rollbackLevel="30">
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.SearchInvoiceOp" breakpoint="true"/>
    <OpChainRoute chainKey="ELECTRONIC_JOURNAL_VIEW" chainType="START" />
  </OpChain>
  <!-- COUNTRYPACK INVOICE END -->

  <!-- COUNTRYPACK TAXFREE START -->
  <!-- Tax Free button pressed -->
  <OpChain name="COUNTRYPACK.TAXFREE_REQUEST">
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeInvoiceIssueSetValueOp" >
      <Parameter name="Requested" value="true" />
    </Op>
    <OpChainRoute chainKey="PRE_TENDERING" chainType="START" />
  </OpChain>

  <!-- Scan provider token button pressed -->
  <OpChain name="COUNTRYPACK.TAXFREE_PROVIDER_TOKEN_SCAN">
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.ScanTaxFreeProviderCardOp" breakpoint="true"/>
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_GET_CUSTOMER_BY_PROVIDER_TOKEN" />
    <ValidationOp class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeValidateTravellerOp" validationsBean="countryPack.taxfree.validateReceivedTraveller" />
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.ConfirmCustomerIdentityOp" />
  </OpChain>

  <!-- Remove token information -->
  <OpChain name="COUNTRYPACK.TAXFREE_REMOVE_PROVIDER_TOKEN">
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.RemoveTaxFreeProviderCardOp" />
  </OpChain>

  <!-- Ask for tax free customer information -->
  <OpChain name="COUNTRYPACK.TAXFREE_CUSTOMER_DATA" >
    <ValidationOp class="oracle.retail.xstore.countrypack.common.taxfree.op.PrepareTaxFreeDataOp" validationsBean="countryPack.validateTaxFreeInvoiceRequest" />
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeCommErrorCleanOp" />
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_CHECK_PROVIDER_STATUS_IMPL" />
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeCustomerSummaryOp" breakpoint="true" />
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeRefundSelectionOp" />
  </OpChain>

  <!-- Print tax free form and wait for confirmation -->
  <OpChain name="COUNTRYPACK.TAXFREE_PRINT_CONFIRM">
    <!-- Operation used just to handle the case of printing retry -->
    <Op class="dtv.pos.framework.op.DoNothingAndCompleteOp" breakpoint="true"/>
    <PromptOp class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreePrintFormOp" longRunning="true" />
    <OpChainRoute>
      <Choice chainKey="COUNTRYPACK.TAXFREE_PRINT_REPORT" condition="oracle.retail.xstore.countrypack.common.taxfree.condition.IsTaxFreePdfReportRequest" />
      <Choice chainKey="COUNTRYPACK.TAXFREE_PRINT_REPORT_BACKGROUND" >
        <Condition class="oracle.retail.xstore.countrypack.common.taxfree.condition.IsTaxFreePdfReportRequest">
          <Parameter name="IsBackground" value="true" />
        </Condition>
      </Choice>
    </OpChainRoute>
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreePrintRcptOp" longRunning="true" />
    <PromptOp class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreePrintFromConfirmationOp" />
  </OpChain>

  <!-- Tax free printout using BI report -->
  <OpChain name="COUNTRYPACK.TAXFREE_PRINT_REPORT">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="COUNTRYPACK.TAXFREE" />
    </Op>
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.SetTaxFreeDataSourceOp" />
    <Op class="dtv.pos.reporting.fill.FillReportNoUiOp" />
    <Op class="dtv.pos.reporting.print.PrintReportOp" />
  </OpChain>

  <!-- Tax free printout using BI report with baqckground printing -->
  <OpChain name="COUNTRYPACK.TAXFREE_PRINT_REPORT_BACKGROUND">
    <Op class="dtv.pos.reporting.LoadReportOp">
      <Parameter name="reportName" value="COUNTRYPACK.TAXFREE" />
    </Op>
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.SetTaxFreeDataSourceOp" />
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreePrintFormBackgroundOp" />
  </OpChain>

  <!-- Issue tax free from Electronic Journal -->
  <OpChain name="COUNTRYPACK.TAXFREE_ISSUE_INVOICE_FROM_EJ_IMPL">
    <PromptOp class="oracle.retail.xstore.countrypack.common.invoice.ejournal.op.PromptInvoiceConfirmationOp" key="COUNTRYPACK.TAXFREE_ISSUE_FROM_EJ" >
      <Parameter name="InvoiceType" value="TAX_FREE" />
    </PromptOp>
    <ValidationOp validationsBean="countryPack.taxfree.validateIssueInvoiceFromEj" />
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_ISSUE_INVOICE_FROM_BACKOFFICE" />
  </OpChain>

  <OpChain name="COUNTRYPACK.TAXFREE_ISSUE_INVOICE_FROM_BACKOFFICE" signal="TransactionComplete">
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_CUSTOMER_DATA" />
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.CreateDeferredInvoiceTransactionOp" >
      <Parameter name="LinkTypeCode" value="DEFERRED_TAXFREE_TRANSACTION" />
    </Op>
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeCommErrorCleanOp" />
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_ISSUE_FORM_PROVIDER_IMPL" />
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_PRINT_CONFIRM" />
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.CloseDeferredInvoiceTransactionOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
  </OpChain>

  <!-- Reissue a Tax Free invoice from Electronic Journal -->
  <OpChain name="COUNTRYPACK.TAXFREE_REISSUE_INVOICE_FROM_EJ_IMPL" signal="TransactionComplete">
    <PromptOp class="oracle.retail.xstore.countrypack.common.taxfree.ejournal.op.ConfirmTaxFreeOp" >
      <Parameter name="requestType" value="invoice_reprint" />
    </PromptOp>
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.CreateDeferredInvoiceTransactionOp" >
      <Parameter name="LinkTypeCode" value="REISSUE_TAXFREE_TRANSACTION" />
    </Op>
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeCommErrorCleanOp" />
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_REISSUE_FORM_PROVIDER_IMPL" />
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_PRINT_CONFIRM" />
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.CloseDeferredInvoiceTransactionOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.ClearInvoiceDataOp" />
  </OpChain>

  <!-- Void an invoice from Electronic Journal -->
  <OpChain name="COUNTRYPACK.TAXFREE_VOID_FROM_EJ_IMPL">
    <PromptOp class="oracle.retail.xstore.countrypack.common.taxfree.ejournal.op.ConfirmTaxFreeOp" >
      <Parameter name="requestType" value="invoice_void" />
    </PromptOp>
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.CreateDeferredInvoiceTransactionOp" >
      <Parameter name="LinkTypeCode" value="VOID_TAXFREE_TRANSACTION" />
    </Op>
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeCommErrorCleanOp" />
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_VOID_FORM_PROVIDER_IMPL" />
    <Op class="oracle.retail.xstore.countrypack.common.invoice.op.CloseDeferredInvoiceTransactionOp" />
    <WorkerOp workersBean="persistTransAndObjWorkers" />
  </OpChain>

  <!-- Post void an invoice from Electronic Journal -->
  <OpChain name="COUNTRYPACK.TAXFREE_POST_VOID_MAIN.1.pre">
    <PromptOp class="oracle.retail.xstore.countrypack.common.taxfree.ejournal.op.ConfirmTaxFreeOp" >
      <Parameter name="requestType" value="post_void" />
    </PromptOp>
  </OpChain>

  <OpChain name="COUNTRYPACK.TAXFREE_POST_VOID">
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_VOID_FORM_PROVIDER_IMPL" />
  </OpChain>

  <!-- Tax free consolidation - scan and search by a result list receipts to issue a taxfree invoice  -->
  <OpChain name="COUNTRYPACK.TAXFREE_SCAN_RECEIPT_MENU" >
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_CHECK_PROVIDER_STATUS_IMPL" />
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_SCAN_RECEIPT" chainType="START"/>
  </OpChain>

  <OpChain name="COUNTRYPACK.TAXFREE_SCAN_RECEIPT" contextKey="TAXFREE_RECEIPT_SCAN_CONTEXT_VIEW" rollbackLevel="30" rollbackChainKey="COUNTRYPACK.TAXFREE_PROMPT_CANCEL_RECEIPT_SCAN_CHANGES" >
    <Op class="dtv.pos.register.itemmessages.DisplayInstructionsOp">
      <Parameter name="FILENAME" value="_instructionalTaxFreeMsg" />
    </Op>
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeDisplayPromptAndListOp" />
    <PromptOp class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreePromptReceiptScanOp" contextKey="TAXFREE_RECEIPT_SCAN_CONTEXT_VIEW" />
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeGetReceiptsToConsolidateValidatorOp" />
    <ValidationOp validationsBean="countryPack.taxfree.validateConsolidateInvoiceByReceipt" />
    <ValidationOp validationsBean="countryPack.validateTaxFreeReceipts" />
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeAddReceiptToListOp"/>
  </OpChain>

  <OpChain name="COUNTRYPACK.TAXFREE_PROMPT_CANCEL_RECEIPT_SCAN_CHANGES" >
    <PromptOp class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreePromptCancelReceiptsScanOp" />
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeOpChainRollbackOp" />
  </OpChain>

  <OpChain name="COUNTRYPACK.TAXFREE_CONSOLIDATE" rollbackLevel="40">
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreePromptTranSearchOp" breakpoint="true" />
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_CONSOLIDATE_VIEW" chainType="START" />
  </OpChain>
  <OpChain name="COUNTRYPACK.TAXFREE_CONSOLIDATE_VIEW" rollbackLevel="50">
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeViewTransOp" />
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_CONSOLIDATE_VIEW_VALIDATE" />
  </OpChain>

  <OpChain name="COUNTRYPACK.TAXFREE_CONSOLIDATE_VIEW_VALIDATE" >
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeGetReceiptsToConsolidateValidatorOp" />
    <ValidationOp validationsBean="countryPack.taxfree.validateConsolidateInvoiceByReceipt" />
    <ValidationOp validationsBean="countryPack.validateTaxFreeReceipts" />
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeReadScopeOp" />
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_SCAN_RECEIPT" chainType="START"/>
  </OpChain>

  <OpChain name="COUNTRYPACK.TAXFREE_REMOVE_RECEIPT">
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeGetSelectedReceiptOp" />
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeRemoveReceiptOp" />
  </OpChain>

  <OpChain name="COUNTRYPACK.TAXFREE_PREPARE_RECEIPTS_TO_ISSUE_TAXFREE_INVOICE">
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreePrepareReceiptsToTaxFreeInvoiceOp" />
    <ValidationOp validationsBean="countryPack.taxfree.validateConsolidateInvoice" />
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeInvoiceIssueSetValueOp" >
      <Parameter name="Requested" value="true" />
    </Op>
    <OpChainRoute chainKey="COUNTRYPACK.TAXFREE_ISSUE_INVOICE_FROM_BACKOFFICE" />
    <Op class="oracle.retail.xstore.countrypack.common.taxfree.op.TaxFreeOpChainRollbackOp" />
  </OpChain>

  <!-- Chains defined by each provider -->
  <OpChain name="COUNTRYPACK.TAXFREE_CHECK_PROVIDER_STATUS_IMPL" />
  <OpChain name="COUNTRYPACK.TAXFREE_ISSUE_FORM_PROVIDER_IMPL" />
  <OpChain name="COUNTRYPACK.TAXFREE_REISSUE_FORM_PROVIDER_IMPL" />
  <OpChain name="COUNTRYPACK.TAXFREE_VOID_FORM_PROVIDER_IMPL" />
  <OpChain name="COUNTRYPACK.TAXFREE_VOID_FORM_ON_SALE_PROVIDER_IMPL" />
  <OpChain name="COUNTRYPACK.TAXFREE_PRINT_FORM_PROVIDER_IMPL" />
  <OpChain name="COUNTRYPACK.TAXFREE_PROVIDER_CHECK_CARD_ELIGIBLE" />
  <OpChain name="COUNTRYPACK.TAXFREE_GET_CUSTOMER_BY_PROVIDER_TOKEN" />
  <!-- COUNTRYPACK TAXFREE END -->

  <!-- PORTUGAL START -->
  <OpChain name="COUNTRYPACK.PT.SAFT_GENERATE" >
    <Op class="oracle.retail.xstore.countrypack.pt.saft.op.SaftFileEnterParametersOp" />
    <Op class="oracle.retail.xstore.countrypack.pt.saft.op.SaftFileExportOp" longRunning="true" />
  </OpChain>

  <OpChain name="COUNTRYPACK.PT.HANDLE_AT_CODE" >
    <Op class="oracle.retail.xstore.countrypack.pt.shipping.op.PtRetrieveShippingATCodeOp" longRunning="true" />
    <PromptOp class="oracle.retail.xstore.countrypack.pt.shipping.op.PtCheckATCodeOp" />
    <Op class="oracle.retail.xstore.countrypack.pt.shipping.op.PtManualATCodeFormOp" />
  </OpChain>
  <!-- PORTUGAL END -->

  <!-- SPAIN START -->
  <OpChain name="COUNTRYPACK.ES.FACTURACOMPLETA">
    <OpChainRoute chainKey="COUNTRYPACK.COMMON.REQUESTINVOICE" />
  </OpChain>
  <!-- SPAIN END -->

  <OpChain name="COUNTRYPACK.COMMON.REQUESTINVOICE">
    <Op class="oracle.retail.xstore.countrypack.common.register.op.SetFacturaCompletaOp" />
    <OpChainRoute chainKey="PRE_TENDERING" chainType="START" />
  </OpChain>

  <OpChain name="VIEW_ORIGINAL_TRANSACTION" >
    <PromptOp class="dtv.pos.register.returns.verification.VerifiedReturnItemListSelectionOp" breakpoint="true" validationsBean="returnListSelectionRules"/>
    <PromptOp class="dtv.pos.register.returns.verification.PromptVerifiedReturnReasonCodeOp" />
    <Op class="dtv.pos.register.returns.verification.VerifiedReturnIteratingOp">
      <Parameter name="ChainKey" value="VERIFIED_RETURN_ITEM_IMPL.pre" />
    </Op>
  </OpChain>

  <OpChain name="AIRPORT_PRE_SALE">
    <Op class="dtv.pos.flight.op.FlightInfoInsertWhileOp" >
      <Parameter name="ChainKey" value="AIRPORT_FLIGHT_INFO_SINGLE" />
    </Op>
    <Op class="dtv.pos.flight.op.ReBuildAirportTabOp"/>
  </OpChain>

  <OpChain name="AIRPORT_FLIGHT_INFO_SINGLE">
    <Op class="dtv.pos.flight.op.FlightInformationVerifyOp" breakpoint="true"/>
    <OpChainRoute chainKey="AIRPORT_FLIGHT_VALIDATIONS" condition="dtv.pos.flight.FlightPassengerCondition"/>
    <Op class="dtv.pos.flight.op.AirportStaffSelectionOp" />
    <Op class="dtv.pos.flight.op.SetCurrentFlightInfoOp" />
    <Op class="dtv.pos.flight.op.FlightAskMoreFlightsPromptOp" />
    <PromptOp class="dtv.pos.flight.op.DisplayFlightInfo" />
    <Op class="dtv.pos.flight.op.CreateAirsideTransactionOp">
      <Parameter name="TransactionType" value="RETAIL_SALE"/>
    </Op>
  </OpChain>

  <OpChain name="AIRPORT_FLIGHT_VALIDATIONS" >
    <ValidationOp class="dtv.pos.flight.op.FlightValidationOp" validationsBean="flightValidations" />
    <PromptOp class="dtv.pos.flight.op.FlightAskConfirmationPromptOp">
      <Parameter name="validatorId" value="flightScheduledDateOutsideWarn" />
    </PromptOp>
    <PromptOp class="dtv.pos.flight.op.FlightAskConfirmationPromptOp">
      <Parameter name="validatorId" value="currentFlightMissing" />
    </PromptOp>
  </OpChain>

  <OpChain name="RESUME_TRANSACTION_AIRSIDE">
    <PromptOp class="dtv.pos.register.suspendresume.PromptSuspendedTransOp" breakpoint="true" />
    <OpChainRoute chainKey="AIRPORT_RESUME_TRANSACTION" condition="dtv.pos.flight.AirsideEnabledCondition" />
    <OpChainRoute chainKey="RESUME_TRANSACTION_IMPL" />
    <Op class="dtv.pos.flight.op.ReBuildAirportTabOp"/>
    <OpChainRoute chainKey="BACKTO_SALE_ITEM" chainType="START" />
  </OpChain>


  <OpChain name="AIRPORT_RESUME_TRANSACTION" >
    <Op class="dtv.pos.flight.resumetransactions.op.SetResumeStateOp" />
    <Op class="dtv.pos.flight.resumetransactions.op.BoardingPassConfirmationOp" breakpoint="true"/>
    <Op class="dtv.pos.flight.resumetransactions.op.StaffConfirmationOp" breakpoint="true"/>
    <Op class="dtv.pos.flight.resumetransactions.op.ArrivalsConfirmationPromptOp" />
    <ValidationOp class="dtv.pos.flight.op.FlightValidationOp" validationsBean="resumeTranValidations" />
  </OpChain>

  <OpChain name="UPDATE_PROMPTS">
    <PromptOp class="dtv.pos.register.UpdateAvailableGraceOp" contextKey="RETURN" />
    <PromptOp class="dtv.pos.register.UpdateWarningOp">
      <Parameter name="updateChain" value="RUN_UPDATES"/>
    </PromptOp>
    <ValidationOp validationsBean="isNotInUpdateRequiredPeriodValidations"/>
  </OpChain>

  <OpChain name="UPDATE_PROMPTS_ROLLBACK">
    <PromptOp class="dtv.pos.register.UpdateAvailableGraceOp" contextKey="RETURN"/>
    <PromptOp class="dtv.pos.register.UpdateWarningOp">
      <Parameter name="updateChain" value="RUN_UPDATES_ROLLBACK"/>
    </PromptOp>
    <ValidationOp validationsBean="isNotInUpdateRequiredPeriodValidations"/>
  </OpChain>

  <OpChain name="RUN_UPDATES">
    <Op class="dtv.pos.appmanagement.op.SendIpcMessageOp">
      <Parameter name="SERVICE" value="xstore" />
      <Parameter name="METHOD" value="INIT_DO_INVASIVE_UPDATES" />
    </Op>
  </OpChain>

  <OpChain name="RUN_UPDATES_ROLLBACK">
    <Op class="dtv.pos.appmanagement.op.SendIpcMessageOp">
      <Parameter name="SERVICE" value="xstore" />
      <Parameter name="METHOD" value="INIT_DO_INVASIVE_UPDATES" />
    </Op>
    <Op class="dtv.pos.framework.op.OpChainRollbackToTopOp" />
  </OpChain>

  <!-- - - - - - - - - - - - - - - - - - - - - -->
  <!-- START OF EXCHANGE SERIAL NUMBER CHAINS  -->
  <!-- - - - - - - - - - - - - - - - - - - - - -->

  <OpChain name="PRE_SERIAL_EXCHANGE_CHAIN" rollbackChainKey="SERIAL_EXCHANGE_ROLLBACK_TRANS_PROMPT" chainType="START">
    <Op class="dtv.pos.common.op.CreateTransactionAsNeededOp">
      <Parameter name="TransactionType" value="SERIAL_EXCHANGE" />
    </Op>
    <Op class="dtv.pos.inventory.serialexchange.PromptExchangeCustomerInfoOp" required="true" />
    <OpChainRoute chainKey="EXCHANGE_SERIAL_NUMBER"/>
  </OpChain>

  <OpChain name="EXCHANGE_SERIAL_NUMBER">
    <Op class="dtv.pos.inventory.serialexchange.PromptExchangeSerialNumReceiptOp" breakpoint="true">
      <Parameter name="SERIALIZED_ITEM" value="EXCHANGE_BY_SERIAL_NUMBER_SEARCH" />
    </Op>
    <OpChainRoute chainKey="EXCHANGE_SERIAL"/>
  </OpChain>
  <OpChain name="EXCHANGE_BY_SERIAL_NUMBER_SEARCH" rollbackChainKey="EXCHANGE_SERIAL_NUMBER">
    <PromptOp class="dtv.pos.inventory.serialexchange.PromptSerialNumberSearchOp"/>
    <OpChainRoute chainKey="EXCHANGE_SERIAL"/>
  </OpChain>

  <OpChain name="EXCHANGE_SERIAL_ITEM_PROCESS" rollbackChainKey="SERIAL_EXCHANGE_ROLLBACK_TRANS_PROMPT">
    <PromptOp class="dtv.pos.inventory.serialexchange.PromptExchangeSerialItemSelectionOp" breakpoint="true" />
    <PromptOp class="dtv.pos.inventory.serialexchange.PromptExchangeReasonCodeOp" />
    <Op class="dtv.pos.inventory.serialexchange.PromptExchangeItemSerialNumberOp" />
    <ValidationOp validationsBean="serialNumberExchangeRules" />
    <Op class="dtv.pos.inventory.serialexchange.inventory.CreateSerialExchangeLineItemOp"></Op>
    <Op class="dtv.pos.inventory.serialexchange.inventory.CreateInventoryLocationModOp"></Op>
    <Op class="dtv.pos.inventory.serialexchange.inventory.HandleKitComponentInventoryOp"></Op>
    <Op class="dtv.pos.inventory.serialexchange.inventory.UpdateOriginalTransaction"/>
    <Op class="dtv.pos.inventory.serialexchange.AddExchangeItemToTransaction"></Op>
    <PromptOp class="dtv.pos.inventory.serialexchange.PromptExchangeMoreItemOp"/>
    <PromptOp class="dtv.pos.inventory.serialexchange.PromptContinueExchange"/>
    <OpChainRoute chainKey="EXCHANGE_SERIAL_PRE_TENDER" chainType="START" />
  </OpChain>

   <OpChain name="EXCHANGE_SERIAL" chainType="START">
    <Op class="dtv.pos.inventory.serialexchange.ExchangeSerialNumberOp" />
    <OpChainRoute chainKey="EXCHANGE_SERIAL_ITEM_PROCESS" chainType="START"/>
  </OpChain>

  <OpChain name="EXCHANGE_SERIAL_PRE_TENDER" signal="TransactionModified">
   <Op class="dtv.pos.inventory.NewProcessInventoryOp" />
    <OpChainRoute chainKey="EXCHANGE_TRANSACTION_COMPLETE" />
    <OpChainRoute chainKey="MENU_TRAVERSAL_FORWARD" chainType="START" />
  </OpChain>

  <OpChain name="EXCHANGE_TRANSACTION_COMPLETE" signal="TransactionComplete">
    <WorkerOp workersBean="completeTransactionWorkers" />
    <Op class="dtv.pos.hardware.op.BuildRcptsOp" />
    <Op class="dtv.pos.hardware.op.BuildExchangeRcptsOp" />
    <WorkerOp workersBean="persistExchangeSerialTransAndObjWorkers" />
    <WorkerOp workersBean="emailRcptsWorkers" />
    <Op class="dtv.pos.hardware.op.PrintRcptsOp" />
    <WorkerOp workersBean="saveRcptsWorkers" />
    <WorkerOp workersBean="persistSystemTotalWorkers" />
    <OpChainRoute chainKey="RESET_REGISTER" />
    <Op class="dtv.pos.hardware.op.WaitForRcptPrintOp" required="false" />
    <OpChainRoute chainKey="PRINT_FISCAL_RECEIPTS.local" />
  </OpChain>

  <OpChain name="SERIAL_EXCHANGE_ROLLBACK_TRANS_PROMPT" chainType="START">
    <OpChainRoute chainKey="VALIDATE_ALLOW_ROLLBACK_TRANS" />
    <Op class="dtv.pos.inventory.serialexchange.PromptSerialExchangeRollbackTransOp" />
  </OpChain>

  <OpChain name="SERIAL_EXCHANGE_ROLLBACK_TRANS_START">
    <OpChainRoute chainKey="SERIAL_EXCHANGE_ROLLBACK_TRANS_START_IMPL" />
    <OpChainRoute chainKey="SERIAL_EXCHANGE_ROLLBACK_TRANS_FINISH" chainType="START" />
  </OpChain>

  <OpChain name="SERIAL_EXCHANGE_ROLLBACK_TRANS_START_IMPL">
  </OpChain>
    <OpChain name="SERIAL_EXCHANGE_RESET_AFTER_TRANS">
    <Op class="dtv.pos.framework.op.OpChainRollbackToTopOp">
      <Parameter name="ProcessTopChain" value="false" />
    </Op>
    <OpChainRoute chainKey="UPDATE_PROMPTS" condition="dtv.pos.register.condition.RegisterNotInTrainingModeRunCondition" />
    <WorkerOp workersBean="registerWorkstationActiveWorkers" />
    <WorkerOp workersBean="saveSystemTimeWorkers" />
    <PromptOp class="dtv.pos.register.StoreCloseWarningOp" key="WORKSTATION_WARNING" />
    <PromptOp class="dtv.pos.register.StoreCloseGraceOp" key="WORKSTATION_GRACE" />
    <PromptOp class="dtv.pos.register.StoreCloseGraceExpiredOp" key="WORKSTATION_GRACE_EXPIRED" />
    <Op class="dtv.pos.systemcycle.access.EndOfDayTimeCheckOp" />
    <OpChainRoute chainKey="MENU_TRAVERSAL_FORWARD" chainType="START" />
  </OpChain>
  <OpChain name="SERIAL_EXCHANGE_ROLLBACK_TRANS_FINISH" signal="TransactionCancelled">
    <OpChainRoute chainKey="ROLLBACK_TRANS_FINISH_IMPL" />
    <OpChainRoute chainKey="RESET_REGISTER" />
    <OpChainRoute chainKey="SERIAL_EXCHANGE_RESET_AFTER_TRANS" chainType="START" />
  </OpChain>

  <!-- - - - - - - - - - - - - - - - - - - -->
  <!-- END OF EXCHANGE SERIAL NUMBER CHAINS -->
  <!-- - - - - - - - - - - - - - - - - - - -->


  <!--
  *** Please leave these at the end of the file ***
  *** SAMPLE OF LAUNCHING AN APP FROM XSTORE ***
  *** Also look at MenuConfig.xml ***
  <OpChain name="EXECUTE_WORD">
    <Op class="dtv.pos.framework.process.ExecOp">
      <Parameter name="processKey" value="WORD" />
      <Parameter name="executableDir" value="c:/Program Files/Microsoft Office/Office10" />
      <Parameter name="executable" value="winword.exe" />
      <Parameter name="arg" value="/n" />
      <Parameter name="arg" value="/f" />
      <Parameter name="workingDir" value="${user.home}" />
      <Parameter name="env" value="ANT_HOME=/bin/ant" />
      <Parameter name="outputFile" value="${user.dir}/log/wordout.log" />
      <Parameter name="appendOutput" value="true" />
      <Parameter name="allowMultiple" value="false" />
      <Parameter name="continueOnError" value="false" />
    </Op>
  </OpChain>

  *** End Sample ***
  -->
</OpChainSet>
